function DS(e,t){for(var s=0;s<t.length;s++){const r=t[s];if(typeof r!="string"&&!Array.isArray(r)){for(const l in r)if(l!=="default"&&!(l in e)){const u=Object.getOwnPropertyDescriptor(r,l);u&&Object.defineProperty(e,l,u.get?u:{enumerable:!0,get:()=>r[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}})();var No=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function au(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pd={exports:{}},ll={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hv;function wS(){if(Hv)return ll;Hv=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(r,l,u){var d=null;if(u!==void 0&&(d=""+u),l.key!==void 0&&(d=""+l.key),"key"in l){u={};for(var h in l)h!=="key"&&(u[h]=l[h])}else u=l;return l=u.ref,{$$typeof:e,type:r,key:d,ref:l!==void 0?l:null,props:u}}return ll.Fragment=t,ll.jsx=s,ll.jsxs=s,ll}var Vv;function MS(){return Vv||(Vv=1,pd.exports=wS()),pd.exports}var it=MS(),vd={exports:{}},Pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qv;function OS(){if(qv)return Pe;qv=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.iterator;function S(T){return T===null||typeof T!="object"?null:(T=b&&T[b]||T["@@iterator"],typeof T=="function"?T:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,M={};function j(T,P,I){this.props=T,this.context=P,this.refs=M,this.updater=I||C}j.prototype.isReactComponent={},j.prototype.setState=function(T,P){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,P,"setState")},j.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function le(){}le.prototype=j.prototype;function oe(T,P,I){this.props=T,this.context=P,this.refs=M,this.updater=I||C}var ie=oe.prototype=new le;ie.constructor=oe,D(ie,j.prototype),ie.isPureReactComponent=!0;var se=Array.isArray,ae={H:null,A:null,T:null,S:null},Ne=Object.prototype.hasOwnProperty;function nt(T,P,I,U,B,z){return I=z.ref,{$$typeof:e,type:T,key:P,ref:I!==void 0?I:null,props:z}}function we(T,P){return nt(T.type,P,void 0,void 0,void 0,T.props)}function ee(T){return typeof T=="object"&&T!==null&&T.$$typeof===e}function Re(T){var P={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(I){return P[I]})}var vt=/\/+/g;function gt(T,P){return typeof T=="object"&&T!==null&&T.key!=null?Re(""+T.key):P.toString(36)}function bt(){}function wt(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(bt,bt):(T.status="pending",T.then(function(P){T.status==="pending"&&(T.status="fulfilled",T.value=P)},function(P){T.status==="pending"&&(T.status="rejected",T.reason=P)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function de(T,P,I,U,B){var z=typeof T;(z==="undefined"||z==="boolean")&&(T=null);var V=!1;if(T===null)V=!0;else switch(z){case"bigint":case"string":case"number":V=!0;break;case"object":switch(T.$$typeof){case e:case t:V=!0;break;case g:return V=T._init,de(V(T._payload),P,I,U,B)}}if(V)return B=B(T),V=U===""?"."+gt(T,0):U,se(B)?(I="",V!=null&&(I=V.replace(vt,"$&/")+"/"),de(B,P,I,"",function(Ae){return Ae})):B!=null&&(ee(B)&&(B=we(B,I+(B.key==null||T&&T.key===B.key?"":(""+B.key).replace(vt,"$&/")+"/")+V)),P.push(B)),1;V=0;var Q=U===""?".":U+":";if(se(T))for(var X=0;X<T.length;X++)U=T[X],z=Q+gt(U,X),V+=de(U,P,I,z,B);else if(X=S(T),typeof X=="function")for(T=X.call(T),X=0;!(U=T.next()).done;)U=U.value,z=Q+gt(U,X++),V+=de(U,P,I,z,B);else if(z==="object"){if(typeof T.then=="function")return de(wt(T),P,I,U,B);throw P=String(T),Error("Objects are not valid as a React child (found: "+(P==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":P)+"). If you meant to render a collection of children, use an array instead.")}return V}function te(T,P,I){if(T==null)return T;var U=[],B=0;return de(T,U,"","",function(z){return P.call(I,z,B++)}),U}function pe(T){if(T._status===-1){var P=T._result;P=P(),P.then(function(I){(T._status===0||T._status===-1)&&(T._status=1,T._result=I)},function(I){(T._status===0||T._status===-1)&&(T._status=2,T._result=I)}),T._status===-1&&(T._status=0,T._result=P)}if(T._status===1)return T._result.default;throw T._result}var A=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var P=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(P))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)};function w(){}return Pe.Children={map:te,forEach:function(T,P,I){te(T,function(){P.apply(this,arguments)},I)},count:function(T){var P=0;return te(T,function(){P++}),P},toArray:function(T){return te(T,function(P){return P})||[]},only:function(T){if(!ee(T))throw Error("React.Children.only expected to receive a single React element child.");return T}},Pe.Component=j,Pe.Fragment=s,Pe.Profiler=l,Pe.PureComponent=oe,Pe.StrictMode=r,Pe.Suspense=p,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ae,Pe.act=function(){throw Error("act(...) is not supported in production builds of React.")},Pe.cache=function(T){return function(){return T.apply(null,arguments)}},Pe.cloneElement=function(T,P,I){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var U=D({},T.props),B=T.key,z=void 0;if(P!=null)for(V in P.ref!==void 0&&(z=void 0),P.key!==void 0&&(B=""+P.key),P)!Ne.call(P,V)||V==="key"||V==="__self"||V==="__source"||V==="ref"&&P.ref===void 0||(U[V]=P[V]);var V=arguments.length-2;if(V===1)U.children=I;else if(1<V){for(var Q=Array(V),X=0;X<V;X++)Q[X]=arguments[X+2];U.children=Q}return nt(T.type,B,void 0,void 0,z,U)},Pe.createContext=function(T){return T={$$typeof:d,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:u,_context:T},T},Pe.createElement=function(T,P,I){var U,B={},z=null;if(P!=null)for(U in P.key!==void 0&&(z=""+P.key),P)Ne.call(P,U)&&U!=="key"&&U!=="__self"&&U!=="__source"&&(B[U]=P[U]);var V=arguments.length-2;if(V===1)B.children=I;else if(1<V){for(var Q=Array(V),X=0;X<V;X++)Q[X]=arguments[X+2];B.children=Q}if(T&&T.defaultProps)for(U in V=T.defaultProps,V)B[U]===void 0&&(B[U]=V[U]);return nt(T,z,void 0,void 0,null,B)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(T){return{$$typeof:h,render:T}},Pe.isValidElement=ee,Pe.lazy=function(T){return{$$typeof:g,_payload:{_status:-1,_result:T},_init:pe}},Pe.memo=function(T,P){return{$$typeof:v,type:T,compare:P===void 0?null:P}},Pe.startTransition=function(T){var P=ae.T,I={};ae.T=I;try{var U=T(),B=ae.S;B!==null&&B(I,U),typeof U=="object"&&U!==null&&typeof U.then=="function"&&U.then(w,A)}catch(z){A(z)}finally{ae.T=P}},Pe.unstable_useCacheRefresh=function(){return ae.H.useCacheRefresh()},Pe.use=function(T){return ae.H.use(T)},Pe.useActionState=function(T,P,I){return ae.H.useActionState(T,P,I)},Pe.useCallback=function(T,P){return ae.H.useCallback(T,P)},Pe.useContext=function(T){return ae.H.useContext(T)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(T,P){return ae.H.useDeferredValue(T,P)},Pe.useEffect=function(T,P){return ae.H.useEffect(T,P)},Pe.useId=function(){return ae.H.useId()},Pe.useImperativeHandle=function(T,P,I){return ae.H.useImperativeHandle(T,P,I)},Pe.useInsertionEffect=function(T,P){return ae.H.useInsertionEffect(T,P)},Pe.useLayoutEffect=function(T,P){return ae.H.useLayoutEffect(T,P)},Pe.useMemo=function(T,P){return ae.H.useMemo(T,P)},Pe.useOptimistic=function(T,P){return ae.H.useOptimistic(T,P)},Pe.useReducer=function(T,P,I){return ae.H.useReducer(T,P,I)},Pe.useRef=function(T){return ae.H.useRef(T)},Pe.useState=function(T){return ae.H.useState(T)},Pe.useSyncExternalStore=function(T,P,I){return ae.H.useSyncExternalStore(T,P,I)},Pe.useTransition=function(){return ae.H.useTransition()},Pe.version="19.0.0",Pe}var Fv;function rh(){return Fv||(Fv=1,vd.exports=OS()),vd.exports}var Xe=rh();const $v=au(Xe);var gd={exports:{}},ol={},md={exports:{}},yd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yv;function LS(){return Yv||(Yv=1,function(e){function t(te,pe){var A=te.length;te.push(pe);e:for(;0<A;){var w=A-1>>>1,T=te[w];if(0<l(T,pe))te[w]=pe,te[A]=T,A=w;else break e}}function s(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var pe=te[0],A=te.pop();if(A!==pe){te[0]=A;e:for(var w=0,T=te.length,P=T>>>1;w<P;){var I=2*(w+1)-1,U=te[I],B=I+1,z=te[B];if(0>l(U,A))B<T&&0>l(z,U)?(te[w]=z,te[B]=A,w=B):(te[w]=U,te[I]=A,w=I);else if(B<T&&0>l(z,A))te[w]=z,te[B]=A,w=B;else break e}}return pe}function l(te,pe){var A=te.sortIndex-pe.sortIndex;return A!==0?A:te.id-pe.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var d=Date,h=d.now();e.unstable_now=function(){return d.now()-h}}var p=[],v=[],g=1,b=null,S=3,C=!1,D=!1,M=!1,j=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;function ie(te){for(var pe=s(v);pe!==null;){if(pe.callback===null)r(v);else if(pe.startTime<=te)r(v),pe.sortIndex=pe.expirationTime,t(p,pe);else break;pe=s(v)}}function se(te){if(M=!1,ie(te),!D)if(s(p)!==null)D=!0,wt();else{var pe=s(v);pe!==null&&de(se,pe.startTime-te)}}var ae=!1,Ne=-1,nt=5,we=-1;function ee(){return!(e.unstable_now()-we<nt)}function Re(){if(ae){var te=e.unstable_now();we=te;var pe=!0;try{e:{D=!1,M&&(M=!1,le(Ne),Ne=-1),C=!0;var A=S;try{t:{for(ie(te),b=s(p);b!==null&&!(b.expirationTime>te&&ee());){var w=b.callback;if(typeof w=="function"){b.callback=null,S=b.priorityLevel;var T=w(b.expirationTime<=te);if(te=e.unstable_now(),typeof T=="function"){b.callback=T,ie(te),pe=!0;break t}b===s(p)&&r(p),ie(te)}else r(p);b=s(p)}if(b!==null)pe=!0;else{var P=s(v);P!==null&&de(se,P.startTime-te),pe=!1}}break e}finally{b=null,S=A,C=!1}pe=void 0}}finally{pe?vt():ae=!1}}}var vt;if(typeof oe=="function")vt=function(){oe(Re)};else if(typeof MessageChannel<"u"){var gt=new MessageChannel,bt=gt.port2;gt.port1.onmessage=Re,vt=function(){bt.postMessage(null)}}else vt=function(){j(Re,0)};function wt(){ae||(ae=!0,vt())}function de(te,pe){Ne=j(function(){te(e.unstable_now())},pe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(te){te.callback=null},e.unstable_continueExecution=function(){D||C||(D=!0,wt())},e.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):nt=0<te?Math.floor(1e3/te):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return s(p)},e.unstable_next=function(te){switch(S){case 1:case 2:case 3:var pe=3;break;default:pe=S}var A=S;S=pe;try{return te()}finally{S=A}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(te,pe){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var A=S;S=te;try{return pe()}finally{S=A}},e.unstable_scheduleCallback=function(te,pe,A){var w=e.unstable_now();switch(typeof A=="object"&&A!==null?(A=A.delay,A=typeof A=="number"&&0<A?w+A:w):A=w,te){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=A+T,te={id:g++,callback:pe,priorityLevel:te,startTime:A,expirationTime:T,sortIndex:-1},A>w?(te.sortIndex=A,t(v,te),s(p)===null&&te===s(v)&&(M?(le(Ne),Ne=-1):M=!0,de(se,A-w))):(te.sortIndex=T,t(p,te),D||C||(D=!0,wt())),te},e.unstable_shouldYield=ee,e.unstable_wrapCallback=function(te){var pe=S;return function(){var A=S;S=pe;try{return te.apply(this,arguments)}finally{S=A}}}}(yd)),yd}var Kv;function IS(){return Kv||(Kv=1,md.exports=LS()),md.exports}var bd={exports:{}},Kt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv;function NS(){if(Qv)return Kt;Qv=1;var e=rh();function t(p){var v="https://react.dev/errors/"+p;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)v+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var r={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(p,v,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:b==null?null:""+b,children:p,containerInfo:v,implementation:g}}var d=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,v){if(p==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return Kt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kt.createPortal=function(p,v){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(t(299));return u(p,v,null,g)},Kt.flushSync=function(p){var v=d.T,g=r.p;try{if(d.T=null,r.p=2,p)return p()}finally{d.T=v,r.p=g,r.d.f()}},Kt.preconnect=function(p,v){typeof p=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,r.d.C(p,v))},Kt.prefetchDNS=function(p){typeof p=="string"&&r.d.D(p)},Kt.preinit=function(p,v){if(typeof p=="string"&&v&&typeof v.as=="string"){var g=v.as,b=h(g,v.crossOrigin),S=typeof v.integrity=="string"?v.integrity:void 0,C=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;g==="style"?r.d.S(p,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:C}):g==="script"&&r.d.X(p,{crossOrigin:b,integrity:S,fetchPriority:C,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},Kt.preinitModule=function(p,v){if(typeof p=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var g=h(v.as,v.crossOrigin);r.d.M(p,{crossOrigin:g,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&r.d.M(p)},Kt.preload=function(p,v){if(typeof p=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var g=v.as,b=h(g,v.crossOrigin);r.d.L(p,g,{crossOrigin:b,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},Kt.preloadModule=function(p,v){if(typeof p=="string")if(v){var g=h(v.as,v.crossOrigin);r.d.m(p,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:g,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else r.d.m(p)},Kt.requestFormReset=function(p){r.d.r(p)},Kt.unstable_batchedUpdates=function(p,v){return p(v)},Kt.useFormState=function(p,v,g){return d.H.useFormState(p,v,g)},Kt.useFormStatus=function(){return d.H.useHostTransitionStatus()},Kt.version="19.0.0",Kt}var Wv;function US(){if(Wv)return bd.exports;Wv=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),bd.exports=NS(),bd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jv;function xS(){if(Jv)return ol;Jv=1;var e=IS(),t=rh(),s=US();function r(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}var u=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),C=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),le=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),se=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function Ne(i){return i===null||typeof i!="object"?null:(i=ae&&i[ae]||i["@@iterator"],typeof i=="function"?i:null)}var nt=Symbol.for("react.client.reference");function we(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===nt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case p:return"Fragment";case h:return"Portal";case g:return"Profiler";case v:return"StrictMode";case M:return"Suspense";case j:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case C:return(i.displayName||"Context")+".Provider";case S:return(i._context.displayName||"Context")+".Consumer";case D:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case le:return n=i.displayName||null,n!==null?n:we(i.type)||"Memo";case oe:n=i._payload,i=i._init;try{return we(i(n))}catch{}}return null}var ee=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Re=Object.assign,vt,gt;function bt(i){if(vt===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);vt=n&&n[1]||"",gt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+vt+i+gt}var wt=!1;function de(i,n){if(!i||wt)return"";wt=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(q){var H=q}Reflect.construct(i,[],J)}else{try{J.call()}catch(q){H=q}i.call(J.prototype)}}else{try{throw Error()}catch(q){H=q}(J=i())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(q){if(q&&H&&typeof q.stack=="string")return[q.stack,H.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=o.DetermineComponentFrameRoot(),m=f[0],E=f[1];if(m&&E){var _=m.split(`
`),N=E.split(`
`);for(c=o=0;o<_.length&&!_[o].includes("DetermineComponentFrameRoot");)o++;for(;c<N.length&&!N[c].includes("DetermineComponentFrameRoot");)c++;if(o===_.length||c===N.length)for(o=_.length-1,c=N.length-1;1<=o&&0<=c&&_[o]!==N[c];)c--;for(;1<=o&&0<=c;o--,c--)if(_[o]!==N[c]){if(o!==1||c!==1)do if(o--,c--,0>c||_[o]!==N[c]){var F=`
`+_[o].replace(" at new "," at ");return i.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",i.displayName)),F}while(1<=o&&0<=c);break}}}finally{wt=!1,Error.prepareStackTrace=a}return(a=i?i.displayName||i.name:"")?bt(a):""}function te(i){switch(i.tag){case 26:case 27:case 5:return bt(i.type);case 16:return bt("Lazy");case 13:return bt("Suspense");case 19:return bt("SuspenseList");case 0:case 15:return i=de(i.type,!1),i;case 11:return i=de(i.type.render,!1),i;case 1:return i=de(i.type,!0),i;default:return""}}function pe(i){try{var n="";do n+=te(i),i=i.return;while(i);return n}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function A(i){var n=i,a=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(a=n.return),i=n.return;while(i)}return n.tag===3?a:null}function w(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function T(i){if(A(i)!==i)throw Error(r(188))}function P(i){var n=i.alternate;if(!n){if(n=A(i),n===null)throw Error(r(188));return n!==i?null:i}for(var a=i,o=n;;){var c=a.return;if(c===null)break;var f=c.alternate;if(f===null){if(o=c.return,o!==null){a=o;continue}break}if(c.child===f.child){for(f=c.child;f;){if(f===a)return T(c),i;if(f===o)return T(c),n;f=f.sibling}throw Error(r(188))}if(a.return!==o.return)a=c,o=f;else{for(var m=!1,E=c.child;E;){if(E===a){m=!0,a=c,o=f;break}if(E===o){m=!0,o=c,a=f;break}E=E.sibling}if(!m){for(E=f.child;E;){if(E===a){m=!0,a=f,o=c;break}if(E===o){m=!0,o=f,a=c;break}E=E.sibling}if(!m)throw Error(r(189))}}if(a.alternate!==o)throw Error(r(190))}if(a.tag!==3)throw Error(r(188));return a.stateNode.current===a?i:n}function I(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=I(i),n!==null)return n;i=i.sibling}return null}var U=Array.isArray,B=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},V=[],Q=-1;function X(i){return{current:i}}function Ae(i){0>Q||(i.current=V[Q],V[Q]=null,Q--)}function ue(i,n){Q++,V[Q]=i.current,i.current=n}var Te=X(null),Be=X(null),je=X(null),ii=X(null);function Ut(i,n){switch(ue(je,n),ue(Be,i),ue(Te,null),i=n.nodeType,i){case 9:case 11:n=(n=n.documentElement)&&(n=n.namespaceURI)?mv(n):0;break;default:if(i=i===8?n.parentNode:n,n=i.tagName,i=i.namespaceURI)i=mv(i),n=yv(i,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}Ae(Te),ue(Te,n)}function Ht(){Ae(Te),Ae(Be),Ae(je)}function oi(i){i.memoizedState!==null&&ue(ii,i);var n=Te.current,a=yv(n,i.type);n!==a&&(ue(Be,i),ue(Te,a))}function ct(i){Be.current===i&&(Ae(Te),Ae(Be)),ii.current===i&&(Ae(ii),il._currentValue=z)}var st=Object.prototype.hasOwnProperty,Cs=e.unstable_scheduleCallback,zn=e.unstable_cancelCallback,lr=e.unstable_shouldYield,Jt=e.unstable_requestPaint,Rt=e.unstable_now,Hn=e.unstable_getCurrentPriorityLevel,De=e.unstable_ImmediatePriority,Me=e.unstable_UserBlockingPriority,me=e.unstable_NormalPriority,Ve=e.unstable_LowPriority,at=e.unstable_IdlePriority,Xt=e.log,Ue=e.unstable_setDisableYieldValue,ve=null,We=null;function Zi(i){if(We&&typeof We.onCommitFiberRoot=="function")try{We.onCommitFiberRoot(ve,i,void 0,(i.current.flags&128)===128)}catch{}}function ni(i){if(typeof Xt=="function"&&Ue(i),We&&typeof We.setStrictMode=="function")try{We.setStrictMode(ve,i)}catch{}}var Vt=Math.clz32?Math.clz32:Cl,vu=Math.log,hn=Math.LN2;function Cl(i){return i>>>=0,i===0?32:31-(vu(i)/hn|0)|0}var or=128,ur=4194304;function xi(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function en(i,n){var a=i.pendingLanes;if(a===0)return 0;var o=0,c=i.suspendedLanes,f=i.pingedLanes,m=i.warmLanes;i=i.finishedLanes!==0;var E=a&134217727;return E!==0?(a=E&~c,a!==0?o=xi(a):(f&=E,f!==0?o=xi(f):i||(m=E&~m,m!==0&&(o=xi(m))))):(E=a&~c,E!==0?o=xi(E):f!==0?o=xi(f):i||(m=a&~m,m!==0&&(o=xi(m)))),o===0?0:n!==0&&n!==o&&(n&c)===0&&(c=o&-o,m=n&-n,c>=m||c===32&&(m&4194176)!==0)?n:o}function fn(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function la(i,n){switch(i){case 1:case 2:case 4:case 8:return n+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cr(){var i=or;return or<<=1,(or&4194176)===0&&(or=128),i}function Vn(){var i=ur;return ur<<=1,(ur&62914560)===0&&(ur=4194304),i}function oa(i){for(var n=[],a=0;31>a;a++)n.push(i);return n}function Rs(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function gu(i,n,a,o,c,f){var m=i.pendingLanes;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=a,i.entangledLanes&=a,i.errorRecoveryDisabledLanes&=a,i.shellSuspendCounter=0;var E=i.entanglements,_=i.expirationTimes,N=i.hiddenUpdates;for(a=m&~a;0<a;){var F=31-Vt(a),J=1<<F;E[F]=0,_[F]=-1;var H=N[F];if(H!==null)for(N[F]=null,F=0;F<H.length;F++){var q=H[F];q!==null&&(q.lane&=-536870913)}a&=~J}o!==0&&Rl(i,o,0),f!==0&&c===0&&i.tag!==0&&(i.suspendedLanes|=f&~(m&~n))}function Rl(i,n,a){i.pendingLanes|=n,i.suspendedLanes&=~n;var o=31-Vt(n);i.entangledLanes|=n,i.entanglements[o]=i.entanglements[o]|1073741824|a&4194218}function _l(i,n){var a=i.entangledLanes|=n;for(i=i.entanglements;a;){var o=31-Vt(a),c=1<<o;c&n|i[o]&n&&(i[o]|=n),a&=~c}}function ua(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function dr(){var i=B.p;return i!==0?i:(i=window.event,i===void 0?32:Uv(i.type))}function pn(i,n){var a=B.p;try{return B.p=i,n()}finally{B.p=a}}var tn=Math.random().toString(36).slice(2),Mt="__reactFiber$"+tn,qt="__reactProps$"+tn,qn="__reactContainer$"+tn,ca="__reactEvents$"+tn,Bi="__reactListeners$"+tn,mu="__reactHandles$"+tn,Pl="__reactResources$"+tn,_s="__reactMarker$"+tn;function da(i){delete i[Mt],delete i[qt],delete i[ca],delete i[Bi],delete i[mu]}function vn(i){var n=i[Mt];if(n)return n;for(var a=i.parentNode;a;){if(n=a[qn]||a[Mt]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(i=Tv(i);i!==null;){if(a=i[Mt])return a;i=Tv(i)}return n}i=a,a=i.parentNode}return null}function si(i){if(i=i[Mt]||i[qn]){var n=i.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return i}return null}function Ps(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(r(33))}function Fn(i){var n=i[Pl];return n||(n=i[Pl]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function St(i){i[_s]=!0}var Dl=new Set,wl={};function Ti(i,n){$n(i,n),$n(i+"Capture",n)}function $n(i,n){for(wl[i]=n,i=0;i<n.length;i++)Dl.add(n[i])}var Gi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ml={},Ol={};function yu(i){return st.call(Ol,i)?!0:st.call(Ml,i)?!1:nn.test(i)?Ol[i]=!0:(Ml[i]=!0,!1)}function hr(i,n,a){if(yu(n))if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+a)}}function fr(i,n,a){if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+a)}}function ji(i,n,a,o){if(o===null)i.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttributeNS(n,a,""+o)}}function xt(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ll(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Ds(i){var n=Ll(i)?"checked":"value",a=Object.getOwnPropertyDescriptor(i.constructor.prototype,n),o=""+i[n];if(!i.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var c=a.get,f=a.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return c.call(this)},set:function(m){o=""+m,f.call(this,m)}}),Object.defineProperty(i,n,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(m){o=""+m},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function ws(i){i._valueTracker||(i._valueTracker=Ds(i))}function ha(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return i&&(o=Ll(i)?i.checked?"true":"false":i.value),i=o,i!==a?(n.setValue(i),!0):!1}function pr(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var bu=/[\n"\\]/g;function ri(i){return i.replace(bu,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function fa(i,n,a,o,c,f,m,E){i.name="",m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"?i.type=m:i.removeAttribute("type"),n!=null?m==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+xt(n)):i.value!==""+xt(n)&&(i.value=""+xt(n)):m!=="submit"&&m!=="reset"||i.removeAttribute("value"),n!=null?va(i,m,xt(n)):a!=null?va(i,m,xt(a)):o!=null&&i.removeAttribute("value"),c==null&&f!=null&&(i.defaultChecked=!!f),c!=null&&(i.checked=c&&typeof c!="function"&&typeof c!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?i.name=""+xt(E):i.removeAttribute("name")}function pa(i,n,a,o,c,f,m,E){if(f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(i.type=f),n!=null||a!=null){if(!(f!=="submit"&&f!=="reset"||n!=null))return;a=a!=null?""+xt(a):"",n=n!=null?""+xt(n):a,E||n===i.value||(i.value=n),i.defaultValue=n}o=o??c,o=typeof o!="function"&&typeof o!="symbol"&&!!o,i.checked=E?i.checked:!!o,i.defaultChecked=!!o,m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(i.name=m)}function va(i,n,a){n==="number"&&pr(i.ownerDocument)===i||i.defaultValue===""+a||(i.defaultValue=""+a)}function Yn(i,n,a,o){if(i=i.options,n){n={};for(var c=0;c<a.length;c++)n["$"+a[c]]=!0;for(a=0;a<i.length;a++)c=n.hasOwnProperty("$"+i[a].value),i[a].selected!==c&&(i[a].selected=c),c&&o&&(i[a].defaultSelected=!0)}else{for(a=""+xt(a),n=null,c=0;c<i.length;c++){if(i[c].value===a){i[c].selected=!0,o&&(i[c].defaultSelected=!0);return}n!==null||i[c].disabled||(n=i[c])}n!==null&&(n.selected=!0)}}function ga(i,n,a){if(n!=null&&(n=""+xt(n),n!==i.value&&(i.value=n),a==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=a!=null?""+xt(a):""}function Ms(i,n,a,o){if(n==null){if(o!=null){if(a!=null)throw Error(r(92));if(U(o)){if(1<o.length)throw Error(r(93));o=o[0]}a=o}a==null&&(a=""),n=a}a=xt(n),i.defaultValue=a,o=i.textContent,o===a&&o!==""&&o!==null&&(i.value=o)}function ui(i,n){if(n){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=n;return}}i.textContent=n}var Su=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Il(i,n,a){var o=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?o?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":o?i.setProperty(n,a):typeof a!="number"||a===0||Su.has(n)?n==="float"?i.cssFloat=a:i[n]=(""+a).trim():i[n]=a+"px"}function zi(i,n,a){if(n!=null&&typeof n!="object")throw Error(r(62));if(i=i.style,a!=null){for(var o in a)!a.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="");for(var c in n)o=n[c],n.hasOwnProperty(c)&&a[c]!==o&&Il(i,c,o)}else for(var f in n)n.hasOwnProperty(f)&&Il(i,f,n[f])}function ma(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ku=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vr(i){return ku.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var ya=null;function Hi(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var gn=null,Kn=null;function Os(i){var n=si(i);if(n&&(i=n.stateNode)){var a=i[qt]||null;e:switch(i=n.stateNode,n.type){case"input":if(fa(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ri(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==i&&o.form===i.form){var c=o[qt]||null;if(!c)throw Error(r(90));fa(o,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(n=0;n<a.length;n++)o=a[n],o.form===i.form&&ha(o)}break e;case"textarea":ga(i,a.value,a.defaultValue);break e;case"select":n=a.value,n!=null&&Yn(i,!!a.multiple,n,!1)}}}var ba=!1;function gr(i,n,a){if(ba)return i(n,a);ba=!0;try{var o=i(n);return o}finally{if(ba=!1,(gn!==null||Kn!==null)&&(vo(),gn&&(n=gn,i=Kn,Kn=gn=null,Os(n),i)))for(n=0;n<i.length;n++)Os(i[n])}}function Ls(i,n){var a=i.stateNode;if(a===null)return null;var o=a[qt]||null;if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(i=i.type,o=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!o;break e;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(r(231,n,typeof a));return a}var mr=!1;if(Gi)try{var Qn={};Object.defineProperty(Qn,"passive",{get:function(){mr=!0}}),window.addEventListener("test",Qn,Qn),window.removeEventListener("test",Qn,Qn)}catch{mr=!1}var Vi=null,mn=null,Is=null;function Nl(){if(Is)return Is;var i,n=mn,a=n.length,o,c="value"in Vi?Vi.value:Vi.textContent,f=c.length;for(i=0;i<a&&n[i]===c[i];i++);var m=a-i;for(o=1;o<=m&&n[a-o]===c[f-o];o++);return Is=c.slice(i,1<o?1-o:void 0)}function yr(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function br(){return!0}function R(){return!1}function O(i){function n(a,o,c,f,m){this._reactName=a,this._targetInst=c,this.type=o,this.nativeEvent=f,this.target=m,this.currentTarget=null;for(var E in i)i.hasOwnProperty(E)&&(a=i[E],this[E]=a?a(f):f[E]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?br:R,this.isPropagationStopped=R,this}return Re(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=br)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=br)},persist:function(){},isPersistent:br}),n}var $={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ne=O($),qe=Re({},$,{view:0,detail:0}),_e=O(qe),Ze,dt,lt,$e=Re({},qe,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eu,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==lt&&(lt&&i.type==="mousemove"?(Ze=i.screenX-lt.screenX,dt=i.screenY-lt.screenY):dt=Ze=0,lt=i),Ze)},movementY:function(i){return"movementY"in i?i.movementY:dt}}),Ft=O($e),ci=Re({},$e,{dataTransfer:0}),Ot=O(ci),ai=Re({},qe,{relatedTarget:0}),$t=O(ai),sn=Re({},$,{animationName:0,elapsedTime:0,pseudoElement:0}),qi=O(sn),yn=Re({},$,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Ul=O(yn),Sr=Re({},$,{data:0}),Ns=O(Sr),By={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Gy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zy(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=jy[i])?!!n[i]:!1}function Eu(){return zy}var Hy=Re({},qe,{key:function(i){if(i.key){var n=By[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=yr(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Gy[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eu,charCode:function(i){return i.type==="keypress"?yr(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?yr(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Vy=O(Hy),qy=Re({},$e,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Oh=O(qy),Fy=Re({},qe,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eu}),$y=O(Fy),Yy=Re({},$,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ky=O(Yy),Qy=Re({},$e,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Wy=O(Qy),Jy=Re({},$,{newState:0,oldState:0}),Xy=O(Jy),Zy=[9,13,27,32],Au=Gi&&"CompositionEvent"in window,Sa=null;Gi&&"documentMode"in document&&(Sa=document.documentMode);var eb=Gi&&"TextEvent"in window&&!Sa,Lh=Gi&&(!Au||Sa&&8<Sa&&11>=Sa),Ih=" ",Nh=!1;function Uh(i,n){switch(i){case"keyup":return Zy.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xh(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Tr=!1;function tb(i,n){switch(i){case"compositionend":return xh(n);case"keypress":return n.which!==32?null:(Nh=!0,Ih);case"textInput":return i=n.data,i===Ih&&Nh?null:i;default:return null}}function ib(i,n){if(Tr)return i==="compositionend"||!Au&&Uh(i,n)?(i=Nl(),Is=mn=Vi=null,Tr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Lh&&n.locale!=="ko"?null:n.data;default:return null}}var nb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!nb[i.type]:n==="textarea"}function Gh(i,n,a,o){gn?Kn?Kn.push(o):Kn=[o]:gn=o,n=So(n,"onChange"),0<n.length&&(a=new ne("onChange","change",null,a,o),i.push({event:a,listeners:n}))}var Ta=null,ka=null;function sb(i){hv(i,0)}function xl(i){var n=Ps(i);if(ha(n))return i}function jh(i,n){if(i==="change")return n}var zh=!1;if(Gi){var Cu;if(Gi){var Ru="oninput"in document;if(!Ru){var Hh=document.createElement("div");Hh.setAttribute("oninput","return;"),Ru=typeof Hh.oninput=="function"}Cu=Ru}else Cu=!1;zh=Cu&&(!document.documentMode||9<document.documentMode)}function Vh(){Ta&&(Ta.detachEvent("onpropertychange",qh),ka=Ta=null)}function qh(i){if(i.propertyName==="value"&&xl(ka)){var n=[];Gh(n,ka,i,Hi(i)),gr(sb,n)}}function rb(i,n,a){i==="focusin"?(Vh(),Ta=n,ka=a,Ta.attachEvent("onpropertychange",qh)):i==="focusout"&&Vh()}function ab(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return xl(ka)}function lb(i,n){if(i==="click")return xl(n)}function ob(i,n){if(i==="input"||i==="change")return xl(n)}function ub(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var di=typeof Object.is=="function"?Object.is:ub;function Ea(i,n){if(di(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var a=Object.keys(i),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var c=a[o];if(!st.call(n,c)||!di(i[c],n[c]))return!1}return!0}function Fh(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function $h(i,n){var a=Fh(i);i=0;for(var o;a;){if(a.nodeType===3){if(o=i+a.textContent.length,i<=n&&o>=n)return{node:a,offset:n-i};i=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Fh(a)}}function Yh(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?Yh(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function Kh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=pr(i.document);n instanceof i.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)i=n.contentWindow;else break;n=pr(i.document)}return n}function _u(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}function cb(i,n){var a=Kh(n);n=i.focusedElem;var o=i.selectionRange;if(a!==n&&n&&n.ownerDocument&&Yh(n.ownerDocument.documentElement,n)){if(o!==null&&_u(n)){if(i=o.start,a=o.end,a===void 0&&(a=i),"selectionStart"in n)n.selectionStart=i,n.selectionEnd=Math.min(a,n.value.length);else if(a=(i=n.ownerDocument||document)&&i.defaultView||window,a.getSelection){a=a.getSelection();var c=n.textContent.length,f=Math.min(o.start,c);o=o.end===void 0?f:Math.min(o.end,c),!a.extend&&f>o&&(c=o,o=f,f=c),c=$h(n,f);var m=$h(n,o);c&&m&&(a.rangeCount!==1||a.anchorNode!==c.node||a.anchorOffset!==c.offset||a.focusNode!==m.node||a.focusOffset!==m.offset)&&(i=i.createRange(),i.setStart(c.node,c.offset),a.removeAllRanges(),f>o?(a.addRange(i),a.extend(m.node,m.offset)):(i.setEnd(m.node,m.offset),a.addRange(i)))}}for(i=[],a=n;a=a.parentNode;)a.nodeType===1&&i.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<i.length;n++)a=i[n],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var db=Gi&&"documentMode"in document&&11>=document.documentMode,kr=null,Pu=null,Aa=null,Du=!1;function Qh(i,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Du||kr==null||kr!==pr(o)||(o=kr,"selectionStart"in o&&_u(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Aa&&Ea(Aa,o)||(Aa=o,o=So(Pu,"onSelect"),0<o.length&&(n=new ne("onSelect","select",null,n,a),i.push({event:n,listeners:o}),n.target=kr)))}function Us(i,n){var a={};return a[i.toLowerCase()]=n.toLowerCase(),a["Webkit"+i]="webkit"+n,a["Moz"+i]="moz"+n,a}var Er={animationend:Us("Animation","AnimationEnd"),animationiteration:Us("Animation","AnimationIteration"),animationstart:Us("Animation","AnimationStart"),transitionrun:Us("Transition","TransitionRun"),transitionstart:Us("Transition","TransitionStart"),transitioncancel:Us("Transition","TransitionCancel"),transitionend:Us("Transition","TransitionEnd")},wu={},Wh={};Gi&&(Wh=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);function xs(i){if(wu[i])return wu[i];if(!Er[i])return i;var n=Er[i],a;for(a in n)if(n.hasOwnProperty(a)&&a in Wh)return wu[i]=n[a];return i}var Jh=xs("animationend"),Xh=xs("animationiteration"),Zh=xs("animationstart"),hb=xs("transitionrun"),fb=xs("transitionstart"),pb=xs("transitioncancel"),ef=xs("transitionend"),tf=new Map,nf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Fi(i,n){tf.set(i,n),Ti(n,[i])}var ki=[],Ar=0,Mu=0;function Bl(){for(var i=Ar,n=Mu=Ar=0;n<i;){var a=ki[n];ki[n++]=null;var o=ki[n];ki[n++]=null;var c=ki[n];ki[n++]=null;var f=ki[n];if(ki[n++]=null,o!==null&&c!==null){var m=o.pending;m===null?c.next=c:(c.next=m.next,m.next=c),o.pending=c}f!==0&&sf(a,c,f)}}function Gl(i,n,a,o){ki[Ar++]=i,ki[Ar++]=n,ki[Ar++]=a,ki[Ar++]=o,Mu|=o,i.lanes|=o,i=i.alternate,i!==null&&(i.lanes|=o)}function Ou(i,n,a,o){return Gl(i,n,a,o),jl(i)}function Wn(i,n){return Gl(i,null,null,n),jl(i)}function sf(i,n,a){i.lanes|=a;var o=i.alternate;o!==null&&(o.lanes|=a);for(var c=!1,f=i.return;f!==null;)f.childLanes|=a,o=f.alternate,o!==null&&(o.childLanes|=a),f.tag===22&&(i=f.stateNode,i===null||i._visibility&1||(c=!0)),i=f,f=f.return;c&&n!==null&&i.tag===3&&(f=i.stateNode,c=31-Vt(a),f=f.hiddenUpdates,i=f[c],i===null?f[c]=[n]:i.push(n),n.lane=a|536870912)}function jl(i){if(50<Qa)throw Qa=0,Bc=null,Error(r(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var Cr={},rf=new WeakMap;function Ei(i,n){if(typeof i=="object"&&i!==null){var a=rf.get(i);return a!==void 0?a:(n={value:i,source:n,stack:pe(n)},rf.set(i,n),n)}return{value:i,source:n,stack:pe(n)}}var Rr=[],_r=0,zl=null,Hl=0,Ai=[],Ci=0,Bs=null,bn=1,Sn="";function Gs(i,n){Rr[_r++]=Hl,Rr[_r++]=zl,zl=i,Hl=n}function af(i,n,a){Ai[Ci++]=bn,Ai[Ci++]=Sn,Ai[Ci++]=Bs,Bs=i;var o=bn;i=Sn;var c=32-Vt(o)-1;o&=~(1<<c),a+=1;var f=32-Vt(n)+c;if(30<f){var m=c-c%5;f=(o&(1<<m)-1).toString(32),o>>=m,c-=m,bn=1<<32-Vt(n)+c|a<<c|o,Sn=f+i}else bn=1<<f|a<<c|o,Sn=i}function Lu(i){i.return!==null&&(Gs(i,1),af(i,1,0))}function Iu(i){for(;i===zl;)zl=Rr[--_r],Rr[_r]=null,Hl=Rr[--_r],Rr[_r]=null;for(;i===Bs;)Bs=Ai[--Ci],Ai[Ci]=null,Sn=Ai[--Ci],Ai[Ci]=null,bn=Ai[--Ci],Ai[Ci]=null}var Zt=null,Bt=null,ze=!1,$i=null,rn=!1,Nu=Error(r(519));function js(i){var n=Error(r(418,""));throw _a(Ei(n,i)),Nu}function lf(i){var n=i.stateNode,a=i.type,o=i.memoizedProps;switch(n[Mt]=i,n[qt]=o,a){case"dialog":xe("cancel",n),xe("close",n);break;case"iframe":case"object":case"embed":xe("load",n);break;case"video":case"audio":for(a=0;a<Ja.length;a++)xe(Ja[a],n);break;case"source":xe("error",n);break;case"img":case"image":case"link":xe("error",n),xe("load",n);break;case"details":xe("toggle",n);break;case"input":xe("invalid",n),pa(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),ws(n);break;case"select":xe("invalid",n);break;case"textarea":xe("invalid",n),Ms(n,o.value,o.defaultValue,o.children),ws(n)}a=o.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||o.suppressHydrationWarning===!0||gv(n.textContent,a)?(o.popover!=null&&(xe("beforetoggle",n),xe("toggle",n)),o.onScroll!=null&&xe("scroll",n),o.onScrollEnd!=null&&xe("scrollend",n),o.onClick!=null&&(n.onclick=To),n=!0):n=!1,n||js(i)}function of(i){for(Zt=i.return;Zt;)switch(Zt.tag){case 3:case 27:rn=!0;return;case 5:case 13:rn=!1;return;default:Zt=Zt.return}}function Ca(i){if(i!==Zt)return!1;if(!ze)return of(i),ze=!0,!1;var n=!1,a;if((a=i.tag!==3&&i.tag!==27)&&((a=i.tag===5)&&(a=i.type,a=!(a!=="form"&&a!=="button")||td(i.type,i.memoizedProps)),a=!a),a&&(n=!0),n&&Bt&&js(i),of(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));e:{for(i=i.nextSibling,n=0;i;){if(i.nodeType===8)if(a=i.data,a==="/$"){if(n===0){Bt=Ki(i.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++;i=i.nextSibling}Bt=null}}else Bt=Zt?Ki(i.stateNode.nextSibling):null;return!0}function Ra(){Bt=Zt=null,ze=!1}function _a(i){$i===null?$i=[i]:$i.push(i)}var Pa=Error(r(460)),uf=Error(r(474)),Uu={then:function(){}};function cf(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Vl(){}function df(i,n,a){switch(a=i[a],a===void 0?i.push(n):a!==n&&(n.then(Vl,Vl),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,i===Pa?Error(r(483)):i;default:if(typeof n.status=="string")n.then(Vl,Vl);else{if(i=et,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=n,i.status="pending",i.then(function(o){if(n.status==="pending"){var c=n;c.status="fulfilled",c.value=o}},function(o){if(n.status==="pending"){var c=n;c.status="rejected",c.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,i===Pa?Error(r(483)):i}throw Da=n,Pa}}var Da=null;function hf(){if(Da===null)throw Error(r(459));var i=Da;return Da=null,i}var Pr=null,wa=0;function ql(i){var n=wa;return wa+=1,Pr===null&&(Pr=[]),df(Pr,i,n)}function Ma(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function Fl(i,n){throw n.$$typeof===u?Error(r(525)):(i=Object.prototype.toString.call(n),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function ff(i){var n=i._init;return n(i._payload)}function pf(i){function n(x,L){if(i){var G=x.deletions;G===null?(x.deletions=[L],x.flags|=16):G.push(L)}}function a(x,L){if(!i)return null;for(;L!==null;)n(x,L),L=L.sibling;return null}function o(x){for(var L=new Map;x!==null;)x.key!==null?L.set(x.key,x):L.set(x.index,x),x=x.sibling;return L}function c(x,L){return x=os(x,L),x.index=0,x.sibling=null,x}function f(x,L,G){return x.index=G,i?(G=x.alternate,G!==null?(G=G.index,G<L?(x.flags|=33554434,L):G):(x.flags|=33554434,L)):(x.flags|=1048576,L)}function m(x){return i&&x.alternate===null&&(x.flags|=33554434),x}function E(x,L,G,K){return L===null||L.tag!==6?(L=wc(G,x.mode,K),L.return=x,L):(L=c(L,G),L.return=x,L)}function _(x,L,G,K){var re=G.type;return re===p?F(x,L,G.props.children,K,G.key):L!==null&&(L.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===oe&&ff(re)===L.type)?(L=c(L,G.props),Ma(L,G),L.return=x,L):(L=uo(G.type,G.key,G.props,null,x.mode,K),Ma(L,G),L.return=x,L)}function N(x,L,G,K){return L===null||L.tag!==4||L.stateNode.containerInfo!==G.containerInfo||L.stateNode.implementation!==G.implementation?(L=Mc(G,x.mode,K),L.return=x,L):(L=c(L,G.children||[]),L.return=x,L)}function F(x,L,G,K,re){return L===null||L.tag!==7?(L=Ws(G,x.mode,K,re),L.return=x,L):(L=c(L,G),L.return=x,L)}function J(x,L,G){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=wc(""+L,x.mode,G),L.return=x,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case d:return G=uo(L.type,L.key,L.props,null,x.mode,G),Ma(G,L),G.return=x,G;case h:return L=Mc(L,x.mode,G),L.return=x,L;case oe:var K=L._init;return L=K(L._payload),J(x,L,G)}if(U(L)||Ne(L))return L=Ws(L,x.mode,G,null),L.return=x,L;if(typeof L.then=="function")return J(x,ql(L),G);if(L.$$typeof===C)return J(x,ao(x,L),G);Fl(x,L)}return null}function H(x,L,G,K){var re=L!==null?L.key:null;if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return re!==null?null:E(x,L,""+G,K);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case d:return G.key===re?_(x,L,G,K):null;case h:return G.key===re?N(x,L,G,K):null;case oe:return re=G._init,G=re(G._payload),H(x,L,G,K)}if(U(G)||Ne(G))return re!==null?null:F(x,L,G,K,null);if(typeof G.then=="function")return H(x,L,ql(G),K);if(G.$$typeof===C)return H(x,L,ao(x,G),K);Fl(x,G)}return null}function q(x,L,G,K,re){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return x=x.get(G)||null,E(L,x,""+K,re);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case d:return x=x.get(K.key===null?G:K.key)||null,_(L,x,K,re);case h:return x=x.get(K.key===null?G:K.key)||null,N(L,x,K,re);case oe:var Le=K._init;return K=Le(K._payload),q(x,L,G,K,re)}if(U(K)||Ne(K))return x=x.get(G)||null,F(L,x,K,re,null);if(typeof K.then=="function")return q(x,L,G,ql(K),re);if(K.$$typeof===C)return q(x,L,G,ao(L,K),re);Fl(L,K)}return null}function ce(x,L,G,K){for(var re=null,Le=null,he=L,ye=L=0,Nt=null;he!==null&&ye<G.length;ye++){he.index>ye?(Nt=he,he=null):Nt=he.sibling;var He=H(x,he,G[ye],K);if(He===null){he===null&&(he=Nt);break}i&&he&&He.alternate===null&&n(x,he),L=f(He,L,ye),Le===null?re=He:Le.sibling=He,Le=He,he=Nt}if(ye===G.length)return a(x,he),ze&&Gs(x,ye),re;if(he===null){for(;ye<G.length;ye++)he=J(x,G[ye],K),he!==null&&(L=f(he,L,ye),Le===null?re=he:Le.sibling=he,Le=he);return ze&&Gs(x,ye),re}for(he=o(he);ye<G.length;ye++)Nt=q(he,x,ye,G[ye],K),Nt!==null&&(i&&Nt.alternate!==null&&he.delete(Nt.key===null?ye:Nt.key),L=f(Nt,L,ye),Le===null?re=Nt:Le.sibling=Nt,Le=Nt);return i&&he.forEach(function(vs){return n(x,vs)}),ze&&Gs(x,ye),re}function Ce(x,L,G,K){if(G==null)throw Error(r(151));for(var re=null,Le=null,he=L,ye=L=0,Nt=null,He=G.next();he!==null&&!He.done;ye++,He=G.next()){he.index>ye?(Nt=he,he=null):Nt=he.sibling;var vs=H(x,he,He.value,K);if(vs===null){he===null&&(he=Nt);break}i&&he&&vs.alternate===null&&n(x,he),L=f(vs,L,ye),Le===null?re=vs:Le.sibling=vs,Le=vs,he=Nt}if(He.done)return a(x,he),ze&&Gs(x,ye),re;if(he===null){for(;!He.done;ye++,He=G.next())He=J(x,He.value,K),He!==null&&(L=f(He,L,ye),Le===null?re=He:Le.sibling=He,Le=He);return ze&&Gs(x,ye),re}for(he=o(he);!He.done;ye++,He=G.next())He=q(he,x,ye,He.value,K),He!==null&&(i&&He.alternate!==null&&he.delete(He.key===null?ye:He.key),L=f(He,L,ye),Le===null?re=He:Le.sibling=He,Le=He);return i&&he.forEach(function(PS){return n(x,PS)}),ze&&Gs(x,ye),re}function pt(x,L,G,K){if(typeof G=="object"&&G!==null&&G.type===p&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case d:e:{for(var re=G.key;L!==null;){if(L.key===re){if(re=G.type,re===p){if(L.tag===7){a(x,L.sibling),K=c(L,G.props.children),K.return=x,x=K;break e}}else if(L.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===oe&&ff(re)===L.type){a(x,L.sibling),K=c(L,G.props),Ma(K,G),K.return=x,x=K;break e}a(x,L);break}else n(x,L);L=L.sibling}G.type===p?(K=Ws(G.props.children,x.mode,K,G.key),K.return=x,x=K):(K=uo(G.type,G.key,G.props,null,x.mode,K),Ma(K,G),K.return=x,x=K)}return m(x);case h:e:{for(re=G.key;L!==null;){if(L.key===re)if(L.tag===4&&L.stateNode.containerInfo===G.containerInfo&&L.stateNode.implementation===G.implementation){a(x,L.sibling),K=c(L,G.children||[]),K.return=x,x=K;break e}else{a(x,L);break}else n(x,L);L=L.sibling}K=Mc(G,x.mode,K),K.return=x,x=K}return m(x);case oe:return re=G._init,G=re(G._payload),pt(x,L,G,K)}if(U(G))return ce(x,L,G,K);if(Ne(G)){if(re=Ne(G),typeof re!="function")throw Error(r(150));return G=re.call(G),Ce(x,L,G,K)}if(typeof G.then=="function")return pt(x,L,ql(G),K);if(G.$$typeof===C)return pt(x,L,ao(x,G),K);Fl(x,G)}return typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint"?(G=""+G,L!==null&&L.tag===6?(a(x,L.sibling),K=c(L,G),K.return=x,x=K):(a(x,L),K=wc(G,x.mode,K),K.return=x,x=K),m(x)):a(x,L)}return function(x,L,G,K){try{wa=0;var re=pt(x,L,G,K);return Pr=null,re}catch(he){if(he===Pa)throw he;var Le=Di(29,he,null,x.mode);return Le.lanes=K,Le.return=x,Le}finally{}}}var zs=pf(!0),vf=pf(!1),Dr=X(null),$l=X(0);function gf(i,n){i=Mn,ue($l,i),ue(Dr,n),Mn=i|n.baseLanes}function xu(){ue($l,Mn),ue(Dr,Dr.current)}function Bu(){Mn=$l.current,Ae(Dr),Ae($l)}var Ri=X(null),an=null;function Jn(i){var n=i.alternate;ue(_t,_t.current&1),ue(Ri,i),an===null&&(n===null||Dr.current!==null||n.memoizedState!==null)&&(an=i)}function mf(i){if(i.tag===22){if(ue(_t,_t.current),ue(Ri,i),an===null){var n=i.alternate;n!==null&&n.memoizedState!==null&&(an=i)}}else Xn()}function Xn(){ue(_t,_t.current),ue(Ri,Ri.current)}function Tn(i){Ae(Ri),an===i&&(an=null),Ae(_t)}var _t=X(0);function Yl(i){for(var n=i;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var vb=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(a,o){i.push(o)}};this.abort=function(){n.aborted=!0,i.forEach(function(a){return a()})}},gb=e.unstable_scheduleCallback,mb=e.unstable_NormalPriority,Pt={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gu(){return{controller:new vb,data:new Map,refCount:0}}function Oa(i){i.refCount--,i.refCount===0&&gb(mb,function(){i.controller.abort()})}var La=null,ju=0,wr=0,Mr=null;function yb(i,n){if(La===null){var a=La=[];ju=0,wr=$c(),Mr={status:"pending",value:void 0,then:function(o){a.push(o)}}}return ju++,n.then(yf,yf),n}function yf(){if(--ju===0&&La!==null){Mr!==null&&(Mr.status="fulfilled");var i=La;La=null,wr=0,Mr=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function bb(i,n){var a=[],o={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return i.then(function(){o.status="fulfilled",o.value=n;for(var c=0;c<a.length;c++)(0,a[c])(n)},function(c){for(o.status="rejected",o.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),o}var bf=ee.S;ee.S=function(i,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&yb(i,n),bf!==null&&bf(i,n)};var Hs=X(null);function zu(){var i=Hs.current;return i!==null?i:et.pooledCache}function Kl(i,n){n===null?ue(Hs,Hs.current):ue(Hs,n.pool)}function Sf(){var i=zu();return i===null?null:{parent:Pt._currentValue,pool:i}}var Zn=0,Oe=null,Ye=null,Tt=null,Ql=!1,Or=!1,Vs=!1,Wl=0,Ia=0,Lr=null,Sb=0;function mt(){throw Error(r(321))}function Hu(i,n){if(n===null)return!1;for(var a=0;a<n.length&&a<i.length;a++)if(!di(i[a],n[a]))return!1;return!0}function Vu(i,n,a,o,c,f){return Zn=f,Oe=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,ee.H=i===null||i.memoizedState===null?qs:es,Vs=!1,f=a(o,c),Vs=!1,Or&&(f=kf(n,a,o,c)),Tf(i),f}function Tf(i){ee.H=ln;var n=Ye!==null&&Ye.next!==null;if(Zn=0,Tt=Ye=Oe=null,Ql=!1,Ia=0,Lr=null,n)throw Error(r(300));i===null||Lt||(i=i.dependencies,i!==null&&ro(i)&&(Lt=!0))}function kf(i,n,a,o){Oe=i;var c=0;do{if(Or&&(Lr=null),Ia=0,Or=!1,25<=c)throw Error(r(301));if(c+=1,Tt=Ye=null,i.updateQueue!=null){var f=i.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,f.memoCache!=null&&(f.memoCache.index=0)}ee.H=Fs,f=n(a,o)}while(Or);return f}function Tb(){var i=ee.H,n=i.useState()[0];return n=typeof n.then=="function"?Na(n):n,i=i.useState()[0],(Ye!==null?Ye.memoizedState:null)!==i&&(Oe.flags|=1024),n}function qu(){var i=Wl!==0;return Wl=0,i}function Fu(i,n,a){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~a}function $u(i){if(Ql){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}Ql=!1}Zn=0,Tt=Ye=Oe=null,Or=!1,Ia=Wl=0,Lr=null}function li(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?Oe.memoizedState=Tt=i:Tt=Tt.next=i,Tt}function kt(){if(Ye===null){var i=Oe.alternate;i=i!==null?i.memoizedState:null}else i=Ye.next;var n=Tt===null?Oe.memoizedState:Tt.next;if(n!==null)Tt=n,Ye=i;else{if(i===null)throw Oe.alternate===null?Error(r(467)):Error(r(310));Ye=i,i={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},Tt===null?Oe.memoizedState=Tt=i:Tt=Tt.next=i}return Tt}var Jl;Jl=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Na(i){var n=Ia;return Ia+=1,Lr===null&&(Lr=[]),i=df(Lr,i,n),n=Oe,(Tt===null?n.memoizedState:Tt.next)===null&&(n=n.alternate,ee.H=n===null||n.memoizedState===null?qs:es),i}function Xl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Na(i);if(i.$$typeof===C)return Yt(i)}throw Error(r(438,String(i)))}function Yu(i){var n=null,a=Oe.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var o=Oe.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(c){return c.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=Jl(),Oe.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(i),o=0;o<i;o++)a[o]=se;return n.index++,a}function kn(i,n){return typeof n=="function"?n(i):n}function Zl(i){var n=kt();return Ku(n,Ye,i)}function Ku(i,n,a){var o=i.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=a;var c=i.baseQueue,f=o.pending;if(f!==null){if(c!==null){var m=c.next;c.next=f.next,f.next=m}n.baseQueue=c=f,o.pending=null}if(f=i.baseState,c===null)i.memoizedState=f;else{n=c.next;var E=m=null,_=null,N=n,F=!1;do{var J=N.lane&-536870913;if(J!==N.lane?(Ge&J)===J:(Zn&J)===J){var H=N.revertLane;if(H===0)_!==null&&(_=_.next={lane:0,revertLane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),J===wr&&(F=!0);else if((Zn&H)===H){N=N.next,H===wr&&(F=!0);continue}else J={lane:0,revertLane:N.revertLane,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},_===null?(E=_=J,m=f):_=_.next=J,Oe.lanes|=H,us|=H;J=N.action,Vs&&a(f,J),f=N.hasEagerState?N.eagerState:a(f,J)}else H={lane:J,revertLane:N.revertLane,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},_===null?(E=_=H,m=f):_=_.next=H,Oe.lanes|=J,us|=J;N=N.next}while(N!==null&&N!==n);if(_===null?m=f:_.next=E,!di(f,i.memoizedState)&&(Lt=!0,F&&(a=Mr,a!==null)))throw a;i.memoizedState=f,i.baseState=m,i.baseQueue=_,o.lastRenderedState=f}return c===null&&(o.lanes=0),[i.memoizedState,o.dispatch]}function Qu(i){var n=kt(),a=n.queue;if(a===null)throw Error(r(311));a.lastRenderedReducer=i;var o=a.dispatch,c=a.pending,f=n.memoizedState;if(c!==null){a.pending=null;var m=c=c.next;do f=i(f,m.action),m=m.next;while(m!==c);di(f,n.memoizedState)||(Lt=!0),n.memoizedState=f,n.baseQueue===null&&(n.baseState=f),a.lastRenderedState=f}return[f,o]}function Ef(i,n,a){var o=Oe,c=kt(),f=ze;if(f){if(a===void 0)throw Error(r(407));a=a()}else a=n();var m=!di((Ye||c).memoizedState,a);if(m&&(c.memoizedState=a,Lt=!0),c=c.queue,Xu(Rf.bind(null,o,c,i),[i]),c.getSnapshot!==n||m||Tt!==null&&Tt.memoizedState.tag&1){if(o.flags|=2048,Ir(9,Cf.bind(null,o,c,a,n),{destroy:void 0},null),et===null)throw Error(r(349));f||(Zn&60)!==0||Af(o,n,a)}return a}function Af(i,n,a){i.flags|=16384,i={getSnapshot:n,value:a},n=Oe.updateQueue,n===null?(n=Jl(),Oe.updateQueue=n,n.stores=[i]):(a=n.stores,a===null?n.stores=[i]:a.push(i))}function Cf(i,n,a,o){n.value=a,n.getSnapshot=o,_f(n)&&Pf(i)}function Rf(i,n,a){return a(function(){_f(n)&&Pf(i)})}function _f(i){var n=i.getSnapshot;i=i.value;try{var a=n();return!di(i,a)}catch{return!0}}function Pf(i){var n=Wn(i,2);n!==null&&ei(n,i,2)}function Wu(i){var n=li();if(typeof i=="function"){var a=i;if(i=a(),Vs){ni(!0);try{a()}finally{ni(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kn,lastRenderedState:i},n}function Df(i,n,a,o){return i.baseState=a,Ku(i,Ye,typeof o=="function"?o:kn)}function kb(i,n,a,o,c){if(io(i))throw Error(r(485));if(i=n.action,i!==null){var f={payload:c,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(m){f.listeners.push(m)}};ee.T!==null?a(!0):f.isTransition=!1,o(f),a=n.pending,a===null?(f.next=n.pending=f,wf(n,f)):(f.next=a.next,n.pending=a.next=f)}}function wf(i,n){var a=n.action,o=n.payload,c=i.state;if(n.isTransition){var f=ee.T,m={};ee.T=m;try{var E=a(c,o),_=ee.S;_!==null&&_(m,E),Mf(i,n,E)}catch(N){Ju(i,n,N)}finally{ee.T=f}}else try{f=a(c,o),Mf(i,n,f)}catch(N){Ju(i,n,N)}}function Mf(i,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(o){Of(i,n,o)},function(o){return Ju(i,n,o)}):Of(i,n,a)}function Of(i,n,a){n.status="fulfilled",n.value=a,Lf(n),i.state=a,n=i.pending,n!==null&&(a=n.next,a===n?i.pending=null:(a=a.next,n.next=a,wf(i,a)))}function Ju(i,n,a){var o=i.pending;if(i.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=a,Lf(n),n=n.next;while(n!==o)}i.action=null}function Lf(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function If(i,n){return n}function Nf(i,n){if(ze){var a=et.formState;if(a!==null){e:{var o=Oe;if(ze){if(Bt){t:{for(var c=Bt,f=rn;c.nodeType!==8;){if(!f){c=null;break t}if(c=Ki(c.nextSibling),c===null){c=null;break t}}f=c.data,c=f==="F!"||f==="F"?c:null}if(c){Bt=Ki(c.nextSibling),o=c.data==="F!";break e}}js(o)}o=!1}o&&(n=a[0])}}return a=li(),a.memoizedState=a.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:If,lastRenderedState:n},a.queue=o,a=Zf.bind(null,Oe,o),o.dispatch=a,o=Wu(!1),f=nc.bind(null,Oe,!1,o.queue),o=li(),c={state:n,dispatch:null,action:i,pending:null},o.queue=c,a=kb.bind(null,Oe,c,f,a),c.dispatch=a,o.memoizedState=i,[n,a,!1]}function Uf(i){var n=kt();return xf(n,Ye,i)}function xf(i,n,a){n=Ku(i,n,If)[0],i=Zl(kn)[0],n=typeof n=="object"&&n!==null&&typeof n.then=="function"?Na(n):n;var o=kt(),c=o.queue,f=c.dispatch;return a!==o.memoizedState&&(Oe.flags|=2048,Ir(9,Eb.bind(null,c,a),{destroy:void 0},null)),[n,f,i]}function Eb(i,n){i.action=n}function Bf(i){var n=kt(),a=Ye;if(a!==null)return xf(n,a,i);kt(),n=n.memoizedState,a=kt();var o=a.queue.dispatch;return a.memoizedState=i,[n,o,!1]}function Ir(i,n,a,o){return i={tag:i,create:n,inst:a,deps:o,next:null},n=Oe.updateQueue,n===null&&(n=Jl(),Oe.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=i.next=i:(o=a.next,a.next=i,i.next=o,n.lastEffect=i),i}function Gf(){return kt().memoizedState}function eo(i,n,a,o){var c=li();Oe.flags|=i,c.memoizedState=Ir(1|n,a,{destroy:void 0},o===void 0?null:o)}function to(i,n,a,o){var c=kt();o=o===void 0?null:o;var f=c.memoizedState.inst;Ye!==null&&o!==null&&Hu(o,Ye.memoizedState.deps)?c.memoizedState=Ir(n,a,f,o):(Oe.flags|=i,c.memoizedState=Ir(1|n,a,f,o))}function jf(i,n){eo(8390656,8,i,n)}function Xu(i,n){to(2048,8,i,n)}function zf(i,n){return to(4,2,i,n)}function Hf(i,n){return to(4,4,i,n)}function Vf(i,n){if(typeof n=="function"){i=i();var a=n(i);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function qf(i,n,a){a=a!=null?a.concat([i]):null,to(4,4,Vf.bind(null,n,i),a)}function Zu(){}function Ff(i,n){var a=kt();n=n===void 0?null:n;var o=a.memoizedState;return n!==null&&Hu(n,o[1])?o[0]:(a.memoizedState=[i,n],i)}function $f(i,n){var a=kt();n=n===void 0?null:n;var o=a.memoizedState;if(n!==null&&Hu(n,o[1]))return o[0];if(o=i(),Vs){ni(!0);try{i()}finally{ni(!1)}}return a.memoizedState=[o,n],o}function ec(i,n,a){return a===void 0||(Zn&1073741824)!==0?i.memoizedState=n:(i.memoizedState=a,i=Kp(),Oe.lanes|=i,us|=i,a)}function Yf(i,n,a,o){return di(a,n)?a:Dr.current!==null?(i=ec(i,a,o),di(i,n)||(Lt=!0),i):(Zn&42)===0?(Lt=!0,i.memoizedState=a):(i=Kp(),Oe.lanes|=i,us|=i,n)}function Kf(i,n,a,o,c){var f=B.p;B.p=f!==0&&8>f?f:8;var m=ee.T,E={};ee.T=E,nc(i,!1,n,a);try{var _=c(),N=ee.S;if(N!==null&&N(E,_),_!==null&&typeof _=="object"&&typeof _.then=="function"){var F=bb(_,o);Ua(i,n,F,vi(i))}else Ua(i,n,o,vi(i))}catch(J){Ua(i,n,{then:function(){},status:"rejected",reason:J},vi())}finally{B.p=f,ee.T=m}}function Ab(){}function tc(i,n,a,o){if(i.tag!==5)throw Error(r(476));var c=Qf(i).queue;Kf(i,c,n,z,a===null?Ab:function(){return Wf(i),a(o)})}function Qf(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:kn,lastRenderedState:z},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:kn,lastRenderedState:a},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Wf(i){var n=Qf(i).next.queue;Ua(i,n,{},vi())}function ic(){return Yt(il)}function Jf(){return kt().memoizedState}function Xf(){return kt().memoizedState}function Cb(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var a=vi();i=ns(a);var o=ss(n,i,a);o!==null&&(ei(o,n,a),Ga(o,n,a)),n={cache:Gu()},i.payload=n;return}n=n.return}}function Rb(i,n,a){var o=vi();a={lane:o,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},io(i)?ep(n,a):(a=Ou(i,n,a,o),a!==null&&(ei(a,i,o),tp(a,n,o)))}function Zf(i,n,a){var o=vi();Ua(i,n,a,o)}function Ua(i,n,a,o){var c={lane:o,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(io(i))ep(n,c);else{var f=i.alternate;if(i.lanes===0&&(f===null||f.lanes===0)&&(f=n.lastRenderedReducer,f!==null))try{var m=n.lastRenderedState,E=f(m,a);if(c.hasEagerState=!0,c.eagerState=E,di(E,m))return Gl(i,n,c,0),et===null&&Bl(),!1}catch{}finally{}if(a=Ou(i,n,c,o),a!==null)return ei(a,i,o),tp(a,n,o),!0}return!1}function nc(i,n,a,o){if(o={lane:2,revertLane:$c(),action:o,hasEagerState:!1,eagerState:null,next:null},io(i)){if(n)throw Error(r(479))}else n=Ou(i,a,o,2),n!==null&&ei(n,i,2)}function io(i){var n=i.alternate;return i===Oe||n!==null&&n===Oe}function ep(i,n){Or=Ql=!0;var a=i.pending;a===null?n.next=n:(n.next=a.next,a.next=n),i.pending=n}function tp(i,n,a){if((a&4194176)!==0){var o=n.lanes;o&=i.pendingLanes,a|=o,n.lanes=a,_l(i,a)}}var ln={readContext:Yt,use:Xl,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useLayoutEffect:mt,useInsertionEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useSyncExternalStore:mt,useId:mt};ln.useCacheRefresh=mt,ln.useMemoCache=mt,ln.useHostTransitionStatus=mt,ln.useFormState=mt,ln.useActionState=mt,ln.useOptimistic=mt;var qs={readContext:Yt,use:Xl,useCallback:function(i,n){return li().memoizedState=[i,n===void 0?null:n],i},useContext:Yt,useEffect:jf,useImperativeHandle:function(i,n,a){a=a!=null?a.concat([i]):null,eo(4194308,4,Vf.bind(null,n,i),a)},useLayoutEffect:function(i,n){return eo(4194308,4,i,n)},useInsertionEffect:function(i,n){eo(4,2,i,n)},useMemo:function(i,n){var a=li();n=n===void 0?null:n;var o=i();if(Vs){ni(!0);try{i()}finally{ni(!1)}}return a.memoizedState=[o,n],o},useReducer:function(i,n,a){var o=li();if(a!==void 0){var c=a(n);if(Vs){ni(!0);try{a(n)}finally{ni(!1)}}}else c=n;return o.memoizedState=o.baseState=c,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:c},o.queue=i,i=i.dispatch=Rb.bind(null,Oe,i),[o.memoizedState,i]},useRef:function(i){var n=li();return i={current:i},n.memoizedState=i},useState:function(i){i=Wu(i);var n=i.queue,a=Zf.bind(null,Oe,n);return n.dispatch=a,[i.memoizedState,a]},useDebugValue:Zu,useDeferredValue:function(i,n){var a=li();return ec(a,i,n)},useTransition:function(){var i=Wu(!1);return i=Kf.bind(null,Oe,i.queue,!0,!1),li().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,a){var o=Oe,c=li();if(ze){if(a===void 0)throw Error(r(407));a=a()}else{if(a=n(),et===null)throw Error(r(349));(Ge&60)!==0||Af(o,n,a)}c.memoizedState=a;var f={value:a,getSnapshot:n};return c.queue=f,jf(Rf.bind(null,o,f,i),[i]),o.flags|=2048,Ir(9,Cf.bind(null,o,f,a,n),{destroy:void 0},null),a},useId:function(){var i=li(),n=et.identifierPrefix;if(ze){var a=Sn,o=bn;a=(o&~(1<<32-Vt(o)-1)).toString(32)+a,n=":"+n+"R"+a,a=Wl++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=Sb++,n=":"+n+"r"+a.toString(32)+":";return i.memoizedState=n},useCacheRefresh:function(){return li().memoizedState=Cb.bind(null,Oe)}};qs.useMemoCache=Yu,qs.useHostTransitionStatus=ic,qs.useFormState=Nf,qs.useActionState=Nf,qs.useOptimistic=function(i){var n=li();n.memoizedState=n.baseState=i;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=nc.bind(null,Oe,!0,a),a.dispatch=n,[i,n]};var es={readContext:Yt,use:Xl,useCallback:Ff,useContext:Yt,useEffect:Xu,useImperativeHandle:qf,useInsertionEffect:zf,useLayoutEffect:Hf,useMemo:$f,useReducer:Zl,useRef:Gf,useState:function(){return Zl(kn)},useDebugValue:Zu,useDeferredValue:function(i,n){var a=kt();return Yf(a,Ye.memoizedState,i,n)},useTransition:function(){var i=Zl(kn)[0],n=kt().memoizedState;return[typeof i=="boolean"?i:Na(i),n]},useSyncExternalStore:Ef,useId:Jf};es.useCacheRefresh=Xf,es.useMemoCache=Yu,es.useHostTransitionStatus=ic,es.useFormState=Uf,es.useActionState=Uf,es.useOptimistic=function(i,n){var a=kt();return Df(a,Ye,i,n)};var Fs={readContext:Yt,use:Xl,useCallback:Ff,useContext:Yt,useEffect:Xu,useImperativeHandle:qf,useInsertionEffect:zf,useLayoutEffect:Hf,useMemo:$f,useReducer:Qu,useRef:Gf,useState:function(){return Qu(kn)},useDebugValue:Zu,useDeferredValue:function(i,n){var a=kt();return Ye===null?ec(a,i,n):Yf(a,Ye.memoizedState,i,n)},useTransition:function(){var i=Qu(kn)[0],n=kt().memoizedState;return[typeof i=="boolean"?i:Na(i),n]},useSyncExternalStore:Ef,useId:Jf};Fs.useCacheRefresh=Xf,Fs.useMemoCache=Yu,Fs.useHostTransitionStatus=ic,Fs.useFormState=Bf,Fs.useActionState=Bf,Fs.useOptimistic=function(i,n){var a=kt();return Ye!==null?Df(a,Ye,i,n):(a.baseState=i,[i,a.queue.dispatch])};function sc(i,n,a,o){n=i.memoizedState,a=a(o,n),a=a==null?n:Re({},n,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var rc={isMounted:function(i){return(i=i._reactInternals)?A(i)===i:!1},enqueueSetState:function(i,n,a){i=i._reactInternals;var o=vi(),c=ns(o);c.payload=n,a!=null&&(c.callback=a),n=ss(i,c,o),n!==null&&(ei(n,i,o),Ga(n,i,o))},enqueueReplaceState:function(i,n,a){i=i._reactInternals;var o=vi(),c=ns(o);c.tag=1,c.payload=n,a!=null&&(c.callback=a),n=ss(i,c,o),n!==null&&(ei(n,i,o),Ga(n,i,o))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var a=vi(),o=ns(a);o.tag=2,n!=null&&(o.callback=n),n=ss(i,o,a),n!==null&&(ei(n,i,a),Ga(n,i,a))}};function ip(i,n,a,o,c,f,m){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(o,f,m):n.prototype&&n.prototype.isPureReactComponent?!Ea(a,o)||!Ea(c,f):!0}function np(i,n,a,o){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==i&&rc.enqueueReplaceState(n,n.state,null)}function $s(i,n){var a=n;if("ref"in n){a={};for(var o in n)o!=="ref"&&(a[o]=n[o])}if(i=i.defaultProps){a===n&&(a=Re({},a));for(var c in i)a[c]===void 0&&(a[c]=i[c])}return a}var no=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function sp(i){no(i)}function rp(i){console.error(i)}function ap(i){no(i)}function so(i,n){try{var a=i.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function lp(i,n,a){try{var o=i.onCaughtError;o(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function ac(i,n,a){return a=ns(a),a.tag=3,a.payload={element:null},a.callback=function(){so(i,n)},a}function op(i){return i=ns(i),i.tag=3,i}function up(i,n,a,o){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var f=o.value;i.payload=function(){return c(f)},i.callback=function(){lp(n,a,o)}}var m=a.stateNode;m!==null&&typeof m.componentDidCatch=="function"&&(i.callback=function(){lp(n,a,o),typeof c!="function"&&(cs===null?cs=new Set([this]):cs.add(this));var E=o.stack;this.componentDidCatch(o.value,{componentStack:E!==null?E:""})})}function _b(i,n,a,o,c){if(a.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=a.alternate,n!==null&&Ba(n,a,c,!0),a=Ri.current,a!==null){switch(a.tag){case 13:return an===null?zc():a.alternate===null&&ft===0&&(ft=3),a.flags&=-257,a.flags|=65536,a.lanes=c,o===Uu?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([o]):n.add(o),Vc(i,o,c)),!1;case 22:return a.flags|=65536,o===Uu?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([o]):a.add(o)),Vc(i,o,c)),!1}throw Error(r(435,a.tag))}return Vc(i,o,c),zc(),!1}if(ze)return n=Ri.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=c,o!==Nu&&(i=Error(r(422),{cause:o}),_a(Ei(i,a)))):(o!==Nu&&(n=Error(r(423),{cause:o}),_a(Ei(n,a))),i=i.current.alternate,i.flags|=65536,c&=-c,i.lanes|=c,o=Ei(o,a),c=ac(i.stateNode,o,c),Tc(i,c),ft!==4&&(ft=2)),!1;var f=Error(r(520),{cause:o});if(f=Ei(f,a),Ya===null?Ya=[f]:Ya.push(f),ft!==4&&(ft=2),n===null)return!0;o=Ei(o,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,i=c&-c,a.lanes|=i,i=ac(a.stateNode,o,i),Tc(a,i),!1;case 1:if(n=a.type,f=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(cs===null||!cs.has(f))))return a.flags|=65536,c&=-c,a.lanes|=c,c=op(c),up(c,i,a,o),Tc(a,c),!1}a=a.return}while(a!==null);return!1}var cp=Error(r(461)),Lt=!1;function Gt(i,n,a,o){n.child=i===null?vf(n,null,a,o):zs(n,i.child,a,o)}function dp(i,n,a,o,c){a=a.render;var f=n.ref;if("ref"in o){var m={};for(var E in o)E!=="ref"&&(m[E]=o[E])}else m=o;return Ks(n),o=Vu(i,n,a,m,f,c),E=qu(),i!==null&&!Lt?(Fu(i,n,c),En(i,n,c)):(ze&&E&&Lu(n),n.flags|=1,Gt(i,n,o,c),n.child)}function hp(i,n,a,o,c){if(i===null){var f=a.type;return typeof f=="function"&&!Dc(f)&&f.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=f,fp(i,n,f,o,c)):(i=uo(a.type,null,o,n,n.mode,c),i.ref=n.ref,i.return=n,n.child=i)}if(f=i.child,!vc(i,c)){var m=f.memoizedProps;if(a=a.compare,a=a!==null?a:Ea,a(m,o)&&i.ref===n.ref)return En(i,n,c)}return n.flags|=1,i=os(f,o),i.ref=n.ref,i.return=n,n.child=i}function fp(i,n,a,o,c){if(i!==null){var f=i.memoizedProps;if(Ea(f,o)&&i.ref===n.ref)if(Lt=!1,n.pendingProps=o=f,vc(i,c))(i.flags&131072)!==0&&(Lt=!0);else return n.lanes=i.lanes,En(i,n,c)}return lc(i,n,a,o,c)}function pp(i,n,a){var o=n.pendingProps,c=o.children,f=(n.stateNode._pendingVisibility&2)!==0,m=i!==null?i.memoizedState:null;if(xa(i,n),o.mode==="hidden"||f){if((n.flags&128)!==0){if(o=m!==null?m.baseLanes|a:a,i!==null){for(c=n.child=i.child,f=0;c!==null;)f=f|c.lanes|c.childLanes,c=c.sibling;n.childLanes=f&~o}else n.childLanes=0,n.child=null;return vp(i,n,o,a)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&Kl(n,m!==null?m.cachePool:null),m!==null?gf(n,m):xu(),mf(n);else return n.lanes=n.childLanes=536870912,vp(i,n,m!==null?m.baseLanes|a:a,a)}else m!==null?(Kl(n,m.cachePool),gf(n,m),Xn(),n.memoizedState=null):(i!==null&&Kl(n,null),xu(),Xn());return Gt(i,n,c,a),n.child}function vp(i,n,a,o){var c=zu();return c=c===null?null:{parent:Pt._currentValue,pool:c},n.memoizedState={baseLanes:a,cachePool:c},i!==null&&Kl(n,null),xu(),mf(n),i!==null&&Ba(i,n,o,!0),null}function xa(i,n){var a=n.ref;if(a===null)i!==null&&i.ref!==null&&(n.flags|=2097664);else{if(typeof a!="function"&&typeof a!="object")throw Error(r(284));(i===null||i.ref!==a)&&(n.flags|=2097664)}}function lc(i,n,a,o,c){return Ks(n),a=Vu(i,n,a,o,void 0,c),o=qu(),i!==null&&!Lt?(Fu(i,n,c),En(i,n,c)):(ze&&o&&Lu(n),n.flags|=1,Gt(i,n,a,c),n.child)}function gp(i,n,a,o,c,f){return Ks(n),n.updateQueue=null,a=kf(n,o,a,c),Tf(i),o=qu(),i!==null&&!Lt?(Fu(i,n,f),En(i,n,f)):(ze&&o&&Lu(n),n.flags|=1,Gt(i,n,a,f),n.child)}function mp(i,n,a,o,c){if(Ks(n),n.stateNode===null){var f=Cr,m=a.contextType;typeof m=="object"&&m!==null&&(f=Yt(m)),f=new a(o,f),n.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=rc,n.stateNode=f,f._reactInternals=n,f=n.stateNode,f.props=o,f.state=n.memoizedState,f.refs={},bc(n),m=a.contextType,f.context=typeof m=="object"&&m!==null?Yt(m):Cr,f.state=n.memoizedState,m=a.getDerivedStateFromProps,typeof m=="function"&&(sc(n,a,m,o),f.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(m=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),m!==f.state&&rc.enqueueReplaceState(f,f.state,null),za(n,o,f,c),ja(),f.state=n.memoizedState),typeof f.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(i===null){f=n.stateNode;var E=n.memoizedProps,_=$s(a,E);f.props=_;var N=f.context,F=a.contextType;m=Cr,typeof F=="object"&&F!==null&&(m=Yt(F));var J=a.getDerivedStateFromProps;F=typeof J=="function"||typeof f.getSnapshotBeforeUpdate=="function",E=n.pendingProps!==E,F||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(E||N!==m)&&np(n,f,o,m),is=!1;var H=n.memoizedState;f.state=H,za(n,o,f,c),ja(),N=n.memoizedState,E||H!==N||is?(typeof J=="function"&&(sc(n,a,J,o),N=n.memoizedState),(_=is||ip(n,a,_,o,H,N,m))?(F||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(n.flags|=4194308)):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=N),f.props=o,f.state=N,f.context=m,o=_):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{f=n.stateNode,Sc(i,n),m=n.memoizedProps,F=$s(a,m),f.props=F,J=n.pendingProps,H=f.context,N=a.contextType,_=Cr,typeof N=="object"&&N!==null&&(_=Yt(N)),E=a.getDerivedStateFromProps,(N=typeof E=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(m!==J||H!==_)&&np(n,f,o,_),is=!1,H=n.memoizedState,f.state=H,za(n,o,f,c),ja();var q=n.memoizedState;m!==J||H!==q||is||i!==null&&i.dependencies!==null&&ro(i.dependencies)?(typeof E=="function"&&(sc(n,a,E,o),q=n.memoizedState),(F=is||ip(n,a,F,o,H,q,_)||i!==null&&i.dependencies!==null&&ro(i.dependencies))?(N||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(o,q,_),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(o,q,_)),typeof f.componentDidUpdate=="function"&&(n.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof f.componentDidUpdate!="function"||m===i.memoizedProps&&H===i.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||m===i.memoizedProps&&H===i.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=q),f.props=o,f.state=q,f.context=_,o=F):(typeof f.componentDidUpdate!="function"||m===i.memoizedProps&&H===i.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||m===i.memoizedProps&&H===i.memoizedState||(n.flags|=1024),o=!1)}return f=o,xa(i,n),o=(n.flags&128)!==0,f||o?(f=n.stateNode,a=o&&typeof a.getDerivedStateFromError!="function"?null:f.render(),n.flags|=1,i!==null&&o?(n.child=zs(n,i.child,null,c),n.child=zs(n,null,a,c)):Gt(i,n,a,c),n.memoizedState=f.state,i=n.child):i=En(i,n,c),i}function yp(i,n,a,o){return Ra(),n.flags|=256,Gt(i,n,a,o),n.child}var oc={dehydrated:null,treeContext:null,retryLane:0};function uc(i){return{baseLanes:i,cachePool:Sf()}}function cc(i,n,a){return i=i!==null?i.childLanes&~a:0,n&&(i|=wi),i}function bp(i,n,a){var o=n.pendingProps,c=!1,f=(n.flags&128)!==0,m;if((m=f)||(m=i!==null&&i.memoizedState===null?!1:(_t.current&2)!==0),m&&(c=!0,n.flags&=-129),m=(n.flags&32)!==0,n.flags&=-33,i===null){if(ze){if(c?Jn(n):Xn(),ze){var E=Bt,_;if(_=E){e:{for(_=E,E=rn;_.nodeType!==8;){if(!E){E=null;break e}if(_=Ki(_.nextSibling),_===null){E=null;break e}}E=_}E!==null?(n.memoizedState={dehydrated:E,treeContext:Bs!==null?{id:bn,overflow:Sn}:null,retryLane:536870912},_=Di(18,null,null,0),_.stateNode=E,_.return=n,n.child=_,Zt=n,Bt=null,_=!0):_=!1}_||js(n)}if(E=n.memoizedState,E!==null&&(E=E.dehydrated,E!==null))return E.data==="$!"?n.lanes=16:n.lanes=536870912,null;Tn(n)}return E=o.children,o=o.fallback,c?(Xn(),c=n.mode,E=hc({mode:"hidden",children:E},c),o=Ws(o,c,a,null),E.return=n,o.return=n,E.sibling=o,n.child=E,c=n.child,c.memoizedState=uc(a),c.childLanes=cc(i,m,a),n.memoizedState=oc,o):(Jn(n),dc(n,E))}if(_=i.memoizedState,_!==null&&(E=_.dehydrated,E!==null)){if(f)n.flags&256?(Jn(n),n.flags&=-257,n=fc(i,n,a)):n.memoizedState!==null?(Xn(),n.child=i.child,n.flags|=128,n=null):(Xn(),c=o.fallback,E=n.mode,o=hc({mode:"visible",children:o.children},E),c=Ws(c,E,a,null),c.flags|=2,o.return=n,c.return=n,o.sibling=c,n.child=o,zs(n,i.child,null,a),o=n.child,o.memoizedState=uc(a),o.childLanes=cc(i,m,a),n.memoizedState=oc,n=c);else if(Jn(n),E.data==="$!"){if(m=E.nextSibling&&E.nextSibling.dataset,m)var N=m.dgst;m=N,o=Error(r(419)),o.stack="",o.digest=m,_a({value:o,source:null,stack:null}),n=fc(i,n,a)}else if(Lt||Ba(i,n,a,!1),m=(a&i.childLanes)!==0,Lt||m){if(m=et,m!==null){if(o=a&-a,(o&42)!==0)o=1;else switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=64;break;case 268435456:o=134217728;break;default:o=0}if(o=(o&(m.suspendedLanes|a))!==0?0:o,o!==0&&o!==_.retryLane)throw _.retryLane=o,Wn(i,o),ei(m,i,o),cp}E.data==="$?"||zc(),n=fc(i,n,a)}else E.data==="$?"?(n.flags|=128,n.child=i.child,n=Hb.bind(null,i),E._reactRetry=n,n=null):(i=_.treeContext,Bt=Ki(E.nextSibling),Zt=n,ze=!0,$i=null,rn=!1,i!==null&&(Ai[Ci++]=bn,Ai[Ci++]=Sn,Ai[Ci++]=Bs,bn=i.id,Sn=i.overflow,Bs=n),n=dc(n,o.children),n.flags|=4096);return n}return c?(Xn(),c=o.fallback,E=n.mode,_=i.child,N=_.sibling,o=os(_,{mode:"hidden",children:o.children}),o.subtreeFlags=_.subtreeFlags&31457280,N!==null?c=os(N,c):(c=Ws(c,E,a,null),c.flags|=2),c.return=n,o.return=n,o.sibling=c,n.child=o,o=c,c=n.child,E=i.child.memoizedState,E===null?E=uc(a):(_=E.cachePool,_!==null?(N=Pt._currentValue,_=_.parent!==N?{parent:N,pool:N}:_):_=Sf(),E={baseLanes:E.baseLanes|a,cachePool:_}),c.memoizedState=E,c.childLanes=cc(i,m,a),n.memoizedState=oc,o):(Jn(n),a=i.child,i=a.sibling,a=os(a,{mode:"visible",children:o.children}),a.return=n,a.sibling=null,i!==null&&(m=n.deletions,m===null?(n.deletions=[i],n.flags|=16):m.push(i)),n.child=a,n.memoizedState=null,a)}function dc(i,n){return n=hc({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function hc(i,n){return Fp(i,n,0,null)}function fc(i,n,a){return zs(n,i.child,null,a),i=dc(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function Sp(i,n,a){i.lanes|=n;var o=i.alternate;o!==null&&(o.lanes|=n),mc(i.return,n,a)}function pc(i,n,a,o,c){var f=i.memoizedState;f===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:c}:(f.isBackwards=n,f.rendering=null,f.renderingStartTime=0,f.last=o,f.tail=a,f.tailMode=c)}function Tp(i,n,a){var o=n.pendingProps,c=o.revealOrder,f=o.tail;if(Gt(i,n,o.children,a),o=_t.current,(o&2)!==0)o=o&1|2,n.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Sp(i,a,n);else if(i.tag===19)Sp(i,a,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break e;for(;i.sibling===null;){if(i.return===null||i.return===n)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}o&=1}switch(ue(_t,o),c){case"forwards":for(a=n.child,c=null;a!==null;)i=a.alternate,i!==null&&Yl(i)===null&&(c=a),a=a.sibling;a=c,a===null?(c=n.child,n.child=null):(c=a.sibling,a.sibling=null),pc(n,!1,c,a,f);break;case"backwards":for(a=null,c=n.child,n.child=null;c!==null;){if(i=c.alternate,i!==null&&Yl(i)===null){n.child=c;break}i=c.sibling,c.sibling=a,a=c,c=i}pc(n,!0,a,null,f);break;case"together":pc(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function En(i,n,a){if(i!==null&&(n.dependencies=i.dependencies),us|=n.lanes,(a&n.childLanes)===0)if(i!==null){if(Ba(i,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(r(153));if(n.child!==null){for(i=n.child,a=os(i,i.pendingProps),n.child=a,a.return=n;i.sibling!==null;)i=i.sibling,a=a.sibling=os(i,i.pendingProps),a.return=n;a.sibling=null}return n.child}function vc(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&ro(i)))}function Pb(i,n,a){switch(n.tag){case 3:Ut(n,n.stateNode.containerInfo),ts(n,Pt,i.memoizedState.cache),Ra();break;case 27:case 5:oi(n);break;case 4:Ut(n,n.stateNode.containerInfo);break;case 10:ts(n,n.type,n.memoizedProps.value);break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(Jn(n),n.flags|=128,null):(a&n.child.childLanes)!==0?bp(i,n,a):(Jn(n),i=En(i,n,a),i!==null?i.sibling:null);Jn(n);break;case 19:var c=(i.flags&128)!==0;if(o=(a&n.childLanes)!==0,o||(Ba(i,n,a,!1),o=(a&n.childLanes)!==0),c){if(o)return Tp(i,n,a);n.flags|=128}if(c=n.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ue(_t,_t.current),o)break;return null;case 22:case 23:return n.lanes=0,pp(i,n,a);case 24:ts(n,Pt,i.memoizedState.cache)}return En(i,n,a)}function kp(i,n,a){if(i!==null)if(i.memoizedProps!==n.pendingProps)Lt=!0;else{if(!vc(i,a)&&(n.flags&128)===0)return Lt=!1,Pb(i,n,a);Lt=(i.flags&131072)!==0}else Lt=!1,ze&&(n.flags&1048576)!==0&&af(n,Hl,n.index);switch(n.lanes=0,n.tag){case 16:e:{i=n.pendingProps;var o=n.elementType,c=o._init;if(o=c(o._payload),n.type=o,typeof o=="function")Dc(o)?(i=$s(o,i),n.tag=1,n=mp(null,n,o,i,a)):(n.tag=0,n=lc(null,n,o,i,a));else{if(o!=null){if(c=o.$$typeof,c===D){n.tag=11,n=dp(null,n,o,i,a);break e}else if(c===le){n.tag=14,n=hp(null,n,o,i,a);break e}}throw n=we(o)||o,Error(r(306,n,""))}}return n;case 0:return lc(i,n,n.type,n.pendingProps,a);case 1:return o=n.type,c=$s(o,n.pendingProps),mp(i,n,o,c,a);case 3:e:{if(Ut(n,n.stateNode.containerInfo),i===null)throw Error(r(387));var f=n.pendingProps;c=n.memoizedState,o=c.element,Sc(i,n),za(n,f,null,a);var m=n.memoizedState;if(f=m.cache,ts(n,Pt,f),f!==c.cache&&yc(n,[Pt],a,!0),ja(),f=m.element,c.isDehydrated)if(c={element:f,isDehydrated:!1,cache:m.cache},n.updateQueue.baseState=c,n.memoizedState=c,n.flags&256){n=yp(i,n,f,a);break e}else if(f!==o){o=Ei(Error(r(424)),n),_a(o),n=yp(i,n,f,a);break e}else for(Bt=Ki(n.stateNode.containerInfo.firstChild),Zt=n,ze=!0,$i=null,rn=!0,a=vf(n,null,f,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Ra(),f===o){n=En(i,n,a);break e}Gt(i,n,f,a)}n=n.child}return n;case 26:return xa(i,n),i===null?(a=Cv(n.type,null,n.pendingProps,null))?n.memoizedState=a:ze||(a=n.type,i=n.pendingProps,o=ko(je.current).createElement(a),o[Mt]=n,o[qt]=i,jt(o,a,i),St(o),n.stateNode=o):n.memoizedState=Cv(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return oi(n),i===null&&ze&&(o=n.stateNode=kv(n.type,n.pendingProps,je.current),Zt=n,rn=!0,Bt=Ki(o.firstChild)),o=n.pendingProps.children,i!==null||ze?Gt(i,n,o,a):n.child=zs(n,null,o,a),xa(i,n),n.child;case 5:return i===null&&ze&&((c=o=Bt)&&(o=sS(o,n.type,n.pendingProps,rn),o!==null?(n.stateNode=o,Zt=n,Bt=Ki(o.firstChild),rn=!1,c=!0):c=!1),c||js(n)),oi(n),c=n.type,f=n.pendingProps,m=i!==null?i.memoizedProps:null,o=f.children,td(c,f)?o=null:m!==null&&td(c,m)&&(n.flags|=32),n.memoizedState!==null&&(c=Vu(i,n,Tb,null,null,a),il._currentValue=c),xa(i,n),Gt(i,n,o,a),n.child;case 6:return i===null&&ze&&((i=a=Bt)&&(a=rS(a,n.pendingProps,rn),a!==null?(n.stateNode=a,Zt=n,Bt=null,i=!0):i=!1),i||js(n)),null;case 13:return bp(i,n,a);case 4:return Ut(n,n.stateNode.containerInfo),o=n.pendingProps,i===null?n.child=zs(n,null,o,a):Gt(i,n,o,a),n.child;case 11:return dp(i,n,n.type,n.pendingProps,a);case 7:return Gt(i,n,n.pendingProps,a),n.child;case 8:return Gt(i,n,n.pendingProps.children,a),n.child;case 12:return Gt(i,n,n.pendingProps.children,a),n.child;case 10:return o=n.pendingProps,ts(n,n.type,o.value),Gt(i,n,o.children,a),n.child;case 9:return c=n.type._context,o=n.pendingProps.children,Ks(n),c=Yt(c),o=o(c),n.flags|=1,Gt(i,n,o,a),n.child;case 14:return hp(i,n,n.type,n.pendingProps,a);case 15:return fp(i,n,n.type,n.pendingProps,a);case 19:return Tp(i,n,a);case 22:return pp(i,n,a);case 24:return Ks(n),o=Yt(Pt),i===null?(c=zu(),c===null&&(c=et,f=Gu(),c.pooledCache=f,f.refCount++,f!==null&&(c.pooledCacheLanes|=a),c=f),n.memoizedState={parent:o,cache:c},bc(n),ts(n,Pt,c)):((i.lanes&a)!==0&&(Sc(i,n),za(n,null,null,a),ja()),c=i.memoizedState,f=n.memoizedState,c.parent!==o?(c={parent:o,cache:o},n.memoizedState=c,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=c),ts(n,Pt,o)):(o=f.cache,ts(n,Pt,o),o!==c.cache&&yc(n,[Pt],a,!0))),Gt(i,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(r(156,n.tag))}var gc=X(null),Ys=null,An=null;function ts(i,n,a){ue(gc,n._currentValue),n._currentValue=a}function Cn(i){i._currentValue=gc.current,Ae(gc)}function mc(i,n,a){for(;i!==null;){var o=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),i===a)break;i=i.return}}function yc(i,n,a,o){var c=i.child;for(c!==null&&(c.return=i);c!==null;){var f=c.dependencies;if(f!==null){var m=c.child;f=f.firstContext;e:for(;f!==null;){var E=f;f=c;for(var _=0;_<n.length;_++)if(E.context===n[_]){f.lanes|=a,E=f.alternate,E!==null&&(E.lanes|=a),mc(f.return,a,i),o||(m=null);break e}f=E.next}}else if(c.tag===18){if(m=c.return,m===null)throw Error(r(341));m.lanes|=a,f=m.alternate,f!==null&&(f.lanes|=a),mc(m,a,i),m=null}else m=c.child;if(m!==null)m.return=c;else for(m=c;m!==null;){if(m===i){m=null;break}if(c=m.sibling,c!==null){c.return=m.return,m=c;break}m=m.return}c=m}}function Ba(i,n,a,o){i=null;for(var c=n,f=!1;c!==null;){if(!f){if((c.flags&524288)!==0)f=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var m=c.alternate;if(m===null)throw Error(r(387));if(m=m.memoizedProps,m!==null){var E=c.type;di(c.pendingProps.value,m.value)||(i!==null?i.push(E):i=[E])}}else if(c===ii.current){if(m=c.alternate,m===null)throw Error(r(387));m.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(i!==null?i.push(il):i=[il])}c=c.return}i!==null&&yc(n,i,a,o),n.flags|=262144}function ro(i){for(i=i.firstContext;i!==null;){if(!di(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Ks(i){Ys=i,An=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Yt(i){return Ep(Ys,i)}function ao(i,n){return Ys===null&&Ks(i),Ep(i,n)}function Ep(i,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},An===null){if(i===null)throw Error(r(308));An=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else An=An.next=n;return a}var is=!1;function bc(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sc(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ns(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function ss(i,n,a){var o=i.updateQueue;if(o===null)return null;if(o=o.shared,(ut&2)!==0){var c=o.pending;return c===null?n.next=n:(n.next=c.next,c.next=n),o.pending=n,n=jl(i),sf(i,null,a),n}return Gl(i,o,n,a),jl(i)}function Ga(i,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194176)!==0)){var o=n.lanes;o&=i.pendingLanes,a|=o,n.lanes=a,_l(i,a)}}function Tc(i,n){var a=i.updateQueue,o=i.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var c=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var m={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};f===null?c=f=m:f=f.next=m,a=a.next}while(a!==null);f===null?c=f=n:f=f.next=n}else c=f=n;a={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:f,shared:o.shared,callbacks:o.callbacks},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=n:i.next=n,a.lastBaseUpdate=n}var kc=!1;function ja(){if(kc){var i=Mr;if(i!==null)throw i}}function za(i,n,a,o){kc=!1;var c=i.updateQueue;is=!1;var f=c.firstBaseUpdate,m=c.lastBaseUpdate,E=c.shared.pending;if(E!==null){c.shared.pending=null;var _=E,N=_.next;_.next=null,m===null?f=N:m.next=N,m=_;var F=i.alternate;F!==null&&(F=F.updateQueue,E=F.lastBaseUpdate,E!==m&&(E===null?F.firstBaseUpdate=N:E.next=N,F.lastBaseUpdate=_))}if(f!==null){var J=c.baseState;m=0,F=N=_=null,E=f;do{var H=E.lane&-536870913,q=H!==E.lane;if(q?(Ge&H)===H:(o&H)===H){H!==0&&H===wr&&(kc=!0),F!==null&&(F=F.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});e:{var ce=i,Ce=E;H=n;var pt=a;switch(Ce.tag){case 1:if(ce=Ce.payload,typeof ce=="function"){J=ce.call(pt,J,H);break e}J=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=Ce.payload,H=typeof ce=="function"?ce.call(pt,J,H):ce,H==null)break e;J=Re({},J,H);break e;case 2:is=!0}}H=E.callback,H!==null&&(i.flags|=64,q&&(i.flags|=8192),q=c.callbacks,q===null?c.callbacks=[H]:q.push(H))}else q={lane:H,tag:E.tag,payload:E.payload,callback:E.callback,next:null},F===null?(N=F=q,_=J):F=F.next=q,m|=H;if(E=E.next,E===null){if(E=c.shared.pending,E===null)break;q=E,E=q.next,q.next=null,c.lastBaseUpdate=q,c.shared.pending=null}}while(!0);F===null&&(_=J),c.baseState=_,c.firstBaseUpdate=N,c.lastBaseUpdate=F,f===null&&(c.shared.lanes=0),us|=m,i.lanes=m,i.memoizedState=J}}function Ap(i,n){if(typeof i!="function")throw Error(r(191,i));i.call(n)}function Cp(i,n){var a=i.callbacks;if(a!==null)for(i.callbacks=null,i=0;i<a.length;i++)Ap(a[i],n)}function Ha(i,n){try{var a=n.updateQueue,o=a!==null?a.lastEffect:null;if(o!==null){var c=o.next;a=c;do{if((a.tag&i)===i){o=void 0;var f=a.create,m=a.inst;o=f(),m.destroy=o}a=a.next}while(a!==c)}}catch(E){Je(n,n.return,E)}}function rs(i,n,a){try{var o=n.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var f=c.next;o=f;do{if((o.tag&i)===i){var m=o.inst,E=m.destroy;if(E!==void 0){m.destroy=void 0,c=n;var _=a;try{E()}catch(N){Je(c,_,N)}}}o=o.next}while(o!==f)}}catch(N){Je(n,n.return,N)}}function Rp(i){var n=i.updateQueue;if(n!==null){var a=i.stateNode;try{Cp(n,a)}catch(o){Je(i,i.return,o)}}}function _p(i,n,a){a.props=$s(i.type,i.memoizedProps),a.state=i.memoizedState;try{a.componentWillUnmount()}catch(o){Je(i,n,o)}}function Qs(i,n){try{var a=i.ref;if(a!==null){var o=i.stateNode;switch(i.tag){case 26:case 27:case 5:var c=o;break;default:c=o}typeof a=="function"?i.refCleanup=a(c):a.current=c}}catch(f){Je(i,n,f)}}function hi(i,n){var a=i.ref,o=i.refCleanup;if(a!==null)if(typeof o=="function")try{o()}catch(c){Je(i,n,c)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){Je(i,n,c)}else a.current=null}function Pp(i){var n=i.type,a=i.memoizedProps,o=i.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break e;case"img":a.src?o.src=a.src:a.srcSet&&(o.srcset=a.srcSet)}}catch(c){Je(i,i.return,c)}}function Dp(i,n,a){try{var o=i.stateNode;Zb(o,i.type,a,n),o[qt]=n}catch(c){Je(i,i.return,c)}}function wp(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27||i.tag===4}function Ec(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||wp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==27&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Ac(i,n,a){var o=i.tag;if(o===5||o===6)i=i.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(i,n):a.insertBefore(i,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(i,a)):(n=a,n.appendChild(i)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=To));else if(o!==4&&o!==27&&(i=i.child,i!==null))for(Ac(i,n,a),i=i.sibling;i!==null;)Ac(i,n,a),i=i.sibling}function lo(i,n,a){var o=i.tag;if(o===5||o===6)i=i.stateNode,n?a.insertBefore(i,n):a.appendChild(i);else if(o!==4&&o!==27&&(i=i.child,i!==null))for(lo(i,n,a),i=i.sibling;i!==null;)lo(i,n,a),i=i.sibling}var Rn=!1,ht=!1,Cc=!1,Mp=typeof WeakSet=="function"?WeakSet:Set,It=null,Op=!1;function Db(i,n){if(i=i.containerInfo,Zc=Po,i=Kh(i),_u(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else e:{a=(a=i.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var c=o.anchorOffset,f=o.focusNode;o=o.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var m=0,E=-1,_=-1,N=0,F=0,J=i,H=null;t:for(;;){for(var q;J!==a||c!==0&&J.nodeType!==3||(E=m+c),J!==f||o!==0&&J.nodeType!==3||(_=m+o),J.nodeType===3&&(m+=J.nodeValue.length),(q=J.firstChild)!==null;)H=J,J=q;for(;;){if(J===i)break t;if(H===a&&++N===c&&(E=m),H===f&&++F===o&&(_=m),(q=J.nextSibling)!==null)break;J=H,H=J.parentNode}J=q}a=E===-1||_===-1?null:{start:E,end:_}}else a=null}a=a||{start:0,end:0}}else a=null;for(ed={focusedElem:i,selectionRange:a},Po=!1,It=n;It!==null;)if(n=It,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,It=i;else for(;It!==null;){switch(n=It,f=n.alternate,i=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&f!==null){i=void 0,a=n,c=f.memoizedProps,f=f.memoizedState,o=a.stateNode;try{var ce=$s(a.type,c,a.elementType===a.type);i=o.getSnapshotBeforeUpdate(ce,f),o.__reactInternalSnapshotBeforeUpdate=i}catch(Ce){Je(a,a.return,Ce)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,a=i.nodeType,a===9)sd(i);else if(a===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":sd(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=n.sibling,i!==null){i.return=n.return,It=i;break}It=n.return}return ce=Op,Op=!1,ce}function Lp(i,n,a){var o=a.flags;switch(a.tag){case 0:case 11:case 15:Pn(i,a),o&4&&Ha(5,a);break;case 1:if(Pn(i,a),o&4)if(i=a.stateNode,n===null)try{i.componentDidMount()}catch(E){Je(a,a.return,E)}else{var c=$s(a.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(c,n,i.__reactInternalSnapshotBeforeUpdate)}catch(E){Je(a,a.return,E)}}o&64&&Rp(a),o&512&&Qs(a,a.return);break;case 3:if(Pn(i,a),o&64&&(o=a.updateQueue,o!==null)){if(i=null,a.child!==null)switch(a.child.tag){case 27:case 5:i=a.child.stateNode;break;case 1:i=a.child.stateNode}try{Cp(o,i)}catch(E){Je(a,a.return,E)}}break;case 26:Pn(i,a),o&512&&Qs(a,a.return);break;case 27:case 5:Pn(i,a),n===null&&o&4&&Pp(a),o&512&&Qs(a,a.return);break;case 12:Pn(i,a);break;case 13:Pn(i,a),o&4&&Up(i,a);break;case 22:if(c=a.memoizedState!==null||Rn,!c){n=n!==null&&n.memoizedState!==null||ht;var f=Rn,m=ht;Rn=c,(ht=n)&&!m?as(i,a,(a.subtreeFlags&8772)!==0):Pn(i,a),Rn=f,ht=m}o&512&&(a.memoizedProps.mode==="manual"?Qs(a,a.return):hi(a,a.return));break;default:Pn(i,a)}}function Ip(i){var n=i.alternate;n!==null&&(i.alternate=null,Ip(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&da(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Et=null,fi=!1;function _n(i,n,a){for(a=a.child;a!==null;)Np(i,n,a),a=a.sibling}function Np(i,n,a){if(We&&typeof We.onCommitFiberUnmount=="function")try{We.onCommitFiberUnmount(ve,a)}catch{}switch(a.tag){case 26:ht||hi(a,n),_n(i,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:ht||hi(a,n);var o=Et,c=fi;for(Et=a.stateNode,_n(i,n,a),a=a.stateNode,n=a.attributes;n.length;)a.removeAttributeNode(n[0]);da(a),Et=o,fi=c;break;case 5:ht||hi(a,n);case 6:c=Et;var f=fi;if(Et=null,_n(i,n,a),Et=c,fi=f,Et!==null)if(fi)try{i=Et,o=a.stateNode,i.nodeType===8?i.parentNode.removeChild(o):i.removeChild(o)}catch(m){Je(a,n,m)}else try{Et.removeChild(a.stateNode)}catch(m){Je(a,n,m)}break;case 18:Et!==null&&(fi?(n=Et,a=a.stateNode,n.nodeType===8?nd(n.parentNode,a):n.nodeType===1&&nd(n,a),al(n)):nd(Et,a.stateNode));break;case 4:o=Et,c=fi,Et=a.stateNode.containerInfo,fi=!0,_n(i,n,a),Et=o,fi=c;break;case 0:case 11:case 14:case 15:ht||rs(2,a,n),ht||rs(4,a,n),_n(i,n,a);break;case 1:ht||(hi(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"&&_p(a,n,o)),_n(i,n,a);break;case 21:_n(i,n,a);break;case 22:ht||hi(a,n),ht=(o=ht)||a.memoizedState!==null,_n(i,n,a),ht=o;break;default:_n(i,n,a)}}function Up(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{al(i)}catch(a){Je(n,n.return,a)}}function wb(i){switch(i.tag){case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new Mp),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new Mp),n;default:throw Error(r(435,i.tag))}}function Rc(i,n){var a=wb(i);n.forEach(function(o){var c=Vb.bind(null,i,o);a.has(o)||(a.add(o),o.then(c,c))})}function _i(i,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var c=a[o],f=i,m=n,E=m;e:for(;E!==null;){switch(E.tag){case 27:case 5:Et=E.stateNode,fi=!1;break e;case 3:Et=E.stateNode.containerInfo,fi=!0;break e;case 4:Et=E.stateNode.containerInfo,fi=!0;break e}E=E.return}if(Et===null)throw Error(r(160));Np(f,m,c),Et=null,fi=!1,f=c.alternate,f!==null&&(f.return=null),c.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)xp(n,i),n=n.sibling}var Yi=null;function xp(i,n){var a=i.alternate,o=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:_i(n,i),Pi(i),o&4&&(rs(3,i,i.return),Ha(3,i),rs(5,i,i.return));break;case 1:_i(n,i),Pi(i),o&512&&(ht||a===null||hi(a,a.return)),o&64&&Rn&&(i=i.updateQueue,i!==null&&(o=i.callbacks,o!==null&&(a=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=a===null?o:a.concat(o))));break;case 26:var c=Yi;if(_i(n,i),Pi(i),o&512&&(ht||a===null||hi(a,a.return)),o&4){var f=a!==null?a.memoizedState:null;if(o=i.memoizedState,a===null)if(o===null)if(i.stateNode===null){e:{o=i.type,a=i.memoizedProps,c=c.ownerDocument||c;t:switch(o){case"title":f=c.getElementsByTagName("title")[0],(!f||f[_s]||f[Mt]||f.namespaceURI==="http://www.w3.org/2000/svg"||f.hasAttribute("itemprop"))&&(f=c.createElement(o),c.head.insertBefore(f,c.querySelector("head > title"))),jt(f,o,a),f[Mt]=i,St(f),o=f;break e;case"link":var m=Pv("link","href",c).get(o+(a.href||""));if(m){for(var E=0;E<m.length;E++)if(f=m[E],f.getAttribute("href")===(a.href==null?null:a.href)&&f.getAttribute("rel")===(a.rel==null?null:a.rel)&&f.getAttribute("title")===(a.title==null?null:a.title)&&f.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){m.splice(E,1);break t}}f=c.createElement(o),jt(f,o,a),c.head.appendChild(f);break;case"meta":if(m=Pv("meta","content",c).get(o+(a.content||""))){for(E=0;E<m.length;E++)if(f=m[E],f.getAttribute("content")===(a.content==null?null:""+a.content)&&f.getAttribute("name")===(a.name==null?null:a.name)&&f.getAttribute("property")===(a.property==null?null:a.property)&&f.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&f.getAttribute("charset")===(a.charSet==null?null:a.charSet)){m.splice(E,1);break t}}f=c.createElement(o),jt(f,o,a),c.head.appendChild(f);break;default:throw Error(r(468,o))}f[Mt]=i,St(f),o=f}i.stateNode=o}else Dv(c,i.type,i.stateNode);else i.stateNode=_v(c,o,i.memoizedProps);else f!==o?(f===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):f.count--,o===null?Dv(c,i.type,i.stateNode):_v(c,o,i.memoizedProps)):o===null&&i.stateNode!==null&&Dp(i,i.memoizedProps,a.memoizedProps)}break;case 27:if(o&4&&i.alternate===null){c=i.stateNode,f=i.memoizedProps;try{for(var _=c.firstChild;_;){var N=_.nextSibling,F=_.nodeName;_[_s]||F==="HEAD"||F==="BODY"||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&_.rel.toLowerCase()==="stylesheet"||c.removeChild(_),_=N}for(var J=i.type,H=c.attributes;H.length;)c.removeAttributeNode(H[0]);jt(c,J,f),c[Mt]=i,c[qt]=f}catch(ce){Je(i,i.return,ce)}}case 5:if(_i(n,i),Pi(i),o&512&&(ht||a===null||hi(a,a.return)),i.flags&32){c=i.stateNode;try{ui(c,"")}catch(ce){Je(i,i.return,ce)}}o&4&&i.stateNode!=null&&(c=i.memoizedProps,Dp(i,c,a!==null?a.memoizedProps:c)),o&1024&&(Cc=!0);break;case 6:if(_i(n,i),Pi(i),o&4){if(i.stateNode===null)throw Error(r(162));o=i.memoizedProps,a=i.stateNode;try{a.nodeValue=o}catch(ce){Je(i,i.return,ce)}}break;case 3:if(Co=null,c=Yi,Yi=Eo(n.containerInfo),_i(n,i),Yi=c,Pi(i),o&4&&a!==null&&a.memoizedState.isDehydrated)try{al(n.containerInfo)}catch(ce){Je(i,i.return,ce)}Cc&&(Cc=!1,Bp(i));break;case 4:o=Yi,Yi=Eo(i.stateNode.containerInfo),_i(n,i),Pi(i),Yi=o;break;case 12:_i(n,i),Pi(i);break;case 13:_i(n,i),Pi(i),i.child.flags&8192&&i.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Nc=Rt()),o&4&&(o=i.updateQueue,o!==null&&(i.updateQueue=null,Rc(i,o)));break;case 22:if(o&512&&(ht||a===null||hi(a,a.return)),_=i.memoizedState!==null,N=a!==null&&a.memoizedState!==null,F=Rn,J=ht,Rn=F||_,ht=J||N,_i(n,i),ht=J,Rn=F,Pi(i),n=i.stateNode,n._current=i,n._visibility&=-3,n._visibility|=n._pendingVisibility&2,o&8192&&(n._visibility=_?n._visibility&-2:n._visibility|1,_&&(n=Rn||ht,a===null||N||n||Nr(i)),i.memoizedProps===null||i.memoizedProps.mode!=="manual"))e:for(a=null,n=i;;){if(n.tag===5||n.tag===26||n.tag===27){if(a===null){N=a=n;try{if(c=N.stateNode,_)f=c.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{m=N.stateNode,E=N.memoizedProps.style;var q=E!=null&&E.hasOwnProperty("display")?E.display:null;m.style.display=q==null||typeof q=="boolean"?"":(""+q).trim()}}catch(ce){Je(N,N.return,ce)}}}else if(n.tag===6){if(a===null){N=n;try{N.stateNode.nodeValue=_?"":N.memoizedProps}catch(ce){Je(N,N.return,ce)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=i.updateQueue,o!==null&&(a=o.retryQueue,a!==null&&(o.retryQueue=null,Rc(i,a))));break;case 19:_i(n,i),Pi(i),o&4&&(o=i.updateQueue,o!==null&&(i.updateQueue=null,Rc(i,o)));break;case 21:break;default:_i(n,i),Pi(i)}}function Pi(i){var n=i.flags;if(n&2){try{if(i.tag!==27){e:{for(var a=i.return;a!==null;){if(wp(a)){var o=a;break e}a=a.return}throw Error(r(160))}switch(o.tag){case 27:var c=o.stateNode,f=Ec(i);lo(i,f,c);break;case 5:var m=o.stateNode;o.flags&32&&(ui(m,""),o.flags&=-33);var E=Ec(i);lo(i,E,m);break;case 3:case 4:var _=o.stateNode.containerInfo,N=Ec(i);Ac(i,N,_);break;default:throw Error(r(161))}}}catch(F){Je(i,i.return,F)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function Bp(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;Bp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function Pn(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)Lp(i,n.alternate,n),n=n.sibling}function Nr(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:rs(4,n,n.return),Nr(n);break;case 1:hi(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&_p(n,n.return,a),Nr(n);break;case 26:case 27:case 5:hi(n,n.return),Nr(n);break;case 22:hi(n,n.return),n.memoizedState===null&&Nr(n);break;default:Nr(n)}i=i.sibling}}function as(i,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,c=i,f=n,m=f.flags;switch(f.tag){case 0:case 11:case 15:as(c,f,a),Ha(4,f);break;case 1:if(as(c,f,a),o=f,c=o.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(N){Je(o,o.return,N)}if(o=f,c=o.updateQueue,c!==null){var E=o.stateNode;try{var _=c.shared.hiddenCallbacks;if(_!==null)for(c.shared.hiddenCallbacks=null,c=0;c<_.length;c++)Ap(_[c],E)}catch(N){Je(o,o.return,N)}}a&&m&64&&Rp(f),Qs(f,f.return);break;case 26:case 27:case 5:as(c,f,a),a&&o===null&&m&4&&Pp(f),Qs(f,f.return);break;case 12:as(c,f,a);break;case 13:as(c,f,a),a&&m&4&&Up(c,f);break;case 22:f.memoizedState===null&&as(c,f,a),Qs(f,f.return);break;default:as(c,f,a)}n=n.sibling}}function _c(i,n){var a=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==a&&(i!=null&&i.refCount++,a!=null&&Oa(a))}function Pc(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Oa(i))}function ls(i,n,a,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Gp(i,n,a,o),n=n.sibling}function Gp(i,n,a,o){var c=n.flags;switch(n.tag){case 0:case 11:case 15:ls(i,n,a,o),c&2048&&Ha(9,n);break;case 3:ls(i,n,a,o),c&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Oa(i)));break;case 12:if(c&2048){ls(i,n,a,o),i=n.stateNode;try{var f=n.memoizedProps,m=f.id,E=f.onPostCommit;typeof E=="function"&&E(m,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(_){Je(n,n.return,_)}}else ls(i,n,a,o);break;case 23:break;case 22:f=n.stateNode,n.memoizedState!==null?f._visibility&4?ls(i,n,a,o):Va(i,n):f._visibility&4?ls(i,n,a,o):(f._visibility|=4,Ur(i,n,a,o,(n.subtreeFlags&10256)!==0)),c&2048&&_c(n.alternate,n);break;case 24:ls(i,n,a,o),c&2048&&Pc(n.alternate,n);break;default:ls(i,n,a,o)}}function Ur(i,n,a,o,c){for(c=c&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var f=i,m=n,E=a,_=o,N=m.flags;switch(m.tag){case 0:case 11:case 15:Ur(f,m,E,_,c),Ha(8,m);break;case 23:break;case 22:var F=m.stateNode;m.memoizedState!==null?F._visibility&4?Ur(f,m,E,_,c):Va(f,m):(F._visibility|=4,Ur(f,m,E,_,c)),c&&N&2048&&_c(m.alternate,m);break;case 24:Ur(f,m,E,_,c),c&&N&2048&&Pc(m.alternate,m);break;default:Ur(f,m,E,_,c)}n=n.sibling}}function Va(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=i,o=n,c=o.flags;switch(o.tag){case 22:Va(a,o),c&2048&&_c(o.alternate,o);break;case 24:Va(a,o),c&2048&&Pc(o.alternate,o);break;default:Va(a,o)}n=n.sibling}}var qa=8192;function xr(i){if(i.subtreeFlags&qa)for(i=i.child;i!==null;)jp(i),i=i.sibling}function jp(i){switch(i.tag){case 26:xr(i),i.flags&qa&&i.memoizedState!==null&&yS(Yi,i.memoizedState,i.memoizedProps);break;case 5:xr(i);break;case 3:case 4:var n=Yi;Yi=Eo(i.stateNode.containerInfo),xr(i),Yi=n;break;case 22:i.memoizedState===null&&(n=i.alternate,n!==null&&n.memoizedState!==null?(n=qa,qa=16777216,xr(i),qa=n):xr(i));break;default:xr(i)}}function zp(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function Fa(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var o=n[a];It=o,Vp(o,i)}zp(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Hp(i),i=i.sibling}function Hp(i){switch(i.tag){case 0:case 11:case 15:Fa(i),i.flags&2048&&rs(9,i,i.return);break;case 3:Fa(i);break;case 12:Fa(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&4&&(i.return===null||i.return.tag!==13)?(n._visibility&=-5,oo(i)):Fa(i);break;default:Fa(i)}}function oo(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var o=n[a];It=o,Vp(o,i)}zp(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:rs(8,n,n.return),oo(n);break;case 22:a=n.stateNode,a._visibility&4&&(a._visibility&=-5,oo(n));break;default:oo(n)}i=i.sibling}}function Vp(i,n){for(;It!==null;){var a=It;switch(a.tag){case 0:case 11:case 15:rs(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var o=a.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Oa(a.memoizedState.cache)}if(o=a.child,o!==null)o.return=a,It=o;else e:for(a=i;It!==null;){o=It;var c=o.sibling,f=o.return;if(Ip(o),o===a){It=null;break e}if(c!==null){c.return=f,It=c;break e}It=f}}}function Mb(i,n,a,o){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Di(i,n,a,o){return new Mb(i,n,a,o)}function Dc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function os(i,n){var a=i.alternate;return a===null?(a=Di(i.tag,n,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=n,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&31457280,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,n=i.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a.refCleanup=i.refCleanup,a}function qp(i,n){i.flags&=31457282;var a=i.alternate;return a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function uo(i,n,a,o,c,f){var m=0;if(o=i,typeof i=="function")Dc(i)&&(m=1);else if(typeof i=="string")m=gS(i,a,Te.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case p:return Ws(a.children,c,f,n);case v:m=8,c|=24;break;case g:return i=Di(12,a,n,c|2),i.elementType=g,i.lanes=f,i;case M:return i=Di(13,a,n,c),i.elementType=M,i.lanes=f,i;case j:return i=Di(19,a,n,c),i.elementType=j,i.lanes=f,i;case ie:return Fp(a,c,f,n);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case b:case C:m=10;break e;case S:m=9;break e;case D:m=11;break e;case le:m=14;break e;case oe:m=16,o=null;break e}m=29,a=Error(r(130,i===null?"null":typeof i,"")),o=null}return n=Di(m,a,n,c),n.elementType=i,n.type=o,n.lanes=f,n}function Ws(i,n,a,o){return i=Di(7,i,o,n),i.lanes=a,i}function Fp(i,n,a,o){i=Di(22,i,o,n),i.elementType=ie,i.lanes=a;var c={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var f=c._current;if(f===null)throw Error(r(456));if((c._pendingVisibility&2)===0){var m=Wn(f,2);m!==null&&(c._pendingVisibility|=2,ei(m,f,2))}},attach:function(){var f=c._current;if(f===null)throw Error(r(456));if((c._pendingVisibility&2)!==0){var m=Wn(f,2);m!==null&&(c._pendingVisibility&=-3,ei(m,f,2))}}};return i.stateNode=c,i}function wc(i,n,a){return i=Di(6,i,null,n),i.lanes=a,i}function Mc(i,n,a){return n=Di(4,i.children!==null?i.children:[],i.key,n),n.lanes=a,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}function Dn(i){i.flags|=4}function $p(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!wv(n)){if(n=Ri.current,n!==null&&((Ge&4194176)===Ge?an!==null:(Ge&62914560)!==Ge&&(Ge&536870912)===0||n!==an))throw Da=Uu,uf;i.flags|=8192}}function co(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?Vn():536870912,i.lanes|=n,Gr|=n)}function $a(i,n){if(!ze)switch(i.tailMode){case"hidden":n=i.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:o.sibling=null}}function ot(i){var n=i.alternate!==null&&i.alternate.child===i.child,a=0,o=0;if(n)for(var c=i.child;c!==null;)a|=c.lanes|c.childLanes,o|=c.subtreeFlags&31457280,o|=c.flags&31457280,c.return=i,c=c.sibling;else for(c=i.child;c!==null;)a|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=i,c=c.sibling;return i.subtreeFlags|=o,i.childLanes=a,n}function Ob(i,n,a){var o=n.pendingProps;switch(Iu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(n),null;case 1:return ot(n),null;case 3:return a=n.stateNode,o=null,i!==null&&(o=i.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Cn(Pt),Ht(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(i===null||i.child===null)&&(Ca(n)?Dn(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,$i!==null&&(Gc($i),$i=null))),ot(n),null;case 26:return a=n.memoizedState,i===null?(Dn(n),a!==null?(ot(n),$p(n,a)):(ot(n),n.flags&=-16777217)):a?a!==i.memoizedState?(Dn(n),ot(n),$p(n,a)):(ot(n),n.flags&=-16777217):(i.memoizedProps!==o&&Dn(n),ot(n),n.flags&=-16777217),null;case 27:ct(n),a=je.current;var c=n.type;if(i!==null&&n.stateNode!=null)i.memoizedProps!==o&&Dn(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return ot(n),null}i=Te.current,Ca(n)?lf(n):(i=kv(c,o,a),n.stateNode=i,Dn(n))}return ot(n),null;case 5:if(ct(n),a=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==o&&Dn(n);else{if(!o){if(n.stateNode===null)throw Error(r(166));return ot(n),null}if(i=Te.current,Ca(n))lf(n);else{switch(c=ko(je.current),i){case 1:i=c.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:i=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":i=c.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":i=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":i=c.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof o.is=="string"?c.createElement("select",{is:o.is}):c.createElement("select"),o.multiple?i.multiple=!0:o.size&&(i.size=o.size);break;default:i=typeof o.is=="string"?c.createElement(a,{is:o.is}):c.createElement(a)}}i[Mt]=n,i[qt]=o;e:for(c=n.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===n)break e;for(;c.sibling===null;){if(c.return===null||c.return===n)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n.stateNode=i;e:switch(jt(i,a,o),a){case"button":case"input":case"select":case"textarea":i=!!o.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Dn(n)}}return ot(n),n.flags&=-16777217,null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==o&&Dn(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(r(166));if(i=je.current,Ca(n)){if(i=n.stateNode,a=n.memoizedProps,o=null,c=Zt,c!==null)switch(c.tag){case 27:case 5:o=c.memoizedProps}i[Mt]=n,i=!!(i.nodeValue===a||o!==null&&o.suppressHydrationWarning===!0||gv(i.nodeValue,a)),i||js(n)}else i=ko(i).createTextNode(o),i[Mt]=n,n.stateNode=i}return ot(n),null;case 13:if(o=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(c=Ca(n),o!==null&&o.dehydrated!==null){if(i===null){if(!c)throw Error(r(318));if(c=n.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[Mt]=n}else Ra(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;ot(n),c=!1}else $i!==null&&(Gc($i),$i=null),c=!0;if(!c)return n.flags&256?(Tn(n),n):(Tn(n),null)}if(Tn(n),(n.flags&128)!==0)return n.lanes=a,n;if(a=o!==null,i=i!==null&&i.memoizedState!==null,a){o=n.child,c=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(c=o.alternate.memoizedState.cachePool.pool);var f=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==c&&(o.flags|=2048)}return a!==i&&a&&(n.child.flags|=8192),co(n,n.updateQueue),ot(n),null;case 4:return Ht(),i===null&&Wc(n.stateNode.containerInfo),ot(n),null;case 10:return Cn(n.type),ot(n),null;case 19:if(Ae(_t),c=n.memoizedState,c===null)return ot(n),null;if(o=(n.flags&128)!==0,f=c.rendering,f===null)if(o)$a(c,!1);else{if(ft!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(f=Yl(i),f!==null){for(n.flags|=128,$a(c,!1),i=f.updateQueue,n.updateQueue=i,co(n,i),n.subtreeFlags=0,i=a,a=n.child;a!==null;)qp(a,i),a=a.sibling;return ue(_t,_t.current&1|2),n.child}i=i.sibling}c.tail!==null&&Rt()>ho&&(n.flags|=128,o=!0,$a(c,!1),n.lanes=4194304)}else{if(!o)if(i=Yl(f),i!==null){if(n.flags|=128,o=!0,i=i.updateQueue,n.updateQueue=i,co(n,i),$a(c,!0),c.tail===null&&c.tailMode==="hidden"&&!f.alternate&&!ze)return ot(n),null}else 2*Rt()-c.renderingStartTime>ho&&a!==536870912&&(n.flags|=128,o=!0,$a(c,!1),n.lanes=4194304);c.isBackwards?(f.sibling=n.child,n.child=f):(i=c.last,i!==null?i.sibling=f:n.child=f,c.last=f)}return c.tail!==null?(n=c.tail,c.rendering=n,c.tail=n.sibling,c.renderingStartTime=Rt(),n.sibling=null,i=_t.current,ue(_t,o?i&1|2:i&1),n):(ot(n),null);case 22:case 23:return Tn(n),Bu(),o=n.memoizedState!==null,i!==null?i.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(a&536870912)!==0&&(n.flags&128)===0&&(ot(n),n.subtreeFlags&6&&(n.flags|=8192)):ot(n),a=n.updateQueue,a!==null&&co(n,a.retryQueue),a=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==a&&(n.flags|=2048),i!==null&&Ae(Hs),null;case 24:return a=null,i!==null&&(a=i.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),Cn(Pt),ot(n),null;case 25:return null}throw Error(r(156,n.tag))}function Lb(i,n){switch(Iu(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return Cn(Pt),Ht(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return ct(n),null;case 13:if(Tn(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(r(340));Ra()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return Ae(_t),null;case 4:return Ht(),null;case 10:return Cn(n.type),null;case 22:case 23:return Tn(n),Bu(),i!==null&&Ae(Hs),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return Cn(Pt),null;case 25:return null;default:return null}}function Yp(i,n){switch(Iu(n),n.tag){case 3:Cn(Pt),Ht();break;case 26:case 27:case 5:ct(n);break;case 4:Ht();break;case 13:Tn(n);break;case 19:Ae(_t);break;case 10:Cn(n.type);break;case 22:case 23:Tn(n),Bu(),i!==null&&Ae(Hs);break;case 24:Cn(Pt)}}var Ib={getCacheForType:function(i){var n=Yt(Pt),a=n.data.get(i);return a===void 0&&(a=i(),n.data.set(i,a)),a}},Nb=typeof WeakMap=="function"?WeakMap:Map,ut=0,et=null,Ie=null,Ge=0,tt=0,pi=null,wn=!1,Br=!1,Oc=!1,Mn=0,ft=0,us=0,Js=0,Lc=0,wi=0,Gr=0,Ya=null,on=null,Ic=!1,Nc=0,ho=1/0,fo=null,cs=null,po=!1,Xs=null,Ka=0,Uc=0,xc=null,Qa=0,Bc=null;function vi(){if((ut&2)!==0&&Ge!==0)return Ge&-Ge;if(ee.T!==null){var i=wr;return i!==0?i:$c()}return dr()}function Kp(){wi===0&&(wi=(Ge&536870912)===0||ze?cr():536870912);var i=Ri.current;return i!==null&&(i.flags|=32),wi}function ei(i,n,a){(i===et&&tt===2||i.cancelPendingCommit!==null)&&(jr(i,0),On(i,Ge,wi,!1)),Rs(i,a),((ut&2)===0||i!==et)&&(i===et&&((ut&2)===0&&(Js|=a),ft===4&&On(i,Ge,wi,!1)),un(i))}function Qp(i,n,a){if((ut&6)!==0)throw Error(r(327));var o=!a&&(n&60)===0&&(n&i.expiredLanes)===0||fn(i,n),c=o?Bb(i,n):Hc(i,n,!0),f=o;do{if(c===0){Br&&!o&&On(i,n,0,!1);break}else if(c===6)On(i,n,0,!wn);else{if(a=i.current.alternate,f&&!Ub(a)){c=Hc(i,n,!1),f=!1;continue}if(c===2){if(f=n,i.errorRecoveryDisabledLanes&f)var m=0;else m=i.pendingLanes&-536870913,m=m!==0?m:m&536870912?536870912:0;if(m!==0){n=m;e:{var E=i;c=Ya;var _=E.current.memoizedState.isDehydrated;if(_&&(jr(E,m).flags|=256),m=Hc(E,m,!1),m!==2){if(Oc&&!_){E.errorRecoveryDisabledLanes|=f,Js|=f,c=4;break e}f=on,on=c,f!==null&&Gc(f)}c=m}if(f=!1,c!==2)continue}}if(c===1){jr(i,0),On(i,n,0,!0);break}e:{switch(o=i,c){case 0:case 1:throw Error(r(345));case 4:if((n&4194176)===n){On(o,n,wi,!wn);break e}break;case 2:on=null;break;case 3:case 5:break;default:throw Error(r(329))}if(o.finishedWork=a,o.finishedLanes=n,(n&62914560)===n&&(f=Nc+300-Rt(),10<f)){if(On(o,n,wi,!wn),en(o,0)!==0)break e;o.timeoutHandle=bv(Wp.bind(null,o,a,on,fo,Ic,n,wi,Js,Gr,wn,2,-0,0),f);break e}Wp(o,a,on,fo,Ic,n,wi,Js,Gr,wn,0,-0,0)}}break}while(!0);un(i)}function Gc(i){on===null?on=i:on.push.apply(on,i)}function Wp(i,n,a,o,c,f,m,E,_,N,F,J,H){var q=n.subtreeFlags;if((q&8192||(q&16785408)===16785408)&&(tl={stylesheets:null,count:0,unsuspend:mS},jp(n),n=bS(),n!==null)){i.cancelPendingCommit=n(nv.bind(null,i,a,o,c,m,E,_,1,J,H)),On(i,f,m,!N);return}nv(i,a,o,c,m,E,_,F,J,H)}function Ub(i){for(var n=i;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var o=0;o<a.length;o++){var c=a[o],f=c.getSnapshot;c=c.value;try{if(!di(f(),c))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function On(i,n,a,o){n&=~Lc,n&=~Js,i.suspendedLanes|=n,i.pingedLanes&=~n,o&&(i.warmLanes|=n),o=i.expirationTimes;for(var c=n;0<c;){var f=31-Vt(c),m=1<<f;o[f]=-1,c&=~m}a!==0&&Rl(i,a,n)}function vo(){return(ut&6)===0?(Wa(0),!1):!0}function jc(){if(Ie!==null){if(tt===0)var i=Ie.return;else i=Ie,An=Ys=null,$u(i),Pr=null,wa=0,i=Ie;for(;i!==null;)Yp(i.alternate,i),i=i.return;Ie=null}}function jr(i,n){i.finishedWork=null,i.finishedLanes=0;var a=i.timeoutHandle;a!==-1&&(i.timeoutHandle=-1,tS(a)),a=i.cancelPendingCommit,a!==null&&(i.cancelPendingCommit=null,a()),jc(),et=i,Ie=a=os(i.current,null),Ge=n,tt=0,pi=null,wn=!1,Br=fn(i,n),Oc=!1,Gr=wi=Lc=Js=us=ft=0,on=Ya=null,Ic=!1,(n&8)!==0&&(n|=n&32);var o=i.entangledLanes;if(o!==0)for(i=i.entanglements,o&=n;0<o;){var c=31-Vt(o),f=1<<c;n|=i[c],o&=~f}return Mn=n,Bl(),a}function Jp(i,n){Oe=null,ee.H=ln,n===Pa?(n=hf(),tt=3):n===uf?(n=hf(),tt=4):tt=n===cp?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,pi=n,Ie===null&&(ft=1,so(i,Ei(n,i.current)))}function Xp(){var i=ee.H;return ee.H=ln,i===null?ln:i}function Zp(){var i=ee.A;return ee.A=Ib,i}function zc(){ft=4,wn||(Ge&4194176)!==Ge&&Ri.current!==null||(Br=!0),(us&134217727)===0&&(Js&134217727)===0||et===null||On(et,Ge,wi,!1)}function Hc(i,n,a){var o=ut;ut|=2;var c=Xp(),f=Zp();(et!==i||Ge!==n)&&(fo=null,jr(i,n)),n=!1;var m=ft;e:do try{if(tt!==0&&Ie!==null){var E=Ie,_=pi;switch(tt){case 8:jc(),m=6;break e;case 3:case 2:case 6:Ri.current===null&&(n=!0);var N=tt;if(tt=0,pi=null,zr(i,E,_,N),a&&Br){m=0;break e}break;default:N=tt,tt=0,pi=null,zr(i,E,_,N)}}xb(),m=ft;break}catch(F){Jp(i,F)}while(!0);return n&&i.shellSuspendCounter++,An=Ys=null,ut=o,ee.H=c,ee.A=f,Ie===null&&(et=null,Ge=0,Bl()),m}function xb(){for(;Ie!==null;)ev(Ie)}function Bb(i,n){var a=ut;ut|=2;var o=Xp(),c=Zp();et!==i||Ge!==n?(fo=null,ho=Rt()+500,jr(i,n)):Br=fn(i,n);e:do try{if(tt!==0&&Ie!==null){n=Ie;var f=pi;t:switch(tt){case 1:tt=0,pi=null,zr(i,n,f,1);break;case 2:if(cf(f)){tt=0,pi=null,tv(n);break}n=function(){tt===2&&et===i&&(tt=7),un(i)},f.then(n,n);break e;case 3:tt=7;break e;case 4:tt=5;break e;case 7:cf(f)?(tt=0,pi=null,tv(n)):(tt=0,pi=null,zr(i,n,f,7));break;case 5:var m=null;switch(Ie.tag){case 26:m=Ie.memoizedState;case 5:case 27:var E=Ie;if(!m||wv(m)){tt=0,pi=null;var _=E.sibling;if(_!==null)Ie=_;else{var N=E.return;N!==null?(Ie=N,go(N)):Ie=null}break t}}tt=0,pi=null,zr(i,n,f,5);break;case 6:tt=0,pi=null,zr(i,n,f,6);break;case 8:jc(),ft=6;break e;default:throw Error(r(462))}}Gb();break}catch(F){Jp(i,F)}while(!0);return An=Ys=null,ee.H=o,ee.A=c,ut=a,Ie!==null?0:(et=null,Ge=0,Bl(),ft)}function Gb(){for(;Ie!==null&&!lr();)ev(Ie)}function ev(i){var n=kp(i.alternate,i,Mn);i.memoizedProps=i.pendingProps,n===null?go(i):Ie=n}function tv(i){var n=i,a=n.alternate;switch(n.tag){case 15:case 0:n=gp(a,n,n.pendingProps,n.type,void 0,Ge);break;case 11:n=gp(a,n,n.pendingProps,n.type.render,n.ref,Ge);break;case 5:$u(n);default:Yp(a,n),n=Ie=qp(n,Mn),n=kp(a,n,Mn)}i.memoizedProps=i.pendingProps,n===null?go(i):Ie=n}function zr(i,n,a,o){An=Ys=null,$u(n),Pr=null,wa=0;var c=n.return;try{if(_b(i,c,n,a,Ge)){ft=1,so(i,Ei(a,i.current)),Ie=null;return}}catch(f){if(c!==null)throw Ie=c,f;ft=1,so(i,Ei(a,i.current)),Ie=null;return}n.flags&32768?(ze||o===1?i=!0:Br||(Ge&536870912)!==0?i=!1:(wn=i=!0,(o===2||o===3||o===6)&&(o=Ri.current,o!==null&&o.tag===13&&(o.flags|=16384))),iv(n,i)):go(n)}function go(i){var n=i;do{if((n.flags&32768)!==0){iv(n,wn);return}i=n.return;var a=Ob(n.alternate,n,Mn);if(a!==null){Ie=a;return}if(n=n.sibling,n!==null){Ie=n;return}Ie=n=i}while(n!==null);ft===0&&(ft=5)}function iv(i,n){do{var a=Lb(i.alternate,i);if(a!==null){a.flags&=32767,Ie=a;return}if(a=i.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(i=i.sibling,i!==null)){Ie=i;return}Ie=i=a}while(i!==null);ft=6,Ie=null}function nv(i,n,a,o,c,f,m,E,_,N){var F=ee.T,J=B.p;try{B.p=2,ee.T=null,jb(i,n,a,o,J,c,f,m,E,_,N)}finally{ee.T=F,B.p=J}}function jb(i,n,a,o,c,f,m,E){do Hr();while(Xs!==null);if((ut&6)!==0)throw Error(r(327));var _=i.finishedWork;if(o=i.finishedLanes,_===null)return null;if(i.finishedWork=null,i.finishedLanes=0,_===i.current)throw Error(r(177));i.callbackNode=null,i.callbackPriority=0,i.cancelPendingCommit=null;var N=_.lanes|_.childLanes;if(N|=Mu,gu(i,o,N,f,m,E),i===et&&(Ie=et=null,Ge=0),(_.subtreeFlags&10256)===0&&(_.flags&10256)===0||po||(po=!0,Uc=N,xc=a,qb(me,function(){return Hr(),null})),a=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||a?(a=ee.T,ee.T=null,f=B.p,B.p=2,m=ut,ut|=4,Db(i,_),xp(_,i),cb(ed,i.containerInfo),Po=!!Zc,ed=Zc=null,i.current=_,Lp(i,_.alternate,_),Jt(),ut=m,B.p=f,ee.T=a):i.current=_,po?(po=!1,Xs=i,Ka=o):sv(i,N),N=i.pendingLanes,N===0&&(cs=null),Zi(_.stateNode),un(i),n!==null)for(c=i.onRecoverableError,_=0;_<n.length;_++)N=n[_],c(N.value,{componentStack:N.stack});return(Ka&3)!==0&&Hr(),N=i.pendingLanes,(o&4194218)!==0&&(N&42)!==0?i===Bc?Qa++:(Qa=0,Bc=i):Qa=0,Wa(0),null}function sv(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,Oa(n)))}function Hr(){if(Xs!==null){var i=Xs,n=Uc;Uc=0;var a=ua(Ka),o=ee.T,c=B.p;try{if(B.p=32>a?32:a,ee.T=null,Xs===null)var f=!1;else{a=xc,xc=null;var m=Xs,E=Ka;if(Xs=null,Ka=0,(ut&6)!==0)throw Error(r(331));var _=ut;if(ut|=4,Hp(m.current),Gp(m,m.current,E,a),ut=_,Wa(0,!1),We&&typeof We.onPostCommitFiberRoot=="function")try{We.onPostCommitFiberRoot(ve,m)}catch{}f=!0}return f}finally{B.p=c,ee.T=o,sv(i,n)}}return!1}function rv(i,n,a){n=Ei(a,n),n=ac(i.stateNode,n,2),i=ss(i,n,2),i!==null&&(Rs(i,2),un(i))}function Je(i,n,a){if(i.tag===3)rv(i,i,a);else for(;n!==null;){if(n.tag===3){rv(n,i,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(cs===null||!cs.has(o))){i=Ei(a,i),a=op(2),o=ss(n,a,2),o!==null&&(up(a,o,n,i),Rs(o,2),un(o));break}}n=n.return}}function Vc(i,n,a){var o=i.pingCache;if(o===null){o=i.pingCache=new Nb;var c=new Set;o.set(n,c)}else c=o.get(n),c===void 0&&(c=new Set,o.set(n,c));c.has(a)||(Oc=!0,c.add(a),i=zb.bind(null,i,n,a),n.then(i,i))}function zb(i,n,a){var o=i.pingCache;o!==null&&o.delete(n),i.pingedLanes|=i.suspendedLanes&a,i.warmLanes&=~a,et===i&&(Ge&a)===a&&(ft===4||ft===3&&(Ge&62914560)===Ge&&300>Rt()-Nc?(ut&2)===0&&jr(i,0):Lc|=a,Gr===Ge&&(Gr=0)),un(i)}function av(i,n){n===0&&(n=Vn()),i=Wn(i,n),i!==null&&(Rs(i,n),un(i))}function Hb(i){var n=i.memoizedState,a=0;n!==null&&(a=n.retryLane),av(i,a)}function Vb(i,n){var a=0;switch(i.tag){case 13:var o=i.stateNode,c=i.memoizedState;c!==null&&(a=c.retryLane);break;case 19:o=i.stateNode;break;case 22:o=i.stateNode._retryCache;break;default:throw Error(r(314))}o!==null&&o.delete(n),av(i,a)}function qb(i,n){return Cs(i,n)}var mo=null,Vr=null,qc=!1,yo=!1,Fc=!1,Zs=0;function un(i){i!==Vr&&i.next===null&&(Vr===null?mo=Vr=i:Vr=Vr.next=i),yo=!0,qc||(qc=!0,$b(Fb))}function Wa(i,n){if(!Fc&&yo){Fc=!0;do for(var a=!1,o=mo;o!==null;){if(i!==0){var c=o.pendingLanes;if(c===0)var f=0;else{var m=o.suspendedLanes,E=o.pingedLanes;f=(1<<31-Vt(42|i)+1)-1,f&=c&~(m&~E),f=f&201326677?f&201326677|1:f?f|2:0}f!==0&&(a=!0,uv(o,f))}else f=Ge,f=en(o,o===et?f:0),(f&3)===0||fn(o,f)||(a=!0,uv(o,f));o=o.next}while(a);Fc=!1}}function Fb(){yo=qc=!1;var i=0;Zs!==0&&(eS()&&(i=Zs),Zs=0);for(var n=Rt(),a=null,o=mo;o!==null;){var c=o.next,f=lv(o,n);f===0?(o.next=null,a===null?mo=c:a.next=c,c===null&&(Vr=a)):(a=o,(i!==0||(f&3)!==0)&&(yo=!0)),o=c}Wa(i)}function lv(i,n){for(var a=i.suspendedLanes,o=i.pingedLanes,c=i.expirationTimes,f=i.pendingLanes&-62914561;0<f;){var m=31-Vt(f),E=1<<m,_=c[m];_===-1?((E&a)===0||(E&o)!==0)&&(c[m]=la(E,n)):_<=n&&(i.expiredLanes|=E),f&=~E}if(n=et,a=Ge,a=en(i,i===n?a:0),o=i.callbackNode,a===0||i===n&&tt===2||i.cancelPendingCommit!==null)return o!==null&&o!==null&&zn(o),i.callbackNode=null,i.callbackPriority=0;if((a&3)===0||fn(i,a)){if(n=a&-a,n===i.callbackPriority)return n;switch(o!==null&&zn(o),ua(a)){case 2:case 8:a=Me;break;case 32:a=me;break;case 268435456:a=at;break;default:a=me}return o=ov.bind(null,i),a=Cs(a,o),i.callbackPriority=n,i.callbackNode=a,n}return o!==null&&o!==null&&zn(o),i.callbackPriority=2,i.callbackNode=null,2}function ov(i,n){var a=i.callbackNode;if(Hr()&&i.callbackNode!==a)return null;var o=Ge;return o=en(i,i===et?o:0),o===0?null:(Qp(i,o,n),lv(i,Rt()),i.callbackNode!=null&&i.callbackNode===a?ov.bind(null,i):null)}function uv(i,n){if(Hr())return null;Qp(i,n,!0)}function $b(i){iS(function(){(ut&6)!==0?Cs(De,i):i()})}function $c(){return Zs===0&&(Zs=cr()),Zs}function cv(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:vr(""+i)}function dv(i,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,i.id&&a.setAttribute("form",i.id),n.parentNode.insertBefore(a,n),i=new FormData(i),a.parentNode.removeChild(a),i}function Yb(i,n,a,o,c){if(n==="submit"&&a&&a.stateNode===c){var f=cv((c[qt]||null).action),m=o.submitter;m&&(n=(n=m[qt]||null)?cv(n.formAction):m.getAttribute("formAction"),n!==null&&(f=n,m=null));var E=new ne("action","action",null,o,c);i.push({event:E,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(Zs!==0){var _=m?dv(c,m):new FormData(c);tc(a,{pending:!0,data:_,method:c.method,action:f},null,_)}}else typeof f=="function"&&(E.preventDefault(),_=m?dv(c,m):new FormData(c),tc(a,{pending:!0,data:_,method:c.method,action:f},f,_))},currentTarget:c}]})}}for(var Yc=0;Yc<nf.length;Yc++){var Kc=nf[Yc],Kb=Kc.toLowerCase(),Qb=Kc[0].toUpperCase()+Kc.slice(1);Fi(Kb,"on"+Qb)}Fi(Jh,"onAnimationEnd"),Fi(Xh,"onAnimationIteration"),Fi(Zh,"onAnimationStart"),Fi("dblclick","onDoubleClick"),Fi("focusin","onFocus"),Fi("focusout","onBlur"),Fi(hb,"onTransitionRun"),Fi(fb,"onTransitionStart"),Fi(pb,"onTransitionCancel"),Fi(ef,"onTransitionEnd"),$n("onMouseEnter",["mouseout","mouseover"]),$n("onMouseLeave",["mouseout","mouseover"]),$n("onPointerEnter",["pointerout","pointerover"]),$n("onPointerLeave",["pointerout","pointerover"]),Ti("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ti("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ti("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ti("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ti("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ti("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ja));function hv(i,n){n=(n&4)!==0;for(var a=0;a<i.length;a++){var o=i[a],c=o.event;o=o.listeners;e:{var f=void 0;if(n)for(var m=o.length-1;0<=m;m--){var E=o[m],_=E.instance,N=E.currentTarget;if(E=E.listener,_!==f&&c.isPropagationStopped())break e;f=E,c.currentTarget=N;try{f(c)}catch(F){no(F)}c.currentTarget=null,f=_}else for(m=0;m<o.length;m++){if(E=o[m],_=E.instance,N=E.currentTarget,E=E.listener,_!==f&&c.isPropagationStopped())break e;f=E,c.currentTarget=N;try{f(c)}catch(F){no(F)}c.currentTarget=null,f=_}}}}function xe(i,n){var a=n[ca];a===void 0&&(a=n[ca]=new Set);var o=i+"__bubble";a.has(o)||(fv(n,i,2,!1),a.add(o))}function Qc(i,n,a){var o=0;n&&(o|=4),fv(a,i,o,n)}var bo="_reactListening"+Math.random().toString(36).slice(2);function Wc(i){if(!i[bo]){i[bo]=!0,Dl.forEach(function(a){a!=="selectionchange"&&(Wb.has(a)||Qc(a,!1,i),Qc(a,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[bo]||(n[bo]=!0,Qc("selectionchange",!1,n))}}function fv(i,n,a,o){switch(Uv(n)){case 2:var c=kS;break;case 8:c=ES;break;default:c=ud}a=c.bind(null,n,a,i),c=void 0,!mr||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(c=!0),o?c!==void 0?i.addEventListener(n,a,{capture:!0,passive:c}):i.addEventListener(n,a,!0):c!==void 0?i.addEventListener(n,a,{passive:c}):i.addEventListener(n,a,!1)}function Jc(i,n,a,o,c){var f=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var m=o.tag;if(m===3||m===4){var E=o.stateNode.containerInfo;if(E===c||E.nodeType===8&&E.parentNode===c)break;if(m===4)for(m=o.return;m!==null;){var _=m.tag;if((_===3||_===4)&&(_=m.stateNode.containerInfo,_===c||_.nodeType===8&&_.parentNode===c))return;m=m.return}for(;E!==null;){if(m=vn(E),m===null)return;if(_=m.tag,_===5||_===6||_===26||_===27){o=f=m;continue e}E=E.parentNode}}o=o.return}gr(function(){var N=f,F=Hi(a),J=[];e:{var H=tf.get(i);if(H!==void 0){var q=ne,ce=i;switch(i){case"keypress":if(yr(a)===0)break e;case"keydown":case"keyup":q=Vy;break;case"focusin":ce="focus",q=$t;break;case"focusout":ce="blur",q=$t;break;case"beforeblur":case"afterblur":q=$t;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=Ft;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=Ot;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=$y;break;case Jh:case Xh:case Zh:q=qi;break;case ef:q=Ky;break;case"scroll":case"scrollend":q=_e;break;case"wheel":q=Wy;break;case"copy":case"cut":case"paste":q=Ul;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=Oh;break;case"toggle":case"beforetoggle":q=Xy}var Ce=(n&4)!==0,pt=!Ce&&(i==="scroll"||i==="scrollend"),x=Ce?H!==null?H+"Capture":null:H;Ce=[];for(var L=N,G;L!==null;){var K=L;if(G=K.stateNode,K=K.tag,K!==5&&K!==26&&K!==27||G===null||x===null||(K=Ls(L,x),K!=null&&Ce.push(Xa(L,K,G))),pt)break;L=L.return}0<Ce.length&&(H=new q(H,ce,null,a,F),J.push({event:H,listeners:Ce}))}}if((n&7)===0){e:{if(H=i==="mouseover"||i==="pointerover",q=i==="mouseout"||i==="pointerout",H&&a!==ya&&(ce=a.relatedTarget||a.fromElement)&&(vn(ce)||ce[qn]))break e;if((q||H)&&(H=F.window===F?F:(H=F.ownerDocument)?H.defaultView||H.parentWindow:window,q?(ce=a.relatedTarget||a.toElement,q=N,ce=ce?vn(ce):null,ce!==null&&(pt=A(ce),Ce=ce.tag,ce!==pt||Ce!==5&&Ce!==27&&Ce!==6)&&(ce=null)):(q=null,ce=N),q!==ce)){if(Ce=Ft,K="onMouseLeave",x="onMouseEnter",L="mouse",(i==="pointerout"||i==="pointerover")&&(Ce=Oh,K="onPointerLeave",x="onPointerEnter",L="pointer"),pt=q==null?H:Ps(q),G=ce==null?H:Ps(ce),H=new Ce(K,L+"leave",q,a,F),H.target=pt,H.relatedTarget=G,K=null,vn(F)===N&&(Ce=new Ce(x,L+"enter",ce,a,F),Ce.target=G,Ce.relatedTarget=pt,K=Ce),pt=K,q&&ce)t:{for(Ce=q,x=ce,L=0,G=Ce;G;G=qr(G))L++;for(G=0,K=x;K;K=qr(K))G++;for(;0<L-G;)Ce=qr(Ce),L--;for(;0<G-L;)x=qr(x),G--;for(;L--;){if(Ce===x||x!==null&&Ce===x.alternate)break t;Ce=qr(Ce),x=qr(x)}Ce=null}else Ce=null;q!==null&&pv(J,H,q,Ce,!1),ce!==null&&pt!==null&&pv(J,pt,ce,Ce,!0)}}e:{if(H=N?Ps(N):window,q=H.nodeName&&H.nodeName.toLowerCase(),q==="select"||q==="input"&&H.type==="file")var re=jh;else if(Bh(H))if(zh)re=ob;else{re=ab;var Le=rb}else q=H.nodeName,!q||q.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?N&&ma(N.elementType)&&(re=jh):re=lb;if(re&&(re=re(i,N))){Gh(J,re,a,F);break e}Le&&Le(i,H,N),i==="focusout"&&N&&H.type==="number"&&N.memoizedProps.value!=null&&va(H,"number",H.value)}switch(Le=N?Ps(N):window,i){case"focusin":(Bh(Le)||Le.contentEditable==="true")&&(kr=Le,Pu=N,Aa=null);break;case"focusout":Aa=Pu=kr=null;break;case"mousedown":Du=!0;break;case"contextmenu":case"mouseup":case"dragend":Du=!1,Qh(J,a,F);break;case"selectionchange":if(db)break;case"keydown":case"keyup":Qh(J,a,F)}var he;if(Au)e:{switch(i){case"compositionstart":var ye="onCompositionStart";break e;case"compositionend":ye="onCompositionEnd";break e;case"compositionupdate":ye="onCompositionUpdate";break e}ye=void 0}else Tr?Uh(i,a)&&(ye="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(ye="onCompositionStart");ye&&(Lh&&a.locale!=="ko"&&(Tr||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&Tr&&(he=Nl()):(Vi=F,mn="value"in Vi?Vi.value:Vi.textContent,Tr=!0)),Le=So(N,ye),0<Le.length&&(ye=new Ns(ye,i,null,a,F),J.push({event:ye,listeners:Le}),he?ye.data=he:(he=xh(a),he!==null&&(ye.data=he)))),(he=eb?tb(i,a):ib(i,a))&&(ye=So(N,"onBeforeInput"),0<ye.length&&(Le=new Ns("onBeforeInput","beforeinput",null,a,F),J.push({event:Le,listeners:ye}),Le.data=he)),Yb(J,i,N,a,F)}hv(J,n)})}function Xa(i,n,a){return{instance:i,listener:n,currentTarget:a}}function So(i,n){for(var a=n+"Capture",o=[];i!==null;){var c=i,f=c.stateNode;c=c.tag,c!==5&&c!==26&&c!==27||f===null||(c=Ls(i,a),c!=null&&o.unshift(Xa(i,c,f)),c=Ls(i,n),c!=null&&o.push(Xa(i,c,f))),i=i.return}return o}function qr(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function pv(i,n,a,o,c){for(var f=n._reactName,m=[];a!==null&&a!==o;){var E=a,_=E.alternate,N=E.stateNode;if(E=E.tag,_!==null&&_===o)break;E!==5&&E!==26&&E!==27||N===null||(_=N,c?(N=Ls(a,f),N!=null&&m.unshift(Xa(a,N,_))):c||(N=Ls(a,f),N!=null&&m.push(Xa(a,N,_)))),a=a.return}m.length!==0&&i.push({event:n,listeners:m})}var Jb=/\r\n?/g,Xb=/\u0000|\uFFFD/g;function vv(i){return(typeof i=="string"?i:""+i).replace(Jb,`
`).replace(Xb,"")}function gv(i,n){return n=vv(n),vv(i)===n}function To(){}function Ke(i,n,a,o,c,f){switch(a){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||ui(i,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&ui(i,""+o);break;case"className":fr(i,"class",o);break;case"tabIndex":fr(i,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":fr(i,a,o);break;case"style":zi(i,o,f);break;case"data":if(n!=="object"){fr(i,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||a!=="href")){i.removeAttribute(a);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){i.removeAttribute(a);break}o=vr(""+o),i.setAttribute(a,o);break;case"action":case"formAction":if(typeof o=="function"){i.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof f=="function"&&(a==="formAction"?(n!=="input"&&Ke(i,n,"name",c.name,c,null),Ke(i,n,"formEncType",c.formEncType,c,null),Ke(i,n,"formMethod",c.formMethod,c,null),Ke(i,n,"formTarget",c.formTarget,c,null)):(Ke(i,n,"encType",c.encType,c,null),Ke(i,n,"method",c.method,c,null),Ke(i,n,"target",c.target,c,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){i.removeAttribute(a);break}o=vr(""+o),i.setAttribute(a,o);break;case"onClick":o!=null&&(i.onclick=To);break;case"onScroll":o!=null&&xe("scroll",i);break;case"onScrollEnd":o!=null&&xe("scrollend",i);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(a=o.__html,a!=null){if(c.children!=null)throw Error(r(60));i.innerHTML=a}}break;case"multiple":i.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":i.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){i.removeAttribute("xlink:href");break}a=vr(""+o),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?i.setAttribute(a,""+o):i.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?i.setAttribute(a,""):i.removeAttribute(a);break;case"capture":case"download":o===!0?i.setAttribute(a,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?i.setAttribute(a,o):i.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?i.setAttribute(a,o):i.removeAttribute(a);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?i.removeAttribute(a):i.setAttribute(a,o);break;case"popover":xe("beforetoggle",i),xe("toggle",i),hr(i,"popover",o);break;case"xlinkActuate":ji(i,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":ji(i,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":ji(i,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":ji(i,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":ji(i,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":ji(i,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":ji(i,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":ji(i,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":ji(i,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":hr(i,"is",o);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Tu.get(a)||a,hr(i,a,o))}}function Xc(i,n,a,o,c,f){switch(a){case"style":zi(i,o,f);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(r(61));if(a=o.__html,a!=null){if(c.children!=null)throw Error(r(60));i.innerHTML=a}}break;case"children":typeof o=="string"?ui(i,o):(typeof o=="number"||typeof o=="bigint")&&ui(i,""+o);break;case"onScroll":o!=null&&xe("scroll",i);break;case"onScrollEnd":o!=null&&xe("scrollend",i);break;case"onClick":o!=null&&(i.onclick=To);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wl.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),n=a.slice(2,c?a.length-7:void 0),f=i[qt]||null,f=f!=null?f[a]:null,typeof f=="function"&&i.removeEventListener(n,f,c),typeof o=="function")){typeof f!="function"&&f!==null&&(a in i?i[a]=null:i.hasAttribute(a)&&i.removeAttribute(a)),i.addEventListener(n,o,c);break e}a in i?i[a]=o:o===!0?i.setAttribute(a,""):hr(i,a,o)}}}function jt(i,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xe("error",i),xe("load",i);var o=!1,c=!1,f;for(f in a)if(a.hasOwnProperty(f)){var m=a[f];if(m!=null)switch(f){case"src":o=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:Ke(i,n,f,m,a,null)}}c&&Ke(i,n,"srcSet",a.srcSet,a,null),o&&Ke(i,n,"src",a.src,a,null);return;case"input":xe("invalid",i);var E=f=m=c=null,_=null,N=null;for(o in a)if(a.hasOwnProperty(o)){var F=a[o];if(F!=null)switch(o){case"name":c=F;break;case"type":m=F;break;case"checked":_=F;break;case"defaultChecked":N=F;break;case"value":f=F;break;case"defaultValue":E=F;break;case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(137,n));break;default:Ke(i,n,o,F,a,null)}}pa(i,f,E,_,N,m,c,!1),ws(i);return;case"select":xe("invalid",i),o=m=f=null;for(c in a)if(a.hasOwnProperty(c)&&(E=a[c],E!=null))switch(c){case"value":f=E;break;case"defaultValue":m=E;break;case"multiple":o=E;default:Ke(i,n,c,E,a,null)}n=f,a=m,i.multiple=!!o,n!=null?Yn(i,!!o,n,!1):a!=null&&Yn(i,!!o,a,!0);return;case"textarea":xe("invalid",i),f=c=o=null;for(m in a)if(a.hasOwnProperty(m)&&(E=a[m],E!=null))switch(m){case"value":o=E;break;case"defaultValue":c=E;break;case"children":f=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:Ke(i,n,m,E,a,null)}Ms(i,o,c,f),ws(i);return;case"option":for(_ in a)if(a.hasOwnProperty(_)&&(o=a[_],o!=null))switch(_){case"selected":i.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:Ke(i,n,_,o,a,null)}return;case"dialog":xe("cancel",i),xe("close",i);break;case"iframe":case"object":xe("load",i);break;case"video":case"audio":for(o=0;o<Ja.length;o++)xe(Ja[o],i);break;case"image":xe("error",i),xe("load",i);break;case"details":xe("toggle",i);break;case"embed":case"source":case"link":xe("error",i),xe("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(N in a)if(a.hasOwnProperty(N)&&(o=a[N],o!=null))switch(N){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,n));default:Ke(i,n,N,o,a,null)}return;default:if(ma(n)){for(F in a)a.hasOwnProperty(F)&&(o=a[F],o!==void 0&&Xc(i,n,F,o,a,void 0));return}}for(E in a)a.hasOwnProperty(E)&&(o=a[E],o!=null&&Ke(i,n,E,o,a,null))}function Zb(i,n,a,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,f=null,m=null,E=null,_=null,N=null,F=null;for(q in a){var J=a[q];if(a.hasOwnProperty(q)&&J!=null)switch(q){case"checked":break;case"value":break;case"defaultValue":_=J;default:o.hasOwnProperty(q)||Ke(i,n,q,null,o,J)}}for(var H in o){var q=o[H];if(J=a[H],o.hasOwnProperty(H)&&(q!=null||J!=null))switch(H){case"type":f=q;break;case"name":c=q;break;case"checked":N=q;break;case"defaultChecked":F=q;break;case"value":m=q;break;case"defaultValue":E=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(r(137,n));break;default:q!==J&&Ke(i,n,H,q,o,J)}}fa(i,m,E,_,N,F,f,c);return;case"select":q=m=E=H=null;for(f in a)if(_=a[f],a.hasOwnProperty(f)&&_!=null)switch(f){case"value":break;case"multiple":q=_;default:o.hasOwnProperty(f)||Ke(i,n,f,null,o,_)}for(c in o)if(f=o[c],_=a[c],o.hasOwnProperty(c)&&(f!=null||_!=null))switch(c){case"value":H=f;break;case"defaultValue":E=f;break;case"multiple":m=f;default:f!==_&&Ke(i,n,c,f,o,_)}n=E,a=m,o=q,H!=null?Yn(i,!!a,H,!1):!!o!=!!a&&(n!=null?Yn(i,!!a,n,!0):Yn(i,!!a,a?[]:"",!1));return;case"textarea":q=H=null;for(E in a)if(c=a[E],a.hasOwnProperty(E)&&c!=null&&!o.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:Ke(i,n,E,null,o,c)}for(m in o)if(c=o[m],f=a[m],o.hasOwnProperty(m)&&(c!=null||f!=null))switch(m){case"value":H=c;break;case"defaultValue":q=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==f&&Ke(i,n,m,c,o,f)}ga(i,H,q);return;case"option":for(var ce in a)if(H=a[ce],a.hasOwnProperty(ce)&&H!=null&&!o.hasOwnProperty(ce))switch(ce){case"selected":i.selected=!1;break;default:Ke(i,n,ce,null,o,H)}for(_ in o)if(H=o[_],q=a[_],o.hasOwnProperty(_)&&H!==q&&(H!=null||q!=null))switch(_){case"selected":i.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:Ke(i,n,_,H,o,q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ce in a)H=a[Ce],a.hasOwnProperty(Ce)&&H!=null&&!o.hasOwnProperty(Ce)&&Ke(i,n,Ce,null,o,H);for(N in o)if(H=o[N],q=a[N],o.hasOwnProperty(N)&&H!==q&&(H!=null||q!=null))switch(N){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(137,n));break;default:Ke(i,n,N,H,o,q)}return;default:if(ma(n)){for(var pt in a)H=a[pt],a.hasOwnProperty(pt)&&H!==void 0&&!o.hasOwnProperty(pt)&&Xc(i,n,pt,void 0,o,H);for(F in o)H=o[F],q=a[F],!o.hasOwnProperty(F)||H===q||H===void 0&&q===void 0||Xc(i,n,F,H,o,q);return}}for(var x in a)H=a[x],a.hasOwnProperty(x)&&H!=null&&!o.hasOwnProperty(x)&&Ke(i,n,x,null,o,H);for(J in o)H=o[J],q=a[J],!o.hasOwnProperty(J)||H===q||H==null&&q==null||Ke(i,n,J,H,o,q)}var Zc=null,ed=null;function ko(i){return i.nodeType===9?i:i.ownerDocument}function mv(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yv(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function td(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var id=null;function eS(){var i=window.event;return i&&i.type==="popstate"?i===id?!1:(id=i,!0):(id=null,!1)}var bv=typeof setTimeout=="function"?setTimeout:void 0,tS=typeof clearTimeout=="function"?clearTimeout:void 0,Sv=typeof Promise=="function"?Promise:void 0,iS=typeof queueMicrotask=="function"?queueMicrotask:typeof Sv<"u"?function(i){return Sv.resolve(null).then(i).catch(nS)}:bv;function nS(i){setTimeout(function(){throw i})}function nd(i,n){var a=n,o=0;do{var c=a.nextSibling;if(i.removeChild(a),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(o===0){i.removeChild(c),al(n);return}o--}else a!=="$"&&a!=="$?"&&a!=="$!"||o++;a=c}while(a);al(n)}function sd(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":sd(a),da(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}i.removeChild(a)}}function sS(i,n,a,o){for(;i.nodeType===1;){var c=a;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(o){if(!i[_s])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(f=i.getAttribute("rel"),f==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(f!==c.rel||i.getAttribute("href")!==(c.href==null?null:c.href)||i.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||i.getAttribute("title")!==(c.title==null?null:c.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(f=i.getAttribute("src"),(f!==(c.src==null?null:c.src)||i.getAttribute("type")!==(c.type==null?null:c.type)||i.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&f&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var f=c.name==null?null:""+c.name;if(c.type==="hidden"&&i.getAttribute("name")===f)return i}else return i;if(i=Ki(i.nextSibling),i===null)break}return null}function rS(i,n,a){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Ki(i.nextSibling),i===null))return null;return i}function Ki(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return i}function Tv(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return i;n--}else a==="/$"&&n++}i=i.previousSibling}return null}function kv(i,n,a){switch(n=ko(a),i){case"html":if(i=n.documentElement,!i)throw Error(r(452));return i;case"head":if(i=n.head,!i)throw Error(r(453));return i;case"body":if(i=n.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}var Mi=new Map,Ev=new Set;function Eo(i){return typeof i.getRootNode=="function"?i.getRootNode():i.ownerDocument}var Ln=B.d;B.d={f:aS,r:lS,D:oS,C:uS,L:cS,m:dS,X:fS,S:hS,M:pS};function aS(){var i=Ln.f(),n=vo();return i||n}function lS(i){var n=si(i);n!==null&&n.tag===5&&n.type==="form"?Wf(n):Ln.r(i)}var Fr=typeof document>"u"?null:document;function Av(i,n,a){var o=Fr;if(o&&typeof n=="string"&&n){var c=ri(n);c='link[rel="'+i+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),Ev.has(c)||(Ev.add(c),i={rel:i,crossOrigin:a,href:n},o.querySelector(c)===null&&(n=o.createElement("link"),jt(n,"link",i),St(n),o.head.appendChild(n)))}}function oS(i){Ln.D(i),Av("dns-prefetch",i,null)}function uS(i,n){Ln.C(i,n),Av("preconnect",i,n)}function cS(i,n,a){Ln.L(i,n,a);var o=Fr;if(o&&i&&n){var c='link[rel="preload"][as="'+ri(n)+'"]';n==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+ri(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+ri(a.imageSizes)+'"]')):c+='[href="'+ri(i)+'"]';var f=c;switch(n){case"style":f=$r(i);break;case"script":f=Yr(i)}Mi.has(f)||(i=Re({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:i,as:n},a),Mi.set(f,i),o.querySelector(c)!==null||n==="style"&&o.querySelector(Za(f))||n==="script"&&o.querySelector(el(f))||(n=o.createElement("link"),jt(n,"link",i),St(n),o.head.appendChild(n)))}}function dS(i,n){Ln.m(i,n);var a=Fr;if(a&&i){var o=n&&typeof n.as=="string"?n.as:"script",c='link[rel="modulepreload"][as="'+ri(o)+'"][href="'+ri(i)+'"]',f=c;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":f=Yr(i)}if(!Mi.has(f)&&(i=Re({rel:"modulepreload",href:i},n),Mi.set(f,i),a.querySelector(c)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(el(f)))return}o=a.createElement("link"),jt(o,"link",i),St(o),a.head.appendChild(o)}}}function hS(i,n,a){Ln.S(i,n,a);var o=Fr;if(o&&i){var c=Fn(o).hoistableStyles,f=$r(i);n=n||"default";var m=c.get(f);if(!m){var E={loading:0,preload:null};if(m=o.querySelector(Za(f)))E.loading=5;else{i=Re({rel:"stylesheet",href:i,"data-precedence":n},a),(a=Mi.get(f))&&rd(i,a);var _=m=o.createElement("link");St(_),jt(_,"link",i),_._p=new Promise(function(N,F){_.onload=N,_.onerror=F}),_.addEventListener("load",function(){E.loading|=1}),_.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Ao(m,n,o)}m={type:"stylesheet",instance:m,count:1,state:E},c.set(f,m)}}}function fS(i,n){Ln.X(i,n);var a=Fr;if(a&&i){var o=Fn(a).hoistableScripts,c=Yr(i),f=o.get(c);f||(f=a.querySelector(el(c)),f||(i=Re({src:i,async:!0},n),(n=Mi.get(c))&&ad(i,n),f=a.createElement("script"),St(f),jt(f,"link",i),a.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},o.set(c,f))}}function pS(i,n){Ln.M(i,n);var a=Fr;if(a&&i){var o=Fn(a).hoistableScripts,c=Yr(i),f=o.get(c);f||(f=a.querySelector(el(c)),f||(i=Re({src:i,async:!0,type:"module"},n),(n=Mi.get(c))&&ad(i,n),f=a.createElement("script"),St(f),jt(f,"link",i),a.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},o.set(c,f))}}function Cv(i,n,a,o){var c=(c=je.current)?Eo(c):null;if(!c)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=$r(a.href),a=Fn(c).hoistableStyles,o=a.get(n),o||(o={type:"style",instance:null,count:0,state:null},a.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){i=$r(a.href);var f=Fn(c).hoistableStyles,m=f.get(i);if(m||(c=c.ownerDocument||c,m={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},f.set(i,m),(f=c.querySelector(Za(i)))&&!f._p&&(m.instance=f,m.state.loading=5),Mi.has(i)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Mi.set(i,a),f||vS(c,i,a,m.state))),n&&o===null)throw Error(r(528,""));return m}if(n&&o!==null)throw Error(r(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Yr(a),a=Fn(c).hoistableScripts,o=a.get(n),o||(o={type:"script",instance:null,count:0,state:null},a.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function $r(i){return'href="'+ri(i)+'"'}function Za(i){return'link[rel="stylesheet"]['+i+"]"}function Rv(i){return Re({},i,{"data-precedence":i.precedence,precedence:null})}function vS(i,n,a,o){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=i.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),jt(n,"link",a),St(n),i.head.appendChild(n))}function Yr(i){return'[src="'+ri(i)+'"]'}function el(i){return"script[async]"+i}function _v(i,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var o=i.querySelector('style[data-href~="'+ri(a.href)+'"]');if(o)return n.instance=o,St(o),o;var c=Re({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return o=(i.ownerDocument||i).createElement("style"),St(o),jt(o,"style",c),Ao(o,a.precedence,i),n.instance=o;case"stylesheet":c=$r(a.href);var f=i.querySelector(Za(c));if(f)return n.state.loading|=4,n.instance=f,St(f),f;o=Rv(a),(c=Mi.get(c))&&rd(o,c),f=(i.ownerDocument||i).createElement("link"),St(f);var m=f;return m._p=new Promise(function(E,_){m.onload=E,m.onerror=_}),jt(f,"link",o),n.state.loading|=4,Ao(f,a.precedence,i),n.instance=f;case"script":return f=Yr(a.src),(c=i.querySelector(el(f)))?(n.instance=c,St(c),c):(o=a,(c=Mi.get(f))&&(o=Re({},a),ad(o,c)),i=i.ownerDocument||i,c=i.createElement("script"),St(c),jt(c,"link",o),i.head.appendChild(c),n.instance=c);case"void":return null;default:throw Error(r(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Ao(o,a.precedence,i));return n.instance}function Ao(i,n,a){for(var o=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=o.length?o[o.length-1]:null,f=c,m=0;m<o.length;m++){var E=o[m];if(E.dataset.precedence===n)f=E;else if(f!==c)break}f?f.parentNode.insertBefore(i,f.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(i,n.firstChild))}function rd(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function ad(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var Co=null;function Pv(i,n,a){if(Co===null){var o=new Map,c=Co=new Map;c.set(a,o)}else c=Co,o=c.get(a),o||(o=new Map,c.set(a,o));if(o.has(i))return o;for(o.set(i,null),a=a.getElementsByTagName(i),c=0;c<a.length;c++){var f=a[c];if(!(f[_s]||f[Mt]||i==="link"&&f.getAttribute("rel")==="stylesheet")&&f.namespaceURI!=="http://www.w3.org/2000/svg"){var m=f.getAttribute(n)||"";m=i+m;var E=o.get(m);E?E.push(f):o.set(m,[f])}}return o}function Dv(i,n,a){i=i.ownerDocument||i,i.head.insertBefore(a,n==="title"?i.querySelector("head > title"):null)}function gS(i,n,a){if(a===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function wv(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var tl=null;function mS(){}function yS(i,n,a){if(tl===null)throw Error(r(475));var o=tl;if(n.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var c=$r(a.href),f=i.querySelector(Za(c));if(f){i=f._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(o.count++,o=Ro.bind(o),i.then(o,o)),n.state.loading|=4,n.instance=f,St(f);return}f=i.ownerDocument||i,a=Rv(a),(c=Mi.get(c))&&rd(a,c),f=f.createElement("link"),St(f);var m=f;m._p=new Promise(function(E,_){m.onload=E,m.onerror=_}),jt(f,"link",a),n.instance=f}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(n,i),(i=n.state.preload)&&(n.state.loading&3)===0&&(o.count++,n=Ro.bind(o),i.addEventListener("load",n),i.addEventListener("error",n))}}function bS(){if(tl===null)throw Error(r(475));var i=tl;return i.stylesheets&&i.count===0&&ld(i,i.stylesheets),0<i.count?function(n){var a=setTimeout(function(){if(i.stylesheets&&ld(i,i.stylesheets),i.unsuspend){var o=i.unsuspend;i.unsuspend=null,o()}},6e4);return i.unsuspend=n,function(){i.unsuspend=null,clearTimeout(a)}}:null}function Ro(){if(this.count--,this.count===0){if(this.stylesheets)ld(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var _o=null;function ld(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,_o=new Map,n.forEach(SS,i),_o=null,Ro.call(i))}function SS(i,n){if(!(n.state.loading&4)){var a=_o.get(i);if(a)var o=a.get(null);else{a=new Map,_o.set(i,a);for(var c=i.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<c.length;f++){var m=c[f];(m.nodeName==="LINK"||m.getAttribute("media")!=="not all")&&(a.set(m.dataset.precedence,m),o=m)}o&&a.set(null,o)}c=n.instance,m=c.getAttribute("data-precedence"),f=a.get(m)||o,f===o&&a.set(null,c),a.set(m,c),this.count++,o=Ro.bind(this),c.addEventListener("load",o),c.addEventListener("error",o),f?f.parentNode.insertBefore(c,f.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(c,i.firstChild)),n.state.loading|=4}}var il={$$typeof:C,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function TS(i,n,a,o,c,f,m,E){this.tag=1,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=oa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oa(0),this.hiddenUpdates=oa(null),this.identifierPrefix=o,this.onUncaughtError=c,this.onCaughtError=f,this.onRecoverableError=m,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function Mv(i,n,a,o,c,f,m,E,_,N,F,J){return i=new TS(i,n,a,m,E,_,N,J),n=1,f===!0&&(n|=24),f=Di(3,null,null,n),i.current=f,f.stateNode=i,n=Gu(),n.refCount++,i.pooledCache=n,n.refCount++,f.memoizedState={element:o,isDehydrated:a,cache:n},bc(f),i}function Ov(i){return i?(i=Cr,i):Cr}function Lv(i,n,a,o,c,f){c=Ov(c),o.context===null?o.context=c:o.pendingContext=c,o=ns(n),o.payload={element:a},f=f===void 0?null:f,f!==null&&(o.callback=f),a=ss(i,o,n),a!==null&&(ei(a,i,n),Ga(a,i,n))}function Iv(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<n?a:n}}function od(i,n){Iv(i,n),(i=i.alternate)&&Iv(i,n)}function Nv(i){if(i.tag===13){var n=Wn(i,67108864);n!==null&&ei(n,i,67108864),od(i,67108864)}}var Po=!0;function kS(i,n,a,o){var c=ee.T;ee.T=null;var f=B.p;try{B.p=2,ud(i,n,a,o)}finally{B.p=f,ee.T=c}}function ES(i,n,a,o){var c=ee.T;ee.T=null;var f=B.p;try{B.p=8,ud(i,n,a,o)}finally{B.p=f,ee.T=c}}function ud(i,n,a,o){if(Po){var c=cd(o);if(c===null)Jc(i,n,o,Do,a),xv(i,o);else if(CS(c,i,n,a,o))o.stopPropagation();else if(xv(i,o),n&4&&-1<AS.indexOf(i)){for(;c!==null;){var f=si(c);if(f!==null)switch(f.tag){case 3:if(f=f.stateNode,f.current.memoizedState.isDehydrated){var m=xi(f.pendingLanes);if(m!==0){var E=f;for(E.pendingLanes|=2,E.entangledLanes|=2;m;){var _=1<<31-Vt(m);E.entanglements[1]|=_,m&=~_}un(f),(ut&6)===0&&(ho=Rt()+500,Wa(0))}}break;case 13:E=Wn(f,2),E!==null&&ei(E,f,2),vo(),od(f,2)}if(f=cd(o),f===null&&Jc(i,n,o,Do,a),f===c)break;c=f}c!==null&&o.stopPropagation()}else Jc(i,n,o,null,a)}}function cd(i){return i=Hi(i),dd(i)}var Do=null;function dd(i){if(Do=null,i=vn(i),i!==null){var n=A(i);if(n===null)i=null;else{var a=n.tag;if(a===13){if(i=w(n),i!==null)return i;i=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Do=i,null}function Uv(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Hn()){case De:return 2;case Me:return 8;case me:case Ve:return 32;case at:return 268435456;default:return 32}default:return 32}}var hd=!1,ds=null,hs=null,fs=null,nl=new Map,sl=new Map,ps=[],AS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xv(i,n){switch(i){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":hs=null;break;case"mouseover":case"mouseout":fs=null;break;case"pointerover":case"pointerout":nl.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":sl.delete(n.pointerId)}}function rl(i,n,a,o,c,f){return i===null||i.nativeEvent!==f?(i={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:f,targetContainers:[c]},n!==null&&(n=si(n),n!==null&&Nv(n)),i):(i.eventSystemFlags|=o,n=i.targetContainers,c!==null&&n.indexOf(c)===-1&&n.push(c),i)}function CS(i,n,a,o,c){switch(n){case"focusin":return ds=rl(ds,i,n,a,o,c),!0;case"dragenter":return hs=rl(hs,i,n,a,o,c),!0;case"mouseover":return fs=rl(fs,i,n,a,o,c),!0;case"pointerover":var f=c.pointerId;return nl.set(f,rl(nl.get(f)||null,i,n,a,o,c)),!0;case"gotpointercapture":return f=c.pointerId,sl.set(f,rl(sl.get(f)||null,i,n,a,o,c)),!0}return!1}function Bv(i){var n=vn(i.target);if(n!==null){var a=A(n);if(a!==null){if(n=a.tag,n===13){if(n=w(a),n!==null){i.blockedOn=n,pn(i.priority,function(){if(a.tag===13){var o=vi(),c=Wn(a,o);c!==null&&ei(c,a,o),od(a,o)}});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function wo(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var a=cd(i.nativeEvent);if(a===null){a=i.nativeEvent;var o=new a.constructor(a.type,a);ya=o,a.target.dispatchEvent(o),ya=null}else return n=si(a),n!==null&&Nv(n),i.blockedOn=a,!1;n.shift()}return!0}function Gv(i,n,a){wo(i)&&a.delete(n)}function RS(){hd=!1,ds!==null&&wo(ds)&&(ds=null),hs!==null&&wo(hs)&&(hs=null),fs!==null&&wo(fs)&&(fs=null),nl.forEach(Gv),sl.forEach(Gv)}function Mo(i,n){i.blockedOn===n&&(i.blockedOn=null,hd||(hd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,RS)))}var Oo=null;function jv(i){Oo!==i&&(Oo=i,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Oo===i&&(Oo=null);for(var n=0;n<i.length;n+=3){var a=i[n],o=i[n+1],c=i[n+2];if(typeof o!="function"){if(dd(o||a)===null)continue;break}var f=si(a);f!==null&&(i.splice(n,3),n-=3,tc(f,{pending:!0,data:c,method:a.method,action:o},o,c))}}))}function al(i){function n(_){return Mo(_,i)}ds!==null&&Mo(ds,i),hs!==null&&Mo(hs,i),fs!==null&&Mo(fs,i),nl.forEach(n),sl.forEach(n);for(var a=0;a<ps.length;a++){var o=ps[a];o.blockedOn===i&&(o.blockedOn=null)}for(;0<ps.length&&(a=ps[0],a.blockedOn===null);)Bv(a),a.blockedOn===null&&ps.shift();if(a=(i.ownerDocument||i).$$reactFormReplay,a!=null)for(o=0;o<a.length;o+=3){var c=a[o],f=a[o+1],m=c[qt]||null;if(typeof f=="function")m||jv(a);else if(m){var E=null;if(f&&f.hasAttribute("formAction")){if(c=f,m=f[qt]||null)E=m.formAction;else if(dd(c)!==null)continue}else E=m.action;typeof E=="function"?a[o+1]=E:(a.splice(o,3),o-=3),jv(a)}}}function fd(i){this._internalRoot=i}Lo.prototype.render=fd.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(r(409));var a=n.current,o=vi();Lv(a,o,i,n,null,null)},Lo.prototype.unmount=fd.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;i.tag===0&&Hr(),Lv(i.current,2,null,i,null,null),vo(),n[qn]=null}};function Lo(i){this._internalRoot=i}Lo.prototype.unstable_scheduleHydration=function(i){if(i){var n=dr();i={blockedOn:null,target:i,priority:n};for(var a=0;a<ps.length&&n!==0&&n<ps[a].priority;a++);ps.splice(a,0,i),a===0&&Bv(i)}};var zv=t.version;if(zv!=="19.0.0")throw Error(r(527,zv,"19.0.0"));B.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=P(n),i=i!==null?I(i):null,i=i===null?null:i.stateNode,i};var _S={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:ee,findFiberByHostInstance:vn,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Io=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Io.isDisabled&&Io.supportsFiber)try{ve=Io.inject(_S),We=Io}catch{}}return ol.createRoot=function(i,n){if(!l(i))throw Error(r(299));var a=!1,o="",c=sp,f=rp,m=ap,E=null;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(c=n.onUncaughtError),n.onCaughtError!==void 0&&(f=n.onCaughtError),n.onRecoverableError!==void 0&&(m=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(E=n.unstable_transitionCallbacks)),n=Mv(i,1,!1,null,null,a,o,c,f,m,E,null),i[qn]=n.current,Wc(i.nodeType===8?i.parentNode:i),new fd(n)},ol.hydrateRoot=function(i,n,a){if(!l(i))throw Error(r(299));var o=!1,c="",f=sp,m=rp,E=ap,_=null,N=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(f=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(E=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(_=a.unstable_transitionCallbacks),a.formState!==void 0&&(N=a.formState)),n=Mv(i,1,!0,n,a??null,o,c,f,m,E,_,N),n.context=Ov(null),a=n.current,o=vi(),c=ns(o),c.callback=null,ss(a,c,o),n.current.lanes=o,Rs(n,o),un(n),i[qn]=n.current,Wc(i),new Lo(n)},ol.version="19.0.0",ol}var Xv;function BS(){if(Xv)return gd.exports;Xv=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),gd.exports=xS(),gd.exports}var GS=BS();function jS(e){let t;const s=new Set,r=(v,g)=>{const b=typeof v=="function"?v(t):v;if(b!==t){const S=t;t=g?b:Object.assign({},t,b),s.forEach(C=>C(t,S))}},l=()=>t,u=(v,g=l,b=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let S=g(t);function C(){const D=g(t);if(!b(S,D)){const M=S;v(S=D,M)}}return s.add(C),()=>s.delete(C)},p={setState:r,getState:l,subscribe:(v,g,b)=>g||b?u(v,g,b):(s.add(v),()=>s.delete(v)),destroy:()=>s.clear()};return t=e(r,l,p),p}const zS=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Zv=zS?Xe.useEffect:Xe.useLayoutEffect;function Uo(e){const t=typeof e=="function"?jS(e):e,s=(r=t.getState,l=Object.is)=>{const[,u]=Xe.useReducer(j=>j+1,0),d=t.getState(),h=Xe.useRef(d),p=Xe.useRef(r),v=Xe.useRef(l),g=Xe.useRef(!1),b=Xe.useRef();b.current===void 0&&(b.current=r(d));let S,C=!1;(h.current!==d||p.current!==r||v.current!==l||g.current)&&(S=r(d),C=!l(b.current,S)),Zv(()=>{C&&(b.current=S),h.current=d,p.current=r,v.current=l,g.current=!1});const D=Xe.useRef(d);Zv(()=>{const j=()=>{try{const oe=t.getState(),ie=p.current(oe);v.current(b.current,ie)||(h.current=oe,b.current=ie,u())}catch{g.current=!0,u()}},le=t.subscribe(j);return t.getState()!==D.current&&j(),le},[]);const M=C?S:b.current;return Xe.useDebugValue(M),M};return Object.assign(s,t),s[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[s,t];return{next(){const l=r.length<=0;return{value:r.shift(),done:l}}}},s}function HS(e,t){return e===t}function VS(e,t,s){if(t===null||s===null||t.length!==s.length)return!1;for(var r=t.length,l=0;l<r;l++)if(!e(t[l],s[l]))return!1;return!0}function qS(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HS,s=null,r=null;return function(){return VS(t,s,arguments)||(r=e.apply(null,arguments)),s=arguments,r}}function FS(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(r){return typeof r=="function"})){var s=t.map(function(r){return typeof r}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, "+("instead received the following types: ["+s+"]"))}return t}function $S(e){for(var t=arguments.length,s=Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return function(){for(var l=arguments.length,u=Array(l),d=0;d<l;d++)u[d]=arguments[d];var h=0,p=u.pop(),v=FS(u),g=e.apply(void 0,[function(){return h++,p.apply(null,arguments)}].concat(s)),b=e(function(){for(var S=[],C=v.length,D=0;D<C;D++)S.push(v[D].apply(null,arguments));return g.apply(null,S)});return b.resultFunc=p,b.dependencies=v,b.recomputations=function(){return h},b.resetRecomputations=function(){return h=0},b}}var Z=$S(qS),fl={exports:{}},YS=fl.exports,eg;function KS(){return eg||(eg=1,function(e,t){(function(s,r){var l="1.0.40",u="",d="?",h="function",p="undefined",v="object",g="string",b="major",S="model",C="name",D="type",M="vendor",j="version",le="architecture",oe="console",ie="mobile",se="tablet",ae="smarttv",Ne="wearable",nt="embedded",we=500,ee="Amazon",Re="Apple",vt="ASUS",gt="BlackBerry",bt="Browser",wt="Chrome",de="Edge",te="Firefox",pe="Google",A="Huawei",w="LG",T="Microsoft",P="Motorola",I="Opera",U="Samsung",B="Sharp",z="Sony",V="Xiaomi",Q="Zebra",X="Facebook",Ae="Chromium OS",ue="Mac OS",Te=" Browser",Be=function(De,Me){var me={};for(var Ve in De)Me[Ve]&&Me[Ve].length%2===0?me[Ve]=Me[Ve].concat(De[Ve]):me[Ve]=De[Ve];return me},je=function(De){for(var Me={},me=0;me<De.length;me++)Me[De[me].toUpperCase()]=De[me];return Me},ii=function(De,Me){return typeof De===g?Ut(Me).indexOf(Ut(De))!==-1:!1},Ut=function(De){return De.toLowerCase()},Ht=function(De){return typeof De===g?De.replace(/[^\d\.]/g,u).split(".")[0]:r},oi=function(De,Me){if(typeof De===g)return De=De.replace(/^\s\s*/,u),typeof Me===p?De:De.substring(0,we)},ct=function(De,Me){for(var me=0,Ve,at,Xt,Ue,ve,We;me<Me.length&&!ve;){var Zi=Me[me],ni=Me[me+1];for(Ve=at=0;Ve<Zi.length&&!ve&&Zi[Ve];)if(ve=Zi[Ve++].exec(De),ve)for(Xt=0;Xt<ni.length;Xt++)We=ve[++at],Ue=ni[Xt],typeof Ue===v&&Ue.length>0?Ue.length===2?typeof Ue[1]==h?this[Ue[0]]=Ue[1].call(this,We):this[Ue[0]]=Ue[1]:Ue.length===3?typeof Ue[1]===h&&!(Ue[1].exec&&Ue[1].test)?this[Ue[0]]=We?Ue[1].call(this,We,Ue[2]):r:this[Ue[0]]=We?We.replace(Ue[1],Ue[2]):r:Ue.length===4&&(this[Ue[0]]=We?Ue[3].call(this,We.replace(Ue[1],Ue[2])):r):this[Ue]=We||r;me+=2}},st=function(De,Me){for(var me in Me)if(typeof Me[me]===v&&Me[me].length>0){for(var Ve=0;Ve<Me[me].length;Ve++)if(ii(Me[me][Ve],De))return me===d?r:me}else if(ii(Me[me],De))return me===d?r:me;return Me.hasOwnProperty("*")?Me["*"]:De},Cs={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},zn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},lr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[j,[C,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[j,[C,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[C,j],[/opios[\/ ]+([\w\.]+)/i],[j,[C,I+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[j,[C,I+" GX"]],[/\bopr\/([\w\.]+)/i],[j,[C,I]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[j,[C,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[j,[C,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[C,j],[/quark(?:pc)?\/([-\w\.]+)/i],[j,[C,"Quark"]],[/\bddg\/([\w\.]+)/i],[j,[C,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[j,[C,"UC"+bt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[j,[C,"WeChat"]],[/konqueror\/([\w\.]+)/i],[j,[C,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[j,[C,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[j,[C,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[j,[C,"Smart Lenovo "+bt]],[/(avast|avg)\/([\w\.]+)/i],[[C,/(.+)/,"$1 Secure "+bt],j],[/\bfocus\/([\w\.]+)/i],[j,[C,te+" Focus"]],[/\bopt\/([\w\.]+)/i],[j,[C,I+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[j,[C,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[j,[C,"Dolphin"]],[/coast\/([\w\.]+)/i],[j,[C,I+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[j,[C,"MIUI"+Te]],[/fxios\/([\w\.-]+)/i],[j,[C,te]],[/\bqihoobrowser\/?([\w\.]*)/i],[j,[C,"360"]],[/\b(qq)\/([\w\.]+)/i],[[C,/(.+)/,"$1Browser"],j],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[C,/(.+)/,"$1"+Te],j],[/samsungbrowser\/([\w\.]+)/i],[j,[C,U+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[j,[C,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[C,"Sogou Mobile"],j],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[C,j],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[C],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[j,C],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[C,X],j],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[C,j],[/\bgsa\/([\w\.]+) .*safari\//i],[j,[C,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[j,[C,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[j,[C,wt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[C,wt+" WebView"],j],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[j,[C,"Android "+bt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[C,j],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[j,[C,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[j,C],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[C,[j,st,Cs]],[/(webkit|khtml)\/([\w\.]+)/i],[C,j],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[C,"Netscape"],j],[/(wolvic|librewolf)\/([\w\.]+)/i],[C,j],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[j,[C,te+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[C,[j,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[C,[j,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[le,"amd64"]],[/(ia32(?=;))/i],[[le,Ut]],[/((?:i[346]|x)86)[;\)]/i],[[le,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[le,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[le,"armhf"]],[/windows (ce|mobile); ppc;/i],[[le,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[le,/ower/,u,Ut]],[/(sun4\w)[;\)]/i],[[le,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[le,Ut]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[S,[M,U],[D,se]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[S,[M,U],[D,ie]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[S,[M,Re],[D,ie]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[S,[M,Re],[D,se]],[/(macintosh);/i],[S,[M,Re]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[S,[M,B],[D,ie]],[/(?:honor)([-\w ]+)[;\)]/i],[S,[M,"Honor"],[D,ie]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[S,[M,A],[D,se]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[S,[M,A],[D,ie]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[S,/_/g," "],[M,V],[D,ie]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[S,/_/g," "],[M,V],[D,se]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[S,[M,"OPPO"],[D,ie]],[/\b(opd2\d{3}a?) bui/i],[S,[M,"OPPO"],[D,se]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[S,[M,"Vivo"],[D,ie]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[S,[M,"Realme"],[D,ie]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[S,[M,P],[D,ie]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[S,[M,P],[D,se]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[S,[M,w],[D,se]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[S,[M,w],[D,ie]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[S,[M,"Lenovo"],[D,se]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[S,/_/g," "],[M,"Nokia"],[D,ie]],[/(pixel c)\b/i],[S,[M,pe],[D,se]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[S,[M,pe],[D,ie]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[S,[M,z],[D,ie]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[S,"Xperia Tablet"],[M,z],[D,se]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[S,[M,"OnePlus"],[D,ie]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[S,[M,ee],[D,se]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[S,/(.+)/g,"Fire Phone $1"],[M,ee],[D,ie]],[/(playbook);[-\w\),; ]+(rim)/i],[S,M,[D,se]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[S,[M,gt],[D,ie]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[S,[M,vt],[D,se]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[S,[M,vt],[D,ie]],[/(nexus 9)/i],[S,[M,"HTC"],[D,se]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[M,[S,/_/g," "],[D,ie]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[S,[M,"TCL"],[D,se]],[/(itel) ((\w+))/i],[[M,Ut],S,[D,st,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[S,[M,"Acer"],[D,se]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[S,[M,"Meizu"],[D,ie]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[S,[M,"Ulefone"],[D,ie]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[S,[M,"Energizer"],[D,ie]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[S,[M,"Cat"],[D,ie]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[S,[M,"Smartfren"],[D,ie]],[/droid.+; (a(?:015|06[35]|142p?))/i],[S,[M,"Nothing"],[D,ie]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[M,S,[D,ie]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[M,S,[D,se]],[/(surface duo)/i],[S,[M,T],[D,se]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[S,[M,"Fairphone"],[D,ie]],[/(u304aa)/i],[S,[M,"AT&T"],[D,ie]],[/\bsie-(\w*)/i],[S,[M,"Siemens"],[D,ie]],[/\b(rct\w+) b/i],[S,[M,"RCA"],[D,se]],[/\b(venue[\d ]{2,7}) b/i],[S,[M,"Dell"],[D,se]],[/\b(q(?:mv|ta)\w+) b/i],[S,[M,"Verizon"],[D,se]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[S,[M,"Barnes & Noble"],[D,se]],[/\b(tm\d{3}\w+) b/i],[S,[M,"NuVision"],[D,se]],[/\b(k88) b/i],[S,[M,"ZTE"],[D,se]],[/\b(nx\d{3}j) b/i],[S,[M,"ZTE"],[D,ie]],[/\b(gen\d{3}) b.+49h/i],[S,[M,"Swiss"],[D,ie]],[/\b(zur\d{3}) b/i],[S,[M,"Swiss"],[D,se]],[/\b((zeki)?tb.*\b) b/i],[S,[M,"Zeki"],[D,se]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[M,"Dragon Touch"],S,[D,se]],[/\b(ns-?\w{0,9}) b/i],[S,[M,"Insignia"],[D,se]],[/\b((nxa|next)-?\w{0,9}) b/i],[S,[M,"NextBook"],[D,se]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[M,"Voice"],S,[D,ie]],[/\b(lvtel\-)?(v1[12]) b/i],[[M,"LvTel"],S,[D,ie]],[/\b(ph-1) /i],[S,[M,"Essential"],[D,ie]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[S,[M,"Envizen"],[D,se]],[/\b(trio[-\w\. ]+) b/i],[S,[M,"MachSpeed"],[D,se]],[/\btu_(1491) b/i],[S,[M,"Rotor"],[D,se]],[/(shield[\w ]+) b/i],[S,[M,"Nvidia"],[D,se]],[/(sprint) (\w+)/i],[M,S,[D,ie]],[/(kin\.[onetw]{3})/i],[[S,/\./g," "],[M,T],[D,ie]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[S,[M,Q],[D,se]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[S,[M,Q],[D,ie]],[/smart-tv.+(samsung)/i],[M,[D,ae]],[/hbbtv.+maple;(\d+)/i],[[S,/^/,"SmartTV"],[M,U],[D,ae]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[M,w],[D,ae]],[/(apple) ?tv/i],[M,[S,Re+" TV"],[D,ae]],[/crkey/i],[[S,wt+"cast"],[M,pe],[D,ae]],[/droid.+aft(\w+)( bui|\))/i],[S,[M,ee],[D,ae]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[S,[M,B],[D,ae]],[/(bravia[\w ]+)( bui|\))/i],[S,[M,z],[D,ae]],[/(mitv-\w{5}) bui/i],[S,[M,V],[D,ae]],[/Hbbtv.*(technisat) (.*);/i],[M,S,[D,ae]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[M,oi],[S,oi],[D,ae]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[D,ae]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[M,S,[D,oe]],[/droid.+; (shield) bui/i],[S,[M,"Nvidia"],[D,oe]],[/(playstation [345portablevi]+)/i],[S,[M,z],[D,oe]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[S,[M,T],[D,oe]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[S,[M,U],[D,Ne]],[/((pebble))app/i],[M,S,[D,Ne]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[S,[M,Re],[D,Ne]],[/droid.+; (glass) \d/i],[S,[M,pe],[D,Ne]],[/droid.+; (wt63?0{2,3})\)/i],[S,[M,Q],[D,Ne]],[/droid.+; (glass) \d/i],[S,[M,pe],[D,Ne]],[/(pico) (4|neo3(?: link|pro)?)/i],[M,S,[D,Ne]],[/; (quest( \d| pro)?)/i],[S,[M,X],[D,Ne]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[M,[D,nt]],[/(aeobc)\b/i],[S,[M,ee],[D,nt]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[S,[D,ie]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[S,[D,se]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[D,se]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[D,ie]],[/(android[-\w\. ]{0,9});.+buil/i],[S,[M,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[j,[C,de+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[C,j],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[j,[C,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[C,j],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[j,C]],os:[[/microsoft (windows) (vista|xp)/i],[C,j],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[C,[j,st,zn]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[j,st,zn],[C,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[j,/_/g,"."],[C,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[C,ue],[j,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[j,C],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[C,j],[/\(bb(10);/i],[j,[C,gt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[j,[C,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[j,[C,te+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[j,[C,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[j,[C,"watchOS"]],[/crkey\/([\d\.]+)/i],[j,[C,wt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[C,Ae],j],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[C,j],[/(sunos) ?([\w\.\d]*)/i],[[C,"Solaris"],j],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[C,j]]},Jt=function(De,Me){if(typeof De===v&&(Me=De,De=r),!(this instanceof Jt))return new Jt(De,Me).getResult();var me=typeof s!==p&&s.navigator?s.navigator:r,Ve=De||(me&&me.userAgent?me.userAgent:u),at=me&&me.userAgentData?me.userAgentData:r,Xt=Me?Be(lr,Me):lr,Ue=me&&me.userAgent==Ve;return this.getBrowser=function(){var ve={};return ve[C]=r,ve[j]=r,ct.call(ve,Ve,Xt.browser),ve[b]=Ht(ve[j]),Ue&&me&&me.brave&&typeof me.brave.isBrave==h&&(ve[C]="Brave"),ve},this.getCPU=function(){var ve={};return ve[le]=r,ct.call(ve,Ve,Xt.cpu),ve},this.getDevice=function(){var ve={};return ve[M]=r,ve[S]=r,ve[D]=r,ct.call(ve,Ve,Xt.device),Ue&&!ve[D]&&at&&at.mobile&&(ve[D]=ie),Ue&&ve[S]=="Macintosh"&&me&&typeof me.standalone!==p&&me.maxTouchPoints&&me.maxTouchPoints>2&&(ve[S]="iPad",ve[D]=se),ve},this.getEngine=function(){var ve={};return ve[C]=r,ve[j]=r,ct.call(ve,Ve,Xt.engine),ve},this.getOS=function(){var ve={};return ve[C]=r,ve[j]=r,ct.call(ve,Ve,Xt.os),Ue&&!ve[C]&&at&&at.platform&&at.platform!="Unknown"&&(ve[C]=at.platform.replace(/chrome os/i,Ae).replace(/macos/i,ue)),ve},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ve},this.setUA=function(ve){return Ve=typeof ve===g&&ve.length>we?oi(ve,we):ve,this},this.setUA(Ve),this};Jt.VERSION=l,Jt.BROWSER=je([C,j,b]),Jt.CPU=je([le]),Jt.DEVICE=je([S,M,D,oe,ie,ae,se,Ne,nt]),Jt.ENGINE=Jt.OS=je([C,j]),e.exports&&(t=e.exports=Jt),t.UAParser=Jt;var Rt=typeof s!==p&&(s.jQuery||s.Zepto);if(Rt&&!Rt.ua){var Hn=new Jt;Rt.ua=Hn.getResult(),Rt.ua.get=function(){return Hn.getUA()},Rt.ua.set=function(De){Hn.setUA(De);var Me=Hn.getResult();for(var me in Me)Rt.ua[me]=Me[me]}}})(typeof window=="object"?window:YS)}(fl,fl.exports)),fl.exports}var QS=KS(),xo,WS=new Uint8Array(16);function JS(){if(!xo&&(xo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xo(WS)}const XS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ZS(e){return typeof e=="string"&&XS.test(e)}var zt=[];for(var Sd=0;Sd<256;++Sd)zt.push((Sd+256).toString(16).substr(1));function eT(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=(zt[e[t+0]]+zt[e[t+1]]+zt[e[t+2]]+zt[e[t+3]]+"-"+zt[e[t+4]]+zt[e[t+5]]+"-"+zt[e[t+6]]+zt[e[t+7]]+"-"+zt[e[t+8]]+zt[e[t+9]]+"-"+zt[e[t+10]]+zt[e[t+11]]+zt[e[t+12]]+zt[e[t+13]]+zt[e[t+14]]+zt[e[t+15]]).toLowerCase();if(!ZS(s))throw TypeError("Stringified UUID is invalid");return s}function ks(e,t,s){e=e||{};var r=e.random||(e.rng||JS)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,eT(r)}var pl={exports:{}};pl.exports;var tg;function tT(){return tg||(tg=1,function(e,t){var s=200,r="__lodash_hash_undefined__",l=1,u=2,d=9007199254740991,h="[object Arguments]",p="[object Array]",v="[object AsyncFunction]",g="[object Boolean]",b="[object Date]",S="[object Error]",C="[object Function]",D="[object GeneratorFunction]",M="[object Map]",j="[object Number]",le="[object Null]",oe="[object Object]",ie="[object Promise]",se="[object Proxy]",ae="[object RegExp]",Ne="[object Set]",nt="[object String]",we="[object Symbol]",ee="[object Undefined]",Re="[object WeakMap]",vt="[object ArrayBuffer]",gt="[object DataView]",bt="[object Float32Array]",wt="[object Float64Array]",de="[object Int8Array]",te="[object Int16Array]",pe="[object Int32Array]",A="[object Uint8Array]",w="[object Uint8ClampedArray]",T="[object Uint16Array]",P="[object Uint32Array]",I=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,B=/^(?:0|[1-9]\d*)$/,z={};z[bt]=z[wt]=z[de]=z[te]=z[pe]=z[A]=z[w]=z[T]=z[P]=!0,z[h]=z[p]=z[vt]=z[g]=z[gt]=z[b]=z[S]=z[C]=z[M]=z[j]=z[oe]=z[ae]=z[Ne]=z[nt]=z[Re]=!1;var V=typeof No=="object"&&No&&No.Object===Object&&No,Q=typeof self=="object"&&self&&self.Object===Object&&self,X=V||Q||Function("return this")(),Ae=t&&!t.nodeType&&t,ue=Ae&&!0&&e&&!e.nodeType&&e,Te=ue&&ue.exports===Ae,Be=Te&&V.process,je=function(){try{return Be&&Be.binding&&Be.binding("util")}catch{}}(),ii=je&&je.isTypedArray;function Ut(R,O){for(var $=-1,ne=R==null?0:R.length,qe=0,_e=[];++$<ne;){var Ze=R[$];O(Ze,$,R)&&(_e[qe++]=Ze)}return _e}function Ht(R,O){for(var $=-1,ne=O.length,qe=R.length;++$<ne;)R[qe+$]=O[$];return R}function oi(R,O){for(var $=-1,ne=R==null?0:R.length;++$<ne;)if(O(R[$],$,R))return!0;return!1}function ct(R,O){for(var $=-1,ne=Array(R);++$<R;)ne[$]=O($);return ne}function st(R){return function(O){return R(O)}}function Cs(R,O){return R.has(O)}function zn(R,O){return R==null?void 0:R[O]}function lr(R){var O=-1,$=Array(R.size);return R.forEach(function(ne,qe){$[++O]=[qe,ne]}),$}function Jt(R,O){return function($){return R(O($))}}function Rt(R){var O=-1,$=Array(R.size);return R.forEach(function(ne){$[++O]=ne}),$}var Hn=Array.prototype,De=Function.prototype,Me=Object.prototype,me=X["__core-js_shared__"],Ve=De.toString,at=Me.hasOwnProperty,Xt=function(){var R=/[^.]+$/.exec(me&&me.keys&&me.keys.IE_PROTO||"");return R?"Symbol(src)_1."+R:""}(),Ue=Me.toString,ve=RegExp("^"+Ve.call(at).replace(I,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),We=Te?X.Buffer:void 0,Zi=X.Symbol,ni=X.Uint8Array,Vt=Me.propertyIsEnumerable,vu=Hn.splice,hn=Zi?Zi.toStringTag:void 0,Cl=Object.getOwnPropertySymbols,or=We?We.isBuffer:void 0,ur=Jt(Object.keys,Object),xi=ui(X,"DataView"),en=ui(X,"Map"),fn=ui(X,"Promise"),la=ui(X,"Set"),cr=ui(X,"WeakMap"),Vn=ui(Object,"create"),oa=Hi(xi),Rs=Hi(en),gu=Hi(fn),Rl=Hi(la),_l=Hi(cr),ua=Zi?Zi.prototype:void 0,dr=ua?ua.valueOf:void 0;function pn(R){var O=-1,$=R==null?0:R.length;for(this.clear();++O<$;){var ne=R[O];this.set(ne[0],ne[1])}}function tn(){this.__data__=Vn?Vn(null):{},this.size=0}function Mt(R){var O=this.has(R)&&delete this.__data__[R];return this.size-=O?1:0,O}function qt(R){var O=this.__data__;if(Vn){var $=O[R];return $===r?void 0:$}return at.call(O,R)?O[R]:void 0}function qn(R){var O=this.__data__;return Vn?O[R]!==void 0:at.call(O,R)}function ca(R,O){var $=this.__data__;return this.size+=this.has(R)?0:1,$[R]=Vn&&O===void 0?r:O,this}pn.prototype.clear=tn,pn.prototype.delete=Mt,pn.prototype.get=qt,pn.prototype.has=qn,pn.prototype.set=ca;function Bi(R){var O=-1,$=R==null?0:R.length;for(this.clear();++O<$;){var ne=R[O];this.set(ne[0],ne[1])}}function mu(){this.__data__=[],this.size=0}function Pl(R){var O=this.__data__,$=xt(O,R);if($<0)return!1;var ne=O.length-1;return $==ne?O.pop():vu.call(O,$,1),--this.size,!0}function _s(R){var O=this.__data__,$=xt(O,R);return $<0?void 0:O[$][1]}function da(R){return xt(this.__data__,R)>-1}function vn(R,O){var $=this.__data__,ne=xt($,R);return ne<0?(++this.size,$.push([R,O])):$[ne][1]=O,this}Bi.prototype.clear=mu,Bi.prototype.delete=Pl,Bi.prototype.get=_s,Bi.prototype.has=da,Bi.prototype.set=vn;function si(R){var O=-1,$=R==null?0:R.length;for(this.clear();++O<$;){var ne=R[O];this.set(ne[0],ne[1])}}function Ps(){this.size=0,this.__data__={hash:new pn,map:new(en||Bi),string:new pn}}function Fn(R){var O=Ms(this,R).delete(R);return this.size-=O?1:0,O}function St(R){return Ms(this,R).get(R)}function Dl(R){return Ms(this,R).has(R)}function wl(R,O){var $=Ms(this,R),ne=$.size;return $.set(R,O),this.size+=$.size==ne?0:1,this}si.prototype.clear=Ps,si.prototype.delete=Fn,si.prototype.get=St,si.prototype.has=Dl,si.prototype.set=wl;function Ti(R){var O=-1,$=R==null?0:R.length;for(this.__data__=new si;++O<$;)this.add(R[O])}function $n(R){return this.__data__.set(R,r),this}function Gi(R){return this.__data__.has(R)}Ti.prototype.add=Ti.prototype.push=$n,Ti.prototype.has=Gi;function nn(R){var O=this.__data__=new Bi(R);this.size=O.size}function Ml(){this.__data__=new Bi,this.size=0}function Ol(R){var O=this.__data__,$=O.delete(R);return this.size=O.size,$}function yu(R){return this.__data__.get(R)}function hr(R){return this.__data__.has(R)}function fr(R,O){var $=this.__data__;if($ instanceof Bi){var ne=$.__data__;if(!en||ne.length<s-1)return ne.push([R,O]),this.size=++$.size,this;$=this.__data__=new si(ne)}return $.set(R,O),this.size=$.size,this}nn.prototype.clear=Ml,nn.prototype.delete=Ol,nn.prototype.get=yu,nn.prototype.has=hr,nn.prototype.set=fr;function ji(R,O){var $=Os(R),ne=!$&&Kn(R),qe=!$&&!ne&&gr(R),_e=!$&&!ne&&!qe&&Is(R),Ze=$||ne||qe||_e,dt=Ze?ct(R.length,String):[],lt=dt.length;for(var $e in R)at.call(R,$e)&&!(Ze&&($e=="length"||qe&&($e=="offset"||$e=="parent")||_e&&($e=="buffer"||$e=="byteLength"||$e=="byteOffset")||ma($e,lt)))&&dt.push($e);return dt}function xt(R,O){for(var $=R.length;$--;)if(gn(R[$][0],O))return $;return-1}function Ll(R,O,$){var ne=O(R);return Os(R)?ne:Ht(ne,$(R))}function Ds(R){return R==null?R===void 0?ee:le:hn&&hn in Object(R)?Su(R):ya(R)}function ws(R){return mn(R)&&Ds(R)==h}function ha(R,O,$,ne,qe){return R===O?!0:R==null||O==null||!mn(R)&&!mn(O)?R!==R&&O!==O:pr(R,O,$,ne,ha,qe)}function pr(R,O,$,ne,qe,_e){var Ze=Os(R),dt=Os(O),lt=Ze?p:zi(R),$e=dt?p:zi(O);lt=lt==h?oe:lt,$e=$e==h?oe:$e;var Ft=lt==oe,ci=$e==oe,Ot=lt==$e;if(Ot&&gr(R)){if(!gr(O))return!1;Ze=!0,Ft=!1}if(Ot&&!Ft)return _e||(_e=new nn),Ze||Is(R)?pa(R,O,$,ne,qe,_e):va(R,O,lt,$,ne,qe,_e);if(!($&l)){var ai=Ft&&at.call(R,"__wrapped__"),$t=ci&&at.call(O,"__wrapped__");if(ai||$t){var sn=ai?R.value():R,qi=$t?O.value():O;return _e||(_e=new nn),qe(sn,qi,$,ne,_e)}}return Ot?(_e||(_e=new nn),Yn(R,O,$,ne,qe,_e)):!1}function bu(R){if(!Vi(R)||ku(R))return!1;var O=mr(R)?ve:U;return O.test(Hi(R))}function ri(R){return mn(R)&&Qn(R.length)&&!!z[Ds(R)]}function fa(R){if(!vr(R))return ur(R);var O=[];for(var $ in Object(R))at.call(R,$)&&$!="constructor"&&O.push($);return O}function pa(R,O,$,ne,qe,_e){var Ze=$&l,dt=R.length,lt=O.length;if(dt!=lt&&!(Ze&&lt>dt))return!1;var $e=_e.get(R);if($e&&_e.get(O))return $e==O;var Ft=-1,ci=!0,Ot=$&u?new Ti:void 0;for(_e.set(R,O),_e.set(O,R);++Ft<dt;){var ai=R[Ft],$t=O[Ft];if(ne)var sn=Ze?ne($t,ai,Ft,O,R,_e):ne(ai,$t,Ft,R,O,_e);if(sn!==void 0){if(sn)continue;ci=!1;break}if(Ot){if(!oi(O,function(qi,yn){if(!Cs(Ot,yn)&&(ai===qi||qe(ai,qi,$,ne,_e)))return Ot.push(yn)})){ci=!1;break}}else if(!(ai===$t||qe(ai,$t,$,ne,_e))){ci=!1;break}}return _e.delete(R),_e.delete(O),ci}function va(R,O,$,ne,qe,_e,Ze){switch($){case gt:if(R.byteLength!=O.byteLength||R.byteOffset!=O.byteOffset)return!1;R=R.buffer,O=O.buffer;case vt:return!(R.byteLength!=O.byteLength||!_e(new ni(R),new ni(O)));case g:case b:case j:return gn(+R,+O);case S:return R.name==O.name&&R.message==O.message;case ae:case nt:return R==O+"";case M:var dt=lr;case Ne:var lt=ne&l;if(dt||(dt=Rt),R.size!=O.size&&!lt)return!1;var $e=Ze.get(R);if($e)return $e==O;ne|=u,Ze.set(R,O);var Ft=pa(dt(R),dt(O),ne,qe,_e,Ze);return Ze.delete(R),Ft;case we:if(dr)return dr.call(R)==dr.call(O)}return!1}function Yn(R,O,$,ne,qe,_e){var Ze=$&l,dt=ga(R),lt=dt.length,$e=ga(O),Ft=$e.length;if(lt!=Ft&&!Ze)return!1;for(var ci=lt;ci--;){var Ot=dt[ci];if(!(Ze?Ot in O:at.call(O,Ot)))return!1}var ai=_e.get(R);if(ai&&_e.get(O))return ai==O;var $t=!0;_e.set(R,O),_e.set(O,R);for(var sn=Ze;++ci<lt;){Ot=dt[ci];var qi=R[Ot],yn=O[Ot];if(ne)var Ul=Ze?ne(yn,qi,Ot,O,R,_e):ne(qi,yn,Ot,R,O,_e);if(!(Ul===void 0?qi===yn||qe(qi,yn,$,ne,_e):Ul)){$t=!1;break}sn||(sn=Ot=="constructor")}if($t&&!sn){var Sr=R.constructor,Ns=O.constructor;Sr!=Ns&&"constructor"in R&&"constructor"in O&&!(typeof Sr=="function"&&Sr instanceof Sr&&typeof Ns=="function"&&Ns instanceof Ns)&&($t=!1)}return _e.delete(R),_e.delete(O),$t}function ga(R){return Ll(R,Nl,Il)}function Ms(R,O){var $=R.__data__;return Tu(O)?$[typeof O=="string"?"string":"hash"]:$.map}function ui(R,O){var $=zn(R,O);return bu($)?$:void 0}function Su(R){var O=at.call(R,hn),$=R[hn];try{R[hn]=void 0;var ne=!0}catch{}var qe=Ue.call(R);return ne&&(O?R[hn]=$:delete R[hn]),qe}var Il=Cl?function(R){return R==null?[]:(R=Object(R),Ut(Cl(R),function(O){return Vt.call(R,O)}))}:yr,zi=Ds;(xi&&zi(new xi(new ArrayBuffer(1)))!=gt||en&&zi(new en)!=M||fn&&zi(fn.resolve())!=ie||la&&zi(new la)!=Ne||cr&&zi(new cr)!=Re)&&(zi=function(R){var O=Ds(R),$=O==oe?R.constructor:void 0,ne=$?Hi($):"";if(ne)switch(ne){case oa:return gt;case Rs:return M;case gu:return ie;case Rl:return Ne;case _l:return Re}return O});function ma(R,O){return O=O??d,!!O&&(typeof R=="number"||B.test(R))&&R>-1&&R%1==0&&R<O}function Tu(R){var O=typeof R;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?R!=="__proto__":R===null}function ku(R){return!!Xt&&Xt in R}function vr(R){var O=R&&R.constructor,$=typeof O=="function"&&O.prototype||Me;return R===$}function ya(R){return Ue.call(R)}function Hi(R){if(R!=null){try{return Ve.call(R)}catch{}try{return R+""}catch{}}return""}function gn(R,O){return R===O||R!==R&&O!==O}var Kn=ws(function(){return arguments}())?ws:function(R){return mn(R)&&at.call(R,"callee")&&!Vt.call(R,"callee")},Os=Array.isArray;function ba(R){return R!=null&&Qn(R.length)&&!mr(R)}var gr=or||br;function Ls(R,O){return ha(R,O)}function mr(R){if(!Vi(R))return!1;var O=Ds(R);return O==C||O==D||O==v||O==se}function Qn(R){return typeof R=="number"&&R>-1&&R%1==0&&R<=d}function Vi(R){var O=typeof R;return R!=null&&(O=="object"||O=="function")}function mn(R){return R!=null&&typeof R=="object"}var Is=ii?st(ii):ri;function Nl(R){return ba(R)?ji(R):fa(R)}function yr(){return[]}function br(){return!1}e.exports=Ls}(pl,pl.exports)),pl.exports}var iT=tT();const Xg=au(iT);let Zg=!0,em=!0;function jo(e,t,s){const r=e.match(t);return r&&r.length>=s&&parseInt(r[s],10)}function ar(e,t,s){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,l=r.addEventListener;r.addEventListener=function(d,h){if(d!==t)return l.apply(this,arguments);const p=v=>{const g=s(v);g&&(h.handleEvent?h.handleEvent(g):h(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,p),l.apply(this,[d,p])};const u=r.removeEventListener;r.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(h))return u.apply(this,arguments);const p=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[d,p])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function nT(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Zg=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function sT(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(em=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function tm(){if(typeof window=="object"){if(Zg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ah(e,t){em&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rT(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:s}=e;if(s.mozGetUserMedia)t.browser="firefox",t.version=jo(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=jo(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=jo(s.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function ig(e){return Object.prototype.toString.call(e)==="[object Object]"}function im(e){return ig(e)?Object.keys(e).reduce(function(t,s){const r=ig(e[s]),l=r?im(e[s]):e[s],u=r&&!Object.keys(l).length;return l===void 0||u?t:Object.assign(t,{[s]:l})},{}):e}function Ld(e,t,s){!t||s.has(t.id)||(s.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Ld(e,e.get(t[r]),s):r.endsWith("Ids")&&t[r].forEach(l=>{Ld(e,e.get(l),s)})}))}function ng(e,t,s){const r=s?"outbound-rtp":"inbound-rtp",l=new Map;if(t===null)return l;const u=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&u.push(d)}),u.forEach(d=>{e.forEach(h=>{h.type===r&&h.trackId===d.id&&Ld(e,h,l)})}),l}const sg=tm;function nm(e,t){const s=e&&e.navigator;if(!s.mediaDevices)return;const r=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(v=>{if(v==="require"||v==="advanced"||v==="mediaSource")return;const g=typeof h[v]=="object"?h[v]:{ideal:h[v]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const b=function(S,C){return S?S+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(g.ideal!==void 0){p.optional=p.optional||[];let S={};typeof g.ideal=="number"?(S[b("min",v)]=g.ideal,p.optional.push(S),S={},S[b("max",v)]=g.ideal,p.optional.push(S)):(S[b("",v)]=g.ideal,p.optional.push(S))}g.exact!==void 0&&typeof g.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[b("",v)]=g.exact):["min","max"].forEach(S=>{g[S]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[b(S,v)]=g[S])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},l=function(h,p){if(t.version>=61)return p(h);if(h=JSON.parse(JSON.stringify(h)),h&&typeof h.audio=="object"){const v=function(g,b,S){b in g&&!(S in g)&&(g[S]=g[b],delete g[b])};h=JSON.parse(JSON.stringify(h)),v(h.audio,"autoGainControl","googAutoGainControl"),v(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=r(h.audio)}if(h&&typeof h.video=="object"){let v=h.video.facingMode;v=v&&(typeof v=="object"?v:{ideal:v});const g=t.version<66;if(v&&(v.exact==="user"||v.exact==="environment"||v.ideal==="user"||v.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete h.video.facingMode;let b;if(v.exact==="environment"||v.ideal==="environment"?b=["back","rear"]:(v.exact==="user"||v.ideal==="user")&&(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(S=>{S=S.filter(D=>D.kind==="videoinput");let C=S.find(D=>b.some(M=>D.label.toLowerCase().includes(M)));return!C&&S.length&&b.includes("back")&&(C=S[S.length-1]),C&&(h.video.deviceId=v.exact?{exact:C.deviceId}:{ideal:C.deviceId}),h.video=r(h.video),sg("chrome: "+JSON.stringify(h)),p(h)})}h.video=r(h.video)}return sg("chrome: "+JSON.stringify(h)),p(h)},u=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},d=function(h,p,v){l(h,g=>{s.webkitGetUserMedia(g,p,b=>{v&&v(u(b))})})};if(s.getUserMedia=d.bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(p){return l(p,v=>h(v).then(g=>{if(v.audio&&!g.getAudioTracks().length||v.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(u(g))))}}}function aT(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(l=>{const u=r.video&&r.video.width,d=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:l,maxFrameRate:h||3}},u&&(r.video.mandatory.maxWidth=u),d&&(r.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(r)})}}}function sm(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function rm(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",l=>{let u;e.RTCPeerConnection.prototype.getReceivers?u=this.getReceivers().find(h=>h.track&&h.track.id===l.track.id):u={track:l.track};const d=new Event("track");d.track=l.track,d.receiver=u,d.transceiver={receiver:u},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(l=>{let u;e.RTCPeerConnection.prototype.getReceivers?u=this.getReceivers().find(h=>h.track&&h.track.id===l.id):u={track:l};const d=new Event("track");d.track=l,d.receiver=u,d.transceiver={receiver:u},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ar(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function am(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(l,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=l.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:l}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let v=l.apply(this,arguments);return v||(v=t(this,h),this._senders.push(v)),v};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._senders=this._senders||[],s.apply(this,[u]),u.getTracks().forEach(d=>{this._senders.push(t(this,d))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._senders=this._senders||[],r.apply(this,[u]),u.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(l=>l._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function lm(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,l,u]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const d=function(p){const v={};return p.result().forEach(b=>{const S={id:b.id,timestamp:b.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[b.type]||b.type};b.names().forEach(C=>{S[C]=b.stat(C)}),v[S.id]=S}),v},h=function(p){return new Map(Object.keys(p).map(v=>[v,p[v]]))};if(arguments.length>=2){const p=function(v){l(h(d(v)))};return t.apply(this,[p,r])}return new Promise((p,v)=>{t.apply(this,[function(g){p(h(d(g)))},v])}).then(l,u)}}function om(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const u=s.apply(this,[]);return u.forEach(d=>d._pc=this),u});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const u=r.apply(this,arguments);return u._pc=this,u}),e.RTCRtpSender.prototype.getStats=function(){const u=this;return this._pc.getStats().then(d=>ng(d,u.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const l=s.apply(this,[]);return l.forEach(u=>u._pc=this),l}),ar(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const l=this;return this._pc.getStats().then(u=>ng(u,l.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let l,u,d;return this.getSenders().forEach(h=>{h.track===r&&(l?d=!0:l=h)}),this.getReceivers().forEach(h=>(h.track===r&&(u?d=!0:u=h),h.track===r)),d||l&&u?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):l?l.getStats():u?u.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function um(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(v=>{if(this.getSenders().find(b=>b.track===v))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const p=this.getSenders().filter(v=>h.indexOf(v)===-1);this._shimmedLocalStreams[d.id]=[d].concat(p)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],r.apply(this,arguments)};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function cm(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return um(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(b=>this._reverseStreams[b.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(b=>{if(this.getSenders().find(C=>C.track===b))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const b=new e.MediaStream(g.getTracks());this._streams[g.id]=b,this._reverseStreams[b.id]=g,g=b}r.apply(this,[g])};const l=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,b){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(M=>M===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(M=>M.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const D=this._streams[b.id];if(D)D.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const M=new e.MediaStream([g]);this._streams[b.id]=M,this._reverseStreams[M.id]=b,this.addStream(M)}return this.getSenders().find(M=>M.track===g)};function u(v,g){let b=g.sdp;return Object.keys(v._reverseStreams||[]).forEach(S=>{const C=v._reverseStreams[S],D=v._streams[C.id];b=b.replace(new RegExp(D.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:b})}function d(v,g){let b=g.sdp;return Object.keys(v._reverseStreams||[]).forEach(S=>{const C=v._reverseStreams[S],D=v._streams[C.id];b=b.replace(new RegExp(C.id,"g"),D.id)}),new RTCSessionDescription({type:g.type,sdp:b})}["createOffer","createAnswer"].forEach(function(v){const g=e.RTCPeerConnection.prototype[v],b={[v](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[D=>{const M=u(this,D);S[0].apply(null,[M])},D=>{S[1]&&S[1].apply(null,D)},arguments[2]]):g.apply(this,arguments).then(D=>u(this,D))}};e.RTCPeerConnection.prototype[v]=b[v]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?h.apply(this,arguments):(arguments[0]=d(this,arguments[0]),h.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const v=p.get.apply(this);return v.type===""?v:u(this,v)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let S;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(M=>g.track===M)&&(S=this._streams[C])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Id(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=e.RTCPeerConnection.prototype[s],l={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=l[s]})}function dm(e,t){ar(e,"negotiationneeded",s=>{const r=s.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return s})}const rg=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:dm,shimAddTrackRemoveTrack:cm,shimAddTrackRemoveTrackWithNative:um,shimGetDisplayMedia:aT,shimGetSendersWithDtmf:am,shimGetStats:lm,shimGetUserMedia:nm,shimMediaStream:sm,shimOnTrack:rm,shimPeerConnection:Id,shimSenderReceiverGetStats:om},Symbol.toStringTag,{value:"Module"}));function hm(e,t){const s=e&&e.navigator,r=e&&e.MediaStreamTrack;if(s.getUserMedia=function(l,u,d){ah("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(l).then(u,d)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const l=function(d,h,p){h in d&&!(p in d)&&(d[p]=d[h],delete d[h])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),l(d.audio,"autoGainControl","mozAutoGainControl"),l(d.audio,"noiseSuppression","mozNoiseSuppression")),u(d)},r&&r.prototype.getSettings){const d=r.prototype.getSettings;r.prototype.getSettings=function(){const h=d.apply(this,arguments);return l(h,"mozAutoGainControl","autoGainControl"),l(h,"mozNoiseSuppression","noiseSuppression"),h}}if(r&&r.prototype.applyConstraints){const d=r.prototype.applyConstraints;r.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),l(h,"autoGainControl","mozAutoGainControl"),l(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function lT(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const l=new DOMException("getDisplayMedia without video constraints is undefined");return l.name="NotFoundError",l.code=8,Promise.reject(l)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function fm(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Nd(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const u=e.RTCPeerConnection.prototype[l],d={[l](){return arguments[0]=new(l==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[l]=d[l]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[u,d,h]=arguments;return r.apply(this,[u||null]).then(p=>{if(t.version<53&&!d)try{p.forEach(v=>{v.type=s[v.type]||v.type})}catch(v){if(v.name!=="TypeError")throw v;p.forEach((g,b)=>{p.set(b,Object.assign({},g,{type:s[g.type]||g.type}))})}return p}).then(d,h)}}function pm(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const l=t.apply(this,[]);return l.forEach(u=>u._pc=this),l});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const l=s.apply(this,arguments);return l._pc=this,l}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function vm(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(l=>l._pc=this),r}),ar(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function gm(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(s){ah("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&s.getTracks().includes(r.track)&&this.removeTrack(r)})})}function mm(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ym(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const l=r.length>0;l&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=t.apply(this,arguments);if(l){const{sender:d}=u,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return u})}function bm(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Sm(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Tm(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const ag=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:ym,shimCreateAnswer:Tm,shimCreateOffer:Sm,shimGetDisplayMedia:lT,shimGetParameters:bm,shimGetUserMedia:hm,shimOnTrack:fm,shimPeerConnection:Nd,shimRTCDataChannel:mm,shimReceiverGetStats:vm,shimRemoveStream:gm,shimSenderGetStats:pm},Symbol.toStringTag,{value:"Module"}));function km(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(l=>t.call(this,l,r)),r.getVideoTracks().forEach(l=>t.call(this,l,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...l){return l&&l.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(s);if(r===-1)return;this._localStreams.splice(r,1);const l=s.getTracks();this.getSenders().forEach(u=>{l.includes(u.track)&&this.removeTrack(u)})})}}function Em(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(l=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(l))return;this._remoteStreams.push(l);const u=new Event("addstream");u.stream=l,this.dispatchEvent(u)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(l){l.streams.forEach(u=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(u)>=0)return;r._remoteStreams.push(u);const d=new Event("addstream");d.stream=u,r.dispatchEvent(d)})}),t.apply(r,arguments)}}}function Am(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,s=t.createOffer,r=t.createAnswer,l=t.setLocalDescription,u=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(v,g){const b=arguments.length>=2?arguments[2]:arguments[0],S=s.apply(this,[b]);return g?(S.then(v,g),Promise.resolve()):S},t.createAnswer=function(v,g){const b=arguments.length>=2?arguments[2]:arguments[0],S=r.apply(this,[b]);return g?(S.then(v,g),Promise.resolve()):S};let h=function(p,v,g){const b=l.apply(this,[p]);return g?(b.then(v,g),Promise.resolve()):b};t.setLocalDescription=h,h=function(p,v,g){const b=u.apply(this,[p]);return g?(b.then(v,g),Promise.resolve()):b},t.setRemoteDescription=h,h=function(p,v,g){const b=d.apply(this,[p]);return g?(b.then(v,g),Promise.resolve()):b},t.addIceCandidate=h}function Cm(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const s=t.mediaDevices,r=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=l=>r(Rm(l))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,l,u){t.mediaDevices.getUserMedia(r).then(l,u)}).bind(t))}function Rm(e){return e&&e.video!==void 0?Object.assign({},e,{video:im(e.video)}):e}function _m(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,l){if(r&&r.iceServers){const u=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];h.urls===void 0&&h.url?(ah("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,u.push(h)):u.push(r.iceServers[d])}r.iceServers=u}return new t(r,l)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Pm(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Dm(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const l=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):r.offerToReceiveAudio===!0&&!l&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const u=this.getTransceivers().find(d=>d.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):r.offerToReceiveVideo===!0&&!u&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function wm(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const lg=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:wm,shimCallbacksAPI:Am,shimConstraints:Rm,shimCreateOfferLegacy:Dm,shimGetUserMedia:Cm,shimLocalStreamsAPI:km,shimRTCIceServerUrls:_m,shimRemoteStreamsAPI:Em,shimTrackEventTransceiver:Pm},Symbol.toStringTag,{value:"Module"}));var Td={exports:{}},og;function oT(){return og||(og=1,function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(s){return s.split(`
m=`).map((l,u)=>(u>0?"m="+l:l).trim()+`\r
`)},t.getDescription=function(s){const r=t.splitSections(s);return r&&r[0]},t.getMediaSections=function(s){const r=t.splitSections(s);return r.shift(),r},t.matchPrefix=function(s,r){return t.splitLines(s).filter(l=>l.indexOf(r)===0)},t.parseCandidate=function(s){let r;s.indexOf("a=candidate:")===0?r=s.substring(12).split(" "):r=s.substring(10).split(" ");const l={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let u=8;u<r.length;u+=2)switch(r[u]){case"raddr":l.relatedAddress=r[u+1];break;case"rport":l.relatedPort=parseInt(r[u+1],10);break;case"tcptype":l.tcpType=r[u+1];break;case"ufrag":l.ufrag=r[u+1],l.usernameFragment=r[u+1];break;default:l[r[u]]===void 0&&(l[r[u]]=r[u+1]);break}return l},t.writeCandidate=function(s){const r=[];r.push(s.foundation);const l=s.component;l==="rtp"?r.push(1):l==="rtcp"?r.push(2):r.push(l),r.push(s.protocol.toUpperCase()),r.push(s.priority),r.push(s.address||s.ip),r.push(s.port);const u=s.type;return r.push("typ"),r.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(r.push("raddr"),r.push(s.relatedAddress),r.push("rport"),r.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(r.push("ufrag"),r.push(s.usernameFragment||s.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let r=s.substring(9).split(" ");const l={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),l.name=r[0],l.clockRate=parseInt(r[1],10),l.channels=r.length===3?parseInt(r[2],10):1,l.numChannels=l.channels,l},t.writeRtpMap=function(s){let r=s.payloadType;s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType);const l=s.channels||s.numChannels||1;return"a=rtpmap:"+r+" "+s.name+"/"+s.clockRate+(l!==1?"/"+l:"")+`\r
`},t.parseExtmap=function(s){const r=s.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){const r={};let l;const u=s.substring(s.indexOf(" ")+1).split(";");for(let d=0;d<u.length;d++)l=u[d].trim().split("="),r[l[0].trim()]=l[1];return r},t.writeFmtp=function(s){let r="",l=s.payloadType;if(s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(d=>{s.parameters[d]!==void 0?u.push(d+"="+s.parameters[d]):u.push(d)}),r+="a=fmtp:"+l+" "+u.join(";")+`\r
`}return r},t.parseRtcpFb=function(s){const r=s.substring(s.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(s){let r="",l=s.payloadType;return s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{r+="a=rtcp-fb:"+l+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(s){const r=s.indexOf(" "),l={ssrc:parseInt(s.substring(7,r),10)},u=s.indexOf(":",r);return u>-1?(l.attribute=s.substring(r+1,u),l.value=s.substring(u+1)):l.attribute=s.substring(r+1),l},t.parseSsrcGroup=function(s){const r=s.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(l=>parseInt(l,10))}},t.getMid=function(s){const r=t.matchPrefix(s,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(s){const r=s.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(s,r){return{role:"auto",fingerprints:t.matchPrefix(s+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,r){let l="a=setup:"+r+`\r
`;return s.fingerprints.forEach(u=>{l+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),l},t.parseCryptoLine=function(s){const r=s.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const r=s.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,r){return t.matchPrefix(s+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,r){const l=t.matchPrefix(s+r,"a=ice-ufrag:")[0],u=t.matchPrefix(s+r,"a=ice-pwd:")[0];return l&&u?{usernameFragment:l.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(s){let r="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(s){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=t.splitLines(s)[0].split(" ");r.profile=u[2];for(let h=3;h<u.length;h++){const p=u[h],v=t.matchPrefix(s,"a=rtpmap:"+p+" ")[0];if(v){const g=t.parseRtpMap(v),b=t.matchPrefix(s,"a=fmtp:"+p+" ");switch(g.parameters=b.length?t.parseFmtp(b[0]):{},g.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),r.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(g.name.toUpperCase());break}}}t.matchPrefix(s,"a=extmap:").forEach(h=>{r.headerExtensions.push(t.parseExtmap(h))});const d=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(g=>g.type===p.type&&g.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),r},t.writeRtpDescription=function(s,r){let l="";l+="m="+s+" ",l+=r.codecs.length>0?"9":"0",l+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=r.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,l+=`c=IN IP4 0.0.0.0\r
`,l+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(d=>{l+=t.writeRtpMap(d),l+=t.writeFmtp(d),l+=t.writeRtcpFb(d)});let u=0;return r.codecs.forEach(d=>{d.maxptime>u&&(u=d.maxptime)}),u>0&&(l+="a=maxptime:"+u+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(d=>{l+=t.writeExtmap(d)}),l},t.parseRtpEncodingParameters=function(s){const r=[],l=t.parseRtpParameters(s),u=l.fecMechanisms.indexOf("RED")!==-1,d=l.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(s,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),p=h.length>0&&h[0].ssrc;let v;const g=t.matchPrefix(s,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(D=>parseInt(D,10)));g.length>0&&g[0].length>1&&g[0][0]===p&&(v=g[0][1]),l.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let C={ssrc:p,codecPayloadType:parseInt(S.parameters.apt,10)};p&&v&&(C.rtx={ssrc:v}),r.push(C),u&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},r.push(C))}}),r.length===0&&p&&r.push({ssrc:p});let b=t.matchPrefix(s,"b=");return b.length&&(b[0].indexOf("b=TIAS:")===0?b=parseInt(b[0].substring(7),10):b[0].indexOf("b=AS:")===0?b=parseInt(b[0].substring(5),10)*1e3*.95-50*40*8:b=void 0,r.forEach(S=>{S.maxBitrate=b})),r},t.parseRtcpParameters=function(s){const r={},l=t.matchPrefix(s,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];l&&(r.cname=l.value,r.ssrc=l.ssrc);const u=t.matchPrefix(s,"a=rtcp-rsize");r.reducedSize=u.length>0,r.compound=u.length===0;const d=t.matchPrefix(s,"a=rtcp-mux");return r.mux=d.length>0,r},t.writeRtcpParameters=function(s){let r="";return s.reducedSize&&(r+=`a=rtcp-rsize\r
`),s.mux&&(r+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(r+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),r},t.parseMsid=function(s){let r;const l=t.matchPrefix(s,"a=msid:");if(l.length===1)return r=l[0].substring(7).split(" "),{stream:r[0],track:r[1]};const u=t.matchPrefix(s,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");if(u.length>0)return r=u[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(s){const r=t.parseMLine(s),l=t.matchPrefix(s,"a=max-message-size:");let u;l.length>0&&(u=parseInt(l[0].substring(19),10)),isNaN(u)&&(u=65536);const d=t.matchPrefix(s,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:r.fmt,maxMessageSize:u};const h=t.matchPrefix(s,"a=sctpmap:");if(h.length>0){const p=h[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:u}}},t.writeSctpDescription=function(s,r){let l=[];return s.protocol!=="DTLS/SCTP"?l=["m="+s.kind+" 9 "+s.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:l=["m="+s.kind+" 9 "+s.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&l.push("a=max-message-size:"+r.maxMessageSize+`\r
`),l.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,r,l){let u;const d=r!==void 0?r:2;return s?u=s:u=t.generateSessionId(),`v=0\r
o=`+(l||"thisisadapterortc")+" "+u+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,r){const l=t.splitLines(s);for(let u=0;u<l.length;u++)switch(l[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[u].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){const l=t.splitLines(s)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},t.parseOLine=function(s){const l=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const r=t.splitLines(s);for(let l=0;l<r.length;l++)if(r[l].length<2||r[l].charAt(1)!=="=")return!1;return!0},e.exports=t}(Td)),Td.exports}var Mm=oT();const Qr=au(Mm),uT=DS({__proto__:null,default:Qr},[Mm]);function zo(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const l=new t(r),u=Qr.parseCandidate(r.candidate);for(const d in u)d in l||Object.defineProperty(l,d,{value:u[d]});return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,ar(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Ud(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ar(e,"icecandidate",t=>{if(t.candidate){const s=Qr.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function Ho(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const s=function(h){if(!h||!h.sdp)return!1;const p=Qr.splitSections(h.sdp);return p.shift(),p.some(v=>{const g=Qr.parseMLine(v);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},r=function(h){const p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const v=parseInt(p[1],10);return v!==v?-1:v},l=function(h){let p=65536;return t.browser==="firefox"&&(t.version<57?h===-1?p=16384:p=2147483637:t.version<60?p=t.version===57?65535:65536:p=2147483637),p},u=function(h,p){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const g=Qr.matchPrefix(h.sdp,"a=max-message-size:");return g.length>0?v=parseInt(g[0].substring(19),10):t.browser==="firefox"&&p!==-1&&(v=2147483637),v},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const p=r(arguments[0]),v=l(p),g=u(arguments[0],p);let b;v===0&&g===0?b=Number.POSITIVE_INFINITY:v===0||g===0?b=Math.max(v,g):b=Math.min(v,g);const S={};Object.defineProperty(S,"maxMessageSize",{get(){return b}}),this._sctp=S}return d.apply(this,arguments)}}function Vo(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,l){const u=r.send;r.send=function(){const h=arguments[0],p=h.length||h.size||h.byteLength;if(r.readyState==="open"&&l.sctp&&p>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return u.apply(r,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const l=s.apply(this,arguments);return t(l,this),l},ar(e,"datachannel",r=>(t(r.channel,r.target),r))}function xd(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const r=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const u=l.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const d=new Event("connectionstatechange",l);u.dispatchEvent(d)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bd(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(l){if(l&&l.sdp&&l.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const u=l.sdp.split(`
`).filter(d=>d.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&l instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:l.type,sdp:u}):l.sdp=u}return s.apply(this,arguments)}}function qo(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const s=e.RTCPeerConnection.prototype.addIceCandidate;!s||s.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Fo(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const s=e.RTCPeerConnection.prototype.setLocalDescription;!s||s.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let l=arguments[0]||{};if(typeof l!="object"||l.type&&l.sdp)return s.apply(this,arguments);if(l={type:l.type,sdp:l.sdp},!l.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":l.type="offer";break;default:l.type="answer";break}return l.sdp||l.type!=="offer"&&l.type!=="answer"?s.apply(this,[l]):(l.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(d=>s.apply(this,[d]))})}const cT=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Bd,shimAddIceCandidateNullOrEmpty:qo,shimConnectionState:xd,shimMaxMessageSize:Ho,shimParameterlessSetLocalDescription:Fo,shimRTCIceCandidate:zo,shimRTCIceCandidateRelayProtocol:Ud,shimSendThrowTypeError:Vo},Symbol.toStringTag,{value:"Module"}));function dT({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=tm,r=rT(e),l={browserDetails:r,commonShim:cT,extractVersion:jo,disableLog:nT,disableWarnings:sT,sdp:uT};switch(r.browser){case"chrome":if(!rg||!Id||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),l;if(r.version===null)return s("Chrome shim can not determine version, not shimming."),l;s("adapter.js shimming chrome."),l.browserShim=rg,qo(e,r),Fo(e),nm(e,r),sm(e),Id(e,r),rm(e),cm(e,r),am(e),lm(e),om(e),dm(e,r),zo(e),Ud(e),xd(e),Ho(e,r),Vo(e),Bd(e,r);break;case"firefox":if(!ag||!Nd||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),l;s("adapter.js shimming firefox."),l.browserShim=ag,qo(e,r),Fo(e),hm(e,r),Nd(e,r),fm(e),gm(e),pm(e),vm(e),mm(e),ym(e),bm(e),Sm(e),Tm(e),zo(e),xd(e),Ho(e,r),Vo(e);break;case"safari":if(!lg||!t.shimSafari)return s("Safari shim is not included in this adapter release."),l;s("adapter.js shimming safari."),l.browserShim=lg,qo(e,r),Fo(e),_m(e),Dm(e),Am(e),km(e),Em(e),Pm(e),Cm(e),wm(e),zo(e),Ud(e),Ho(e,r),Vo(e),Bd(e,r);break;default:s("Unsupported browser!");break}return l}const ug=dT({window:typeof window>"u"?void 0:window});var kd={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */var cg;function hT(){return cg||(cg=1,function(e,t){(function(s){var r=Object.hasOwnProperty,l=Array.isArray?Array.isArray:function(w){return Object.prototype.toString.call(w)==="[object Array]"},u=10,d=typeof process=="object"&&typeof process.nextTick=="function",h=typeof Symbol=="function",p=typeof Reflect=="object",v=typeof setImmediate=="function",g=v?setImmediate:setTimeout,b=h?p&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(A){var w=Object.getOwnPropertyNames(A);return w.push.apply(w,Object.getOwnPropertySymbols(A)),w}:Object.keys;function S(){this._events={},this._conf&&C.call(this,this._conf)}function C(A){A&&(this._conf=A,A.delimiter&&(this.delimiter=A.delimiter),A.maxListeners!==s&&(this._maxListeners=A.maxListeners),A.wildcard&&(this.wildcard=A.wildcard),A.newListener&&(this._newListener=A.newListener),A.removeListener&&(this._removeListener=A.removeListener),A.verboseMemoryLeak&&(this.verboseMemoryLeak=A.verboseMemoryLeak),A.ignoreErrors&&(this.ignoreErrors=A.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function D(A,w){var T="(node) warning: possible EventEmitter memory leak detected. "+A+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(T+=" Event name: "+w+"."),typeof process<"u"&&process.emitWarning){var P=new Error(T);P.name="MaxListenersExceededWarning",P.emitter=this,P.count=A,process.emitWarning(P)}else console.error(T),console.trace&&console.trace()}var M=function(A,w,T){var P=arguments.length;switch(P){case 0:return[];case 1:return[A];case 2:return[A,w];case 3:return[A,w,T];default:for(var I=new Array(P);P--;)I[P]=arguments[P];return I}};function j(A,w){for(var T={},P,I=A.length,U=0,B=0;B<I;B++)P=A[B],T[P]=B<U?w[B]:s;return T}function le(A,w,T){this._emitter=A,this._target=w,this._listeners={},this._listenersCount=0;var P,I;if((T.on||T.off)&&(P=T.on,I=T.off),w.addEventListener?(P=w.addEventListener,I=w.removeEventListener):w.addListener?(P=w.addListener,I=w.removeListener):w.on&&(P=w.on,I=w.off),!P&&!I)throw Error("target does not implement any known event API");if(typeof P!="function")throw TypeError("on method must be a function");if(typeof I!="function")throw TypeError("off method must be a function");this._on=P,this._off=I;var U=A._observers;U?U.push(this):A._observers=[this]}Object.assign(le.prototype,{subscribe:function(A,w,T){var P=this,I=this._target,U=this._emitter,B=this._listeners,z=function(){var V=M.apply(null,arguments),Q={data:V,name:w,original:A};if(T){var X=T.call(I,Q);X!==!1&&U.emit.apply(U,[Q.name].concat(V));return}U.emit.apply(U,[w].concat(V))};if(B[A])throw Error("Event '"+A+"' is already listening");this._listenersCount++,U._newListener&&U._removeListener&&!P._onNewListener?(this._onNewListener=function(V){V===w&&B[A]===null&&(B[A]=z,P._on.call(I,A,z))},U.on("newListener",this._onNewListener),this._onRemoveListener=function(V){V===w&&!U.hasListeners(V)&&B[A]&&(B[A]=null,P._off.call(I,A,z))},B[A]=null,U.on("removeListener",this._onRemoveListener)):(B[A]=z,P._on.call(I,A,z))},unsubscribe:function(A){var w=this,T=this._listeners,P=this._emitter,I,U,B=this._off,z=this._target,V;if(A&&typeof A!="string")throw TypeError("event must be a string");function Q(){w._onNewListener&&(P.off("newListener",w._onNewListener),P.off("removeListener",w._onRemoveListener),w._onNewListener=null,w._onRemoveListener=null);var X=we.call(P,w);P._observers.splice(X,1)}if(A){if(I=T[A],!I)return;B.call(z,A,I),delete T[A],--this._listenersCount||Q()}else{for(U=b(T),V=U.length;V-- >0;)A=U[V],B.call(z,A,T[A]);this._listeners={},this._listenersCount=0,Q()}}});function oe(A,w,T,P){var I=Object.assign({},w);if(!A)return I;if(typeof A!="object")throw TypeError("options must be an object");var U=Object.keys(A),B=U.length,z,V,Q;function X(ue){throw Error('Invalid "'+z+'" option value'+(ue?". Reason: "+ue:""))}for(var Ae=0;Ae<B;Ae++){if(z=U[Ae],!r.call(w,z))throw Error('Unknown "'+z+'" option');V=A[z],V!==s&&(Q=T[z],I[z]=Q?Q(V,X):V)}return I}function ie(A,w){return(typeof A!="function"||!A.hasOwnProperty("prototype"))&&w("value must be a constructor"),A}function se(A){var w="value must be type of "+A.join("|"),T=A.length,P=A[0],I=A[1];return T===1?function(U,B){if(typeof U===P)return U;B(w)}:T===2?function(U,B){var z=typeof U;if(z===P||z===I)return U;B(w)}:function(U,B){for(var z=typeof U,V=T;V-- >0;)if(z===A[V])return U;B(w)}}var ae=se(["function"]),Ne=se(["object","function"]);function nt(A,w,T){var P,I,U=0,B,z=new A(function(V,Q,X){T=oe(T,{timeout:0,overload:!1},{timeout:function(Be,je){return Be*=1,(typeof Be!="number"||Be<0||!Number.isFinite(Be))&&je("timeout must be a positive number"),Be}}),P=!T.overload&&typeof A.prototype.cancel=="function"&&typeof X=="function";function Ae(){I&&(I=null),U&&(clearTimeout(U),U=0)}var ue=function(Be){Ae(),V(Be)},Te=function(Be){Ae(),Q(Be)};P?w(ue,Te,X):(I=[function(Be){Te(Be||Error("canceled"))}],w(ue,Te,function(Be){if(B)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof Be!="function")throw TypeError("onCancel callback must be a function");I.push(Be)}),B=!0),T.timeout>0&&(U=setTimeout(function(){var Be=Error("timeout");Be.code="ETIMEDOUT",U=0,z.cancel(Be),Q(Be)},T.timeout))});return P||(z.cancel=function(V){if(I){for(var Q=I.length,X=1;X<Q;X++)I[X](V);I[0](V),I=null}}),z}function we(A){var w=this._observers;if(!w)return-1;for(var T=w.length,P=0;P<T;P++)if(w[P]._target===A)return P;return-1}function ee(A,w,T,P,I){if(!T)return null;if(P===0){var U=typeof w;if(U==="string"){var B,z,V=0,Q=0,X=this.delimiter,Ae=X.length;if((z=w.indexOf(X))!==-1){B=new Array(5);do B[V++]=w.slice(Q,z),Q=z+Ae;while((z=w.indexOf(X,Q))!==-1);B[V++]=w.slice(Q),w=B,I=V}else w=[w],I=1}else U==="object"?I=w.length:(w=[w],I=1)}var ue=null,Te,Be,je,ii,Ut,Ht=w[P],oi=w[P+1],ct,st;if(P===I)T._listeners&&(typeof T._listeners=="function"?(A&&A.push(T._listeners),ue=[T]):(A&&A.push.apply(A,T._listeners),ue=[T]));else if(Ht==="*"){for(ct=b(T),z=ct.length;z-- >0;)Te=ct[z],Te!=="_listeners"&&(st=ee(A,w,T[Te],P+1,I),st&&(ue?ue.push.apply(ue,st):ue=st));return ue}else if(Ht==="**"){for(Ut=P+1===I||P+2===I&&oi==="*",Ut&&T._listeners&&(ue=ee(A,w,T,I,I)),ct=b(T),z=ct.length;z-- >0;)Te=ct[z],Te!=="_listeners"&&(Te==="*"||Te==="**"?(T[Te]._listeners&&!Ut&&(st=ee(A,w,T[Te],I,I),st&&(ue?ue.push.apply(ue,st):ue=st)),st=ee(A,w,T[Te],P,I)):Te===oi?st=ee(A,w,T[Te],P+2,I):st=ee(A,w,T[Te],P,I),st&&(ue?ue.push.apply(ue,st):ue=st));return ue}else T[Ht]&&(ue=ee(A,w,T[Ht],P+1,I));if(Be=T["*"],Be&&ee(A,w,Be,P+1,I),je=T["**"],je)if(P<I)for(je._listeners&&ee(A,w,je,I,I),ct=b(je),z=ct.length;z-- >0;)Te=ct[z],Te!=="_listeners"&&(Te===oi?ee(A,w,je[Te],P+2,I):Te===Ht?ee(A,w,je[Te],P+1,I):(ii={},ii[Te]=je[Te],ee(A,w,{"**":ii},P+1,I)));else je._listeners?ee(A,w,je,I,I):je["*"]&&je["*"]._listeners&&ee(A,w,je["*"],I,I);return ue}function Re(A,w,T){var P=0,I=0,U,B=this.delimiter,z=B.length,V;if(typeof A=="string")if((U=A.indexOf(B))!==-1){V=new Array(5);do V[P++]=A.slice(I,U),I=U+z;while((U=A.indexOf(B,I))!==-1);V[P++]=A.slice(I)}else V=[A],P=1;else V=A,P=A.length;if(P>1){for(U=0;U+1<P;U++)if(V[U]==="**"&&V[U+1]==="**")return}var Q=this.listenerTree,X;for(U=0;U<P;U++)if(X=V[U],Q=Q[X]||(Q[X]={}),U===P-1)return Q._listeners?(typeof Q._listeners=="function"&&(Q._listeners=[Q._listeners]),T?Q._listeners.unshift(w):Q._listeners.push(w),!Q._listeners.warned&&this._maxListeners>0&&Q._listeners.length>this._maxListeners&&(Q._listeners.warned=!0,D.call(this,Q._listeners.length,X))):Q._listeners=w,!0;return!0}function vt(A,w,T,P){for(var I=b(A),U=I.length,B,z,V,Q=A._listeners,X;U-- >0;)z=I[U],B=A[z],z==="_listeners"?V=T:V=T?T.concat(z):[z],X=P||typeof z=="symbol",Q&&w.push(X?V:V.join(this.delimiter)),typeof B=="object"&&vt.call(this,B,w,V,X);return w}function gt(A){for(var w=b(A),T=w.length,P,I,U;T-- >0;)I=w[T],P=A[I],P&&(U=!0,I!=="_listeners"&&!gt(P)&&delete A[I]);return U}function bt(A,w,T){this.emitter=A,this.event=w,this.listener=T}bt.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function wt(A,w,T){if(T===!0)I=!0;else if(T===!1)P=!0;else{if(!T||typeof T!="object")throw TypeError("options should be an object or true");var P=T.async,I=T.promisify,U=T.nextTick,B=T.objectify}if(P||U||I){var z=w,V=w._origin||w;if(U&&!d)throw Error("process.nextTick is not supported");I===s&&(I=w.constructor.name==="AsyncFunction"),w=function(){var Q=arguments,X=this,Ae=this.event;return I?U?Promise.resolve():new Promise(function(ue){g(ue)}).then(function(){return X.event=Ae,z.apply(X,Q)}):(U?process.nextTick:g)(function(){X.event=Ae,z.apply(X,Q)})},w._async=!0,w._origin=V}return[w,B?new bt(this,A,w):this]}function de(A){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,C.call(this,A)}de.EventEmitter2=de,de.prototype.listenTo=function(A,w,T){if(typeof A!="object")throw TypeError("target musts be an object");var P=this;T=oe(T,{on:s,off:s,reducers:s},{on:ae,off:ae,reducers:Ne});function I(U){if(typeof U!="object")throw TypeError("events must be an object");var B=T.reducers,z=we.call(P,A),V;z===-1?V=new le(P,A,T):V=P._observers[z];for(var Q=b(U),X=Q.length,Ae,ue=typeof B=="function",Te=0;Te<X;Te++)Ae=Q[Te],V.subscribe(Ae,U[Ae]||Ae,ue?B:B&&B[Ae])}return l(w)?I(j(w)):I(typeof w=="string"?j(w.split(/\s+/)):w),this},de.prototype.stopListeningTo=function(A,w){var T=this._observers;if(!T)return!1;var P=T.length,I,U=!1;if(A&&typeof A!="object")throw TypeError("target should be an object");for(;P-- >0;)I=T[P],(!A||I._target===A)&&(I.unsubscribe(w),U=!0);return U},de.prototype.delimiter=".",de.prototype.setMaxListeners=function(A){A!==s&&(this._maxListeners=A,this._conf||(this._conf={}),this._conf.maxListeners=A)},de.prototype.getMaxListeners=function(){return this._maxListeners},de.prototype.event="",de.prototype.once=function(A,w,T){return this._once(A,w,!1,T)},de.prototype.prependOnceListener=function(A,w,T){return this._once(A,w,!0,T)},de.prototype._once=function(A,w,T,P){return this._many(A,1,w,T,P)},de.prototype.many=function(A,w,T,P){return this._many(A,w,T,!1,P)},de.prototype.prependMany=function(A,w,T,P){return this._many(A,w,T,!0,P)},de.prototype._many=function(A,w,T,P,I){var U=this;if(typeof T!="function")throw new Error("many only accepts instances of Function");function B(){return--w===0&&U.off(A,B),T.apply(this,arguments)}return B._origin=T,this._on(A,B,P,I)},de.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||S.call(this);var A=arguments[0],w,T=this.wildcard,P,I,U,B,z;if(A==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(T&&(w=A,A!=="newListener"&&A!=="removeListener"&&typeof A=="object")){if(I=A.length,h){for(U=0;U<I;U++)if(typeof A[U]=="symbol"){z=!0;break}}z||(A=A.join(this.delimiter))}var V=arguments.length,Q;if(this._all&&this._all.length)for(Q=this._all.slice(),U=0,I=Q.length;U<I;U++)switch(this.event=A,V){case 1:Q[U].call(this,A);break;case 2:Q[U].call(this,A,arguments[1]);break;case 3:Q[U].call(this,A,arguments[1],arguments[2]);break;default:Q[U].apply(this,arguments)}if(T)Q=[],ee.call(this,Q,w,this.listenerTree,0,I);else if(Q=this._events[A],typeof Q=="function"){switch(this.event=A,V){case 1:Q.call(this);break;case 2:Q.call(this,arguments[1]);break;case 3:Q.call(this,arguments[1],arguments[2]);break;default:for(P=new Array(V-1),B=1;B<V;B++)P[B-1]=arguments[B];Q.apply(this,P)}return!0}else Q&&(Q=Q.slice());if(Q&&Q.length){if(V>3)for(P=new Array(V-1),B=1;B<V;B++)P[B-1]=arguments[B];for(U=0,I=Q.length;U<I;U++)switch(this.event=A,V){case 1:Q[U].call(this);break;case 2:Q[U].call(this,arguments[1]);break;case 3:Q[U].call(this,arguments[1],arguments[2]);break;default:Q[U].apply(this,P)}return!0}else if(!this.ignoreErrors&&!this._all&&A==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},de.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||S.call(this);var A=arguments[0],w=this.wildcard,T,P,I,U,B,z;if(A==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(w&&(T=A,A!=="newListener"&&A!=="removeListener"&&typeof A=="object")){if(U=A.length,h){for(B=0;B<U;B++)if(typeof A[B]=="symbol"){P=!0;break}}P||(A=A.join(this.delimiter))}var V=[],Q=arguments.length,X;if(this._all)for(B=0,U=this._all.length;B<U;B++)switch(this.event=A,Q){case 1:V.push(this._all[B].call(this,A));break;case 2:V.push(this._all[B].call(this,A,arguments[1]));break;case 3:V.push(this._all[B].call(this,A,arguments[1],arguments[2]));break;default:V.push(this._all[B].apply(this,arguments))}if(w?(X=[],ee.call(this,X,T,this.listenerTree,0)):X=this._events[A],typeof X=="function")switch(this.event=A,Q){case 1:V.push(X.call(this));break;case 2:V.push(X.call(this,arguments[1]));break;case 3:V.push(X.call(this,arguments[1],arguments[2]));break;default:for(I=new Array(Q-1),z=1;z<Q;z++)I[z-1]=arguments[z];V.push(X.apply(this,I))}else if(X&&X.length){if(X=X.slice(),Q>3)for(I=new Array(Q-1),z=1;z<Q;z++)I[z-1]=arguments[z];for(B=0,U=X.length;B<U;B++)switch(this.event=A,Q){case 1:V.push(X[B].call(this));break;case 2:V.push(X[B].call(this,arguments[1]));break;case 3:V.push(X[B].call(this,arguments[1],arguments[2]));break;default:V.push(X[B].apply(this,I))}}else if(!this.ignoreErrors&&!this._all&&A==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(V)},de.prototype.on=function(A,w,T){return this._on(A,w,!1,T)},de.prototype.prependListener=function(A,w,T){return this._on(A,w,!0,T)},de.prototype.onAny=function(A){return this._onAny(A,!1)},de.prototype.prependAny=function(A){return this._onAny(A,!0)},de.prototype.addListener=de.prototype.on,de.prototype._onAny=function(A,w){if(typeof A!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),w?this._all.unshift(A):this._all.push(A),this},de.prototype._on=function(A,w,T,P){if(typeof A=="function")return this._onAny(A,w),this;if(typeof w!="function")throw new Error("on only accepts instances of Function");this._events||S.call(this);var I=this,U;return P!==s&&(U=wt.call(this,A,w,P),w=U[0],I=U[1]),this._newListener&&this.emit("newListener",A,w),this.wildcard?(Re.call(this,A,w,T),I):(this._events[A]?(typeof this._events[A]=="function"&&(this._events[A]=[this._events[A]]),T?this._events[A].unshift(w):this._events[A].push(w),!this._events[A].warned&&this._maxListeners>0&&this._events[A].length>this._maxListeners&&(this._events[A].warned=!0,D.call(this,this._events[A].length,A))):this._events[A]=w,I)},de.prototype.off=function(A,w){if(typeof w!="function")throw new Error("removeListener only takes instances of Function");var T,P=[];if(this.wildcard){var I=typeof A=="string"?A.split(this.delimiter):A.slice();if(P=ee.call(this,null,I,this.listenerTree,0),!P)return this}else{if(!this._events[A])return this;T=this._events[A],P.push({_listeners:T})}for(var U=0;U<P.length;U++){var B=P[U];if(T=B._listeners,l(T)){for(var z=-1,V=0,Q=T.length;V<Q;V++)if(T[V]===w||T[V].listener&&T[V].listener===w||T[V]._origin&&T[V]._origin===w){z=V;break}if(z<0)continue;return this.wildcard?B._listeners.splice(z,1):this._events[A].splice(z,1),T.length===0&&(this.wildcard?delete B._listeners:delete this._events[A]),this._removeListener&&this.emit("removeListener",A,w),this}else(T===w||T.listener&&T.listener===w||T._origin&&T._origin===w)&&(this.wildcard?delete B._listeners:delete this._events[A],this._removeListener&&this.emit("removeListener",A,w))}return this.listenerTree&&gt(this.listenerTree),this},de.prototype.offAny=function(A){var w=0,T=0,P;if(A&&this._all&&this._all.length>0){for(P=this._all,w=0,T=P.length;w<T;w++)if(A===P[w])return P.splice(w,1),this._removeListener&&this.emit("removeListenerAny",A),this}else{if(P=this._all,this._removeListener)for(w=0,T=P.length;w<T;w++)this.emit("removeListenerAny",P[w]);this._all=[]}return this},de.prototype.removeListener=de.prototype.off,de.prototype.removeAllListeners=function(A){if(A===s)return!this._events||S.call(this),this;if(this.wildcard){var w=ee.call(this,null,A,this.listenerTree,0),T,P;if(!w)return this;for(P=0;P<w.length;P++)T=w[P],T._listeners=null;this.listenerTree&&gt(this.listenerTree)}else this._events&&(this._events[A]=null);return this},de.prototype.listeners=function(A){var w=this._events,T,P,I,U,B;if(A===s){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!w)return[];for(T=b(w),U=T.length,I=[];U-- >0;)P=w[T[U]],typeof P=="function"?I.push(P):I.push.apply(I,P);return I}else{if(this.wildcard){if(B=this.listenerTree,!B)return[];var z=[],V=typeof A=="string"?A.split(this.delimiter):A.slice();return ee.call(this,z,V,B,0),z}return w?(P=w[A],P?typeof P=="function"?[P]:P:[]):[]}},de.prototype.eventNames=function(A){var w=this._events;return this.wildcard?vt.call(this,this.listenerTree,[],null,A):w?b(w):[]},de.prototype.listenerCount=function(A){return this.listeners(A).length},de.prototype.hasListeners=function(A){if(this.wildcard){var w=[],T=typeof A=="string"?A.split(this.delimiter):A.slice();return ee.call(this,w,T,this.listenerTree,0),w.length>0}var P=this._events,I=this._all;return!!(I&&I.length||P&&(A===s?b(P).length:P[A]))},de.prototype.listenersAny=function(){return this._all?this._all:[]},de.prototype.waitFor=function(A,w){var T=this,P=typeof w;return P==="number"?w={timeout:w}:P==="function"&&(w={filter:w}),w=oe(w,{timeout:0,filter:s,handleError:!1,Promise,overload:!1},{filter:ae,Promise:ie}),nt(w.Promise,function(I,U,B){function z(){var V=w.filter;if(!(V&&!V.apply(T,arguments)))if(T.off(A,z),w.handleError){var Q=arguments[0];Q?U(Q):I(M.apply(null,arguments).slice(1))}else I(M.apply(null,arguments))}B(function(){T.off(A,z)}),T._on(A,z,!1)},{timeout:w.timeout,overload:w.overload})};function te(A,w,T){T=oe(T,{Promise,timeout:0,overload:!1},{Promise:ie});var P=T.Promise;return nt(P,function(I,U,B){var z;if(typeof A.addEventListener=="function"){z=function(){I(M.apply(null,arguments))},B(function(){A.removeEventListener(w,z)}),A.addEventListener(w,z,{once:!0});return}var V=function(){Q&&A.removeListener("error",Q),I(M.apply(null,arguments))},Q;w!=="error"&&(Q=function(X){A.removeListener(w,V),U(X)},A.once("error",Q)),B(function(){Q&&A.removeListener("error",Q),A.removeListener(w,V)}),A.once(w,V)},{timeout:T.timeout,overload:T.overload})}var pe=de.prototype;Object.defineProperties(de,{defaultMaxListeners:{get:function(){return pe._maxListeners},set:function(A){if(typeof A!="number"||A<0||Number.isNaN(A))throw TypeError("n must be a non-negative number");pe._maxListeners=A},enumerable:!0},once:{value:te,writable:!0,configurable:!0}}),Object.defineProperties(pe,{_maxListeners:{value:u,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),e.exports=de})()}(kd)),kd.exports}var lu=hT();const fT=au(lu);function Ji(e){for(var t=arguments.length,s=Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(s.length?" "+s.map(function(l){return"'"+l+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ta(e){return!!e&&!!e[bi]}function rr(e){var t;return!!e&&(function(s){if(!s||typeof s!="object")return!1;var r=Object.getPrototypeOf(s);if(r===null)return!0;var l=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return l===Object||typeof l=="function"&&Function.toString.call(l)===TT}(e)||Array.isArray(e)||!!e[yg]||!!(!((t=e.constructor)===null||t===void 0)&&t[yg])||lh(e)||oh(e))}function yl(e,t,s){s===void 0&&(s=!1),ra(e)===0?(s?Object.keys:fh)(e).forEach(function(r){s&&typeof r=="symbol"||t(r,e[r],e)}):e.forEach(function(r,l){return t(l,r,e)})}function ra(e){var t=e[bi];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:lh(e)?2:oh(e)?3:0}function Gd(e,t){return ra(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function pT(e,t){return ra(e)===2?e.get(t):e[t]}function Om(e,t,s){var r=ra(e);r===2?e.set(t,s):r===3?e.add(s):e[t]=s}function vT(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function lh(e){return bT&&e instanceof Map}function oh(e){return ST&&e instanceof Set}function er(e){return e.o||e.t}function uh(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=kT(e);delete t[bi];for(var s=fh(t),r=0;r<s.length;r++){var l=s[r],u=t[l];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(t[l]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[l]})}return Object.create(Object.getPrototypeOf(e),t)}function ch(e,t){return t===void 0&&(t=!1),dh(e)||ta(e)||!rr(e)||(ra(e)>1&&(e.set=e.add=e.clear=e.delete=gT),Object.freeze(e),t&&yl(e,function(s,r){return ch(r,!0)},!0)),e}function gT(){Ji(2)}function dh(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function dn(e){var t=ET[e];return t||Ji(18,e),t}function dg(){return bl}function Ed(e,t){t&&(dn("Patches"),e.u=[],e.s=[],e.v=t)}function Jo(e){jd(e),e.p.forEach(mT),e.p=null}function jd(e){e===bl&&(bl=e.l)}function hg(e){return bl={p:[],l:bl,h:e,m:!0,_:0}}function mT(e){var t=e[bi];t.i===0||t.i===1?t.j():t.g=!0}function Ad(e,t){t._=t.p.length;var s=t.p[0],r=e!==void 0&&e!==s;return t.h.O||dn("ES5").S(t,e,r),r?(s[bi].P&&(Jo(t),Ji(4)),rr(e)&&(e=Xo(t,e),t.l||Zo(t,e)),t.u&&dn("Patches").M(s[bi].t,e,t.u,t.s)):e=Xo(t,s,[]),Jo(t),t.u&&t.v(t.u,t.s),e!==Lm?e:void 0}function Xo(e,t,s){if(dh(t))return t;var r=t[bi];if(!r)return yl(t,function(h,p){return fg(e,r,t,h,p,s)},!0),t;if(r.A!==e)return t;if(!r.P)return Zo(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var l=r.i===4||r.i===5?r.o=uh(r.k):r.o,u=l,d=!1;r.i===3&&(u=new Set(l),l.clear(),d=!0),yl(u,function(h,p){return fg(e,r,l,h,p,s,d)}),Zo(e,l,!1),s&&e.u&&dn("Patches").N(r,s,e.u,e.s)}return r.o}function fg(e,t,s,r,l,u,d){if(ta(l)){var h=Xo(e,l,u&&t&&t.i!==3&&!Gd(t.R,r)?u.concat(r):void 0);if(Om(s,r,h),!ta(h))return;e.m=!1}else d&&s.add(l);if(rr(l)&&!dh(l)){if(!e.h.D&&e._<1)return;Xo(e,l),t&&t.A.l||Zo(e,l)}}function Zo(e,t,s){s===void 0&&(s=!1),!e.l&&e.h.D&&e.m&&ch(t,s)}function Cd(e,t){var s=e[bi];return(s?er(s):e)[t]}function pg(e,t){if(t in e)for(var s=Object.getPrototypeOf(e);s;){var r=Object.getOwnPropertyDescriptor(s,t);if(r)return r;s=Object.getPrototypeOf(s)}}function zd(e){e.P||(e.P=!0,e.l&&zd(e.l))}function Rd(e){e.o||(e.o=uh(e.t))}function Hd(e,t,s){var r=lh(t)?dn("MapSet").F(t,s):oh(t)?dn("MapSet").T(t,s):e.O?function(l,u){var d=Array.isArray(l),h={i:d?1:0,A:u?u.A:dg(),P:!1,I:!1,R:{},l:u,t:l,k:null,o:null,j:null,C:!1},p=h,v=Vd;d&&(p=[h],v=vl);var g=Proxy.revocable(p,v),b=g.revoke,S=g.proxy;return h.k=S,h.j=b,S}(t,s):dn("ES5").J(t,s);return(s?s.A:dg()).p.push(r),r}function yT(e){return ta(e)||Ji(22,e),function t(s){if(!rr(s))return s;var r,l=s[bi],u=ra(s);if(l){if(!l.P&&(l.i<4||!dn("ES5").K(l)))return l.t;l.I=!0,r=vg(s,u),l.I=!1}else r=vg(s,u);return yl(r,function(d,h){l&&pT(l.t,d)===h||Om(r,d,t(h))}),u===3?new Set(r):r}(e)}function vg(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return uh(e)}var gg,bl,hh=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",bT=typeof Map<"u",ST=typeof Set<"u",mg=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Lm=hh?Symbol.for("immer-nothing"):((gg={})["immer-nothing"]=!0,gg),yg=hh?Symbol.for("immer-draftable"):"__$immer_draftable",bi=hh?Symbol.for("immer-state"):"__$immer_state",TT=""+Object.prototype.constructor,fh=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,kT=Object.getOwnPropertyDescriptors||function(e){var t={};return fh(e).forEach(function(s){t[s]=Object.getOwnPropertyDescriptor(e,s)}),t},ET={},Vd={get:function(e,t){if(t===bi)return e;var s=er(e);if(!Gd(s,t))return function(l,u,d){var h,p=pg(u,d);return p?"value"in p?p.value:(h=p.get)===null||h===void 0?void 0:h.call(l.k):void 0}(e,s,t);var r=s[t];return e.I||!rr(r)?r:r===Cd(e.t,t)?(Rd(e),e.o[t]=Hd(e.A.h,r,e)):r},has:function(e,t){return t in er(e)},ownKeys:function(e){return Reflect.ownKeys(er(e))},set:function(e,t,s){var r=pg(er(e),t);if(r!=null&&r.set)return r.set.call(e.k,s),!0;if(!e.P){var l=Cd(er(e),t),u=l==null?void 0:l[bi];if(u&&u.t===s)return e.o[t]=s,e.R[t]=!1,!0;if(vT(s,l)&&(s!==void 0||Gd(e.t,t)))return!0;Rd(e),zd(e)}return e.o[t]===s&&(s!==void 0||t in e.o)||Number.isNaN(s)&&Number.isNaN(e.o[t])||(e.o[t]=s,e.R[t]=!0),!0},deleteProperty:function(e,t){return Cd(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,Rd(e),zd(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var s=er(e),r=Reflect.getOwnPropertyDescriptor(s,t);return r&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:r.enumerable,value:s[t]}},defineProperty:function(){Ji(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Ji(12)}},vl={};yl(Vd,function(e,t){vl[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),vl.deleteProperty=function(e,t){return vl.set.call(this,e,t,void 0)},vl.set=function(e,t,s){return Vd.set.call(this,e[0],t,s,e[0])};var AT=function(){function e(s){var r=this;this.O=mg,this.D=!0,this.produce=function(l,u,d){if(typeof l=="function"&&typeof u!="function"){var h=u;u=l;var p=r;return function(M){var j=this;M===void 0&&(M=h);for(var le=arguments.length,oe=Array(le>1?le-1:0),ie=1;ie<le;ie++)oe[ie-1]=arguments[ie];return p.produce(M,function(se){var ae;return(ae=u).call.apply(ae,[j,se].concat(oe))})}}var v;if(typeof u!="function"&&Ji(6),d!==void 0&&typeof d!="function"&&Ji(7),rr(l)){var g=hg(r),b=Hd(r,l,void 0),S=!0;try{v=u(b),S=!1}finally{S?Jo(g):jd(g)}return typeof Promise<"u"&&v instanceof Promise?v.then(function(M){return Ed(g,d),Ad(M,g)},function(M){throw Jo(g),M}):(Ed(g,d),Ad(v,g))}if(!l||typeof l!="object"){if((v=u(l))===void 0&&(v=l),v===Lm&&(v=void 0),r.D&&ch(v,!0),d){var C=[],D=[];dn("Patches").M(l,v,C,D),d(C,D)}return v}Ji(21,l)},this.produceWithPatches=function(l,u){if(typeof l=="function")return function(v){for(var g=arguments.length,b=Array(g>1?g-1:0),S=1;S<g;S++)b[S-1]=arguments[S];return r.produceWithPatches(v,function(C){return l.apply(void 0,[C].concat(b))})};var d,h,p=r.produce(l,u,function(v,g){d=v,h=g});return typeof Promise<"u"&&p instanceof Promise?p.then(function(v){return[v,d,h]}):[p,d,h]},typeof(s==null?void 0:s.useProxies)=="boolean"&&this.setUseProxies(s.useProxies),typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze)}var t=e.prototype;return t.createDraft=function(s){rr(s)||Ji(8),ta(s)&&(s=yT(s));var r=hg(this),l=Hd(this,s,void 0);return l[bi].C=!0,jd(r),l},t.finishDraft=function(s,r){var l=s&&s[bi],u=l.A;return Ed(u,r),Ad(void 0,u)},t.setAutoFreeze=function(s){this.D=s},t.setUseProxies=function(s){s&&!mg&&Ji(20),this.O=s},t.applyPatches=function(s,r){var l;for(l=r.length-1;l>=0;l--){var u=r[l];if(u.path.length===0&&u.op==="replace"){s=u.value;break}}l>-1&&(r=r.slice(l+1));var d=dn("Patches").$;return ta(s)?d(s,r):this.produce(s,function(h){return d(h,r)})},e}(),Si=new AT,CT=Si.produce;Si.produceWithPatches.bind(Si);Si.setAutoFreeze.bind(Si);Si.setUseProxies.bind(Si);Si.applyPatches.bind(Si);Si.createDraft.bind(Si);Si.finishDraft.bind(Si);function RT(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(let r=0;r<s.length;r++)if(!Object.prototype.hasOwnProperty.call(t,s[r])||!Object.is(e[s[r]],t[s[r]]))return!1;return!0}function _T(e){let t;const s=new Set,r=(v,g)=>{const b=typeof v=="function"?v(t):v;if(b!==t){const S=t;t=g?b:Object.assign({},t,b),s.forEach(C=>C(t,S))}},l=()=>t,u=(v,g=l,b=Object.is)=>{let S=g(t);function C(){const D=g(t);if(!b(S,D)){const M=S;v(S=D,M)}}return s.add(C),()=>s.delete(C)},p={setState:r,getState:l,subscribe:(v,g,b)=>g||b?u(v,g,b):(s.add(v),()=>s.delete(v)),destroy:()=>s.clear()};return t=e(r,l,p),p}var Qi={},_d={},Pd={exports:{}},bg;function ph(){if(bg)return Pd.exports;bg=1;var e=Pd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var s="candidate:%s %d %s %d %s %d typ %s";return s+=t.raddr!=null?" raddr %s rport %d":"%v%v",s+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(s+=" generation %d"),s+=t["network-id"]!=null?" network-id %d":"%v",s+=t["network-cost"]!=null?" network-cost %d":"%v",s}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var s="ssrc:%d";return t.attribute!=null&&(s+=" %s",t.value!=null&&(s+=":%s")),s}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var s="mediaclk:";return s+=t.id!=null?"id=%s %s":"%v%s",s+=t.mediaClockValue!=null?"=%s":"",s+=t.rateNumerator!=null?" rate=%s":"",s+=t.rateDenominator!=null?"/%s":"",s}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){var s=e[t];s.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),Pd.exports}var Sg;function PT(){return Sg||(Sg=1,function(e){var t=function(h){return String(Number(h))===h?Number(h):h},s=function(h,p,v,g){if(g&&!v)p[g]=t(h[1]);else for(var b=0;b<v.length;b+=1)h[b+1]!=null&&(p[v[b]]=t(h[b+1]))},r=function(h,p,v){var g=h.name&&h.names;h.push&&!p[h.push]?p[h.push]=[]:g&&!p[h.name]&&(p[h.name]={});var b=h.push?{}:g?p[h.name]:p;s(v.match(h.reg),b,h.names,h.name),h.push&&p[h.push].push(b)},l=ph(),u=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(h){var p={},v=[],g=p;return h.split(/(\r\n|\r|\n)/).filter(u).forEach(function(b){var S=b[0],C=b.slice(2);S==="m"&&(v.push({rtp:[],fmtp:[]}),g=v[v.length-1]);for(var D=0;D<(l[S]||[]).length;D+=1){var M=l[S][D];if(M.reg.test(C))return r(M,g,C)}}),p.media=v,p};var d=function(h,p){var v=p.split(/=(.+)/,2);return v.length===2?h[v[0]]=t(v[1]):v.length===1&&p.length>1&&(h[v[0]]=void 0),h};e.parseParams=function(h){return h.split(/;\s?/).reduce(d,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(h){return h.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(h){for(var p=[],v=h.split(" ").map(t),g=0;g<v.length;g+=3)p.push({component:v[g],ip:v[g+1],port:v[g+2]});return p},e.parseImageAttributes=function(h){return h.split(" ").map(function(p){return p.substring(1,p.length-1).split(",").reduce(d,{})})},e.parseSimulcastStreamList=function(h){return h.split(";").map(function(p){return p.split(",").map(function(v){var g,b=!1;return v[0]!=="~"?g=t(v):(g=t(v.substring(1,v.length)),b=!0),{scid:g,paused:b}})})}}(_d)),_d}var Dd,Tg;function DT(){if(Tg)return Dd;Tg=1;var e=ph(),t=/%[sdv%]/g,s=function(d){var h=1,p=arguments,v=p.length;return d.replace(t,function(g){if(h>=v)return g;var b=p[h];switch(h+=1,g){case"%%":return"%";case"%s":return String(b);case"%d":return Number(b);case"%v":return""}})},r=function(d,h,p){var v=h.format instanceof Function?h.format(h.push?p:p[h.name]):h.format,g=[d+"="+v];if(h.names)for(var b=0;b<h.names.length;b+=1){var S=h.names[b];h.name?g.push(p[h.name][S]):g.push(p[h.names[b]])}else g.push(p[h.name]);return s.apply(null,g)},l=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];return Dd=function(d,h){h=h||{},d.version==null&&(d.version=0),d.name==null&&(d.name=" "),d.media.forEach(function(b){b.payloads==null&&(b.payloads="")});var p=h.outerOrder||l,v=h.innerOrder||u,g=[];return p.forEach(function(b){e[b].forEach(function(S){S.name in d&&d[S.name]!=null?g.push(r(b,S,d)):S.push in d&&d[S.push]!=null&&d[S.push].forEach(function(C){g.push(r(b,S,C))})})}),d.media.forEach(function(b){g.push(r("m",e.m[0],b)),v.forEach(function(S){e[S].forEach(function(C){C.name in b&&b[C.name]!=null?g.push(r(S,C,b)):C.push in b&&b[C.push]!=null&&b[C.push].forEach(function(D){g.push(r(S,C,D))})})})}),g.join(`\r
`)+`\r
`},Dd}var kg;function wT(){if(kg)return Qi;kg=1;var e=PT(),t=DT(),s=ph();return Qi.grammar=s,Qi.write=t,Qi.parse=e.parse,Qi.parseParams=e.parseParams,Qi.parseFmtpConfig=e.parseFmtpConfig,Qi.parsePayloads=e.parsePayloads,Qi.parseRemoteCandidates=e.parseRemoteCandidates,Qi.parseImageAttributes=e.parseImageAttributes,Qi.parseSimulcastStreamList=e.parseSimulcastStreamList,Qi}var qd=wT(),MT=Object.defineProperty,OT=Object.defineProperties,LT=Object.getOwnPropertyDescriptors,eu=Object.getOwnPropertySymbols,IT=Object.getPrototypeOf,Im=Object.prototype.hasOwnProperty,Nm=Object.prototype.propertyIsEnumerable,NT=Reflect.get,Eg=(e,t,s)=>t in e?MT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,W=(e,t)=>{for(var s in t||(t={}))Im.call(t,s)&&Eg(e,s,t[s]);if(eu)for(var s of eu(t))Nm.call(t,s)&&Eg(e,s,t[s]);return e},Se=(e,t)=>OT(e,LT(t)),Ag=(e,t)=>{var s={};for(var r in e)Im.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&eu)for(var r of eu(e))t.indexOf(r)<0&&Nm.call(e,r)&&(s[r]=e[r]);return s},UT=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ys=(e,t,s)=>NT(IT(e),s,t),y=(e,t,s)=>new Promise((r,l)=>{var u=p=>{try{h(s.next(p))}catch(v){l(v)}},d=p=>{try{h(s.throw(p))}catch(v){l(v)}},h=p=>p.done?r(p.value):Promise.resolve(p.value).then(u,d);h((s=s.apply(e,t)).next())}),Um=UT((e,t)=>{t.exports={version:"0.12.32",license:"MIT",repository:{type:"git",url:"https://github.com/100mslive/web-sdks.git",directory:"packages/hms-video-store"},main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},sideEffects:!1,scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",dependencies:{eventemitter2:"^6.4.9",immer:"^9.0.6","lodash.isequal":"^4.5.0",reselect:"4.0.0","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0",zustand:"3.5.7"},devDependencies:{"@types/dom-screen-wake-lock":"^1.0.1","@types/lodash.isequal":"^4.5.8","@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1","jsdom-worker":"^0.3.0",tslib:"^2.2.0"},description:"@100mslive Core SDK which abstracts the complexities of webRTC while providing a reactive store for data management with a unidirectional data flow",keywords:["video","webrtc","conferencing","100ms"],gitHead:"6aeacabde5b5f2509dc47e155d71b572f785d845"}}),xT=(e=>(e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e))(xT||{}),xm=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:"Disconnected",recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{},polls:{},whiteboards:{},hideLocalPeer:!1}),Bm=()=>({peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}),BT=(e=>(e.CHAT="chat",e))(BT||{}),GT=(e=>(e.INFO="info",e.ERROR="error",e))(GT||{}),Gm=(e=>(e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED",e.POLL_CREATED="POLL_CREATED",e.POLL_STARTED="POLL_STARTED",e.POLL_STOPPED="POLL_STOPPED",e.POLL_VOTES_UPDATED="POLL_VOTES_UPDATED",e.POLLS_LIST="POLLS_LIST",e.HAND_RAISE_CHANGED="HAND_RAISE_CHANGED",e.TRANSCRIPTION_STATE_UPDATED="TRANSCRIPTION_STATE_UPDATED",e))(Gm||{}),jT=(e=>(e.audio="audio",e.video="video",e))(jT||{});function kl(e,t){let s,r;if(t)for(let l of t.auxiliaryTracks){let u=e[l];zT(u)&&(r=vh(u)?u:r,s=gh(u)?u:s)}return{video:s,audio:r}}function vh(e){return e&&e.type==="audio"}function gh(e){return e&&e.type==="video"}function zT(e){return e&&e.source==="screen"}function jm(e){return e&&e.source==="audioplaylist"}function mh(e){return e&&e.source==="videoplaylist"}function HT(e){return e?!!(e!=null&&e.degraded):!1}function zm(e,t){return t&&e.tracks[t]?e.tracks[t].enabled:!1}function VT(e,t){return t&&e.tracks[t]?e.tracks[t].displayEnabled:!1}function Hm(e){var t;let s=!1,r=!1,l=!1;return(t=e==null?void 0:e.publishParams)!=null&&t.allowed&&(s=e.publishParams.allowed.includes("video"),r=e.publishParams.allowed.includes("audio"),l=e.publishParams.allowed.includes("screen")),{video:s,audio:r,screen:l}}var qT=(e=>(e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE",e))(qT||{}),FT=typeof window<"u"&&typeof window.expect<"u",k=class{static v(t,...s){this.log(0,t,...s)}static d(t,...s){this.log(1,t,...s)}static i(t,...s){this.log(2,t,...s)}static w(t,...s){this.log(3,t,...s)}static e(t,...s){this.log(6,t,...s)}static time(t){this.log(4,"[HMSPerformanceTiming]",t)}static timeEnd(t){this.log(5,"[HMSPerformanceTiming]",t,t)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(t,s,...r){if(!(this.level.valueOf()>t.valueOf()))switch(t){case 0:{console.log(s,...r);break}case 1:{console.debug(s,...r);break}case 2:{console.info(s,...r);break}case 3:{console.warn(s,...r);break}case 6:{console.error(s,...r);break}case 4:{performance.mark(r[0]);break}case 5:{let l=r[0];try{let u=performance.measure(l,l);this.log(1,s,l,u==null?void 0:u.duration),performance.clearMarks(l),performance.clearMeasures(l)}catch(u){this.log(1,s,l,u)}break}}}};k.level=FT?7:0;var Vm=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}updateId(e){this.id=e}},Bn=new QS.UAParser,Ii=typeof window<"u",Cg,yh=typeof window>"u"&&!((Cg=Bn.getBrowser().name)!=null&&Cg.toLowerCase().includes("electron")),Fd=()=>Bn.getDevice().type==="mobile",$T=()=>typeof document<"u"&&document.hidden,YT=()=>{var e;return((e=Bn.getOS().name)==null?void 0:e.toLowerCase())==="ios"},Rg,_g,KT=(_g=(Rg=Bn.getBrowser())==null?void 0:Rg.name)==null?void 0:_g.toLowerCase().includes("safari"),Pg,Dg,qm=((Dg=(Pg=Bn.getBrowser())==null?void 0:Pg.name)==null?void 0:Dg.toLowerCase())==="firefox",QT=(e=>(e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS",e))(QT||{});function WT(){if(Ii&&window){let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"?"LOCAL":e.includes("app.100ms.live")?"HMS":"CUSTOM"}return"CUSTOM"}var $o=WT(),fe={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},APIErrors:{INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3004,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013,SELECTED_DEVICE_MISSING:3014,NO_DATA:3015},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006,STATS_FAILED:4007},WebsocketMethodErrors:{ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011,LOCAL_STORAGE_ACCESS_DENIED:6012,VALIDATION_FAILED:6013},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},ge=class Fm extends Error{constructor(t,s,r,l,u,d=!1){super(l),this.code=t,this.name=s,this.message=l,this.description=u,this.isTerminal=d,Object.setPrototypeOf(this,Fm.prototype),this.action=r.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(t){this.nativeError=t}toString(){var t;return`{
        code: ${this.code};
        name: ${this.name};
        action: ${this.action};
        message: ${this.message};
        description: ${this.description};
        isTerminal: ${this.isTerminal};
        nativeError: ${(t=this.nativeError)==null?void 0:t.message};
      }`}},Qt=class extends ge{constructor(e,t,s,r,l,u){super(e,t,s,r,l,!1),this.code=e,this.name=t,this.message=r,this.description=l,this.trackType=u}toAnalyticsProperties(){return Se(W({},super.toAnalyticsProperties()),{track_type:this.trackType})}toString(){var e;return`{
        code: ${this.code};
        name: ${this.name};
        action: ${this.action};
        message: ${this.message};
        description: ${this.description};
        isTerminal: ${this.isTerminal};
        nativeError: ${(e=this.nativeError)==null?void 0:e.message};
        trackType: ${this.trackType};
      }`}},JT=(e=>(e.AUDIO="audio",e.VIDEO="video",e.AUDIO_VIDEO="audio, video",e.SCREEN="screen",e))(JT||{});function wg(e){switch(e){case"join":return"JOIN";case"offer":return"PUBLISH";case"answer":return"SUBSCRIBE";case"track-update":return"TRACK";default:return"NONE"}}var XT=["join","offer","answer","trickle","on-error","JOIN"],Y={WebSocketConnectionErrors:{FailedToConnect(e,t=""){return new ge(fe.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`)},WebSocketConnectionLost(e,t=""){return new ge(fe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost",t)},AbnormalClose(e,t=""){return new ge(fe.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},APIErrors:{ServerErrors(e,t,s="",r=!0){return new ge(e,"ServerErrors",t,`[${t}]: Server error ${s}`,s,r)},EndpointUnreachable(e,t=""){return new ge(fe.APIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t)},InvalidTokenFormat(e,t=""){return new ge(fe.APIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0)},InitConfigNotAvailable(e,t=""){return new ge(fe.APIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)}},TracksErrors:{GenericTrack(e,t=""){return new Qt(fe.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`,"audio, video")},CantAccessCaptureDevice(e,t,s=""){return new Qt(fe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,s,t)},DeviceNotAvailable(e,t,s=""){return new Qt(fe.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,s,t)},DeviceInUse(e,t,s=""){return new Qt(fe.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,s,t)},DeviceLostMidway(e,t,s=""){return new Qt(fe.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,s,t)},NothingToReturn(e,t="",s="There is no media to return. Please select either video or audio or both."){return new Qt(fe.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,s,t,"audio, video")},InvalidVideoSettings(e,t=""){return new Qt(fe.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t,"video")},AutoplayBlocked(e,t=""){return new Qt(fe.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t,"audio")},CodecChangeNotPermitted(e,t=""){return new Qt(fe.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t,"audio, video")},OverConstrained(e,t,s=""){return new Qt(fe.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,s,t)},NoAudioDetected(e,t="Please check the mic or use another audio input"){return new Qt(fe.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t,"audio")},SystemDeniedPermission(e,t,s=""){return new Qt(fe.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,s,t)},CurrentTabNotShared(){return new Qt(fe.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared","TRACK","The app requires you to share the current tab","You must screen share the current tab in order to proceed","screen")},AudioPlaybackError(e){return new Qt(fe.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error","TRACK",e,e,"audio")},SelectedDeviceMissing(e){return new Qt(fe.TracksErrors.SELECTED_DEVICE_MISSING,"SelectedDeviceMissing","TRACK",`Could not detect selected ${e} device`,`Please check connection to the ${e} device`,e)},NoDataInTrack(e){return new Qt(fe.TracksErrors.NO_DATA,"Track does not have any data","TRACK",e,"This could possibily due to another application taking priority over the access to camera or microphone or due to an incoming call","audio, video")}},WebrtcErrors:{CreateOfferFailed(e,t=""){return new ge(fe.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t)},CreateAnswerFailed(e,t=""){return new ge(fe.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t)},SetLocalDescriptionFailed(e,t=""){return new ge(fe.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t)},SetRemoteDescriptionFailed(e,t=""){return new ge(fe.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t,!0)},ICEFailure(e,t="",s=!1){return new ge(fe.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t,s)},ICEDisconnected(e,t=""){return new ge(fe.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,`[${e.toString()}]: Ice connection state DISCONNECTED`,t)},StatsFailed(e,t=""){return new ge(fe.WebrtcErrors.STATS_FAILED,"StatsFailed",e,`Failed to WebRTC get stats - ${t}`,t)}},WebsocketMethodErrors:{ServerErrors(e,t,s){return new ge(e,"ServerErrors",t,s,s,XT.includes(t))},AlreadyJoined(e,t=""){return new ge(fe.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e,t=""){return new ge(fe.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e,t=""){return new ge(fe.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling(e,t){return new ge(fe.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t)},Unknown(e,t){return new ge(fe.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t)},NotReady(e,t=""){return new ge(fe.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t,s=""){return new ge(fe.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,s)},TrackMetadataMissing(e,t=""){return new ge(fe.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e,t=""){return new ge(fe.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e,t=""){return new ge(fe.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed(e,t){return new ge(fe.GenericErrors.VALIDATION_FAILED,"ValidationFailed","VALIDATION",e,t?JSON.stringify(t):"")},InvalidRole(e,t){return new ge(fe.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress(e,t=""){return new ge(fe.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},LocalStorageAccessDenied(e="Access to localStorage has been denied"){return new ge(fe.GenericErrors.LOCAL_STORAGE_ACCESS_DENIED,"LocalStorageAccessDenied","NONE","LocalStorageAccessDenied",e)},MissingMediaDevices(){return new ge(fe.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices","JOIN","navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection(){return new ge(fe.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection","JOIN","RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported(e,t=""){return new ge(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed(e,t=""){return new ge(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed(e,t=""){return new ge(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress(e,t=""){return new ge(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported(e,t=""){return new ge(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay(e,t){return new ge(fe.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying(e,t){return new ge(fe.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},ZT=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(arguments.length===0)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},e0=()=>{try{Ii&&!localStorage&&(window.localStorage=new ZT)}catch{k.e("Error initialising localStorage",Y.GenericErrors.LocalStorageAccessDenied())}},ou=class{constructor(e){this.key=e,this.storage=null}getStorage(){try{return Ii&&!this.storage&&(e0(),this.storage=window.localStorage),this.storage}catch{return k.e("Error initialising localStorage",Y.GenericErrors.LocalStorageAccessDenied()),null}}get(){var e;let t=(e=this.getStorage())==null?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let s=JSON.stringify(e);(t=this.getStorage())==null||t.setItem(this.key,s)}clear(){var e;(e=this.getStorage())==null||e.removeItem(this.key)}},$m=()=>{let e,t=new ou("hms-analytics-deviceId"),s=t.get();return s?e=s:(e=ks(),t.set(e)),e},Ym="[VALIDATIONS]";function bs(e){return e!=null}var $d=()=>{if(!bs(RTCPeerConnection)){let e=Y.GenericErrors.MissingRTCPeerConnection();throw k.e(Ym,e),e}},Yd=()=>{if(!bs(navigator.mediaDevices)){let e=Y.GenericErrors.MissingMediaDevices();throw k.e(Ym,e),e}},t0=e=>{if(!e.getPublishParams())throw Y.GenericErrors.NotConnected("VALIDATION","call addTrack after preview or join is successful")},Mg=Um().version;function Kd(e="prod",t){let s="web",r=$o!=="LOCAL"&&e==="prod"?"prod":"debug";if(yh)return Og({os:"web_nodejs",os_version:process.version,sdk:s,sdk_version:Mg,env:r,domain:$o,is_prebuilt:!!(t!=null&&t.isPrebuilt),framework:"node",framework_version:process.version,framework_sdk_version:t==null?void 0:t.sdkVersion});let l=Bn.getOS(),u=Bn.getDevice(),d=Bn.getBrowser(),h=wd(`web_${l.name}`),p=l.version||"",v=wd(`${d.name}_${d.version}`),g=v;return u.type&&(g=`${wd(`${u.vendor}_${u.type}`)}/${v}`),Og({os:h,os_version:p,sdk:s,sdk_version:Mg,device_model:g,env:r,domain:$o,is_prebuilt:!!(t!=null&&t.isPrebuilt),framework:t==null?void 0:t.type,framework_version:t==null?void 0:t.version,framework_sdk_version:t==null?void 0:t.sdkVersion})}function wd(e){return e.replace(/ /g,"_")}var Og=(e,t=",")=>Object.keys(e).filter(s=>bs(e[s])).map(s=>`${s}:${e[s]}`).join(t),Fe=class{constructor({name:e,level:t,properties:s,includesPII:r,timestamp:l}){this.metadata={peer:{},userAgent:Kd()},this.name=e,this.level=t,this.includesPII=r||!1,this.properties=s||{},this.timestamp=l||new Date().getTime(),this.event_id=ks(),this.device_id=$m()}toSignalParams(){return{name:this.name,info:Se(W({},this.properties),{timestamp:this.timestamp,domain:$o}),timestamp:new Date().getTime()}}},be=class{static connect(e,t,s=new Date,r=new Date,l){let u=this.eventNameFor("connect",e===void 0),d=e?2:1,h=this.getPropertiesWithError(Se(W({},t),{[this.KEY_REQUESTED_AT]:s==null?void 0:s.getTime(),[this.KEY_RESPONDED_AT]:r==null?void 0:r.getTime(),endpoint:l}),e);return new Fe({name:u,level:d,properties:h})}static disconnect(e,t){let s="disconnected",r=e?2:1,l=this.getPropertiesWithError(t,e);return new Fe({name:s,level:r,properties:l})}static preview(e){var t=e,{error:s}=t,r=Ag(t,["error"]);let l=this.eventNameFor("preview",s===void 0),u=s?2:1,d=this.getPropertiesWithError(r,s);return new Fe({name:l,level:u,properties:d})}static join(e){var t=e,{error:s}=t,r=Ag(t,["error"]);let l=this.eventNameFor("join",s===void 0),u=s?2:1,d=this.getPropertiesWithError(Se(W({},r),{is_preview_called:!!r.is_preview_called}),s);return new Fe({name:l,level:u,properties:d})}static publish({devices:e,settings:t,error:s}){let r=this.eventNameFor("publish",s===void 0),l=s?2:1,u=this.getPropertiesWithError({devices:e,audio:t==null?void 0:t.audio,video:t==null?void 0:t.video},s);return new Fe({name:r,level:l,properties:u})}static hlsPlayerError(e){return new Fe({name:"hlsPlayerError",level:2,properties:this.getErrorProperties(e)})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),s=2,r=this.getErrorProperties(e);return new Fe({name:t,level:s,properties:r})}static leave(){return new Fe({name:"leave",level:1})}static autoplayError(){return new Fe({name:"autoplayError",level:2})}static audioPlaybackError(e){return new Fe({name:"audioPlaybackError",level:2,properties:this.getErrorProperties(e)})}static audioRecovered(e){return new Fe({name:"audioRecovered",level:1,properties:{message:e}})}static permissionChange(e,t){return new Fe({name:"permissionChanged",level:1,properties:{message:`Perrmission for ${e} changed to ${t}`}})}static deviceChange({isUserSelection:e,selection:t,type:s,devices:r,error:l}){let u=this.eventNameFor(l?"publish":`device.${s}`,l===void 0),d=l?2:1,h=this.getPropertiesWithError({selection:t,devices:r,isUserSelection:e},l);return new Fe({name:u,level:d,properties:h})}static performance(e){let t="perf.stats",s=1,r=e.toAnalyticsProperties();return new Fe({name:t,level:s,properties:r})}static rtcStats(e){let t="rtc.stats",s=1,r=e.toAnalyticsProperties();return new Fe({name:t,level:s,properties:r})}static rtcStatsFailed(e){let t="rtc.stats.failed",s=2;return new Fe({name:t,level:s,properties:this.getErrorProperties(e)})}static degradationStats(e,t){let s="video.degradation.stats",r=1,l={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let u=new Date,d=u.valueOf()-e.degradedAt.valueOf();l=Se(W({},l),{duration:d,restoredAt:u})}return new Fe({name:s,level:r,properties:l})}static audioDetectionFail(e,t){let s=this.getPropertiesWithError({device:t},e),r=2,l="audiopresence.failed";return new Fe({name:l,level:r,properties:s})}static previewNetworkQuality(e){return new Fe({name:"perf.networkquality.preview",level:e.error?2:1,properties:e})}static publishStats(e){return new Fe({name:"publisher.stats",level:1,properties:e})}static subscribeStats(e){return new Fe({name:"subscriber.stats",level:1,properties:e})}static getKrispUsage(e){return new Fe({name:"krisp.usage",level:1,properties:{duration:e}})}static krispStart(){return new Fe({name:"krisp.start",level:1})}static krispStop(){return new Fe({name:"krisp.stop",level:1})}static interruption({started:e,type:t,reason:s,deviceInfo:r}){return new Fe({name:`${e?"interruption.start":"interruption.stop"}`,level:1,properties:W({reason:s,type:t},r)})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let s=this.getErrorProperties(t);return e=W(W({},s),e),e}static getErrorProperties(e){return e?e instanceof ge?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};be.KEY_REQUESTED_AT="requested_at",be.KEY_RESPONDED_AT="responded_at";var Km=e=>e?`{
    trackId: ${e.id};
    kind: ${e.kind};
    enabled: ${e.enabled};
    muted: ${e.muted};
    readyState: ${e.readyState};
  }`:"",bh=class{constructor(e,t,s){this.logIdentifier="",this.isTrackNotPublishing=()=>this.nativeTrack.readyState==="ended"||this.nativeTrack.muted,this.stream=e,this.nativeTrack=t,this.source=s}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return y(this,null,function*(){this.nativeTrack.enabled=e})}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}sendInterruptionEvent({started:e,reason:t}){return be.interruption({started:e,type:this.type,reason:t,deviceInfo:{deviceId:this.nativeTrack.getSettings().deviceId,groupId:this.nativeTrack.getSettings().groupId}})}cleanup(){var e;k.d("[HMSTrack]","Stopping track",this.toString()),(e=this.nativeTrack)==null||e.stop()}toString(){var e;return`{
      streamId: ${this.stream.id};
      peerId: ${this.peerId};
      trackId: ${this.trackId};
      mid: ${((e=this.transceiver)==null?void 0:e.mid)||"-"};
      logIdentifier: ${this.logIdentifier};
      source: ${this.source};
      enabled: ${this.enabled};
      nativeTrack: ${Km(this.nativeTrack)};
    }`}},Sh=class extends bh{constructor(e,t,s){if(super(e,t,s),this.type="audio",this.audioElement=null,t.kind!=="audio")throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?Math.floor(this.audioElement.volume*100):null}setVolume(e){return y(this,null,function*(){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");yield this.subscribeToAudio(e===0?!1:this.enabled),this.audioElement&&(this.audioElement.volume=e/100)})}setAudioElement(e){k.d("[HMSAudioTrack]",this.logIdentifier,"adding audio element",`${this}`,e),this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return y(this,null,function*(){var t;if(!e){k.d("[HMSAudioTrack]",this.logIdentifier,"device is null",`${this}`);return}if(!this.audioElement){k.d("[HMSAudioTrack]",this.logIdentifier,"no audio element to set output",`${this}`),this.outputDevice=e;return}try{typeof this.audioElement.setSinkId=="function"&&(qm||(yield(t=this.audioElement)==null?void 0:t.setSinkId(e.deviceId)),this.outputDevice=e)}catch(s){k.d("[HMSAudioTrack]","error in setSinkId",s)}})}subscribeToAudio(e){return y(this,null,function*(){this.stream instanceof Ah&&(yield this.stream.setAudio(e,this.trackId,this.logIdentifier))})}},i0=class{constructor(){this.storage=new ou("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:s}){if(!this.devices||!this.remember)return;let r=this.devices[e].find(u=>this.isSame({deviceId:t,groupId:s},u));if(!r){k.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${s}`);return}let l=this.storage.get()||{};l[e]=r,this.storage.set(l)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},Gn=new i0,n0=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(n0||{}),s0=(e=>(e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED",e))(s0||{}),Wr=class{static failure(e,t){let s="mediaPlugin.failed",r=2,l=W({plugin_name:e},t.toAnalyticsProperties());return new Fe({name:s,level:r,properties:l})}static audioPluginFailure(e,t,s){let r="mediaPlugin.failed",l=2,u=W({plugin_name:e,sampleRate:t},s.toAnalyticsProperties());return new Fe({name:r,level:l,properties:u})}static audioPluginStats({pluginName:e,duration:t,loadTime:s,sampleRate:r}){let l="mediaPlugin.stats",u=1,d={plugin_name:e,duration:t,load_time:s,sampleRate:r};return new Fe({name:l,level:u,properties:d})}static added(e,t){let s="mediaPlugin.added",r=1,l={plugin_name:e,added_at:t};return new Fe({name:s,level:r,properties:l})}static stats({pluginName:e,duration:t,loadTime:s,avgPreProcessingTime:r,avgProcessingTime:l,inputFrameRate:u,pluginFrameRate:d}){let h="mediaPlugin.stats",p=1,v={plugin_name:e,duration:t,load_time:s,avg_preprocessing_time:r,avg_processing_time:l,input_frame_rate:u,plugin_frame_rate:d};return new Fe({name:h,level:p,properties:v})}},r0=class{constructor(e){this.eventBus=e,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t,this.eventBus.analytics.publish(Wr.added(e,this.addedTimestamps[e]))}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(Wr.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Wr.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return y(this,null,function*(){if(this.initTime[e]){k.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let s;try{s=yield this.timeInMs(t),k.i(this.TAG,`Time taken for Plugin ${e} initialization : ${s}`)}catch(r){let l=Y.MediaPluginErrors.InitFailed("AUDIO_PLUGINS",`failed during initialization of plugin${r.message||r}`);throw k.e(this.TAG,l),this.failure(e,l),l}s&&(this.initTime[e]=s)})}timeInMs(e){return y(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},Qd=[{echoCancellation:{exact:!0}},{highpassFilter:{exact:!0}},{audioMirroring:{exact:!0}}],a0=(e=>(e.SIP="sip",e.REGULAR="regular",e))(a0||{}),l0=(e=>(e.NONE="none",e.INITIALISED="initialised",e.STARTED="started",e.PAUSED="paused",e.RESUMED="resumed",e.STOPPED="stopped",e.FAILED="failed",e))(l0||{}),o0=(e=>(e.DVR="dvr",e.NO_DVR="no-dvr",e))(o0||{}),u0=(e=>(e.REGULAR="regular",e.SCREEN="screen",e.COMPOSITE="composite",e))(u0||{}),c0=(e=>(e.INITIALISED="initialised",e.STARTED="started",e.STOPPED="stopped",e.FAILED="failed",e))(c0||{}),d0=(e=>(e.CAPTION="caption",e))(d0||{}),h0={f:"high",h:"medium",q:"low"},f0=(e=>(e.VOICE="voice",e.MUSIC="music",e))(f0||{}),p0=(e=>(e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput",e))(p0||{}),jn=class{constructor(){this._volume=1,this._codec="opus",this._maxBitrate=32,this._deviceId="default",this._audioMode="voice",this._advanced=[...Qd,{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=this._audioMode==="music"?320:e,this}deviceId(e){return this._deviceId=e,this}audioMode(e="voice"){return this._audioMode=e,this._audioMode==="music"?this._maxBitrate=320:this._maxBitrate=32,this}advanced(e){return this._advanced=e,this}build(){return new Th(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced,this._audioMode)}},Th=class{constructor(e,t,s,r,l,u){this.volume=e,this.codec=t,this.maxBitrate=s,this.deviceId=r,this.advanced=l,this.audioMode=u,this.audioMode==="music"?this.maxBitrate=320:this.maxBitrate=32}toConstraints(){return{deviceId:this.deviceId,advanced:this.audioMode==="music"?[]:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},Ss=class{constructor(){this._width=320,this._height=180,this._codec="vp8",this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if(typeof e=="number"&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}facingMode(e){return this._facingMode=e,this}build(){return new kh(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate,this._facingMode)}},kh=class{constructor(e,t,s,r,l,u,d,h){this.width=e,this.height=t,this.codec=s,this.maxFramerate=r,this.maxBitrate=d,this.deviceId=l,this.advanced=u,this.facingMode=h}toConstraints(e){let t="ideal";e&&(t="max");let s=this.improviseConstraintsAspect();return{width:{[t]:s.width},height:{[t]:s.height},frameRate:this.maxFramerate,deviceId:this.deviceId,facingMode:this.facingMode}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec,facingMode:this.facingMode}}improviseConstraintsAspect(){return Fd()&&this.height&&this.width&&this.height>this.width?{width:this.height,height:this.width}:{width:this.width,height:this.height}}},tu=class{constructor(){this._video=new Ss().build(),this._audio=new jn().build(),this._screen=new Ss().build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(this._audio===null&&this._video===null)throw Y.TracksErrors.NothingToReturn("TRACK");if(this._video===null&&this._simulcast)throw Y.TracksErrors.InvalidVideoSettings("TRACK","Cannot enable simulcast when no video settings are provided");return new Wd(this._video,this._audio,this._simulcast,this._screen||void 0)}},Wd=class{constructor(e,t,s,r=null){this.video=e,this.audio=t,this.simulcast=s,this.screen=r}toAnalyticsProperties(){let e={audio_enabled:this.audio!==null,video_enabled:this.video!==null};return this.audio&&(e=W(W({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=W(W({},this.video.toAnalyticsProperties()),e)),e}},v0=class{constructor(e,t,s){this.eventBus=t,this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new r0(t),this.audioContext=aa.getAudioContext(),this.room=s}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return y(this,null,function*(){var t,s;let r=(t=e.getName)==null?void 0:t.call(e);if(!r){k.w("no name provided by the plugin");return}if(this.pluginAddInProgress){let l=Y.MediaPluginErrors.AddAlreadyInProgress("AUDIO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.added(r,this.audioContext.sampleRate),this.analytics.failure(r,l),k.w("can't add another plugin when previous add is in progress"),l}switch(e.getName()){case"HMSKrispPlugin":{if(!((s=this.room)!=null&&s.isNoiseCancellationEnabled)){let d="Krisp Noise Cancellation is not enabled for this room";if(this.pluginsMap.size===0)throw Error(d);k.w(this.TAG,d);return}this.eventBus.analytics.publish(be.krispStart());let{settings:l}=this.hmsTrack,u=new jn().codec(l.codec).maxBitrate(l.maxBitrate).deviceId(l.deviceId).advanced([...Qd,{autoGainControl:{exact:!1}},{noiseSuppression:{exact:!1}}]).audioMode(l.audioMode).build();yield this.hmsTrack.setSettings(u);break}}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e){return y(this,null,function*(){var t,s;let r=(t=e.getName)==null?void 0:t.call(e);if(this.pluginsMap.get(r)){k.w(this.TAG,`plugin - ${r} already added.`);return}yield this.validateAndThrow(r,e),(s=e.setEventBus)==null||s.call(e,this.eventBus);try{this.pluginsMap.size===0?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(r,this.audioContext.sampleRate),yield this.analytics.initWithTime(r,()=>y(this,null,function*(){return e.init()})),this.pluginsMap.set(r,e),yield this.processPlugin(e),yield this.connectToDestination(),yield this.updateProcessedTrack()}catch(l){throw k.e(this.TAG,"failed to add plugin",l),l}})}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return y(this,null,function*(){let s=this.validatePlugin(t);if(s.isSupported)k.i(this.TAG,`plugin is supported,- ${t.getName()}`);else if(this.analytics.added(e,this.audioContext.sampleRate),s.errType==="PLATFORM_NOT_SUPPORTED"){let r=Y.MediaPluginErrors.PlatformNotSupported("AUDIO_PLUGINS","platform not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}else if(s.errType==="DEVICE_NOT_SUPPORTED"){let r=Y.MediaPluginErrors.DeviceNotSupported("AUDIO_PLUGINS","audio device not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}})}removePlugin(e){return y(this,null,function*(){switch(e.getName()){case"HMSKrispPlugin":{this.eventBus.analytics.publish(be.krispStop());let{settings:t}=this.hmsTrack,s=new jn().codec(t.codec).maxBitrate(t.maxBitrate).deviceId(t.deviceId).advanced([...Qd,{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}}]).audioMode(t.audioMode).build();yield this.hmsTrack.setSettings(s);break}}yield this.removePluginInternal(e),this.pluginsMap.size===0?(yield this.cleanup(),k.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()})}cleanup(){return y(this,null,function*(){var e,t,s;for(let r of this.pluginsMap.values())yield this.removePluginInternal(r);yield this.hmsTrack.setProcessedTrack(void 0),(e=this.sourceNode)==null||e.disconnect(),(t=this.prevAudioNode)==null||t.disconnect(),(s=this.outputTrack)==null||s.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0})}closeContext(){return y(this,null,function*(){this.audioContext=void 0})}reprocessPlugins(){return y(this,null,function*(){if(this.pluginsMap.size===0||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t);yield this.updateProcessedTrack()})}initAudioNodes(){return y(this,null,function*(){if(this.audioContext){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e),this.destinationNode||(this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0])}})}updateProcessedTrack(){return y(this,null,function*(){try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw k.e(this.TAG,"error in setting processed track",e),e}})}processPlugin(e){return y(this,null,function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let s=e.getName();k.e(this.TAG,`error in processing plugin ${s}`,t),yield this.removePluginInternal(e)}})}connectToDestination(){return y(this,null,function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){k.e(this.TAG,"error in connecting to destination node",e)}})}removePluginInternal(e){return y(this,null,function*(){var t;let s=(t=e.getName)==null?void 0:t.call(e);if(!this.pluginsMap.get(s)){k.w(this.TAG,`plugin - ${s} not found to remove.`);return}k.i(this.TAG,`removing plugin ${s}`),this.pluginsMap.delete(s),e.stop(),this.analytics.removed(s)})}};function g0(e,t){let s=e.toLowerCase(),r=Y.TracksErrors.GenericTrack("TRACK",e);return s.includes("device not found")?r=Y.TracksErrors.DeviceNotAvailable("TRACK",t,e):s.includes("permission denied")&&(r=Y.TracksErrors.CantAccessCaptureDevice("TRACK",t,e)),r}function m0(e,t=""){if(ug.browserDetails.browser==="chrome"&&e.name==="NotAllowedError"&&e.message.includes("denied by system"))return Y.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);if(ug.browserDetails.browser==="firefox"&&e.name==="NotFoundError"){let s=Y.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);return s.description=`Capture device is either blocked at Operating System level or not available - ${t}`,s}switch(e.name){case"OverconstrainedError":return Y.TracksErrors.OverConstrained("TRACK",t,e.constraint);case"NotAllowedError":return Y.TracksErrors.CantAccessCaptureDevice("TRACK",t,e.message);case"NotFoundError":return Y.TracksErrors.DeviceNotAvailable("TRACK",t,e.message);case"NotReadableError":return Y.TracksErrors.DeviceInUse("TRACK",t,e.message);case"TypeError":return Y.TracksErrors.NothingToReturn("TRACK",e.message);default:return g0(e.message,t)}}function Sl(e,t){let s=m0(e,t);return s.addNativeError(e),s}function Lg(e){return y(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:e?e.toConstraints():!1})).getAudioTracks()[0]}catch(t){throw Sl(t,"audio")}})}function Ig(e){return y(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:e?e.toConstraints():!1})).getVideoTracks()[0]}catch(t){throw Sl(t,"video")}})}function Jr(e){return"canvas"in e||e.label==="MediaStreamAudioDestinationNode"||e.label===""}var Qm=(e,t)=>{if(!navigator.permissions){k.d("Permissions API not supported");return}navigator.permissions.query({name:e}).then(s=>{s.onchange=()=>{t(s.state)}})},y0=32e3,aa={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=qm?new AudioContext:new AudioContext({sampleRate:y0})),this.audioContext},resumeContext(){return y(this,null,function*(){try{return yield this.getAudioContext().resume()}catch(e){k.e("AudioContext",e)}})}},b0=(e=>(e.SPEAKERPHONE="SPEAKERPHONE",e.WIRED="WIRED",e.BLUETOOTH="BLUETOOTH",e.EARPIECE="EARPIECE",e))(b0||{}),S0=e=>{if(!e)return k.w("[DeviceManager]:","No device label provided"),"SPEAKERPHONE";let t=e.toLowerCase();return t.includes("speakerphone")?"SPEAKERPHONE":t.includes("wired")?"WIRED":/airpods|buds|wireless|bluetooth/gi.test(t)?"BLUETOOTH":t.includes("earpiece")?"EARPIECE":"SPEAKERPHONE"},Eh=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}},Wm=`(function workerSetup() {
  function ticker() {
    self.postMessage('tick');
  }
  self.onmessage = function (event) {
    const [data, time] = event.data;
    switch (data) {
      case 'start':
        setTimeout(ticker, time);
        break;
      default:
        break;
    }
  };
})()`;function Ts(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(t=>{setTimeout(t,e)})}function uu(e){if(e<0)throw Error("`ms` should be a positive integer");if(typeof Worker>"u")return Ts(e);let t=new Worker(URL.createObjectURL(new Blob([Wm],{type:"application/javascript"})));return t.postMessage(["start",e]),new Promise(s=>{t.onmessage=r=>{r.data==="tick"&&(s(),t.terminate())}})}function T0(){if(typeof Worker>"u")return{sleep:t=>Ts(t)};let e=new Worker(URL.createObjectURL(new Blob([Wm],{type:"application/javascript"})));return{sleep:t=>(e.postMessage(["start",t]),new Promise(s=>{e.onmessage=r=>{r.data==="tick"&&s()}}))}}function Jm(e,t=300){let s;return function(...r){clearTimeout(s),s=void 0;let l=this;s=setTimeout(()=>{e.apply(l,r)},t)}}var k0=35,E0=5,A0=class{constructor(e,t,s){this.track=e,this.audioLevelEvent=t,this.silenceEvent=s,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Eh(this.historyInterval/this.interval),this.detectSilence=()=>y(this,null,function*(){let r=0;for(;this.isMonitored;){if(this.track.enabled)if(this.isSilentThisInstant()){if(r++,r>50){this.silenceEvent.publish({track:this.track});break}}else break;yield Ts(20)}});try{let r=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(r);let l=this.analyserNode.frequencyBinCount;this.dataArray=new Uint8Array(l)}catch(r){k.w(this.TAG,"Unable to initialize AudioContext",r)}}start(){this.stop(),this.isMonitored=!0,k.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then(()=>k.d(this.TAG,"Stopping track Monitor",`${this.track}`))}stop(){if(!this.analyserNode){k.d(this.TAG,"AudioContext not initialized");return}this.sendAudioLevel(0),this.isMonitored=!1}loop(){return y(this,null,function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Ts(this.interval)})}sendAudioLevel(e=0){if(e=e>k0?e:0,Math.abs(this.audioLevel-e)>E0){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode){k.d(this.TAG,"AudioContext not initialized");return}let e=this.calculateAudioLevel();return e!==void 0&&this.history.enqueue(e),this.history.aggregate(t=>Math.max(...t))}calculateAudioLevel(){if(!this.analyserNode||!this.dataArray){k.d(this.TAG,"AudioContext not initialized");return}this.analyserNode.getByteTimeDomainData(this.dataArray);let e=.009,t=e;for(let r of this.dataArray)t=Math.max(t,(r-128)/128);let s=(Math.log(e)-Math.log(t))/Math.log(e);return Math.ceil(Math.min(Math.max(s*100,0),100))}isSilentThisInstant(){if(!this.analyserNode||!this.dataArray){k.d(this.TAG,"AudioContext not initialized");return}return this.analyserNode.getByteTimeDomainData(this.dataArray),this.dataArray.every(e=>e===128||e===0)}createAnalyserNodeForStream(e){let t=aa.getAudioContext(),s=t.createMediaStreamSource(e),r=t.createAnalyser();return r.fftSize=2048,s.connect(r),r}};function Ng(e,t){return function(s){return!Xg(e[s],t[s])}}var nr=class Yo extends Sh{constructor(t,s,r,l,u=new jn().build(),d){super(t,s,r),this.eventBus=l,this.room=d,this.TAG="[HMSLocalAudioTrack]",this.tracksCreated=new Set,this.isPublished=!1,this.handleVisibilityChange=()=>y(this,null,function*(){if(!this.shouldReacquireTrack()){k.d(this.TAG,`visibiltiy: ${document.visibilityState}`,`${this}`);return}if(document.visibilityState==="hidden")this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{k.d(this.TAG,"On visibile replacing track as it is not publishing");try{yield this.replaceTrackWith(this.settings)}catch(h){this.eventBus.error.publish(h)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}}),this.trackPermissions=()=>{Qm("microphone",h=>{this.eventBus.analytics.publish(be.permissionChange(this.type,h)),h==="denied"&&this.eventBus.localAudioEnabled.publish({enabled:!1,track:this})})},this.handleTrackMute=()=>{k.d(this.TAG,"muted natively");let h=document.visibilityState==="hidden"?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:h})),this.eventBus.localAudioEnabled.publish({enabled:!1,track:this})},this.handleTrackUnmute=()=>y(this,null,function*(){k.d(this.TAG,"unmuted natively");let h=document.visibilityState==="hidden"?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:h}));try{yield this.setEnabled(this.enabled,!0),this.eventBus.localAudioUnmutedNatively.publish()}catch(p){this.eventBus.error.publish(p)}}),this.replaceSenderTrack=()=>y(this,null,function*(){if(!this.transceiver||this.transceiver.direction!=="sendonly"){k.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`);return}yield this.transceiver.sender.replaceTrack(this.processedTrack||this.nativeTrack)}),this.shouldReacquireTrack=()=>Jr(this.nativeTrack)||this.isTrackNotPublishing(),this.handleSettingsChange=h=>y(this,null,function*(){let p=this.stream,v=Ng(h,this.settings);(v("maxBitrate")||v("audioMode"))&&h.maxBitrate&&(yield p.setMaxBitrateAndFramerate(this,h)),(v("advanced")||v("audioMode"))&&(yield this.replaceTrackWith(h))}),this.handleDeviceChange=(h,p=!1)=>y(this,null,function*(){if(Ng(h,this.settings)("deviceId")){this.manuallySelectedDeviceId=p?this.manuallySelectedDeviceId:h.deviceId,k.d(this.TAG,"device change","manual selection:",this.manuallySelectedDeviceId,"new device:",h.deviceId),yield this.replaceTrackWith(h);let v=this.nativeTrack.getSettings().groupId;!p&&h.deviceId&&(Gn.updateSelection("audioInput",{deviceId:h.deviceId,groupId:v}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"audioInput",selection:{deviceId:h.deviceId,groupId:v}}))}}),t.tracks.push(this),this.addTrackEventListeners(s),this.trackPermissions(),this.settings=u,u.deviceId!==s.getSettings().deviceId&&!Jr(s)&&(this.settings=this.buildNewSettings({deviceId:s.getSettings().deviceId})),this.pluginsManager=new v0(this,l,d),this.setFirstTrackId(s.id),r==="regular"&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let s=this.nativeTrack.clone();t.nativeStream.addTrack(s);let r=new Yo(t,s,this.source,this.eventBus,this.settings,this.room);return r.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach(l=>{r.addPlugin(l).catch(u=>k.e(this.TAG,"Plugin add failed while migrating",l,u))}),r}getManuallySelectedDeviceId(){return this.manuallySelectedDeviceId}resetManuallySelectedDeviceId(){this.manuallySelectedDeviceId=void 0}updateTrack(t){return y(this,null,function*(){t.enabled=this.enabled,yield this.stream.replaceStreamTrack(this.nativeTrack,t),this.nativeTrack=t,yield this.replaceSenderTrack(),this.audioLevelMonitor&&this.initAudioLevelMonitor()})}replaceTrackWith(t){return y(this,null,function*(){let s=this.nativeTrack;s==null||s.stop(),this.removeTrackEventListeners(s),this.tracksCreated.forEach(r=>r.stop()),this.tracksCreated.clear();try{let r=yield Lg(t);this.addTrackEventListeners(r),this.tracksCreated.add(r),k.d(this.TAG,"replaceTrack, Previous track stopped",s,"newTrack",r),yield this.updateTrack(r)}catch(r){let l=yield Lg(this.settings);throw this.addTrackEventListeners(l),this.tracksCreated.add(l),yield this.updateTrack(l),this.isPublished&&this.eventBus.analytics.publish(be.publish({error:r})),r}try{yield this.pluginsManager.reprocessPlugins()}catch(r){this.eventBus.audioPluginFailed.publish(r)}})}setEnabled(t,s=!1){return y(this,null,function*(){t===this.enabled&&!s||(t&&this.shouldReacquireTrack()&&(yield this.replaceTrackWith(this.settings)),yield ys(Yo.prototype,this,"setEnabled").call(this,t),t&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:t,track:this}))})}isPublishedTrackId(t){return this.publishedTrackId===t}setSettings(t,s=!1){return y(this,null,function*(){let r=this.buildNewSettings(t);if(Jr(this.nativeTrack)){this.settings=r;return}yield this.handleDeviceChange(r,s),yield this.handleSettingsChange(r),this.settings=r})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(t){return y(this,null,function*(){return this.pluginsManager.addPlugin(t)})}removePlugin(t){return y(this,null,function*(){return this.pluginsManager.removePlugin(t)})}validatePlugin(t){return this.pluginsManager.validatePlugin(t)}setProcessedTrack(t){return y(this,null,function*(){t?t!==this.processedTrack&&(this.processedTrack=t):this.processedTrack=void 0,yield this.replaceSenderTrack()})}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),k.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new A0(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var t;(t=this.audioLevelMonitor)==null||t.stop(),this.audioLevelMonitor=void 0}cleanup(){return y(this,null,function*(){var t;ys(Yo.prototype,this,"cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),this.transceiver=void 0,(t=this.processedTrack)==null||t.stop(),this.tracksCreated.forEach(s=>s.stop()),this.tracksCreated.clear(),this.isPublished=!1,this.destroyAudioLevelMonitor(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}addTrackEventListeners(t){t.addEventListener("mute",this.handleTrackMute),t.addEventListener("unmute",this.handleTrackUnmute)}removeTrackEventListeners(t){t.removeEventListener("mute",this.handleTrackMute),t.removeEventListener("unmute",this.handleTrackUnmute)}buildNewSettings(t){let{volume:s,codec:r,maxBitrate:l,deviceId:u,advanced:d,audioMode:h}=W(W({},this.settings),t);return new Th(s,r,l,u,d,h)}},ia=class Xm extends Sh{setEnabled(t){return y(this,null,function*(){t!==this.enabled&&(yield ys(Xm.prototype,this,"setEnabled").call(this,t),yield this.subscribeToAudio(t))})}},Zm=class extends bh{constructor(e,t,s){if(super(e,t,s),this.type="video",this.sinkCount=0,this.handleTrackUnmute=()=>{this.getSinks().forEach(r=>this.reTriggerPlay({videoElement:r}))},this.reTriggerPlay=({videoElement:r})=>{setTimeout(()=>{r.play().catch(l=>{k.w("[HMSVideoTrack]","failed to play",l.message)})},0)},t.kind!=="video")throw new Error("Expected 'track' kind = 'video'")}setVideoHandler(e){this.videoHandler=e}hasSinks(){return this.sinkCount>0}getSinks(){return this.videoHandler.getVideoElements()||[]}attach(e){this.videoHandler.addVideoElement(e)}detach(e){this.videoHandler.removeVideoElement(e)}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){e.srcObject!==null&&(e.srcObject=null,this.reduceSinkCount())}cleanup(){super.cleanup(),this.videoHandler.cleanup()}addSinkInternal(e,t){let s=e.srcObject;if(s!==null&&s instanceof MediaStream){let l=s.getVideoTracks()[0];if((l==null?void 0:l.id)===t.id){if(!l.muted&&l.readyState==="live")return;this.reduceSinkCount()}else this.reduceSinkCount()}this.addPropertiesToElement(e);let r=new MediaStream([t]);e.srcObject=r,this.reTriggerPlay({videoElement:e}),this.sinkCount++}reduceSinkCount(){this.sinkCount>0&&this.sinkCount--}addPropertiesToElement(e){KT||(e.autoplay=!0),e.playsInline=!0,e.muted=!0,e.controls=!1}},iu={none:-1,low:0,medium:1,high:2},C0=.5,R0=(e,t)=>{let s="high",r=t.width>t.height?"width":"height",l=[...e].sort((d,h)=>iu[d.layer]-iu[h.layer]),u=t[r]*((window==null?void 0:window.devicePixelRatio)||1);for(let d=0;d<l.length;d++){let{resolution:h,layer:p}=l[d],v=h[r];if(u<=v){s=p;break}else{let g=l[d+1],b=g?g.resolution[r]:Number.POSITIVE_INFINITY;if((u-v)/(b-v)<C0){s=p;break}}}return s},_0=class{constructor(){this.TAG="[HMSIntersectionObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t)=>{var s;this.createObserver(),this.unobserve(e),(s=this.intersectionObserver)==null||s.observe(e),this.listeners.set(e,t)},this.unobserve=e=>{var t;(t=this.intersectionObserver)==null||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.intersectionObserver&&(this.intersectionObserver=new IntersectionObserver(this.handleIntersection))},this.handleIntersection=e=>{var t;for(let s of e)(t=this.listeners.get(s.target))==null||t(s)},this.createObserver()}isSupported(){let e=Ii&&typeof window.IntersectionObserver<"u";return e||k.w(this.TAG,"IntersectionObserver is not supported, fallback will be used instead"),e}},P0=new _0,D0=class{constructor(){this.TAG="[HMSResizeObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t,s={box:"border-box"})=>{var r;this.createObserver(),this.unobserve(e),(r=this.resizeObserver)==null||r.observe(e,s),this.listeners.set(e,t)},this.unobserve=e=>{var t;(t=this.resizeObserver)==null||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.resizeObserver&&(this.resizeObserver=new ResizeObserver(Jm(this.handleResize,300)))},this.handleResize=e=>{var t;for(let s of e)(t=this.listeners.get(s.target))==null||t(s)},this.createObserver()}isSupported(){let e=Ii&&typeof window.ResizeObserver<"u";return e||k.w(this.TAG,"Resize Observer is not supported"),e}},w0=new D0,ey=class{constructor(e){this.track=e,this.TAG="[VideoElementManager]",this.videoElements=new Set,this.entries=new WeakMap,this.handleIntersection=t=>y(this,null,function*(){let s=getComputedStyle(t.target).visibility==="visible";this.track.enabled&&(t.isIntersecting&&s||!document.contains(t.target))?(k.d(this.TAG,"add sink intersection",`${this.track}`,this.id),this.entries.set(t.target,t.boundingClientRect),yield this.selectMaxLayer(),yield this.track.addSink(t.target)):(k.d(this.TAG,"remove sink intersection",`${this.track}`,this.id),yield this.track.removeSink(t.target))}),this.handleResize=t=>y(this,null,function*(){!this.track.enabled||!(this.track instanceof yi)||(this.entries.set(t.target,t.contentRect),yield this.selectMaxLayer())}),this.cleanup=()=>{this.videoElements.forEach(t=>{var s,r;t.srcObject=null,(s=this.resizeObserver)==null||s.unobserve(t),(r=this.intersectionObserver)==null||r.unobserve(t)}),this.videoElements.clear(),this.resizeObserver=void 0,this.intersectionObserver=void 0},this.init(),this.id=ks()}updateSinks(e=!1){for(let t of this.videoElements)this.track.enabled?this.track.addSink(t,e):this.track.removeSink(t,e)}addVideoElement(e){return y(this,null,function*(){var t;this.videoElements.has(e)||(this.init(),k.d(this.TAG,`Adding video element for ${this.track}`,this.id),this.videoElements.add(e),this.videoElements.size>=10&&k.w(this.TAG,`${this.track}`,`the track is added to ${this.videoElements.size} video elements, while this may be intentional, it's likely that there is a bug leading to unnecessary creation of video elements in the UI`),(t=this.intersectionObserver)!=null&&t.isSupported()?this.intersectionObserver.observe(e,this.handleIntersection):Ii&&(this.isElementInViewport(e)?this.track.addSink(e):this.track.removeSink(e)),this.resizeObserver?this.resizeObserver.observe(e,this.handleResize):this.track instanceof yi&&(yield this.track.setPreferredLayer(this.track.getPreferredLayer())))})}removeVideoElement(e){var t,s;this.track.removeSink(e),this.videoElements.delete(e),this.entries.delete(e),(t=this.resizeObserver)==null||t.unobserve(e),(s=this.intersectionObserver)==null||s.unobserve(e),k.d(this.TAG,`Removing video element for ${this.track}`)}getVideoElements(){return Array.from(this.videoElements)}init(){Ii&&(this.resizeObserver=w0,this.intersectionObserver=P0)}isElementInViewport(e){let t=e.offsetTop,s=e.offsetLeft,r=e.offsetWidth,l=e.offsetHeight,{hidden:u}=e,{opacity:d,display:h}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop,s+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&s<window.pageXOffset+window.innerWidth&&t+l>window.pageYOffset&&s+r>window.pageXOffset&&!u&&(d!==""?parseFloat(d)>0:!0)&&h!=="none"}selectMaxLayer(){return y(this,null,function*(){if(!(this.track instanceof yi)||this.videoElements.size===0)return;let e;for(let t of this.videoElements){let s=this.entries.get(t);if(!s)continue;let{width:r,height:l}=s;if(r===0||l===0)continue;let u=R0(this.track.getSimulcastDefinitions(),{width:r,height:l});e?e=iu[u]>iu[e]?u:e:e=u}e&&(k.d(this.TAG,`selecting max layer ${e} for the track`,`${this.track}`),yield this.track.setPreferredLayer(e))})}},M0=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(M0||{}),O0=(e=>(e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2",e))(O0||{}),Ug=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},ty=class{constructor(e){this.eventBus=e,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new Ug,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,s){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new Ug,t&&(this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=s||t),this.eventBus.analytics.publish(Wr.added(e,this.addedTimestamps[e]))}removed(e){var t;if(this.pluginAdded[e]){let s={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:(t=this.processingAvgs[e])==null?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(Wr.stats(s)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Wr.failure(e,t)),this.clean(e))}initWithTime(e,t){return y(this,null,function*(){if(this.initTime[e]){k.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let s;try{s=yield this.timeInMs(t),k.i(this.TAG,`Time taken for Plugin ${e} initialization : ${s}`)}catch(r){let l=Y.MediaPluginErrors.InitFailed("VIDEO_PLUGINS",`failed during initialization of plugin${r.message||r}`);throw k.e(this.TAG,l),this.failure(e,l),l}s&&(this.initTime[e]=s)})}preProcessWithTime(e){return y(this,null,function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)})}processWithTime(e,t){return y(this,null,function*(){var s;let r;try{r=yield this.timeInMs(t)}catch(l){let u=Y.MediaPluginErrors.ProcessingFailed("VIDEO_PLUGINS",`Failed during processing of plugin${l.message||l}`);throw k.e(this.TAG,u),this.failure(e,u),u}r&&((s=this.processingAvgs[e])==null||s.add(r))})}timeInMs(e){return y(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},xg=24,L0=320,I0=240,N0=class{constructor(e,t){this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.reusableWorker=T0(),this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new ty(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return y(this,null,function*(){var s;if(this.pluginAddInProgress){let r=(s=e.getName)==null?void 0:s.call(e);if(!r||r===""){k.w("no name provided by the plugin");return}let l=Y.MediaPluginErrors.AddAlreadyInProgress("VIDEO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.failure(r,l),k.w("can't add another plugin when previous add is in progress"),l}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e,t){return y(this,null,function*(){var s,r;let l=(s=e.getName)==null?void 0:s.call(e);if(!l||l===""){k.w("no name provided by the plugin");return}if(this.pluginsMap.has(l)){k.w(this.TAG,`plugin - ${e.getName()} already added.`);return}let u=this.hmsTrack.getMediaTrackSettings().frameRate||xg,d=0;t&&t>0?(k.i(this.TAG,`adding plugin ${e.getName()} with framerate ${t}`),t<u&&(d=Math.ceil(u/t)-1),this.analytics.added(l,u,t)):(k.i(this.TAG,`adding plugin ${e.getName()}`),this.analytics.added(l,u)),k.i(this.TAG,"numFrames to skip processing",d),this.pluginNumFramesToSkip[l]=d,this.pluginNumFramesSkipped[l]=d,this.validateAndThrow(l,e);try{if(yield this.analytics.initWithTime(l,()=>y(this,null,function*(){return yield e.init()})),this.pluginsMap.set(l,e),this.pluginsMap.size+1>this.canvases.length)for(let h=this.canvases.length;h<=this.pluginsMap.size;h++)this.canvases[h]=document.createElement("canvas");yield this.startPluginsLoop((r=e.getContextType)==null?void 0:r.call(e))}catch(h){throw k.e(this.TAG,"failed to add plugin",h),yield this.removePlugin(e),h}})}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let s=this.validatePlugin(t);if(s.isSupported)k.i(this.TAG,`plugin is supported,- ${t.getName()}`);else{let r;switch(s.errType){case"PLATFORM_NOT_SUPPORTED":throw r=Y.MediaPluginErrors.PlatformNotSupported("VIDEO_PLUGINS","platform not supported, see docs"),this.analytics.failure(e,r),r;case"DEVICE_NOT_SUPPORTED":throw r=Y.MediaPluginErrors.DeviceNotSupported("VIDEO_PLUGINS","video device not supported, see docs"),this.analytics.failure(e,r),r}}}removePlugin(e){return y(this,null,function*(){let t=e.getName();if(!this.pluginsMap.get(t)){k.w(this.TAG,`plugin - ${t} not found to remove.`);return}k.i(this.TAG,`removing plugin ${t}`),this.removePluginEntry(t),this.pluginsMap.size===0&&(k.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)})}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return y(this,null,function*(){if(!(!this.pluginsLoopRunning||this.pluginsLoopState==="running"))for(;this.pluginsLoopState==="paused";)yield uu(100)})}cleanup(){return y(this,null,function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);(e=this.outputTrack)==null||e.stop()})}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||"2d");let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return y(this,null,function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(t){throw this.pluginsLoopRunning=!1,k.e(this.TAG,"error in setting processed track",t),t}this.pluginsLoop().then(()=>{k.d(this.TAG,"processLoop stopped")})}})}stopPluginsLoop(){return y(this,null,function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),(e=this.outputTrack)==null||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)})}pluginsLoop(){return y(this,null,function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||xg,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||this.hmsTrack.nativeTrack.readyState==="ended"){this.pluginsLoopState==="running"&&this.resetCanvases(),this.pluginsLoopState="paused",yield this.reusableWorker.sleep(t);continue}let s=0;try{yield this.analytics.preProcessWithTime(()=>y(this,null,function*(){return yield this.doPreProcessing()}));let r=Date.now();yield this.processFramesThroughPlugins(),s=Math.floor(Date.now()-r),s>t&&(s=t)}catch(r){k.e(this.TAG,"error in plugins loop",r)}this.pluginsLoopState="running",yield this.reusableWorker.sleep(t-s)}})}doPreProcessing(){return y(this,null,function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()})}processFramesThroughPlugins(){return y(this,null,function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let s=t.getName();if(t){try{let r=this.checkIfSkipRequired(s);if(t.getPluginType()==="TRANSFORM"){let l=(u,d)=>y(this,null,function*(){try{yield t.processVideoFrame(u,d,r)}catch(h){k.e(this.TAG,`error in processing plugin ${s}`,h)}});if(r)e===this.pluginsMap.size-1?yield l(this.canvases[e],this.outputCanvas):yield l(this.canvases[e],this.canvases[e+1]);else{let u=this.canvases[e],d=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(s,()=>y(this,null,function*(){return l(u,this.outputCanvas)})):yield this.analytics.processWithTime(s,()=>y(this,null,function*(){return l(u,d)}))}}else t.getPluginType()==="ANALYZE"&&!r&&(yield this.analytics.processWithTime(s,()=>y(this,null,function*(){return yield t.processVideoFrame(this.inputCanvas)})))}catch(r){k.e(this.TAG,`error in processing plugin ${s}`,r),yield this.removePlugin(t)}e++}}})}addTrackToVideo(){return y(this,null,function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;t!==null&&t instanceof MediaStream&&((e=t.getVideoTracks()[0])==null?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())})}updateInputCanvas(){return y(this,null,function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=L0,height:t=I0}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)})}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}},U0=class{constructor(e,t){this.TAG="[MediaStreamPluginsManager]",this.plugins=new Set,this.analytics=new ty(e),this.room=t}addPlugins(e){e.forEach(t=>{var s;switch(t.getName()){case"HMSEffectsPlugin":if(!((s=this.room)!=null&&s.isEffectsEnabled)){let r="Effects Virtual Background is not enabled for this room";if(this.plugins.size===0)throw Error(r);k.w(this.TAG,r);return}break}this.plugins.add(t)})}removePlugins(e){e.forEach(t=>{t.stop(),this.analytics.removed(t.getName()),this.plugins.delete(t)})}applyPlugins(e){let t=e;for(let s of this.plugins){let r=s.getName();try{t=s.apply(t),this.analytics.added(r)}catch(l){this.analytics.failure(r,l),k.e("Could not apply plugin",l,r)}}return t}getPlugins(){return Array.from(this.plugins).map(e=>e.getName())}cleanup(){return y(this,null,function*(){this.removePlugins(Array.from(this.plugins))})}},x0=["init_response_time","ws_connect_time","on_policy_change_time","local_audio_track_time","local_video_track_time","peer_list_time","room_state_time","join_response_time"],B0=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),k.d("[HMSPerformanceTiming]",e,(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration)}catch(s){k.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:s})}}getTimeTaken(e){var t;return(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration}getTimes(...e){return[...x0,...e].reduce((t,s)=>Se(W({},t),{[s]:this.getTimeTaken(s)}),{})}cleanup(){this.eventPerformanceMeasures={}}},Md={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default",audioMode:"voice"},In,Bo,nu=class Jd{constructor(t,s,r,l,u){this.store=t,this.observer=s,this.deviceManager=r,this.eventBus=l,this.analyticsTimer=u,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(){return y(this,arguments,function*(t=Md){let s=this.getAVTrackSettings(t);if(!s)return[];let r=!!s.audio,l=!!s.video,u=[],{videoTrack:d,audioTrack:h}=yield this.updateCurrentLocalTrackSettings(s),p=(d==null?void 0:d.stream)||(h==null?void 0:h.stream),v=!!(d&&this.store.getTrackById(d.trackId)),g=!!(h&&this.store.getTrackById(h.trackId));if(v&&g)return[];let b={audio:r&&!h&&(t.isAudioMuted?"empty":!0),video:l&&!d&&(t.isVideoMuted?"empty":!0)};b.audio&&this.analyticsTimer.start("local_audio_track_time"),b.video&&this.analyticsTimer.start("local_video_track_time");try{k.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:b}),u=yield this.getLocalTracks(b,s,p)}catch(S){u=yield this.retryGetLocalTracks(S,s,b,p)}return b.audio&&this.analyticsTimer.end("local_audio_track_time"),b.video&&this.analyticsTimer.end("local_video_track_time"),d&&l&&!v&&u.push(d),h&&r&&!g&&u.push(h),u})}getLocalTracks(){return y(this,arguments,function*(t={audio:!0,video:!0},s,r){try{let l=yield this.getNativeLocalTracks(t,s);return this.createHMSLocalTracks(l,s,r)}catch(l){throw this.eventBus.analytics.publish(be.publish({devices:this.deviceManager.getDevices(),error:l,settings:s})),l}})}getNativeLocalTracks(){return y(this,arguments,function*(t={audio:!1,video:!1},s){let r=new Wd(t.video===!0?s.video:null,t.audio===!0?s.audio:null,s.simulcast),l=[];return(r.audio||r.video)&&l.push(...yield this.getAVTracks(r)),l.push(...this.getEmptyTracks(t)),l})}optimizeScreenShareConstraint(t,s){return y(this,null,function*(){var r,l,u;if(typeof s.video=="boolean"||!((r=s.video)!=null&&r.width)||!((l=s.video)!=null&&l.height))return;let d=this.store.getPublishParams();if(!d||!((u=d.allowed)!=null&&u.includes("screen")))return;let h=document.createElement("video");h.srcObject=t,h.addEventListener("loadedmetadata",()=>y(this,null,function*(){let{videoWidth:p,videoHeight:v}=h,g=d.screen,b=g.width*g.height,S=p/v,C=g.width/g.height;if(S>C){let D=s.video,M=S/C,j=Math.sqrt(M);p*v>b?(D.width=p/j,D.height=v/j):(D.height=v*j,D.width=p*j),yield t.getVideoTracks()[0].applyConstraints(D)}}))})}getLocalScreen(t,s=!1){return y(this,null,function*(){var r;let l=yield this.getOrDefaultScreenshareConfig(t),u=this.getScreenshareSettings(l.videoOnly),d={video:Se(W({},u==null?void 0:u.video.toConstraints(!0)),{displaySurface:l.displaySurface}),preferCurrentTab:l.preferCurrentTab,selfBrowserSurface:l.selfBrowserSurface,surfaceSwitching:l.surfaceSwitching,systemAudio:l.systemAudio};if(u!=null&&u.audio){let C=(r=u==null?void 0:u.audio)==null?void 0:r.toConstraints();delete C.advanced,d.audio=Se(W({},C),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}else t!=null&&t.forceCurrentTab&&t.preferCurrentTab&&t.cropElement&&(d.audio={echoCancellation:!0,noiseSuppression:!0});let h;try{k.d("retrieving screenshare with ",{config:l},{constraints:d}),h=yield navigator.mediaDevices.getDisplayMedia(d),s&&(yield this.optimizeScreenShareConstraint(h,d))}catch(C){k.w(this.TAG,"error in getting screenshare - ",C);let D=Sl(C,"screen");throw this.eventBus.analytics.publish(be.publish({error:D,devices:this.deviceManager.getDevices(),settings:new Wd(u==null?void 0:u.video,u==null?void 0:u.audio,!1)})),D}let p=[],v=new Xr(h),g=h.getVideoTracks()[0],b=new Li(v,g,"screen",this.eventBus,u==null?void 0:u.video,this.store.getRoom());b.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen"));try{let C=this.validateCurrentTabCapture(b,l.forceCurrentTab);b.isCurrentTab=C,yield b.cropTo(l.cropTarget)}catch(C){throw h.getTracks().forEach(D=>D.stop()),C}p.push(b);let S=h.getAudioTracks()[0];if(S){let C=new nr(v,S,"screen",this.eventBus,u==null?void 0:u.audio,this.store.getRoom());p.push(C)}return k.v(this.TAG,"getLocalScreen",p),p})}setScreenCaptureHandleConfig(t){var s;!((s=navigator.mediaDevices)!=null&&s.setCaptureHandleConfig)||this.isInIframe()||(t=t||{},Object.assign(t,{handle:ks(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),k.d("setting capture handle - ",t.handle),navigator.mediaDevices.setCaptureHandleConfig(t),this.captureHandleIdentifier=t.handle)}validateCurrentTabCapture(t,s){let r=t.getCaptureHandle(),l=!!(this.captureHandleIdentifier&&(r==null?void 0:r.handle)===this.captureHandleIdentifier);if(s&&!l)throw k.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),Y.TracksErrors.CurrentTabNotShared();return l}requestPermissions(){return y(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(t=>t.stop())}catch(t){k.e(this.TAG,t)}})}static getEmptyVideoTrack(t){var s,r,l;let u=((s=t==null?void 0:t.getSettings())==null?void 0:s.width)||320,d=((r=t==null?void 0:t.getSettings())==null?void 0:r.height)||240,h=1;In||(In=document.createElement("canvas"),In.width=u,In.height=d,(l=In.getContext("2d"))==null||l.fillRect(0,0,u,d)),Bo||(Bo=setInterval(()=>{let v=In==null?void 0:In.getContext("2d");v&&v.fillRect(0,0,1,1)},1e3/h));let p=In.captureStream(h).getVideoTracks()[0];return p.enabled=!1,p}static getEmptyAudioTrack(){let t=aa.getAudioContext(),s=t.createOscillator(),r=t.createMediaStreamDestination();s.connect(r),s.start();let l=r.stream.getAudioTracks()[0];return l.enabled=!1,l}static cleanup(){clearInterval(Bo),Bo=void 0,In=void 0}getAVTracks(t){return y(this,null,function*(){try{let s=yield navigator.mediaDevices.getUserMedia({audio:t.audio?t.audio.toConstraints():!1,video:t.video?t.video.toConstraints():!1});return s.getVideoTracks().concat(s.getAudioTracks())}catch(s){yield this.deviceManager.init();let r=!!(!this.deviceManager.hasWebcamPermission&&t.video),l=!!(!this.deviceManager.hasMicrophonePermission&&t.audio),u=this.getErrorType(r,l);throw Sl(s,u)}})}getAVTrackSettings(t){let s=this.getAudioSettings(t),r=this.getVideoSettings(t);return!s&&!r?null:new tu().video(r).audio(s).build()}isInIframe(){try{return window.self!==window.top}catch{return!0}}retryGetLocalTracks(t,s,r,l){return y(this,null,function*(){if(t instanceof ge&&t.action==="TRACK"){this.observer.onFailure(t);let u=t.code===fe.TracksErrors.OVER_CONSTRAINED,d=t.message.includes("audio"),h=t.message.includes("video");if(u){let p=new tu().video(new kh).audio(new Th).build();k.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:r},{error:t});try{return yield this.getLocalTracks(r,p,l)}catch(v){let g=v instanceof ge?v.nativeError:v,b=v;if((g==null?void 0:g.name)==="OverconstrainedError"){let S=Y.TracksErrors.GenericTrack("TRACK","Overconstrained error after dropping all constraints");S.addNativeError(g),b=S}return yield this.retryGetLocalTracks(b,s,r,l)}}r.audio=d?"empty":r.audio,r.video=h?"empty":r.video,k.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:r},t);try{return yield this.getLocalTracks(r,s,l)}catch(p){return k.w(this.TAG,"Fetch empty tacks failed",p),r.audio=r.audio&&"empty",r.video=r.video&&"empty",this.observer.onFailure(p),yield this.getLocalTracks(r,s,l)}}else return k.w(this.TAG,"Fetch AV Tracks failed - unknown exception",t),this.observer.onFailure(t),[]})}getErrorType(t,s){return t&&s?"audio, video":t?"video":s?"audio":"audio, video"}getEmptyTracks(t){let s=[];return t.audio==="empty"&&s.push(Jd.getEmptyAudioTrack()),t.video==="empty"&&s.push(Jd.getEmptyVideoTrack()),s}updateCurrentLocalTrackSettings(t){return y(this,null,function*(){let s=this.store.getLocalPeerTracks(),r=s.find(h=>h.type==="video"&&h.source==="regular"),l=s.find(h=>h.type==="audio"&&h.source==="regular"),u=s.find(h=>h.type==="video"&&h.source==="screen");t!=null&&t.video&&(yield r==null?void 0:r.setSettings(t.video)),t!=null&&t.audio&&(yield l==null?void 0:l.setSettings(t.audio));let d=this.getScreenshareSettings(!0);return d!=null&&d.video&&(yield u==null?void 0:u.setSettings(d==null?void 0:d.video)),{videoTrack:r,audioTrack:l}})}getAudioSettings(t){var s;let r=this.store.getPublishParams();if(!r||!((s=r.allowed)!=null&&s.includes("audio")))return null;let l=this.store.getLocalPeer(),u=l==null?void 0:l.audioTrack,d=(u==null?void 0:u.settings.deviceId)||t.audioInputDeviceId;return new jn().codec(r.audio.codec).maxBitrate(r.audio.bitRate).deviceId(d||Md.audioInputDeviceId).build()}getVideoSettings(t){var s;let r=this.store.getPublishParams();if(!r||!((s=r.allowed)!=null&&s.includes("video")))return null;let l=this.store.getLocalPeer(),u=l==null?void 0:l.videoTrack,d=(u==null?void 0:u.settings.deviceId)||t.videoDeviceId,h=r.video;return new Ss().codec(h.codec).maxBitrate(h.bitRate).maxFramerate(h.frameRate).setWidth(h.width).setHeight(h.height).deviceId(d||Md.videoDeviceId).build()}getScreenshareSettings(t=!1){var s;let r=this.store.getPublishParams();if(!r||!((s=r.allowed)!=null&&s.includes("screen")))return null;let l=r.screen;return{video:new Ss().maxBitrate(l.bitRate,!1).codec(l.codec).maxFramerate(l.frameRate).setWidth(l.width).setHeight(l.height).build(),audio:t?void 0:new jn().build()}}getOrDefaultScreenshareConfig(t){return y(this,null,function*(){var s;let r=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},t||{});return r.forceCurrentTab&&(r.videoOnly=!0,r.preferCurrentTab=!0,r.selfBrowserSurface="include",r.surfaceSwitching="exclude"),r.preferCurrentTab&&(r.selfBrowserSurface="include",r.displaySurface=void 0),r.cropElement&&(s=window.CropTarget)!=null&&s.fromElement&&(r.cropTarget=yield window.CropTarget.fromElement(r.cropElement)),r})}createHMSLocalTracks(t,s,r){let l=t.find(h=>h.kind==="video"),u=t.find(h=>h.kind==="audio");r?t.forEach(h=>r==null?void 0:r.nativeStream.addTrack(h)):r=new Xr(new MediaStream(t));let d=[];if(u&&s!=null&&s.audio){let h=new nr(r,u,"regular",this.eventBus,s.audio,this.store.getRoom());d.push(h)}if(l&&s!=null&&s.video){let h=new Li(r,l,"regular",this.eventBus,s.video,this.store.getRoom());h.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),d.push(h)}return d}};function Bg(e,t){return function(s){return!Xg(e[s],t[s])}}var Li=class Ko extends Zm{constructor(t,s,r,l,u=new Ss().build(),d){super(t,s,r),this.eventBus=l,this.room=d,this._layerDefinitions=[],this.TAG="[HMSLocalVideoTrack]",this.enabledStateBeforeBackground=!1,this.isCurrentTab=!1,this.isPublished=!1,this.replaceSenderTrack=h=>y(this,null,function*(){if(!this.transceiver||this.transceiver.direction!=="sendonly"){k.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`);return}yield this.transceiver.sender.replaceTrack(h)}),this.buildNewSettings=h=>{let{width:p,height:v,codec:g,maxFramerate:b,maxBitrate:S,deviceId:C,advanced:D,facingMode:M}=W(W({},this.settings),h);return new kh(p,v,g,b,C,D,S,M)},this.handleSettingsChange=h=>y(this,null,function*(){let p=this.stream,v=Bg(h,this.settings);if(v("maxBitrate")&&h.maxBitrate&&(yield p.setMaxBitrateAndFramerate(this)),v("width")||v("height")||v("advanced"))if(this.source==="video"){let g=yield this.replaceTrackWith(h);yield this.replaceSender(g,this.enabled),this.nativeTrack=g,yield this.processPlugins(),this.videoHandler.updateSinks()}else yield this.nativeTrack.applyConstraints(h.toConstraints())}),this.handleDeviceChange=(h,p=!1)=>y(this,null,function*(){if(Bg(h,this.settings)("deviceId")&&this.source==="regular"){if(this.enabled){delete h.facingMode;let g=yield this.replaceTrackWith(h);yield this.replaceSender(g,this.enabled),this.nativeTrack=g,yield this.processPlugins(),this.videoHandler.updateSinks()}let v=this.nativeTrack.getSettings().groupId;!p&&h.deviceId&&(Gn.updateSelection("videoInput",{deviceId:h.deviceId,groupId:v}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"video",selection:{deviceId:h.deviceId,groupId:v}}))}}),this.trackPermissions=()=>{Qm("camera",h=>{this.eventBus.analytics.publish(be.permissionChange(this.type,h)),h==="denied"&&this.eventBus.localVideoEnabled.publish({enabled:!1,track:this})})},this.handleTrackMute=()=>{k.d(this.TAG,"muted natively",document.visibilityState);let h=document.visibilityState==="hidden"?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:h})),this.eventBus.localVideoEnabled.publish({enabled:!1,track:this})},this.handleTrackUnmuteNatively=()=>y(this,null,function*(){k.d(this.TAG,"unmuted natively");let h=document.visibilityState==="hidden"?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:h})),this.handleTrackUnmute(),this.eventBus.localVideoEnabled.publish({enabled:this.enabled,track:this}),this.eventBus.localVideoUnmutedNatively.publish(),yield this.setEnabled(this.enabled)}),this.removeOrReplaceProcessedTrack=h=>y(this,null,function*(){h?h!==this.processedTrack&&(this.processedTrack=h):this.processedTrack=void 0,yield this.replaceSenderTrack(this.processedTrack||this.nativeTrack)}),this.handleVisibilityChange=()=>y(this,null,function*(){if(document.visibilityState==="hidden")this.enabledStateBeforeBackground=this.enabled,this.enabled&&(yield this.setEnabled(!1)),this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{if(k.d(this.TAG,"visibility visible, restoring track state",this.enabledStateBeforeBackground),this.enabledStateBeforeBackground)try{yield this.setEnabled(!0)}catch(h){this.eventBus.error.publish(h)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}}),this.addTrackEventListeners(s),this.trackPermissions(),t.tracks.push(this),this.setVideoHandler(new ey(this)),this.settings=u,u.deviceId!==s.getSettings().deviceId&&s.enabled&&(this.settings=this.buildNewSettings({deviceId:s.getSettings().deviceId})),this.pluginsManager=new N0(this,l),this.mediaStreamPluginsManager=new U0(l,d),this.setFirstTrackId(this.trackId),this.eventBus.localAudioUnmutedNatively.subscribe(this.handleTrackUnmute),Ii&&r==="regular"&&Fd()&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let s=this.nativeTrack.clone();t.nativeStream.addTrack(s);let r=new Ko(t,s,this.source,this.eventBus,this.settings,this.room);return r.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach(l=>{r.addPlugin(l).catch(u=>k.e(this.TAG,"Plugin add failed while migrating",l,u))}),this.mediaStreamPluginsManager.plugins.size>0&&r.addStreamPlugins(Array.from(this.mediaStreamPluginsManager.plugins)),r}setSimulcastDefinitons(t){this._layerDefinitions=t}getSimulcastDefinitions(){return this._layerDefinitions}setEnabled(t){return y(this,null,function*(){var s;if(t!==this.enabled){if(this.source==="regular"){let r;t?r=yield this.replaceTrackWith(this.settings):r=yield this.replaceTrackWithBlank(),yield this.replaceSender(r,t),(s=this.nativeTrack)==null||s.stop(),this.nativeTrack=r,yield ys(Ko.prototype,this,"setEnabled").call(this,t),t&&(yield this.pluginsManager.waitForRestart(),yield this.processPlugins(),this.settings=this.buildNewSettings({deviceId:r.getSettings().deviceId})),this.videoHandler.updateSinks()}this.eventBus.localVideoEnabled.publish({enabled:t,track:this})}})}processPlugins(){return y(this,null,function*(){try{if(this.pluginsManager.getPlugins().length>0)return;if(this.mediaStreamPluginsManager.getPlugins().length>0){let t=this.mediaStreamPluginsManager.applyPlugins(new MediaStream([this.nativeTrack])).getVideoTracks()[0];yield this.setProcessedTrack(t)}else yield this.setProcessedTrack();this.videoHandler.updateSinks()}catch(t){console.error("error in processing plugin(s)",t)}})}addStreamPlugins(t){return y(this,null,function*(){if(this.pluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSMediaStreamPlugin and HMSVideoPlugin cannot be used together");this.mediaStreamPluginsManager.addPlugins(t),yield this.processPlugins()})}removeStreamPlugins(t){return y(this,null,function*(){this.mediaStreamPluginsManager.removePlugins(t),yield this.processPlugins()})}isPublishedTrackId(t){return this.publishedTrackId===t}addSink(t){this.addSinkInternal(t,this.processedTrack||this.nativeTrack)}setSettings(t,s=!1){return y(this,null,function*(){let r=this.buildNewSettings(t);if(yield this.handleDeviceChange(r,s),!this.enabled||Jr(this.nativeTrack)){this.settings=r;return}else yield this.pluginsManager.waitForRestart();yield this.handleSettingsChange(r),this.settings=r})}getPlugins(){return this.mediaStreamPluginsManager.getPlugins().length>0?this.mediaStreamPluginsManager.getPlugins():this.pluginsManager.getPlugins()}addPlugin(t,s){return y(this,null,function*(){if(this.mediaStreamPluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSVideoPlugin and HMSMediaStreamPlugin cannot be used together");return this.pluginsManager.addPlugin(t,s)})}removePlugin(t){return y(this,null,function*(){return this.pluginsManager.removePlugin(t)})}validatePlugin(t){return this.pluginsManager.validatePlugin(t)}cleanup(){return y(this,null,function*(){var t;this.eventBus.localAudioUnmutedNatively.unsubscribe(this.handleTrackUnmute),this.removeTrackEventListeners(this.nativeTrack),yield this.mediaStreamPluginsManager.cleanup(),yield this.pluginsManager.cleanup(),ys(Ko.prototype,this,"cleanup").call(this),this.transceiver=void 0,(t=this.processedTrack)==null||t.stop(),this.isPublished=!1,Ii&&Fd()&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}cropTo(t){return y(this,null,function*(){if(t&&this.source==="screen")try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(t))}catch(s){throw k.e(this.TAG,"failed to crop screenshare capture - ",s),Y.TracksErrors.GenericTrack("TRACK","failed to crop screenshare capture")}})}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(t){return y(this,null,function*(){if(!this.nativeTrack.enabled){this.processedTrack=t;return}yield this.removeOrReplaceProcessedTrack(t),this.videoHandler.updateSinks()})}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled?this.processedTrack||this.nativeTrack:this.nativeTrack}switchCamera(){return y(this,null,function*(){var t;let s=this.getMediaTrackSettings().facingMode;if(!s||this.source!=="regular"){k.d(this.TAG,"facingMode not supported");return}let r=s==="environment"?"user":"environment";(t=this.nativeTrack)==null||t.stop();let l=yield this.replaceTrackWith(this.buildNewSettings({facingMode:r,deviceId:void 0}));yield this.replaceSender(l,this.enabled),this.nativeTrack=l,yield this.processPlugins(),this.videoHandler.updateSinks(),this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId,facingMode:r}),Gn.updateSelection("videoInput",{deviceId:this.settings.deviceId,groupId:this.nativeTrack.getSettings().groupId})})}replaceTrackWith(t){return y(this,null,function*(){let s=this.nativeTrack;this.removeTrackEventListeners(s),s==null||s.stop();try{let r=yield Ig(t);return this.addTrackEventListeners(r),k.d(this.TAG,"replaceTrack, Previous track stopped",s,"newTrack",r),this.settings.deviceId==="default"&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),r}catch(r){let l=yield Ig(this.settings);throw this.addTrackEventListeners(l),yield this.replaceSender(l,this.enabled),this.nativeTrack=l,yield this.processPlugins(),this.videoHandler.updateSinks(),this.isPublished&&this.eventBus.analytics.publish(be.publish({error:r})),r}})}replaceTrackWithBlank(){return y(this,null,function*(){let t=this.nativeTrack,s=nu.getEmptyVideoTrack(t);return this.removeTrackEventListeners(t),this.addTrackEventListeners(s),t==null||t.stop(),k.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",t,"newTrack",s),s})}replaceSender(t,s){return y(this,null,function*(){s?yield this.replaceSenderTrack(this.processedTrack||t):yield this.replaceSenderTrack(t),this.stream.replaceStreamTrack(this.nativeTrack,t)})}addTrackEventListeners(t){t.addEventListener("mute",this.handleTrackMute),t.addEventListener("unmute",this.handleTrackUnmuteNatively)}removeTrackEventListeners(t){t.removeEventListener("mute",this.handleTrackMute),t.removeEventListener("unmute",this.handleTrackUnmuteNatively)}},ul="renegotiation-callback-id",iy="ion-sfu",cl="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",G0="https://event.100ms.live/v2/client/report",j0="https://event-nonprod.100ms.live/v2/client/report",su=Math.pow(2,31)-1,At={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",LOCAL_VIDEO_UNMUTED_NATIVELY:"local-video-unmuted-natively",LOCAL_AUDIO_UNMUTED_NATIVELY:"local-audio-unmuted-natively",STATS_UPDATE:"stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error",LEAVE:"leave",ERROR:"error"},z0="2.5",H0="20250115",Kr="_handraise",Gg=1e3,jg=64,V0="https://whiteboard.100ms.live",q0="https://whiteboard-qa.100ms.live",yi=class Qo extends Zm{constructor(t,s,r,l){super(t,s,r),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new F0,this.preferredLayer="high",this.disableNoneLayerRequest=!1,this.disableNoneLayerRequest=!!l,this.setVideoHandler(new ey(this))}setTrackId(t){this.bizTrackId=t}get trackId(){return this.bizTrackId||super.trackId}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(t){return y(this,null,function*(){t!==this.enabled&&(ys(Qo.prototype,this,"setEnabled").call(this,t),this.videoHandler.updateSinks(!0))})}setPreferredLayer(t){return y(this,null,function*(){if(t==="none"){k.w("layer none will be ignored");return}if(this.preferredLayer=t,!!this.shouldSendVideoLayer(t,"preferLayer")){if(!this.hasSinks()){k.d(`[Remote Track] ${this.logIdentifier}
        streamId=${this.stream.id} 
        trackId=${this.trackId}
        saving ${t}, source=${this.source}
        Track does not have any sink`);return}yield this.requestLayer(t,"preferLayer"),this.pushInHistory(`uiPreferLayer-${t}`)}})}getSimulcastLayer(){return this.stream.getSimulcastLayer()}getLayer(){return this.stream.getVideoLayer()}getPreferredLayer(){return this.preferredLayer}getPreferredLayerDefinition(){return this._layerDefinitions.find(t=>t.layer===this.preferredLayer)}replaceTrack(t){this.nativeTrack=t.nativeTrack,t.transceiver&&(this.transceiver=t.transceiver,this.stream.updateId(t.stream.id)),this.videoHandler.updateSinks()}addSink(t,s=!0){return y(this,null,function*(){Jr(this.nativeTrack)?yield this.requestLayer(this.preferredLayer,"addSink"):(ys(Qo.prototype,this,"addSink").call(this,t),s&&(yield this.updateLayer("addSink"))),this.pushInHistory("uiSetLayer-high")})}removeSink(t,s=!0){return y(this,null,function*(){ys(Qo.prototype,this,"removeSink").call(this,t),s&&(yield this.updateLayer("removeSink")),this._degraded=!1,this.pushInHistory("uiSetLayer-none")})}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(t){this._layerDefinitions=t}setLayerFromServer(t){this._degraded=this.getDegradationValue(t),this._degradedAt=this._degraded?new Date:this._degradedAt;let s=t.current_layer;return k.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id} 
      trackId=${this.trackId}
      layer update from sfu
      currLayer=${t.current_layer}
      preferredLayer=${t.expected_layer}
      sub_degraded=${t.subscriber_degraded}
      pub_degraded=${t.publisher_degraded}
      isDegraded=${this._degraded}`),this.stream.setVideoLayerLocally(s,this.logIdentifier,"setLayerFromServer"),this.pushInHistory(`sfuLayerUpdate-${s}`),this._degraded}getDegradationValue(t){return this.enabled&&(t.publisher_degraded||t.subscriber_degraded)&&t.current_layer==="none"}updateLayer(t){return y(this,null,function*(){let s=this.preferredLayer;this.enabled&&this.hasSinks()?s=this.preferredLayer:this.disableNoneLayerRequest||(s="none"),this.shouldSendVideoLayer(s,t)&&(yield this.requestLayer(s,t))})}pushInHistory(t){}requestLayer(t,s){return y(this,null,function*(){try{let r=yield this.stream.setVideoLayer(t,this.trackId,this.logIdentifier,s);return k.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id}
      trackId=${this.trackId}
      Requested layer ${t}, source=${s}`),r}catch(r){throw k.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id}
      trackId=${this.trackId}
      Failed to set layer ${t}, source=${s}
      error=${r.message}`),r}})}shouldSendVideoLayer(t,s){let r=this.getLayer();return this.degraded&&t==="none"?!0:r===t?(k.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${t}, source=${s}`),!1):!0}},F0=class{constructor(){this.history=[]}push(e){e.time=new Date().toISOString().split("T")[1],this.history.push(e)}},Xr=class extends Vm{constructor(){super(...arguments),this.TAG="[HMSLocalStream]",this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let s=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:this.getTrackEncodings(e,t)});return this.setPreferredCodec(s,e.nativeTrack.kind),e.transceiver=s,s}setMaxBitrateAndFramerate(e,t){return y(this,null,function*(){var s;yield(s=this.connection)==null?void 0:s.setMaxBitrateAndFramerate(e,t)})}setPreferredCodec(e,t){}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}removeSender(e){var t,s;if(!this.connection||this.connection.connectionState==="closed"){k.d(this.TAG,"publish connection is not initialised or closed");return}let r=(t=e.transceiver)==null?void 0:t.sender;if(!r){k.w(this.TAG,`No sender found for trackId=${e.trackId}`);return}(s=this.connection)==null||s.removeTrack(r);let l=this.tracks.indexOf(e);l!==-1?this.tracks.splice(l,1):k.w(this.TAG,`Cannot find ${e.trackId} in locally stored tracks`)}getTrackEncodings(e,t){let s=[];if(e instanceof Li)if(t.length>0)k.d(this.TAG,"Simulcast enabled with layers",t),s.push(...t);else{let r={active:this.nativeStream.active};e.settings.maxBitrate&&!yh&&(r.maxBitrate=e.settings.maxBitrate),s.push(r)}return s}},Ah=class extends Vm{constructor(e,t){super(e),this.audio=!0,this.video="none",this.connection=t}setAudio(e,t,s){return y(this,null,function*(){this.audio!==e&&(this.audio=e,k.d(`[Remote stream] ${s||""} 
    streamId=${this.id}
    trackId=${t}
    subscribing audio - ${this.audio}`),yield this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"}))})}setVideoLayerLocally(e,t,s){this.video=e,k.d(`[Remote stream] ${t}
    streamId=${this.id}
    source: ${s}
    Setting layer field to=${e}`)}setVideoLayer(e,t,s,r){return k.d(`[Remote stream] ${s} 
      streamId=${this.id}
      trackId=${t} 
      source: ${r} request ${e} layer`),this.setVideoLayerLocally(e,s,r),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}getSimulcastLayer(){return this.video}getVideoLayer(){return this.video}isAudioSubscribed(){return this.audio}},$0=(e,t,s,r)=>y(void 0,null,function*(){var l;let u,d={};if((l=t.transceiver)!=null&&l.sender.track){try{u=yield t.transceiver.sender.getStats();let h={},p={},v={};u==null||u.forEach(g=>{switch(g.type){case"outbound-rtp":p[g.id]=g;break;case"remote-inbound-rtp":v[g.ssrc]=g;break;case"codec":h[g.id]=g.mimeType;break;default:break}}),Object.keys(W({},p)).forEach(g=>{var b,S;let C=(b=p[g])==null?void 0:b.codecId,D=C?h[C]:void 0,M;D&&(M=D.substring(D.indexOf("/")+1));let j=Se(W({},p[g]),{rid:(S=p[g])==null?void 0:S.rid}),le=v[j.ssrc];d[g]=Se(W({},j),{bitrate:cu("bytesSent",j,r==null?void 0:r[g]),packetsLost:le==null?void 0:le.packetsLost,jitter:le==null?void 0:le.jitter,roundTripTime:le==null?void 0:le.roundTripTime,totalRoundTripTime:le==null?void 0:le.totalRoundTripTime,peerName:s,peerID:t.peerId,enabled:t.enabled,codec:M})})}catch(h){e.analytics.publish(be.rtcStatsFailed(Y.WebrtcErrors.StatsFailed("TRACK",`Error getting local track stats ${t.trackId} - ${h.message}`))),k.w("[HMSWebrtcStats]","Error in getting local track stats",t,h,h.name)}return d}}),Y0=(e,t,s,r)=>y(void 0,null,function*(){var l;let u;try{u=yield(l=t.transceiver)==null?void 0:l.receiver.getStats()}catch(v){e.analytics.publish(be.rtcStatsFailed(Y.WebrtcErrors.StatsFailed("TRACK",`Error getting remote track stats ${t.trackId} - ${v.message}`))),k.w("[HMSWebrtcStats]","Error in getting remote track stats",t,v)}let d=K0(u),h=cu("bytesReceived",d,r),p=Xd("packetsLost",d,r);return d!=null&&d.remote&&Object.assign(d.remote,{packetsLostRate:Xd("packetsLost",d.remote,r==null?void 0:r.remote)}),d&&Se(W({},d),{bitrate:h,packetsLostRate:p,peerID:t.peerId,enabled:t.enabled,peerName:s,codec:d.codec})}),K0=e=>{let t,s,r={};e==null||e.forEach(d=>{switch(d.type){case"inbound-rtp":t=d;break;case"outbound-rtp":t=d;break;case"remote-inbound-rtp":s=d;break;case"codec":r[d.id]=d.mimeType;break}});let l=t!=null&&t.codecId?r[t.codecId]:void 0,u;return l&&(u=l.substring(l.indexOf("/")+1)),t&&Object.assign(t,{remote:s,codec:u})},zg=(e,t,s)=>{let r=Q0(t),l=cu(e==="publish"?"bytesSent":"bytesReceived",r,s&&s[e]);return r&&Object.assign(r,{bitrate:l})},Q0=e=>{let t;return e==null||e.forEach(s=>{s.type==="transport"&&(t=e==null?void 0:e.get(s.selectedCandidatePairId))}),t||e==null||e.forEach(s=>{s.type==="candidate-pair"&&s.selected&&(t=s)}),t},W0=e=>{let t={packetsLost:0,jitter:0};return e==null||e.forEach(s=>{s.packetsLost&&(t.packetsLost+=s.packetsLost),s.jitter>t.jitter&&(t.jitter=s.jitter)}),t},J0=(e,t)=>Array.from(new Set(e.concat(t))),cu=(e,t,s)=>Xd(e,t,s)*8,Xd=(e,t,s)=>{let r=t&&t[e],l=s?s[e]:null;return[t,s,bs(r),bs(l)].every(u=>!!u)?ny(r,l,t==null?void 0:t.timestamp,s==null?void 0:s.timestamp)*1e3:0},ny=(e,t,s,r)=>bs(e)&&bs(t)&&s&&r?(e-t)/(s-r):0,X0=class{constructor(e,t,s,r){this.store=e,this.eventBus=t,this.publishConnection=s,this.subscribeConnection=r,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.getLocalPeerStats=()=>this.peerStats[this.localPeerID],this.getRemoteTrackStats=u=>this.remoteTrackStats[u],this.getAllRemoteTracksStats=()=>this.remoteTrackStats,this.getLocalTrackStats=()=>this.localTrackStats,this.updateStats=()=>y(this,null,function*(){yield this.updateLocalPeerStats(),yield this.updateLocalTrackStats(),yield this.updateRemoteTrackStats()}),this.updateLocalPeerStats=()=>y(this,null,function*(){var u,d,h,p;let v=this.getLocalPeerStats(),g;try{g=yield(u=this.publishConnection)==null?void 0:u.getStats()}catch(oe){this.eventBus.analytics.publish(be.rtcStatsFailed(Y.WebrtcErrors.StatsFailed("PUBLISH",oe.message))),k.w(this.TAG,"Error in getting publish stats",oe)}let b=g&&zg("publish",g,v),S;try{S=yield(d=this.subscribeConnection)==null?void 0:d.getStats()}catch(oe){this.eventBus.analytics.publish(be.rtcStatsFailed(Y.WebrtcErrors.StatsFailed("SUBSCRIBE",oe.message))),k.w(this.TAG,"Error in getting subscribe stats",oe)}let C=S&&zg("subscribe",S,v),{packetsLost:D,jitter:M}=W0(S),j=ny(D,(h=v==null?void 0:v.subscribe)==null?void 0:h.packetsLost,C==null?void 0:C.timestamp,(p=v==null?void 0:v.subscribe)==null?void 0:p.timestamp),le=C&&Object.assign(C,{packetsLostRate:j,jitter:M,packetsLost:D});this.peerStats[this.localPeerID]={publish:b,subscribe:le}}),this.updateRemoteTrackStats=()=>y(this,null,function*(){var u;let d=Array.from(this.store.getTracksMap().values()).filter(p=>p instanceof yi||p instanceof ia),h=d.map(p=>p.trackId);Object.keys(this.remoteTrackStats).forEach(p=>{h.includes(p)||delete this.remoteTrackStats[p]});for(let p of d){let v=p.peerId&&((u=this.store.getPeerById(p.peerId))==null?void 0:u.name),g=this.getRemoteTrackStats(p.trackId),b=yield Y0(this.eventBus,p,v,g);b&&(this.remoteTrackStats[p.trackId]=b)}}),this.updateLocalTrackStats=()=>y(this,null,function*(){var u;let d=this.store.getLocalPeerTracks().reduce((p,v)=>(p[v.getTrackIDBeingSent()]=v,p),{}),h=J0(Object.keys(this.localTrackStats),Object.keys(d));for(let p of h){let v=d[p];if(v){let g=(u=this.store.getLocalPeer())==null?void 0:u.name,b=yield $0(this.eventBus,v,g,this.localTrackStats[p]);b&&(this.localTrackStats[p]=b)}else delete this.localTrackStats[p]}});var l;this.localPeerID=(l=this.store.getLocalPeer())==null?void 0:l.peerId}setPeerConnections({publish:e,subscribe:t}){this.publishConnection=e,this.subscribeConnection=t}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}},Z0=class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>y(this,null,function*(){var s;yield(s=this.hmsStats)==null?void 0:s.updateStats(),this.hmsStats&&this.eventBus.statsUpdate.publish(this.hmsStats)})}getCurrentStats(){return this.hmsStats}getPublishPeerConnection(){var e;return(e=this.hmsStats)==null?void 0:e.getPublishPeerConnection()}getSubscribePeerConnection(){var e;return(e=this.hmsStats)==null?void 0:e.getSubscribePeerConnection()}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){this.hmsStats?this.hmsStats.setPeerConnections({publish:e,subscribe:t}):this.hmsStats=new X0(this.store,this.eventBus,e,t)}start(){return y(this,null,function*(){if(this.isMonitored){k.d(this.TAG,"Already started");return}this.stop(),this.isMonitored=!0,k.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(()=>k.d(this.TAG,"Stopping Webrtc Stats Monitor")).catch(e=>{this.eventBus.analytics.publish(be.rtcStatsFailed(Y.WebrtcErrors.StatsFailed("PUBLISH",e.message))),k.e(this.TAG,e.message)})})}stop(){this.isMonitored=!1}startLoop(){return y(this,null,function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Ts(this.interval)})}cleanup(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},sy=class{constructor({peerId:e,name:t,isLocal:s,customerUserId:r,metadata:l,role:u,joinedAt:d,groups:h,realtime:p,type:v}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=s,this.customerUserId=r,this.metadata=l,this.joinedAt=d,this.groups=h,this.realtime=p,this.type=v,u&&(this.role=u)}get isHandRaised(){var e;return!!((e=this.groups)!=null&&e.includes(Kr))}updateRole(e){this.role=e}updateName(e){this.name=e}updateNetworkQuality(e){this.networkQuality=e}updateMetadata(e){this.metadata=e}updateGroups(e){this.groups=e}toString(){var e,t,s,r;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
      ${this.audioTrack?`audioTrack: ${(t=this.audioTrack)==null?void 0:t.trackId};`:""}
      ${this.videoTrack?`videoTrack: ${(s=this.videoTrack)==null?void 0:s.trackId};`:""}
      groups: ${(r=this.groups)==null?void 0:r.join()}
    }`}},ry=class{};ry.makePeerId=()=>ks();var ay=class extends sy{constructor(e){super(Se(W({},e),{peerId:ry.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[],this.asRole=e.asRole}isInPreview(){return!!this.asRole}toString(){var e,t,s;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
      ${this.asRole?`asRole: ${this.asRole.name};`:""}
      ${this.audioTrack?`audioTrack: ${(t=this.audioTrack)==null?void 0:t.trackId};`:""}
      ${this.videoTrack?`videoTrack: ${(s=this.videoTrack)==null?void 0:s.trackId};`:""}
    }`}},ek=class extends sy{constructor(e){super(Se(W({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},Zr=(e,t)=>new ek({peerId:e.peer_id,name:e.info.name,role:t.getPolicyForRole(e.role),customerUserId:e.info.user_id,metadata:e.info.data,groups:e.groups,type:e.info.type}),tk=class{constructor(e,t,s){this.transport=e,this.store=t,this.options=s,this.isEnd=!1,this.iterator=null,this.total=0,this.defaultPaginationLimit=10}validateConnection(){if(!this.transport||!this.store)throw Error("Use usePaginatedParticipants or hmsActions.getPeerListIterator after preview or join has happened")}hasNext(){return!this.isEnd}getTotal(){return this.total}findPeers(){return y(this,null,function*(){var e;this.validateConnection();let t=yield this.transport.signal.findPeers(Se(W({},this.options||{}),{limit:((e=this.options)==null?void 0:e.limit)||this.defaultPaginationLimit}));return this.updateState(t),this.processPeers(t.peers)})}next(){return y(this,null,function*(){var e;this.validateConnection();let t;return!this.iterator&&!this.isEnd?yield this.findPeers():this.iterator?(t=yield this.transport.signal.peerIterNext({iterator:this.iterator,limit:((e=this.options)==null?void 0:e.limit)||this.defaultPaginationLimit}),this.updateState(t),this.processPeers(t.peers)):[]})}processPeers(e){let t=[];return e.forEach(s=>{let r=Zr(s,this.store);t.push(r)}),t}updateState(e){this.isEnd=e.eof,this.total=e.total,e.iterator&&(this.iterator=e.iterator)}},ly=class{constructor(e){this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){return y(this,null,function*(){this.audioContext.state==="suspended"&&(yield this.audioContext.resume(),k.d(this.TAG,"AudioContext is resumed"))})}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){this.audioContext.state!=="closed"&&this.audioContext.close().catch(e=>{k.d(this.TAG,"AudioContext close error",e.message)})}},Ch=class extends lu.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},ik=class extends Ch{constructor(){super(...arguments),this.audioElement=null,this.TAG="[PlaylistAudioManager]",this.seeked=!1}play(e){return y(this,null,function*(){return this.audioElement=this.getAudioElement(),new Promise((t,s)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let r=`Error loading ${e}`;k.e(this.TAG,r),this.stop(),s(r)},this.audioElement.oncanplaythrough=()=>y(this,null,function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let r=this.audioContextManager.getAudioTrack();this.track=r,t([r])}}catch(r){k.e(this.TAG,"Error playing audio",e,r.message),s(r)}}),this.audioElement.onseeked=()=>{this.seeked=!0}})})}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement||(this.audioElement=this.getAudioElement()),this.audioElement}stop(){var e,t,s;(e=this.audioElement)==null||e.pause(),(t=this.audioElement)==null||t.removeAttribute("src"),this.audioElement=null,(s=this.audioContextManager)==null||s.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new ly(e),e}},nk=class extends Ch{constructor(){super(...arguments),this.TAG="[PlaylistVideoManager]",this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,s;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&((s=this.canvasContext)==null||s.drawImage(this.videoElement,0,0,(e=this.canvas)==null?void 0:e.width,(t=this.canvas)==null?void 0:t.height),this.timer=setTimeout(()=>{this.drawImage()},1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((t,s)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let r=`Error loading ${e}`;k.e(this.TAG,r),this.stop(),s(r)},this.videoElement.oncanplaythrough=()=>y(this,null,function*(){var r,l,u;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,this.tracks.length===0){this.clearCanvasAndTracks();let d=this.canvas.captureStream();if(!d){k.e(this.TAG,"Browser does not support captureStream");return}this.videoElement.onplay=this.drawImage,yield this.audioContextManager.resumeContext(),yield this.videoElement.play();let h=this.audioContextManager.getAudioTrack();d.addTrack(h),d.getTracks().forEach(p=>{this.tracks.push(p)}),t(this.tracks)}else this.seeked?(this.seeked=!1,(u=this.canvasContext)==null||u.drawImage(this.videoElement,0,0,(r=this.canvas)==null?void 0:r.width,(l=this.canvas)==null?void 0:l.height)):(yield this.videoElement.play(),t(this.tracks))}catch(d){k.e(this.TAG,"Error playing video",e,d.message),s(d)}}),this.videoElement.onseeked=()=>{this.seeked=!0}})}getTracks(){return this.tracks.map(e=>e.id)}getElement(){return this.videoElement||(this.videoElement=this.getVideoElement()),this.videoElement}stop(){var e,t,s;(e=this.videoElement)==null||e.pause(),(t=this.videoElement)==null||t.removeAttribute("src"),this.videoElement=null,(s=this.audioContextManager)==null||s.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],(e=this.canvasContext)==null||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new ly(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}},Go={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},sk=class extends Ch{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:W({},Go.audio),video:W({},Go.video)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=s=>y(this,[s],function*({enabled:r,track:l}){var u;if(r)return;let d;l.source==="audioplaylist"&&(d="audio"),l.source==="videoplaylist"&&(d="video"),d&&((u=this.getElement(d))==null||u.pause())}),this.addTrack=(s,r)=>y(this,null,function*(){yield this.sdk.addTrack(s,r),k.d(this.TAG,"Playlist track added",Km(s))}),this.removeTrack=s=>y(this,null,function*(){yield this.sdk.removeTrack(s,!0),k.d(this.TAG,"Playlist track removed",s)}),this.audioManager=new ik,this.videoManager=new nk,this.addListeners()}getList(e="audio"){return this.state[e].list}setList(e){if(!e||e.length===0){k.w(this.TAG,"Please pass in a list of HMSPlaylistItem's");return}e.forEach(t=>{this.state[t.type].list.find(s=>s.id===t.id)||this.state[t.type].list.push(t)})}clearList(e){return y(this,null,function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]})}removeItem(e,t){return y(this,null,function*(){let{list:s,currentIndex:r}=this.state[t],l=s.findIndex(u=>e===u.id);return l>-1?(r===l&&this.isPlaying(t)&&(yield this.stop(t)),s.splice(l,1),!0):!1})}seek(e,t="audio"){let{currentIndex:s}=this.state[t];if(s===-1)throw Y.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");let r=this.getElement(t);if(r){let l=Math.max(r.currentTime+e,0);r.currentTime=Math.min(l,r.duration)}}seekTo(e,t="audio"){let{currentIndex:s}=this.state[t];if(s===-1)throw Y.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");if(e<0)throw Error("value cannot be negative");let r=this.getElement(t);r&&(r.currentTime=Math.min(e,r.duration))}setVolume(e,t="audio"){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let s=this.getElement(t);s&&(s.volume=e*.01)}getVolume(e="audio"){let t=this.getElement(e);return t?Math.floor(t.volume*100):0}getCurrentTime(e="audio"){let t=this.getElement(e);return(t==null?void 0:t.currentTime)||0}getCurrentIndex(e="audio"){return this.state[e].currentIndex}getCurrentProgress(e="audio"){var t;let{list:s,currentIndex:r}=this.state[e],l=(t=s[r])==null?void 0:t.url,u=this.getElement(e);return!l||!u?0:Math.floor(100*(u.currentTime/u.duration))}getCurrentSelection(e="audio"){let{list:t,currentIndex:s}=this.state[e];if(s!==-1)return t[s]}isPlaying(e="audio"){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e="audio",t){this.state[e].isAutoplayOn=t}getPlaybackRate(e="audio"){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e="audio",t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let s=this.getElement(e);s&&(s.playbackRate=t)}setEnabled(e,t){return y(this,arguments,function*(s,{id:r,type:l="audio"}){let u=this.state[l].list.findIndex(h=>h.id===r);if(!r||u===-1){k.w(this.TAG,"Pass a valid id");return}let d=this.state[l].list[u].url;s?yield this.play(d,l):yield this.pause(d,l),this.state[l].currentIndex=u,this.setDuration(l)})}playNext(){return y(this,arguments,function*(e="audio"){let{list:t,currentIndex:s}=this.state[e];if(s>=t.length-1)throw Y.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached end of playlist");yield this.play(t[s+1].url,e),this.state[e].currentIndex=s+1,this.setDuration(e)})}playPrevious(){return y(this,arguments,function*(e="audio"){let{list:t,currentIndex:s}=this.state[e];if(s<=0)throw Y.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached start of playlist");yield this.play(t[s-1].url,e),this.state[e].currentIndex=s-1,this.setDuration(e)})}stop(){return y(this,arguments,function*(e="audio"){var t;let s=e==="audio"?this.audioManager:this.videoManager;(t=s.getElement())==null||t.pause(),yield this.removeTracks(e),s.stop(),this.state[e].currentIndex=-1})}cleanup(){this.state={audio:W({},Go.audio),video:W({},Go.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",()=>{try{e({type:"video",progress:this.getCurrentProgress("video")})}catch{k.e(this.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",()=>{try{e({type:"audio",progress:this.getCurrentProgress("audio")})}catch{k.e(this.TAG,"Error in onProgress callback")}})}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e="audio"){return e==="audio"?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return y(this,arguments,function*(e="audio"){let t=(e==="audio"?this.audioManager:this.videoManager).getTracks();for(let s of t)yield this.removeTrack(s)})}play(e){return y(this,arguments,function*(t,s="audio"){let r=s==="audio"?this.audioManager:this.videoManager,l=r.getElement();if(this.isItemCurrentlyPlaying(t,s)){k.w(this.TAG,`The ${s} is currently playing`);return}if(l!=null&&l.src.includes(t))yield l.play();else{l==null||l.pause();let u=yield r.play(t);for(let d of u)yield this.addTrack(d,s==="audio"?"audioplaylist":"videoplaylist")}})}isItemCurrentlyPlaying(e,t){let s=this.getElement(t);return!!(s&&!s.paused&&s.src.includes(e))}setDuration(e="audio"){let t=this.getElement(e),{list:s,currentIndex:r}=this.state[e];s[r]&&(s[r].duration=(t==null?void 0:t.duration)||0),this.emit("newTrackStart",s[r])}pause(e){return y(this,arguments,function*(t,s="audio"){let r=this.getElement(s);r&&!r.paused&&r.src.includes(t)?(r.pause(),k.d(this.TAG,"paused url",t)):k.w(this.TAG,"The passed in url is not currently playing")})}addListeners(){this.audioManager.on("ended",()=>this.handleEnded("audio")),this.videoManager.on("ended",()=>this.handleEnded("video")),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return y(this,arguments,function*(e="audio"){let{list:t,currentIndex:s,isAutoplayOn:r}=this.state[e];s===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):r?this.playNext(e):yield this.pause(t[s].url,e),this.emit("currentTrackEnded",t[s])})}},Dt=e=>e.room,rk=e=>e.errors;Z(rk,e=>e.length===0?null:e.at(-1));Z(Dt,e=>e.id);var Ui=e=>e.peers,oy=e=>e.messages.byID,uy=e=>e.messages.allIDs,yt=e=>e.tracks,ak=e=>e.settings,lk=e=>e.appData,ok=e=>e.speakers,sr=Z([Dt],e=>e&&e.isConnected);Z([sr,Dt],(e,t)=>e?t.peerCount!==void 0?t.peerCount||1:t.peers.length:Math.max(t.peerCount!==void 0?t.peerCount:t.peers.length-1,0));var uk=e=>e.hideLocalPeer,du=Z([Dt,Ui,uk],(e,t,s)=>s?e.peers.filter(r=>e.localPeer!==r).map(r=>t[r]):e.peers.map(r=>t[r])),ck=Z(yt,e=>Object.values(e)),Ni=Z(Dt,Ui,(e,t)=>t[e.localPeer]),ea=Z(Dt,e=>e.localPeer);Z(Ni,e=>e==null?void 0:e.name);Z(Ni,e=>e==null?void 0:e.roleName);var xn=Z(Ni,e=>e==null?void 0:e.audioTrack),Wi=Z(Ni,e=>e==null?void 0:e.videoTrack),dk=Z(Ni,e=>e==null?void 0:e.auxiliaryTracks),hk=Z([xn,Wi,dk],(e,t,s)=>{let r=s?[...s]:[];return e&&r.unshift(e),t&&r.unshift(t),r});Z(du,e=>e.filter(t=>!t.isLocal));Z(Ui,ok,(e,t)=>{let s=Object.entries(t).sort((r,l)=>{var u,d;let h=((u=r[1])==null?void 0:u.audioLevel)||0;return(((d=l[1])==null?void 0:d.audioLevel)||0)>h?1:-1});if(s.length>0&&s[0][1].audioLevel&&s[0][1].audioLevel>0){let r=s[0][1].peerID;if(r in e)return e[r]}return null});var fk=e=>{let t=Ni(e);return zm(e,t==null?void 0:t.audioTrack)},Zd=e=>{let t=Ni(e);return zm(e,t==null?void 0:t.videoTrack)},pk=e=>{let t=Ni(e);return VT(e,t==null?void 0:t.videoTrack)},Hg=Z(Ni,yt,(e,t)=>{let{video:s,audio:r}=kl(t,e);return!!(s||r)}),vk=Z(Ui,yt,(e,t)=>{let s;for(let r in e){let l=e[r],{video:u,audio:d}=kl(t,l);if(u)return l;d&&!s&&(s=l)}return s});Z(vk,e=>!!e);Z(Ui,yt,(e,t)=>{for(let s in e){let r=e[s],{audio:l,video:u}=kl(t,r);if(!u&&l)return r}});Z(Ui,yt,(e,t)=>{let s=[],r=[];for(let l in e){let u=e[l],{video:d,audio:h}=kl(t,u);d?s.push(u):h&&r.push(u)}return s.concat(r)});Z(Ui,yt,(e,t)=>{for(let s in t){let r=t[s];if(mh(r)&&gh(r)&&r.peerId)return e[r.peerId]}});Z(Ui,yt,(e,t)=>{for(let s in t){let r=t[s];if(jm(r)&&r.peerId)return e[r.peerId]}});Z(ck,e=>e.filter(HT));Z(uy,e=>e.length);Z(oy,e=>Object.values(e).filter(t=>!t.read).length);var hu=Z(uy,oy,(e,t)=>{let s=[];return e.forEach(r=>{s.push(t[r])}),s}),gk=Z(hu,e=>e.filter(t=>{var s;return!t.recipientPeer&&!(t.recipientRoles&&((s=t.recipientRoles)==null?void 0:s.length)>0)}));Z(gk,e=>e.filter(t=>!t.read).length);var cn=Z([Dt],e=>e&&e.roomState),cy=Z(cn,e=>e==="Preview");Z(Dt,e=>e.roomState!=="Disconnected");Z(Dt,e=>!e.transcriptions||e.transcriptions.length<=0?!1:e.transcriptions.some(t=>t.mode==="caption"&&t.state==="started"));var na=e=>e.roles;Z([na],e=>Object.keys(e));var Rh=Z([Ni,na],(e,t)=>e!=null&&e.roleName?t[e.roleName]:null),mk=e=>{var t;return(t=e.preview)==null?void 0:t.asRole},yk=Z([mk,na],(e,t)=>e?t[e]:null);Z([Rh],e=>{var t;return(t=e==null?void 0:e.subscribeParams)!=null&&t.subscribeToRoles?e.subscribeParams.subscribeToRoles.length>0:!1});var bk=Z(Rh,e=>e==null?void 0:e.permissions);Z(Dt,e=>e.recording);Z(Dt,e=>e.rtmp);Z(Dt,e=>e.hls);Z(Dt,e=>e.transcriptions);Z(Dt,e=>e.sessionId);Z(Dt,e=>e.startedAt);Z(Dt,e=>!!e.isLargeRoom);Z(Dt,e=>!!e.isEffectsEnabled);Z(Dt,e=>!!e.isVBEnabled);Z(Dt,e=>e.effectsKey);var Sk=e=>e.polls;Z(du,e=>e.filter(t=>t.isHandRaised));var Tk=e=>e.whiteboards;Z(Tk,e=>Object.values(e)[0]);var dy=(e="audio")=>t=>t.playlist[e].list,_h=(e="audio")=>t=>t.playlist[e].selection,hy=(e="audio")=>Z(dy(e),t=>Object.values(t)),fy=(e="audio")=>Z(dy(e),_h(e),(t,s)=>{if(s.id)return t[s.id]}),kk={selection:_h("audio"),list:hy("audio"),selectedItem:fy("audio")},Ek={selection:_h("video"),list:hy("video"),selectedItem:fy("video")};function Wt(e){return t=>s=>e(s,t)}var dl="HMS-Store:",ke=class{static v(e,...t){this.log(0,e,...t)}static d(...e){this.log(1,...e)}static i(...e){this.log(2,...e)}static w(...e){this.log(3,...e)}static e(...e){this.log(6,...e)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:{console.log(dl,...t);break}case 1:{console.debug(dl,...t);break}case 2:{console.info(dl,...t);break}case 3:{console.warn(dl,...t);break}case 6:{console.error(dl,...t);break}case 4:{performance.mark(t[1]);break}case 5:{let s=t[0],r=t[1];try{let l=performance.measure(r,r);this.log(1,s,r,l==null?void 0:l.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(l){this.log(1,s,r,l)}break}}}};ke.level=0;var Ph=(e,t)=>t,El=(e,t)=>t,py=(e,t)=>t,Ak=(e,t)=>t,Ck=(e,t)=>t,Es=Z([Ui,Ph],(e,t)=>t?e[t]:null),Rk=Z([yt,El],(e,t)=>t?e[t]:null),_k=Z([yt,El],(e,t)=>{if(!t)return null;let s=e[t];return(s==null?void 0:s.type)==="video"?s:null});Z([yt,El],(e,t)=>{if(!t)return null;let s=e[t];return(s==null?void 0:s.type)==="audio"?s:null});Z([yt,El],(e,t)=>{if(!t)return null;let s=e[t];return(s==null?void 0:s.type)==="audio"&&(s==null?void 0:s.source)==="screen"?s:null});Z([yt,El],(e,t)=>{if(!t)return null;let s=e[t];return(s==null?void 0:s.type)==="video"&&(s==null?void 0:s.source)==="screen"?s:null});var Pk=Z([Sk,Ck],(e,t)=>t?e[t]:null),Un=Wt(Es);Wt(Z([lk,Ak],(e,t)=>{if(e)return t?e[t]:e}));Wt(Z(Es,e=>e==null?void 0:e.name));Wt(Z(Es,e=>e==null?void 0:e.type));var vy=Wt(Rk),gy=Wt(_k),Dk=Wt((e,t)=>{let s=Es(e,t);if(s&&s.audioTrack&&s.audioTrack!=="")return e.tracks[s.audioTrack]}),my=(e,t)=>t?e.speakers[t]:null;Wt(Z(my,e=>(e==null?void 0:e.audioLevel)||0));var wk=(e,t)=>{let s=Dk(t)(e);return my(e,s==null?void 0:s.id)};Wt(Z(wk,e=>(e==null?void 0:e.audioLevel)||0));Wt(Z(yt,Es,(e,t)=>{let s=t==null?void 0:t.auxiliaryTracks.find(r=>{let l=e[r];return mh(l)&&gh(l)});return s?e[s]:void 0}));Wt(Z(yt,Es,(e,t)=>{let s=t==null?void 0:t.auxiliaryTracks.find(r=>{let l=e[r];return mh(l)&&vh(l)});return s?e[s]:void 0}));Wt(Z(yt,Es,(e,t)=>{let s=t==null?void 0:t.auxiliaryTracks.find(r=>{let l=e[r];return jm(l)&&vh(l)});return s?e[s]:void 0}));Wt(Z(yt,Es,(e,t)=>kl(e,t)));var Mk=Z([hu,ea,Ph],(e,t,s)=>{if(s)return e.filter(r=>{var l;return!r.recipientPeer&&!((l=r.recipientRoles)!=null&&l.length)||r.sender&&![t,s].includes(r.sender)?!1:[t,s].includes(r.recipientPeer)})}),Ok=Z([hu,py],(e,t)=>{if(t)return e.filter(s=>{var r,l;return(r=s.recipientRoles)!=null&&r.length?(l=s.recipientRoles)==null?void 0:l.includes(t):!1})}),Lk=Z(hu,e=>e.filter(t=>{var s;return!t.recipientPeer&&!((s=t.recipientRoles)!=null&&s.length)}));Z([Ok,py],e=>e?e.filter(t=>!t.read).length:0);Z([Mk,Ph],e=>e?e.filter(t=>!t.read).length:0);Z(Lk,e=>e.filter(t=>!t.read).length);var Ik=Wt(Pk);Z([Ui,yt],(e,t)=>Object.values(e).map(s=>{var r;return{peer:s,isAudioEnabled:s.audioTrack?(r=t[s.audioTrack])==null?void 0:r.enabled:!1}}));var Nk=e=>e.roleChangeRequests[0]||null;Z([Nk,Ui,na],(e,t,s)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:s[e.roleName],token:e.token}:null);var Uk=Z([Rh],e=>Hm(e)),xk=Z([yk],e=>Hm(e));Z([Wi,yt],(e,t)=>{let s=null;return e&&(s=t[e]),(s==null?void 0:s.plugins)||[]});Z([xn,yt],(e,t)=>{let s=null;return e&&(s=t[e]),(s==null?void 0:s.plugins)||[]});var yy={0:"PEER_JOINED",1:"PEER_LEFT",8:"ROLE_UPDATED",10:"NAME_UPDATED",11:"METADATA_UPDATED",12:"HAND_RAISE_CHANGED"},eh={0:"TRACK_ADDED",1:"TRACK_REMOVED",2:"TRACK_MUTED",3:"TRACK_UNMUTED",5:"TRACK_DEGRADED",6:"TRACK_RESTORED",4:"TRACK_DESCRIPTION_CHANGED"},by={0:"POLL_CREATED",1:"POLL_STARTED",2:"POLL_STOPPED",4:"POLL_VOTES_UPDATED",3:"POLLS_LIST"},Bk={TRANSCRIPTION_STATE_UPDATED:"TRANSCRIPTION_STATE_UPDATED"},Od="hmsNotification",Gk=class{constructor(e){this.id=0,this.onNotification=(t,s)=>{let r=l=>{if(s){let u;if(Array.isArray(s)?u=s.includes(l.type):u=s===l.type,!u)return}t(l)};return this.eventEmitter.addListener(Od,r),()=>{this.eventEmitter.removeListener(Od,r)}},this.store=e,this.eventEmitter=new lu.EventEmitter2({maxListeners:Object.keys(Gm).length})}sendPlaylistTrackEnded(e){let t=this.createNotification("PLAYLIST_TRACK_ENDED",e,"info");this.emitEvent(t)}sendDeviceChange(e){var t;let s=this.createNotification("DEVICE_CHANGE_UPDATE",e,e.error?"error":"info",`Selected ${e.type} device - ${(t=e.selection)==null?void 0:t.label}`);this.emitEvent(s)}sendLeaveRoom(e){var t;let s=(t=e.requestedBy)==null?void 0:t.name,r=this.createNotification(e.roomEnded||!s?"ROOM_ENDED":"REMOVED_FROM_ROOM",e,"info",`${e.roomEnded?"Room ended":"Removed from room"} ${s?`by ${s}`:""}`);this.emitEvent(r)}sendPeerList(e){if(e.length===0)return;let t=this.createNotification("PEER_LIST",e,"info");this.emitEvent(t)}sendPeerUpdate(e,t){let s=this.store.getState(Un(t==null?void 0:t.id))||t,r=yy[e];if(r&&s){let l=this.createNotification(r,s,"info");this.emitEvent(l)}}sendTrackUpdate(e,t){let s=this.store.getState(vy(t)),r=eh[e];if(r){let l=this.createNotification(r,s,"info");this.emitEvent(l)}}sendMessageReceived(e){let t=this.createNotification("NEW_MESSAGE",e,"info");this.emitEvent(t)}sendError(e){let t=this.createNotification("ERROR",e,"error");this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification("RECONNECTING",e,"error");this.emitEvent(t)}sendReconnected(){let e=this.createNotification("RECONNECTED",null,"info");this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification("CHANGE_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification("CHANGE_MULTI_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendPollUpdate(e,t){let s=by[e],r=this.store.getState(Ik(t));if(s){let l=this.createNotification(s,r,"info");this.emitEvent(l)}}sendTranscriptionUpdate(e){let t=this.createNotification(Bk.TRANSCRIPTION_STATE_UPDATED,e,"info");this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(Od,e)}createNotification(e,t,s,r=""){return this.id++,{id:this.id,type:e,message:r,data:t,severity:s}}},jk=class{constructor(e){this.queuedUpdates={},this.timers={},this.DEFAULT_INTERVAL_MS=50,this.store=e}setState(e,t,s=this.DEFAULT_INTERVAL_MS){this.queuedUpdates[t]=this.queuedUpdates[t]||[],this.queuedUpdates[t].push(e),!this.timers[t]&&(window?this.timers[t]=window.setTimeout(()=>this.setStateBatched(t),s):this.setStateBatched(t))}setStateBatched(e){var t;if(((t=this.queuedUpdates[e])==null?void 0:t.length)>0){let s=r=>{this.queuedUpdates[e].forEach(l=>{try{l(r)}catch(u){ke.w("failed to update store",u)}})};console.time(`timed-${e}`),this.store.namedSetState(s,e),console.timeEnd(`timed-${e}`)}delete this.queuedUpdates[e],window&&this.timers[e]&&(window.clearTimeout(this.timers[e]),delete this.timers[e])}};function zk(e){return e instanceof ia||e instanceof yi}var Hk=(e,t)=>{let s=Al(Object.keys(e),Object.keys(t));for(let r of s){let l=e[r],u=t[r];sa(l,u)?(Xi(l.auxiliaryTracks,u.auxiliaryTracks)&&(u.auxiliaryTracks=l.auxiliaryTracks),l.groups&&Xi(l.groups,u.groups)&&(u.groups=l.groups),Object.assign(l,u)):Dh(l,u)?delete e[r]:fu(l,u)&&(e[r]=u)}},Vk=(e,t)=>{let s=Al(Object.keys(e),Object.keys(t));for(let r of s){let l=e[r],u=t[r];sa(l,u)?(Sy(l,u),Object.assign(l,u)):Dh(l,u)?delete e[r]:fu(l,u)&&(e[r]=u)}},qk=(e,t)=>{let s=Al(Object.keys(e),Object.keys(t));for(let r of s){let l=e[r],u=t[r];sa(l,u)?(l.questions&&Xi(l.questions,u.questions)&&(u.questions=l.questions),Object.assign(l,u)):fu(l,u)&&(e[r]=u)}},Vg=(e,t)=>{let s=Al(Object.keys(e),Object.keys(t));for(let r of s){let l=e[r],u=t[r];sa(l,u)?Object.assign(l,u):Dh(l,u)?delete e[r]:fu(l,u)&&(e[r]=u)}},Fk=(e,t,s)=>{let r=s.reduce((u,d)=>(u[d.firstTrackId]=Object.values(t[d.getTrackIDBeingSent()]||{}).sort((h,p)=>!h.rid||!p.rid?0:h.rid<p.rid?-1:1),u),{}),l=Al(Object.keys(e),Object.keys(r));for(let u of l){if(!r[u]){delete e[u];continue}e[u]=r[u]}},Sy=(e,t)=>{e.plugins&&Xi(e.plugins,t.plugins)&&(t.plugins=e.plugins),e.type==="video"&&e.layerDefinitions&&Xi(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},sa=(e,t)=>e&&t,Dh=(e,t)=>e&&!t,fu=(e,t)=>!e&&t,Xi=(e,t)=>{if(e===t||e.length===0&&(t==null?void 0:t.length)===0)return!0;if(!e||!t||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0},Al=(e,t)=>{let s=new Set;for(let r of e)s.add(r);for(let r of t)s.add(r);return Array.from(s)},rt=class ms{static convertPeer(t){var s,r,l;return{id:t.peerId,name:t.name,roleName:(s=t.role)==null?void 0:s.name,isLocal:t.isLocal,videoTrack:(r=t.videoTrack)==null?void 0:r.trackId,audioTrack:(l=t.audioTrack)==null?void 0:l.trackId,auxiliaryTracks:t.auxiliaryTracks.map(u=>u.trackId),customerUserId:t.customerUserId,metadata:t.metadata,joinedAt:t.joinedAt,groups:t.groups,isHandRaised:t.isHandRaised,type:t.type}}static convertTrack(t,s){let r={id:t.trackId,source:t.source,type:t.type,enabled:t.enabled,displayEnabled:t.enabled,peerId:t.peerId||s};return this.enrichTrack(r,t),r}static enrichTrack(t,s){let r=s.getMediaTrackSettings();s instanceof ia&&(t.volume=s.getVolume()||0),ms.updateDeviceID(t,s),ms.enrichLocalTrack(t,s),t.type==="video"&&(t.source==="screen"?(t.displaySurface=r.displaySurface,ms.enrichScreenTrack(t,s)):t.source==="regular"&&(t.facingMode=r.facingMode),t.height=r.height,t.width=r.width,ms.enrichVideoTrack(t,s)),ms.enrichPluginsDetails(t,s)}static enrichLocalTrack(t,s){(s instanceof Li||s instanceof nr)&&(t.isPublished=s.isPublished)}static updateDeviceID(t,s){var r;s instanceof Li||s instanceof nr?t.deviceID=s.settings.deviceId:t.deviceID=(r=s.getMediaTrackSettings())==null?void 0:r.deviceId}static enrichVideoTrack(t,s){s instanceof yi&&(t.layer=s.getLayer(),t.preferredLayer=s.getPreferredLayer(),t.degraded=s.degraded),(s instanceof yi||s instanceof Li)&&(Xi(s.getSimulcastDefinitions(),t.layerDefinitions)||(t.layerDefinitions=s.getSimulcastDefinitions()))}static enrichScreenTrack(t,s){var r,l;if(s instanceof Li){let u=(r=s.getCaptureHandle)==null?void 0:r.call(s);(u==null?void 0:u.handle)!==((l=t.captureHandle)==null?void 0:l.handle)&&(t.captureHandle=u),s.isCurrentTab&&(t.displaySurface="selfBrowser")}}static enrichPluginsDetails(t,s){(s instanceof Li||s instanceof nr)&&(Xi(s.getPlugins(),t.plugins)||(t.plugins=s.getPlugins()))}static convertRoom(t,s){let{recording:r,rtmp:l,hls:u,transcriptions:d}=ms.convertRecordingStreamingState(t.recording,t.rtmp,t.hls,t.transcriptions);return{id:t.id,name:t.name,localPeer:s,recording:r,rtmp:l,hls:u,transcriptions:d,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount,isLargeRoom:t.large_room_optimization,isEffectsEnabled:t.isEffectsEnabled,disableNoneLayerRequest:t.disableNoneLayerRequest,isVBEnabled:t.isVBEnabled,effectsKey:t.effectsKey,isHipaaEnabled:t.isHipaaEnabled,isNoiseCancellationEnabled:t.isNoiseCancellationEnabled}}static convertMessage(t,s){var r,l,u,d;return{sender:(r=t.peer)==null?void 0:r.peer_id,senderName:(l=t.peer)==null?void 0:l.info.name,senderRole:(u=t.peer)==null?void 0:u.role,senderUserId:(d=t.peer)==null?void 0:d.info.user_id,recipientPeer:t.private?s:void 0,recipientRoles:t.roles,time:new Date(t.timestamp),type:t.info.type,message:t.info.message,id:t.message_id}}static convertRoles(t){let s={};return t&&t.forEach(r=>{s[r.name]=r}),s}static convertRoleChangeRequest(t){var s;return{requestedBy:(s=t.requestedBy)==null?void 0:s.peerId,roleName:t.role.name,token:t.token}}static convertException(t){let s="trackType"in t,r={code:t.code,action:t.action,name:t.name,message:t.message,description:t.description,isTerminal:t.isTerminal,nativeError:t.nativeError,timestamp:new Date};return s&&(r.trackType=t==null?void 0:t.trackType),r}static convertDeviceChangeUpdate(t){let s={devices:t.devices,selection:t.selection,type:t.type};return t.error&&(s.error=this.convertException(t.error)),s}static convertPlaylist(t){let s=this.getConvertedPlaylistType(t,"audio"),r=this.getConvertedPlaylistType(t,"video");return{audio:s,video:r}}static convertPlaylistItem(t,s){let r=s.type,l=t.getCurrentSelection(r),u=t.isPlaying(r),d=s.url===(l==null?void 0:l.url);return Se(W({},s),{type:s.type,selected:d,playing:d&&u})}static getConvertedPlaylistType(t,s){let r={},l=t.getCurrentSelection(s),u=t.getCurrentProgress(s),d=t.getVolume(s),h=t.getList(s),p=t.getCurrentIndex(s);return t.getList(s).forEach(v=>{r[v.id]=ms.convertPlaylistItem(t,v)}),{list:r,selection:{id:l==null?void 0:l.id,hasPrevious:p>0,hasNext:p<h.length-1},progress:u,volume:d,currentTime:t.getCurrentTime(s),playbackRate:t.getPlaybackRate(s)}}static convertRecordingStreamingState(t,s,r,l){var u;return{recording:{browser:W({running:!1},t==null?void 0:t.browser),server:W({running:!1},t==null?void 0:t.server),hls:W({running:!1},t==null?void 0:t.hls)},rtmp:W({running:!1},s),hls:{variants:((u=r==null?void 0:r.variants)==null?void 0:u.map(d=>d))||[],running:!!(r!=null&&r.running),error:r==null?void 0:r.error},transcriptions:l||[]}}},qg=class{constructor(e,t,s,r){this.playlistManager=e,this.syncPlaylistState=s,this.store=r,this.type=t}play(e){return y(this,null,function*(){if(!e){ke.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return y(this,null,function*(){let e=this.type==="audio"?kk:Ek,t=this.store.getState(e.selection);if(!t.id){ke.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return y(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return y(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return y(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return y(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t})}clearList(){return y(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)})}},$k=class{constructor(e,t){this.sdk=e,this.setLocally=t}get sdkSessionStore(){return this.sdk.getSessionStore()}set(e,t){return y(this,null,function*(){let{value:s}=yield this.sdkSessionStore.set(String(e),t);this.setLocally({key:e,value:s})})}observe(e){return y(this,null,function*(){let t=Array.isArray(e)?e.map(s=>String(s)):[String(e)];yield this.sdkSessionStore.observe(t)})}unobserve(e){return y(this,null,function*(){let t=Array.isArray(e)?e.map(s=>String(s)):[String(e)];yield this.sdkSessionStore.unobserve(t)})}},Yk=class{constructor(e,t){this.TAG="[BeamSpeakerLabelsLogger]",this.intervalMs=100,this.shouldMonitor=!1,this.hasStarted=!1,this.unsubs=[],this.analysers={},this.store=e,this.actions=t}start(){return y(this,null,function*(){if(this.hasStarted)return;this.hasStarted=!0,ke.d("starting audio level monitor for remote peers",this.store);let e=this.store.getState(sr);ke.d("starting audio levels is connected to room",e),e&&(yield this.monitorAudioLevels());let t=this.store.subscribe(this.monitorAudioLevels.bind(this),sr);this.unsubs.push(t)})}stop(){return y(this,null,function*(){this.hasStarted&&(this.hasStarted=!1,this.shouldMonitor=!1,this.unsubs.forEach(e=>e()),ke.d("stopped audio level monitor for remote peers"))})}monitorAudioLevels(){return y(this,null,function*(){if(!this.store.getState(sr)){this.shouldMonitor&&(ke.i("room no longer connected, stopping audio level monitoring for remote"),this.shouldMonitor=!1);return}if(this.shouldMonitor)return;ke.i("monitoring audio levels"),this.shouldMonitor=!0;let e=()=>{this.shouldMonitor?(this.logAllPeersAudioLevels(),setTimeout(e,this.intervalMs)):ke.i("stopped monitoring audio levels")};setTimeout(e,1e3)})}logAllPeersAudioLevels(){return y(this,null,function*(){var e;if(!window.__triggerBeamEvent__)return;let t=this.store.getState(du),s=t.filter(l=>!!l.audioTrack);ke.d(this.TAG,"Peers Without audio track",t.filter(l=>!l.audioTrack).map(l=>l.id).join(","));let r=[];for(let l of s){let u=this.actions.getTrackById(l.audioTrack||""),d=(e=u==null?void 0:u.stream)==null?void 0:e.nativeStream;if(l.joinedAt&&d){let h=yield this.getAudioLevel(l,d);ke.d(this.TAG,l.id,h),h.level>0&&r.push(h)}}if(r.length>0){let l={event:"app-audio-level",data:r};ke.d("logging audio levels",JSON.stringify(r)),window.__triggerBeamEvent__(JSON.stringify(l))}})}getAudioLevel(e,t){return y(this,null,function*(){this.analysers[t.id]||(this.analysers[t.id]=this.createAnalyserNode(t));let s=this.analysers[t.id],r=this.calculateAudioLevel(s);return{peerId:e.id,peerName:e.name,level:r}})}createAnalyserNode(e){this.audioContext||(this.audioContext=new AudioContext);let t=this.audioContext.createAnalyser();return this.audioContext.createMediaStreamSource(e).connect(t),t}calculateAudioLevel(e){let t=new Uint8Array(e.fftSize);e.getByteTimeDomainData(t);let s=.009,r=s;for(let u of t)r=Math.max(r,(u-128)/128);let l=(Math.log(s)-Math.log(r))/Math.log(s);return Math.ceil(Math.min(Math.max(l*100,0),100))}},Kk=2e4,Qk=1e4,hl={name:"diagnostics-role",priority:1,publishParams:{allowed:["audio","video"],audio:{bitRate:32,codec:"opus"},video:{bitRate:100,codec:"vp8",frameRate:30,height:720,width:1280},screen:{bitRate:100,codec:"vp8",frameRate:10,height:1080,width:1920}},subscribeParams:{subscribeToRoles:[],maxSubsBitRate:3200},permissions:{browserRecording:!1,changeRole:!1,endRoom:!1,hlsStreaming:!1,mute:!1,pollRead:!1,pollWrite:!1,removeOthers:!1,rtmpStreaming:!1,unmute:!1}},Wk="https://100ms.live/test-audio.wav",Jk=class{constructor(){this.networkScores=[],this.lastPushedAt=0}pushScore(e){!e||e<0||(this.networkScores.length===0?(this.networkScores.push(e),this.lastPushedAt=Date.now()):this.addPendingCQSTillNow())}addPendingCQSTillNow(){if(this.networkScores.length>0){let e=(Date.now()-this.lastPushedAt)/1e3;for(;e>0;)this.networkScores.push(this.networkScores[this.networkScores.length-1]),e-=1;this.lastPushedAt=Date.now()}}getCQS(){return this.networkScores.reduce((e,t)=>e+t,0)/this.networkScores.length}},Xk=e=>!!e&&!isNaN(e),gi=e=>e[e.length-1],gs=(e,t)=>{let s=e.filter(r=>Xk(t(r)));return s.reduce((r,l)=>r+(t(l)||0),0)/s.length},Zk=class{constructor(e){this.sdk=e,this.peerStatsList=[],this.localAudioTrackStatsList=[],this.localVideoTrackStatsList=[],this.remoteAudioTrackStatsList=[],this.remoteVideoTrackStatsList=[]}handleStatsUpdate(e){return y(this,null,function*(){var t,s,r,l,u,d,h,p;let v=e.getLocalPeerStats();v&&this.peerStatsList.push(v);let g=(r=(s=(t=this.sdk.getLocalPeer())==null?void 0:t.audioTrack)==null?void 0:s.nativeTrack)==null?void 0:r.id,b=(d=(u=(l=this.sdk.getLocalPeer())==null?void 0:l.videoTrack)==null?void 0:u.nativeTrack)==null?void 0:d.id,S=e.getLocalTrackStats();S&&(g&&this.localAudioTrackStatsList.push(S[g]),b&&this.localVideoTrackStatsList.push(S[b]));let C=yield(p=(h=this.sdk.getWebrtcInternals())==null?void 0:h.getSubscribePeerConnection())==null?void 0:p.getStats();C==null||C.forEach(D=>{if(D.type==="inbound-rtp"){let M=D.kind==="audio"?this.remoteAudioTrackStatsList:this.remoteVideoTrackStatsList,j=cu("bytesReceived",D,gi(M));M.push(Se(W({},D),{bitrate:j}))}})})}buildReport(){var e,t,s,r,l,u,d,h,p,v;let g=(e=gi(this.peerStatsList))==null?void 0:e.publish,b=(t=gi(this.peerStatsList))==null?void 0:t.subscribe,S=g!=null&&g.responsesReceived?((g==null?void 0:g.totalRoundTripTime)||0)/g.responsesReceived:0,C=b!=null&&b.responsesReceived?((b==null?void 0:b.totalRoundTripTime)||0)/b.responsesReceived:0,D=Number(((S+C)/2*1e3).toFixed(2)),M=((s=gi(this.remoteAudioTrackStatsList))==null?void 0:s.packetsReceived)||0,j=((r=gi(this.remoteVideoTrackStatsList))==null?void 0:r.packetsReceived)||0,le=this.localAudioTrackStatsList.map(we=>we?gs(Object.values(we),ee=>ee.bitrate):0),oe=this.localVideoTrackStatsList.map(we=>we?gs(Object.values(we),ee=>ee.bitrate):0),ie=((l=gi(this.remoteAudioTrackStatsList))==null?void 0:l.jitter)||0,se=((u=gi(this.remoteVideoTrackStatsList))==null?void 0:u.jitter)||0,ae=Math.max(ie,se),Ne=gi(this.localAudioTrackStatsList),nt=gi(this.localVideoTrackStatsList);return{combined:{roundTripTime:D,packetsReceived:M+j,packetsLost:(b==null?void 0:b.packetsLost)||0,bytesSent:(g==null?void 0:g.bytesSent)||0,bytesReceived:(b==null?void 0:b.bytesReceived)||0,bitrateSent:gs(this.peerStatsList,we=>{var ee;return(ee=we.publish)==null?void 0:ee.bitrate}),bitrateReceived:gs(this.peerStatsList,we=>{var ee;return(ee=we.subscribe)==null?void 0:ee.bitrate}),jitter:ae},audio:{roundTripTime:D,packetsReceived:M,packetsLost:((d=gi(this.remoteAudioTrackStatsList))==null?void 0:d.packetsLost)||0,bytesReceived:((h=gi(this.remoteAudioTrackStatsList))==null?void 0:h.bytesReceived)||0,bitrateSent:gs(le,we=>we),bitrateReceived:gs(this.remoteAudioTrackStatsList,we=>we.bitrate),bytesSent:Ne?Object.values(Ne).reduce((we,ee)=>we+(ee.bytesSent||0),0):0,jitter:ie},video:{roundTripTime:D,packetsLost:((p=gi(this.remoteVideoTrackStatsList))==null?void 0:p.packetsLost)||0,bytesReceived:((v=gi(this.remoteVideoTrackStatsList))==null?void 0:v.bytesReceived)||0,packetsReceived:j,bitrateSent:gs(oe,we=>we),bitrateReceived:gs(this.remoteVideoTrackStatsList,we=>we.bitrate),bytesSent:nt?Object.values(nt).reduce((we,ee)=>we+(ee.bytesSent||0),0):0,jitter:se}}}},eE=(e=>(e[e.STARTING=0]="STARTING",e[e.INIT_FETCHED=1]="INIT_FETCHED",e[e.SIGNAL_CONNECTED=2]="SIGNAL_CONNECTED",e[e.ICE_ESTABLISHED=3]="ICE_ESTABLISHED",e[e.MEDIA_CAPTURED=4]="MEDIA_CAPTURED",e[e.MEDIA_PUBLISHED=5]="MEDIA_PUBLISHED",e[e.COMPLETED=6]="COMPLETED",e))(eE||{}),Fg,$g,tE=class{constructor(e,t,s,r,l=Kk){this.sdk=e,this.sdkListener=t,this.progressCallback=s,this.completionCallback=r,this.connectivityDuration=l,this.wsConnected=!1,this.initConnected=!1,this.isPublishICEConnected=!1,this.isSubscribeICEConnected=!1,this.gatheredPublishICECandidates=[],this.gatheredSubscribeICECandidates=[],this.errors=[],this.isAudioTrackCaptured=!1,this.isVideoTrackCaptured=!1,this.isAudioTrackPublished=!1,this.isVideoTrackPublished=!1,this.cqsCalculator=new Jk,this.timestamp=Date.now(),this.onRoomUpdate=this.sdkListener.onRoomUpdate.bind(this.sdkListener),this.onPeerUpdate=this.sdkListener.onPeerUpdate.bind(this.sdkListener),this.onMessageReceived=this.sdkListener.onMessageReceived.bind(this.sdkListener),this.onReconnected=this.sdkListener.onReconnected.bind(this.sdkListener),this.onRoleChangeRequest=this.sdkListener.onRoleChangeRequest.bind(this.sdkListener),this.onRoleUpdate=this.sdkListener.onRoleUpdate.bind(this.sdkListener),this.onChangeTrackStateRequest=this.sdkListener.onChangeTrackStateRequest.bind(this.sdkListener),this.onChangeMultiTrackStateRequest=this.sdkListener.onChangeMultiTrackStateRequest.bind(this.sdkListener),this.onRemovedFromRoom=this.sdkListener.onRemovedFromRoom.bind(this.sdkListener),this.onNetworkQuality=(Fg=this.sdkListener.onNetworkQuality)==null?void 0:Fg.bind(this.sdkListener),this.onPreview=this.sdkListener.onPreview.bind(this.sdkListener),this.onDeviceChange=($g=this.sdkListener.onDeviceChange)==null?void 0:$g.bind(this.sdkListener),this.onSessionStoreUpdate=this.sdkListener.onSessionStoreUpdate.bind(this.sdkListener),this.onPollsUpdate=this.sdkListener.onPollsUpdate.bind(this.sdkListener),this.onWhiteboardUpdate=this.sdkListener.onWhiteboardUpdate.bind(this.sdkListener),this.handleConnectionQualityUpdate=u=>{let d=u.find(h=>{var p,v;return h.peerID===((v=(p=this.sdk)==null?void 0:p.store.getLocalPeer())==null?void 0:v.peerId)});this.cqsCalculator.pushScore(d==null?void 0:d.downlinkQuality)},this.statsCollector=new Zk(e),this.state=0}get state(){return this._state}set state(e){var t;e===void 0||this._state!==void 0&&e<this._state||(this._state=e,(t=this.progressCallback)==null||t.call(this,e))}onICESuccess(e){e?this.isPublishICEConnected=!0:this.isSubscribeICEConnected=!0,this.isPublishICEConnected&&this.isSubscribeICEConnected&&(this.state=3)}onSelectedICECandidatePairChange(e,t){t?this.selectedPublishICECandidate=e:this.selectedSubscribeICECandidate=e}onICECandidate(e,t){t?this.gatheredPublishICECandidates.push(e):this.gatheredSubscribeICECandidates.push(e)}onMediaPublished(e){switch(e.type){case"audio":this.isAudioTrackPublished=!0;break;case"video":this.isVideoTrackPublished=!0;break}this.isVideoTrackPublished&&this.isAudioTrackPublished&&(this.state=5)}onInitSuccess(e){this.websocketURL=e,this.initConnected=!0,this.state=1}onSignallingSuccess(){this.wsConnected=!0,this.state=2}onJoin(e){var t,s;this.sdkListener.onJoin(e),(t=this.sdk.getWebrtcInternals())==null||t.onStatsChange(r=>this.statsCollector.handleStatsUpdate(r)),(s=this.sdk.getWebrtcInternals())==null||s.start(),this.cleanupTimer=window.setTimeout(()=>{this.cleanupAndReport()},this.connectivityDuration)}onError(e){this.sdkListener.onError(e),this.errors.push(e),e!=null&&e.isTerminal&&this.cleanupAndReport()}onTrackUpdate(e,t,s){if(this.sdkListener.onTrackUpdate(e,t,s),s.isLocal&&e===0){switch(t.type){case"audio":this.isAudioTrackCaptured=!0;break;case"video":this.isVideoTrackCaptured=!0;break}this.isVideoTrackCaptured&&this.isAudioTrackCaptured&&(this.state=4)}}onReconnecting(e){this.sdkListener.onReconnecting(e),this.cqsCalculator.addPendingCQSTillNow()}cleanupAndReport(){var e;clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0,this.state===5&&(this.state=6),(e=this.completionCallback)==null||e.call(this,this.buildReport()),this.sdk.leave()}buildReport(){this.cqsCalculator.addPendingCQSTillNow();let e=this.cqsCalculator.getCQS(),t=this.statsCollector.buildReport();return{testTimestamp:this.timestamp,connectivityState:this.state,errors:this.errors,signallingReport:{isConnected:this.wsConnected,isInitConnected:this.initConnected,websocketUrl:this.websocketURL},mediaServerReport:{stats:t,connectionQualityScore:e,isPublishICEConnected:this.isPublishICEConnected,isSubscribeICEConnected:this.isSubscribeICEConnected,publishICECandidatePairSelected:this.selectedPublishICECandidate,subscribeICECandidatePairSelected:this.selectedSubscribeICECandidate,publishIceCandidatesGathered:this.gatheredPublishICECandidates,subscribeIceCandidatesGathered:this.gatheredSubscribeICECandidates}}}},Ty=class{constructor(e){this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]},this.transcriptions=[],this.id=e}},ky=(e,t,s)=>y(void 0,null,function*(){let r=Error("something went wrong during fetch");for(let l=0;l<4;l++)try{let u=yield fetch(e,t),d=yield u.clone().json();if(s&&s.length&&!u.ok&&s.includes(d.code))throw Y.APIErrors.ServerErrors(d.code,"GET_TOKEN",d.message,!1);return u}catch(u){r=u}throw["Failed to fetch","NetworkError"].some(l=>r.message.includes(l))?Y.APIErrors.EndpointUnreachable("GET_TOKEN",r.message):r}),iE=class{constructor(e,t){this.sdk=e,this.sdkListener=t,this.recordedAudio=Wk,this.sdk.setIsDiagnostics(!0),this.initSdkWithLocalPeer()}get localPeer(){var e;return(e=this.sdk)==null?void 0:e.store.getLocalPeer()}checkBrowserSupport(){Yd(),$d()}requestPermission(e){return y(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia(e);return t.getTracks().forEach(s=>s.stop()),yield this.sdk.deviceManager.init(!0),{audio:t.getAudioTracks().length>0,video:t.getVideoTracks().length>0}}catch(t){throw Sl(t,this.sdk.localTrackManager.getErrorType(!!e.video,!!e.audio))}})}startCameraCheck(e){return y(this,null,function*(){var t,s,r,l;if(this.initSdkWithLocalPeer(),!this.localPeer)throw new Error("Local peer not found");this.sdk.store.setSimulcastEnabled(!1),this.localPeer.role=Se(W({},hl),{publishParams:Se(W({},hl.publishParams),{allowed:["video"]})});let u=new tu().video(new Ss().deviceId(e||"default").build()).build(),d=yield(t=this.sdk)==null?void 0:t.localTrackManager.getLocalTracks({audio:!1,video:!0},u),h=d==null?void 0:d.find(p=>p.type==="video");if(!h)throw new Error("No video track found");(s=this.sdk)==null||s.deviceManager.init(!0),this.localPeer.videoTrack=h,(l=(r=this.sdk)==null?void 0:r.listener)==null||l.onPeerUpdate(9,[this.localPeer])})}stopCameraCheck(){var e,t;(t=(e=this.localPeer)==null?void 0:e.videoTrack)==null||t.cleanup(),this.localPeer&&(this.localPeer.videoTrack=void 0)}startMicCheck(e){return y(this,arguments,function*({inputDevice:t,onError:s,onStop:r,time:l=Qk}){var u,d,h,p;this.initSdkWithLocalPeer(S=>{this.stopMicCheck(),s==null||s(S)});let v=yield this.getLocalAudioTrack(t);if((u=this.sdk)==null||u.deviceManager.init(!0),!this.localPeer)throw new Error("Local peer not found");if(!v)throw new Error("No audio track found");this.localPeer.audioTrack=v,(d=this.sdk)==null||d.initPreviewTrackAudioLevelMonitor(),(p=(h=this.sdk)==null?void 0:h.listener)==null||p.onPeerUpdate(9,[this.localPeer]),this.mediaRecorder=new MediaRecorder(v.stream.nativeStream);let g=[];this.mediaRecorder.ondataavailable=function(S){g.push(S.data)},this.mediaRecorder.onstop=()=>{var S,C;let D=new Blob(g,{type:(S=this.mediaRecorder)==null?void 0:S.mimeType});this.recordedAudio=URL.createObjectURL(D),(C=this.onStopMicCheck)==null||C.call(this)},this.mediaRecorder.start();let b=setTimeout(()=>{this.stopMicCheck()},l);this.onStopMicCheck=()=>{clearTimeout(b),r==null||r()}})}stopMicCheck(){var e,t,s;(e=this.mediaRecorder)==null||e.stop(),(s=(t=this.localPeer)==null?void 0:t.audioTrack)==null||s.cleanup(),this.localPeer&&(this.localPeer.audioTrack=void 0)}getRecordedAudio(){return this.recordedAudio}startConnectivityCheck(e,t,s,r){return y(this,null,function*(){if(!this.sdk)throw new Error("SDK not found");this.connectivityCheck=new tE(this.sdk,this.sdkListener,e,t,r);let l=yield this.getAuthToken(s);yield this.sdk.leave(),yield this.sdk.join({authToken:l,userName:"diagnostics-test"},this.connectivityCheck),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:u=>{var d;(d=this.connectivityCheck)==null||d.handleConnectionQualityUpdate(u)}})})}stopConnectivityCheck(){return y(this,null,function*(){var e;return(e=this.connectivityCheck)==null?void 0:e.cleanupAndReport()})}initSdkWithLocalPeer(e){var t,s,r;this.sdkListener&&((t=this.sdk)==null||t.initStoreAndManagers(Se(W({},this.sdkListener),{onError:d=>{e==null||e(d),this.sdkListener.onError(d)}})));let l=new ay({name:"diagnostics-peer",role:hl,type:"regular"});(s=this.sdk)==null||s.store.addPeer(l);let u=new Ty("diagnostics-room");this.sdk.store.setRoom(u),this.sdkListener.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",u),(r=this.sdk)==null||r.deviceManager.init(!0)}getAuthToken(e){return y(this,null,function*(){let t=new URL("https://api.100ms.live/v2/diagnostics/token");e&&t.searchParams.append("region",e);let s=yield ky(t.toString(),{method:"GET"},[429,500,501,502,503,504,505,506,507,508,509,510,511]),r=yield s.json();if(!s.ok)throw Y.APIErrors.ServerErrors(r.code,"GET_TOKEN",r.message,!1);let{token:l}=r;if(!l)throw Error(r.message);return l})}getLocalAudioTrack(e){return y(this,null,function*(){var t;if(!this.localPeer)return;this.localPeer.role=Se(W({},hl),{publishParams:Se(W({},hl.publishParams),{allowed:["audio"]})});let s=new tu().audio(new jn().deviceId(e||"default").build()).build(),r=yield(t=this.sdk)==null?void 0:t.localTrackManager.getLocalTracks({audio:!0,video:!1},s);return r==null?void 0:r.find(l=>l.type==="audio")})}},nE=class{constructor(e,t,s){this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:r,progress:l})=>{this.setState(u=>{u.playlist[r].progress=l,u.playlist[r].currentTime=this.sdk.getPlaylistManager().getCurrentTime(r)},"playlistProgress")},this.syncPlaylistState=r=>{this.setState(l=>{Object.assign(l.playlist,rt.convertPlaylist(this.sdk.getPlaylistManager()))},r)},this.sendPeerUpdateNotification=(r,l)=>{let u=this.store.getState(Un(l.peerId)),d=yy[r]||"peerUpdate";if(r===8)this.syncRoomState(d),this.updateMidCallPreviewRoomState(r,l);else if([0,1].includes(r))this.syncRoomState(d),u||(u=this.store.getState(Un(l.peerId)));else if([12,13,14].includes(r))this.syncRoomState(d),u||(u=this.store.getState(Un(l.peerId)));else{let h=rt.convertPeer(l);this.setState(p=>{let v=p.peers[h.id];sa(v,h)&&(Xi(v.auxiliaryTracks,h.auxiliaryTracks)&&(v.auxiliaryTracks=h.auxiliaryTracks),Object.assign(v,h)),u=h},d)}this.hmsNotifications.sendPeerUpdate(r,u)},this.getSDKHMSPeer=r=>this.sdk.getPeerMap()[r],this.setState=(r,l)=>this.store.namedSetState(r,l),this.store=e,this.sdk=t,this.hmsNotifications=s,this.sessionStore=new $k(this.sdk,this.setSessionStoreValueLocally.bind(this)),this.actionBatcher=new jk(e)}submitSessionFeedback(e,t){return this.sdk.submitSessionFeedback(e,t)}getLocalTrack(e){return this.sdk.store.getLocalPeerTracks().find(t=>t.trackId===e)}get interactivityCenter(){return this.sdk.getInteractivityCenter()}setPlaylistSettings(e){this.sdk.updatePlaylistSettings(e)}refreshDevices(){return y(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return y(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){return y(this,null,function*(){t?yield this.setTrackVolume(e,t):(yield this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))})}setAudioOutputDevice(e){return y(this,null,function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState(t=>{t.settings.audioOutputDeviceId=e},"setAudioOutputDevice")})}setPreferredLayer(e,t){return y(this,null,function*(){var s;let r=this.getTrackById(e);if(r)if(r instanceof yi){if(t==="none"){ke.d("layer none will be ignored");return}if(((s=this.store.getState(gy(e)))==null?void 0:s.preferredLayer)===t){ke.d(`preferred layer is already ${t}`);return}this.setState(l=>{let u=l.tracks[e];u&&(u.preferredLayer=t)},"setPreferredLayer"),yield r.setPreferredLayer(t)}else ke.d(`track ${e} is not a remote video track`);else this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)})}getNativeTrackById(e){var t;return(t=this.sdk.store.getTrackById(e))==null?void 0:t.nativeTrack}getTrackById(e){return this.sdk.store.getTrackById(e)}getAuthTokenByRoomCode(e,t){return this.sdk.getAuthTokenByRoomCode(e,t)}preview(e){return y(this,null,function*(){let t=this.store.getState(cn);if(t==="Preview"||t==="Connecting"){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{t!=="Connected"&&this.setState(s=>{s.room.roomState="Connecting"},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(s){throw ke.e("Cannot show preview. Failed to connect to room - ",s),s}})}cancelMidCallPreview(){return y(this,null,function*(){return this.sdk.cancelMidCallPreview()})}join(e){return y(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState="Connecting"},"join"),yield this.sdkJoinWithListeners(e)}catch(t){throw this.isRoomJoinCalled=!1,ke.e("Failed to connect to room - ",t),t}})}leave(){return y(this,null,function*(){let e=this.store.getState(sr),t=!0;e||(t=!1,this.logPossibleInconsistency("room leave is called when no room is connected"));let s=this.store.getState(cn);return this.setState(r=>{r.room.roomState="Disconnecting"},"leaving"),this.sdk.leave(t).then(()=>{this.resetState("leave"),this.beamSpeakerLabelsLogger&&this.beamSpeakerLabelsLogger.stop().catch(ke.e),ke.i("left room")}).catch(r=>{ke.e("error in leaving room - ",r),this.setState(l=>{l.room.roomState=s},"revertLeave")})})}setScreenShareEnabled(e,t){return y(this,null,function*(){typeof t=="boolean"&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(s){throw this.hmsNotifications.sendError(rt.convertException(s)),s}})}addTrack(e,t="regular"){return y(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return y(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return y(this,null,function*(){let t=this.store.getState(xn);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return y(this,null,function*(){let t=this.store.getState(Wi);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return y(this,null,function*(){var s;if(((s=this.store.getState().tracks[e])==null?void 0:s.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(l=>{l.tracks[e]?l.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(l){throw this.setState(u=>{u.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(rt.convertException(l)),l}let r=t?3:2;this.hmsNotifications.sendTrackUpdate(r,e)})}setAudioSettings(e){return y(this,null,function*(){let t=this.store.getState(xn);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return y(this,null,function*(){let t=this.store.getState(Wi);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}switchCamera(){return y(this,null,function*(){let e=this.store.getState(Wi);if(e){let t=this.sdk.store.getLocalPeerTracks().find(s=>s.trackId===e);t&&(yield t.switchCamera(),this.syncRoomState("switchCamera"))}})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return y(this,null,function*(){let{message_id:s,timestamp:r}=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore({message:e,type:t,id:s,time:r})})}sendGroupMessage(e,t,s){return y(this,null,function*(){let r=this.store.getState(na),l=t.map(h=>r[h]),{message_id:u,timestamp:d}=yield this.sdk.sendGroupMessage(e,l,s);this.updateMessageInStore({message:e,recipientRoles:t,type:s,id:u,time:d})})}sendDirectMessage(e,t,s){return y(this,null,function*(){let{message_id:r,timestamp:l}=yield this.sdk.sendDirectMessage(e,t,s);this.updateMessageInStore({message:e,recipientPeer:t,type:s,id:r,time:l})})}updateMessageInStore(e){var t;if(!e.message)throw ke.w("sendMessage","Failed to send message",e),Error(`sendMessage Failed - ${JSON.stringify(e)}`);if(e.type&&this.ignoredMessageTypes.includes(e.type))return;let s=this.sdk.getLocalPeer(),r={read:!0,id:e.id,time:new Date(e.time),message:e.message,type:e.type||"chat",recipientPeer:e.recipientPeer,recipientRoles:e.recipientRoles,senderName:s==null?void 0:s.name,sender:s==null?void 0:s.peerId,senderRole:(t=s==null?void 0:s.role)==null?void 0:t.name,ignored:!1};this.setState(l=>{l.messages.byID[r.id]=r,l.messages.allIDs.push(r.id)},"newMessage")}setMessageRead(e,t){this.setState(s=>{t?s.messages.byID[t]?s.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):s.messages.allIDs.forEach(r=>{s.messages.byID[r].read=e})},"setMessageRead")}attachVideo(e,t){return y(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(s=>{let r=this.store.subscribe(l=>y(this,null,function*(){l&&(yield this.attachVideoInternal(e,t),r(),s())}),Zd)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return y(this,null,function*(){let s=this.getTrackById(e);(s==null?void 0:s.type)==="video"?yield this.sdk.detachVideo(s,t):(t&&(t.srcObject=null),ke.d("possible inconsistency detected - no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return y(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginsToVideoStream(e){return y(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"add")})}removePluginsFromVideoStream(e){return y(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"remove")})}addPluginToAudioTrack(e){return y(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={};if(t.isSupported=!1,!e)return ke.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let s=this.store.getState(Wi);if(!s)return ke.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let r=this.getTrackById(s);return r?t=r.validatePlugin(e):(ke.w(`track ${s} not present, unable to validate plugin`),t.errMsg=`track ${s} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={};if(t.isSupported=!1,!e)return ke.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let s=this.store.getState(xn);if(!s)return ke.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let r=this.getTrackById(s);return r?t=r.validatePlugin(e):(ke.w(`track ${s} not present, unable to validate plugin`),t.errMsg=`track ${s} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return y(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return y(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,s=!1){return y(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,s)})}changeRoleOfPeer(e,t,s=!1){return y(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,s)})}changeRoleOfPeersWithRoles(e,t){return y(this,null,function*(){let s=this.sdk.getRoles().filter(r=>e.includes(r.name));yield this.sdk.changeRoleOfPeersWithRoles(s,t)})}acceptChangeRole(e){return y(this,null,function*(){let t=e.requestedBy?this.getSDKHMSPeer(e.requestedBy.id):void 0;t||ke.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let s={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(s),this.removeRoleChangeRequest(e)})}raiseLocalPeerHand(){return y(this,null,function*(){yield this.sdk.raiseLocalPeerHand()})}lowerLocalPeerHand(){return y(this,null,function*(){yield this.sdk.lowerLocalPeerHand()})}raiseRemotePeerHand(e){return y(this,null,function*(){yield this.sdk.raiseRemotePeerHand(e)})}lowerRemotePeerHand(e){return y(this,null,function*(){yield this.sdk.lowerRemotePeerHand(e)})}getPeer(e){return y(this,null,function*(){let t=yield this.sdk.getPeer(e);if(t)return rt.convertPeer(t)})}findPeerByName(e){return y(this,null,function*(){let{offset:t,peers:s,eof:r}=yield this.sdk.findPeerByName(e);return{offset:t,eof:r,peers:s.map(l=>rt.convertPeer(l))}})}getPeerListIterator(e){let t=this.sdk.getPeerListIterator(e);return{hasNext:()=>t.hasNext(),next:()=>y(this,null,function*(){return(yield t.next()).map(s=>rt.convertPeer(s))}),findPeers:()=>y(this,null,function*(){return(yield t.findPeers()).map(s=>rt.convertPeer(s))}),getTotal:()=>t.getTotal()}}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,s){let r=(t==null?void 0:t.constructor.name)==="Object";this.setState(l=>{if(l.appData)s&&r?Object.assign(l.appData[e],t):l.appData[e]=t;else{let u={[e]:t};l.appData=u}},`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return y(this,null,function*(){let s=this.store.getState(bk);if(!(s!=null&&s.endRoom)){ke.w("You are not allowed to perform this action - endRoom");return}let r=this.store.getState(cn);this.setState(l=>{l.room.roomState="Disconnecting"},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(l){ke.e("error in ending room - ",l),this.setState(u=>{u.room.roomState=r},"revertEndRoom")}})}removePeer(e,t){return y(this,null,function*(){var s;let r=(s=this.sdk.getLocalPeer())==null?void 0:s.peerId;e!==r&&(yield this.sdk.removePeer(e,t))})}startRTMPOrRecording(e){return y(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return y(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return y(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return y(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}startTranscription(e){return y(this,null,function*(){yield this.sdk.startTranscription(e)})}stopTranscription(e){return y(this,null,function*(){yield this.sdk.stopTranscription(e)})}sendHLSTimedMetadata(e){return y(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return y(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return y(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setSessionMetadata(e){return y(this,null,function*(){yield this.sdk.setSessionMetadata(e),this.setState(t=>{t.sessionMetadata=e},"setSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"setSessionMetadata")})}populateSessionMetadata(){return y(this,null,function*(){let e=yield this.sdk.getSessionMetadata();this.setState(t=>{t.sessionMetadata=e},"populateSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"populateSessionmetadata")})}setRemoteTrackEnabled(e,t){return y(this,null,function*(){if(typeof e=="string"){let s=this.getTrackById(e);s&&zk(s)?yield this.sdk.changeTrackState(s,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(s=>this.setRemoteTrackEnabled(s,t))})}setRemoteTracksEnabled(e){return y(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let s=this.store.getState(na);t.roles=e.roles.map(r=>s[r])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){ke.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let s of e)this.ignoredMessageTypes.includes(s)||this.ignoredMessageTypes.push(s)}enableBeamSpeakerLabelsLogging(){return y(this,null,function*(){this.beamSpeakerLabelsLogger||(ke.i("enabling beam speaker labels logging"),this.beamSpeakerLabelsLogger=new Yk(this.store,this),yield this.beamSpeakerLabelsLogger.start())})}initDiagnostics(){let e=new iE(this.sdk,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this)});return this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)}),e}resetState(e="resetState"){this.isRoomJoinCalled=!1,ke.cleanup(),this.setState(t=>{Object.assign(t,xm())},e)}getDebugInfo(){return this.sdk.getDebugInfo()}sdkJoinWithListeners(e){return y(this,null,function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this),onSFUMigration:this.onSFUMigration.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})})}onSFUMigration(){this.syncRoomState("SFUMigration")}onRemovedFromRoom(e){var t;let s=this.store.getState(Un((t=e.requestedBy)==null?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Se(W({},e),{requestedBy:s||void 0}));let r=e.roomEnded||!s?"roomEnded":"removedFromRoom";ke.i(`resetting state after peer removed ${r}`,e),this.resetState(r)}onDeviceChange(e){let t=e.devices;if(!t)return;let s=this.store.getState(Ni);if(this.setState(r=>{Xi(r.devices.audioInput,t.audioInput)||(r.devices.audioInput=t.audioInput),Xi(r.devices.videoInput,t.videoInput)||(r.devices.videoInput=t.videoInput),Xi(r.devices.audioOutput,t.audioOutput)||(r.devices.audioOutput=t.audioOutput);let l=this.sdk.getLocalPeer();s!=null&&s.id&&l&&Object.assign(r.settings,this.getMediaSettings(l))},"deviceChange"),e.selection&&!e.internal){let r=rt.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(r)}}sdkPreviewWithListeners(e){return y(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var s;let r=t.room.localPeer||((s=this.sdk.getLocalPeer())==null?void 0:s.peerId);r&&(t.connectionQualities[r]={peerID:r,downlinkQuality:e})},"ConnectionQuality")}onSessionStoreUpdate(e){this.setSessionStoreValueLocally(e,"sessionStoreUpdate")}onPollsUpdate(e,t){let s=by[e];this.setState(r=>{let l=t.reduce((u,d)=>{var h;return u[d.id]=Se(W({},d),{questions:(h=d.questions)==null?void 0:h.map(p=>{var v,g;return Se(W({},p),{answer:p.answer?W({},p.answer):void 0,options:(v=p.options)==null?void 0:v.map(b=>W({},b)),responses:(g=p.responses)==null?void 0:g.map(b=>W({},b))})})}),u},{});qk(r.polls,l)},s),t.forEach(r=>this.hmsNotifications.sendPollUpdate(e,r.id))}onWhiteboardUpdate(e){this.setState(t=>{t.whiteboards[e.id]=e},"whiteboardUpdate")}startScreenShare(e){return y(this,null,function*(){this.store.getState(Hg)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return y(this,null,function*(){this.store.getState(Hg)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return y(this,null,function*(){let s=this.getTrackById(e);s||(s=this.getLocalTrack(e)),s&&s.type==="video"?yield this.sdk.attachVideo(s,t):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e=`${e}_fullSync`,ke.time(`store-sync-${e}`);let t={},s=[],r={},l={},u={},d,h=this.sdk.getPeers();for(let S of h){let C=rt.convertPeer(S);t[C.id]=C,s.push(C.id),u[C.id]={peerID:C.id,downlinkQuality:S.networkQuality||-1};let D=[S.audioTrack,S.videoTrack,...S.auxiliaryTracks];for(let M of D){if(!M)continue;let j=rt.convertTrack(M);r[j.id]=j}if(S.isLocal){let M=S;d=this.getPreviewFields(M),Object.assign(l,this.getMediaSettings(M))}}let p=this.sdk.getRecordingState(),v=this.sdk.getRTMPState(),g=this.sdk.getHLSState(),b=this.sdk.getTranscriptionState();this.setState(S=>{var C;S.room.peers=s;let D=S.peers,M=S.tracks;Hk(D,t),Vk(M,r),Object.assign(S.settings,l),S.room.isConnected&&Object.assign(S.connectionQualities,u),(C=S.preview)!=null&&C.localPeer&&d!=null&&d.localPeer?Object.assign(S.preview,d):S.preview=d,Object.assign(S.roles,rt.convertRoles(this.sdk.getRoles())),Object.assign(S.playlist,rt.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(S.room,rt.convertRecordingStreamingState(p,v,g,b)),Object.assign(S.templateAppData,this.sdk.getTemplateAppData())},e),ke.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{var s;Object.assign(t.room,rt.convertRoom(e,(s=this.sdk.getLocalPeer())==null?void 0:s.peerId)),t.room.roomState="Preview"},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new qg(t,"audio",this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new qg(t,"video",this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(s=>{var r;Object.assign(s.room,rt.convertRoom(e,(r=this.sdk.getLocalPeer())==null?void 0:r.peerId)),s.room.isConnected=!0,s.room.roomState="Connected"},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(s=>{this.syncPlaylistState(`${s.type}PlaylistUpdate`)}),t.onPlaylistEnded(s=>{this.syncPlaylistState(`${s}PlaylistEnded`)}),t.onCurrentTrackEnded(s=>{this.hmsNotifications.sendPlaylistTrackEnded(rt.convertPlaylistItem(t,s)),this.syncPlaylistState(`${s.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(s=>{var r;Object.assign(s.room,rt.convertRoom(t,(r=this.sdk.getLocalPeer())==null?void 0:r.peerId))},e),e==="TRANSCRIPTION_STATE_UPDATED"&&this.hmsNotifications.sendTranscriptionUpdate(t.transcriptions)}onPeerUpdate(e,t){if(![4,5].includes(e)){if(Array.isArray(t)){let s=this.store.getState(Ui),r=t.filter(l=>!s[l.peerId]);if(this.syncRoomState("peersJoined"),this.store.getState(sr)){let l=[];for(let u of t){let d=this.store.getState(Un(u.peerId));d&&l.push(d)}this.hmsNotifications.sendPeerList(l)}else r.forEach(l=>{let u=this.store.getState(Un(l.peerId));u&&this.hmsNotifications.sendPeerUpdate(0,u)});return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,s){if(e===1)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,s);else if([0,1].includes(e)){let r=eh[e];this.syncRoomState(r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}else{let r=eh[e]||"trackUpdate",l=rt.convertTrack(t);this.setState(u=>{let d=u.tracks[l.id];sa(d,l)&&(Sy(d,l),Object.assign(d,l))},r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=rt.convertMessage(e,this.store.getState(ea));t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),t.type==="hms_transcript"&&(t.ignored=!0),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.actionBatcher.setState(t=>{t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage",150)}onAudioLevelUpdate(e){this.setState(t=>{let s={};e.forEach(l=>{if(!l.track||!l.peer)return;let u=l.track.trackId;s[u]=l.audioLevel,t.speakers[u]||(t.speakers[u]={audioLevel:l.audioLevel,peerID:l.peer.peerId,trackID:u})});let r=Object.entries(t.speakers);for(let[l,u]of r)u.audioLevel=s[l]||0,u.audioLevel===0&&delete t.speakers[l]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{e.forEach(s=>{let r=s.peerID;r&&(t.connectionQualities[r]?Object.assign(t.connectionQualities[r],s):t.connectionQualities[r]=s)})},"connectionQuality")}onChangeTrackStateRequest(e){var t;let s=this.store.getState(Un((t=e.requestedBy)==null?void 0:t.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),l=this.store.getState(vy(r));if(!l)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:s||void 0,track:l,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let s=this.store.getState(Un((t=e.requestedBy)==null?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let r=[],l=this.store.getState(yt);for(let u of e.tracks){let d=this.getStoreLocalTrackIDfromSDKTrack(u);d&&l[d]&&r.push(l[d])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:s||void 0,tracks:r,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?"Connected":"Preview"},"reconnected")}onReconnecting(e){let t=rt.convertException(e);ke.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(s=>{s.room.roomState="Reconnecting",s.errors.push(t)},"reconnecting")}onError(e){let t=rt.convertException(e);t.isTerminal?(this.leave().then(()=>ke.e("error from SDK, left room.")),this.setState(s=>{s.room.roomState="Failed",s.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(s=>{s.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),ke.e("received error from sdk",t instanceof ge?`${t}`:t)}handleTrackRemove(e,t){this.setState(s=>{let r=s.peers[t.peerId],l=s.tracks,u=e.trackId;if(r)if(u===r.audioTrack)delete r.audioTrack;else if(u===r.videoTrack)delete r.videoTrack;else{let d=r.auxiliaryTracks.indexOf(u);d>-1&&r.auxiliaryTracks.splice(d,1)}delete l[u]},"trackRemoved")}setEnabledSDKTrack(e,t){return y(this,null,function*(){let s=this.getLocalTrack(e);s?yield s.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return y(this,null,function*(){let s=this.getLocalTrack(e);s?yield s.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return y(this,null,function*(){let s=this.getLocalTrack(e);s?yield s.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var t;let s=this.store.getState(ak),r=e.audioTrack,l=e.videoTrack;return{audioInputDeviceId:(r==null?void 0:r.settings.deviceId)||s.audioInputDeviceId,videoInputDeviceId:(l==null?void 0:l.settings.deviceId)||s.videoInputDeviceId,audioOutputDeviceId:(t=this.sdk.getAudioOutput().getDevice())==null?void 0:t.deviceId,audioMode:(r==null?void 0:r.settings.audioMode)||"voice"}}getPreviewFields(e){var t,s;if(!e.isInPreview())return;let r=rt.convertPeer(e);return{localPeer:r.id,audioTrack:r.audioTrack,videoTrack:r.videoTrack,asRole:((t=e.asRole)==null?void 0:t.name)||((s=e.role)==null?void 0:s.name)}}setTrackVolume(e,t){return y(this,null,function*(){let s=this.getTrackById(t);s?s instanceof Sh?(yield s.setVolume(e),this.setState(r=>{let l=r.tracks[t];l&&l.type==="audio"&&(l.volume=e)},"trackVolume")):ke.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)})}localAndVideoUnmuting(e){let t=this.store.getState(Ni);if((t==null?void 0:t.videoTrack)!==e)return!1;let s=this.store.getState(pk),r=this.store.getState(Zd);return s&&!r}logPossibleInconsistency(e){ke.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,s){return y(this,null,function*(){if(!e){ke.w("Invalid plugin received in store");return}let r=this.store.getState(Wi);if(r){let l=this.getLocalTrack(r);l?(t==="add"?yield l.addPlugin(e,s):t==="remove"&&(yield l.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${r} not present, unable to ${t} plugin`)}})}addRemoveMediaStreamVideoPlugins(e,t){return y(this,null,function*(){if(e.length===0){ke.w("Invalid plugin received in store");return}let s=this.store.getState(Wi);if(s){let r=this.getLocalTrack(s);r?(t==="add"?yield r.addStreamPlugins(e):t==="remove"&&(yield r.removeStreamPlugins(e)),this.syncRoomState(`${t}MediaStreamPlugin`)):this.logPossibleInconsistency(`track ${s} not present, unable to ${t} plugin`)}})}addRemoveAudioPlugin(e,t){return y(this,null,function*(){try{if(!e){ke.w("Invalid plugin received in store");return}let s=this.store.getState(xn);if(s){let r=this.getLocalTrack(s);r?(t==="add"?yield r.addPlugin(e):t==="remove"&&(yield r.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${s} not present, unable to ${t} plugin`)}}catch(s){console.error(s)}})}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push(rt.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let s=t.roleChangeRequests.findIndex(r=>r.token===e.token);s!==-1&&t.roleChangeRequests.splice(s,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(hk).find(t=>{var s;return((s=this.getTrackById(t))==null?void 0:s.trackId)===e.trackId})}updateMidCallPreviewRoomState(e,t){t.isLocal&&e===8&&this.store.getState(cy)&&this.setState(s=>{s.room.roomState="Connected"},"midCallPreviewCompleted")}setSessionStoreValueLocally(e,t="setSessionStore"){let s=Array.isArray(e)?e:[e];this.setState(r=>{s.forEach(l=>{r.sessionStore[l.key]=l.value})},t)}hasActiveElements(e){let t=Object.keys(this.store.getState().whiteboards).length>0,s=Object.keys(this.store.getState().polls).length>0,r=Object.keys(this.store.getState().peers).length>0,l=e.getState().remoteTrackStats;return r&&(t||s||Object.values(l).some(u=>u&&typeof u.bitrate=="number"&&u.bitrate>0))}},Ey=e=>Ii?`${e} ${document.title}`:e,sE=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=s=>y(this,null,function*(){var r;if(!s)return;let{url:l,timeout:u,scoreMap:d}=s,h=this.controller.signal,p=Date.now(),v=0,g=Ts(u).then(()=>{this.controller.abort()});try{let b=(r=(yield fetch(`${l}?${Date.now()}`,{signal:h})).body)==null?void 0:r.getReader();if(!b)throw Error("unable to process request");let S=()=>y(this,null,function*(){if(b)try{let C=!1;for(;!C;){let{value:D,done:M}=yield b.read();C=M,D&&(v+=D.byteLength,this.sendScore({scoreMap:d,downloadedSize:v,startTime:p}))}}catch(C){C.name!=="AbortError"&&k.d(this.TAG,C)}});return Promise.race([S(),g]).then(()=>{this.sendScore({scoreMap:d,downloadedSize:v,startTime:p,finished:!0})}).catch(C=>{k.d(this.TAG,C),this.updateScoreToListener(0),this.eventBus.analytics.publish(be.previewNetworkQuality({error:C.message}))})}catch(b){b.name!=="AbortError"?(k.d(this.TAG,b),this.updateScoreToListener(0),this.eventBus.analytics.publish(be.previewNetworkQuality({error:b.message}))):k.d(this.TAG,b)}}),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:s,downloadedSize:r,startTime:l,finished:u=!1})=>{let d=(Date.now()-l)/1e3,h=r/1024/d*8,p=-1;for(let v in s){let g=s[v];h>=g.low&&(!g.high||h<=g.high)&&(p=Number(v))}this.updateScoreToListener(p),u&&this.eventBus.analytics.publish(be.previewNetworkQuality({score:p,downLink:h.toFixed(2)}))}}updateScoreToListener(e){var t,s;e!==this.score&&(this.score=e,(s=(t=this.listener)==null?void 0:t.onNetworkQuality)==null||s.call(t,e))}},rE=class{constructor(e,t,s,r,l,u){this.store=e,this.transport=t,this.deviceManager=s,this.publish=r,this.removeAuxiliaryTrack=l,this.listener=u,this.handleLocalPeerRoleUpdate=d=>y(this,[d],function*({oldRole:h,newRole:p}){var v;let g=this.store.getLocalPeer();g&&(yield this.diffRolesAndPublishTracks({oldRole:h,newRole:p}),(v=this.listener)==null||v.onPeerUpdate(8,g))}),this.diffRolesAndPublishTracks=d=>y(this,[d],function*({oldRole:h,newRole:p}){var v,g,b,S,C,D;let M=new Set(h.publishParams.allowed),j=new Set(p.publishParams.allowed),le=this.removeTrack(M,j,"video"),oe=this.removeTrack(M,j,"audio"),ie=this.removeTrack(M,j,"screen"),se=this.hasSimulcastDifference((v=h.publishParams.simulcast)==null?void 0:v.video,(g=p.publishParams.simulcast)==null?void 0:g.video),ae=this.hasSimulcastDifference((b=h.publishParams.simulcast)==null?void 0:b.screen,(S=p.publishParams.simulcast)==null?void 0:S.screen),Ne=(D=(C=this.store.getLocalPeer())==null?void 0:C.videoTrack)==null?void 0:D.enabled;yield this.removeAudioTrack(oe),yield this.removeVideoTracks(le||se),yield this.removeScreenTracks(ie||ae);let nt=this.getSettings();se&&(nt.isVideoMuted=!Ne),yield this.publish(nt),yield this.syncDevices(nt,p)})}syncDevices(e,t){return y(this,null,function*(){(!e.isAudioMuted||!e.isVideoMuted)&&t.publishParams.allowed.length>0&&(yield this.deviceManager.init(!0))})}removeVideoTracks(e){return y(this,null,function*(){var t;if(!e)return;let s=this.store.getLocalPeer();s!=null&&s.videoTrack&&(s.videoTrack.isPublished?yield this.transport.unpublish([s.videoTrack]):yield s.videoTrack.cleanup(),(t=this.listener)==null||t.onTrackUpdate(1,s.videoTrack,s),s.videoTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="video")})}removeAudioTrack(e){return y(this,null,function*(){var t;if(!e)return;let s=this.store.getLocalPeer();s!=null&&s.audioTrack&&(s.audioTrack.isPublished?yield this.transport.unpublish([s.audioTrack]):yield s.audioTrack.cleanup(),(t=this.listener)==null||t.onTrackUpdate(1,s.audioTrack,s),s.audioTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="audio")})}removeScreenTracks(e){return y(this,null,function*(){e&&(yield this.removeAuxTracks(t=>t.source==="screen"))})}removeAuxTracks(e){return y(this,null,function*(){let t=this.store.getLocalPeer();if(t!=null&&t.auxiliaryTracks){let s=[...t.auxiliaryTracks];for(let r of s)e(r)&&(yield this.removeAuxiliaryTrack(r.trackId))}})}removeTrack(e,t,s){return e.has(s)&&!t.has(s)}hasSimulcastDifference(e,t){var s,r,l;return!e&&!t?!1:((s=e==null?void 0:e.layers)==null?void 0:s.length)!==((r=t==null?void 0:t.layers)==null?void 0:r.length)?!0:!!((l=e==null?void 0:e.layers)!=null&&l.some(u=>{var d;let h=(d=t==null?void 0:t.layers)==null?void 0:d.find(p=>p.rid===u.rid);return(h==null?void 0:h.maxBitrate)!==u.maxBitrate||(h==null?void 0:h.maxFramerate)!==u.maxFramerate}))}getSettings(){let{isAudioMuted:e,isVideoMuted:t}=this.getMutedStatus(),{audioInputDeviceId:s,audioOutputDeviceId:r}=this.getAudioDeviceSettings(),l=this.getVideoInputDeviceId();return{isAudioMuted:e,isVideoMuted:t,audioInputDeviceId:s,audioOutputDeviceId:r,videoDeviceId:l}}getMutedStatus(){var e,t,s;let r=(e=this.store.getConfig())==null?void 0:e.settings;return{isAudioMuted:(t=r==null?void 0:r.isAudioMuted)!=null?t:!0,isVideoMuted:(s=r==null?void 0:r.isVideoMuted)!=null?s:!0}}getAudioDeviceSettings(){var e,t,s;let r=(e=this.store.getConfig())==null?void 0:e.settings,l=((t=this.deviceManager.currentSelection.audioInput)==null?void 0:t.deviceId)||(r==null?void 0:r.audioInputDeviceId)||"default",u=((s=this.deviceManager.currentSelection.audioOutput)==null?void 0:s.deviceId)||(r==null?void 0:r.audioOutputDeviceId)||"default";return{audioInputDeviceId:l,audioOutputDeviceId:u}}getVideoInputDeviceId(){var e,t;let s=(e=this.store.getConfig())==null?void 0:e.settings;return((t=this.deviceManager.currentSelection.videoInput)==null?void 0:t.deviceId)||(s==null?void 0:s.videoDeviceId)||"default"}},aE=class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new ou("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}setEnv(e){this.env=e,this.flushFailedEvents()}setWebsocketEndpoint(e){this.websocketURL=e}sendEvent(e){if(!this.env){this.addEventToStorage(e);return}let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},s=this.env==="prod"?G0:j0;fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then(r=>{if(r.status===401){this.removeFromStorage(e);return}if(r.status!==200)throw Error(r.statusText);this.removeFromStorage(e)}).catch(r=>{k.v(this.TAG,"Failed to send event",r,e),this.addEventToStorage(e)})}flushFailedEvents(){let e=this.failedEvents.get();e==null||e.forEach(t=>this.sendEvent(t))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find(s=>s.timestamp===e.timestamp)||(t.length===100&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],s=t.findIndex(r=>r.timestamp===e.timestamp);s>-1&&(t.splice(s,1),this.failedEvents.set(t))}},Tl=new aE,Yg=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof bh?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},lE=class{constructor(){this.TAG="[Store]:",this.knownRoles={},this.peers={},this.tracks=new Map,this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env="prod",this.simulcastEnabled=!1,this.userAgent=Kd(this.env),this.polls=new Map,this.whiteboards=new Map,this.addPermissionToRole=(e,t,s,r)=>{var l;if(!this.knownRoles[e]){k.d(this.TAG,`role ${e} is not present in given roles`,this.knownRoles);return}let u=this.knownRoles[e].permissions;t==="transcriptions"&&r?u[t]=Se(W({},u[t]),{[r]:[s]}):t==="whiteboard"&&(u[t]||(u[t]=[]),(l=u[t])==null||l.push(s))},this.addWhiteboardPluginToRole=e=>{var t,s,r;let l=e==null?void 0:e.permissions;(t=l==null?void 0:l.admin)==null||t.forEach(u=>this.addPermissionToRole(u,"whiteboard","admin")),(s=l==null?void 0:l.reader)==null||s.forEach(u=>this.addPermissionToRole(u,"whiteboard","read")),(r=l==null?void 0:l.writer)==null||r.forEach(u=>this.addPermissionToRole(u,"whiteboard","write"))},this.addTranscriptionsPluginToRole=(e=[])=>{var t,s;for(let r of e)(s=(t=r.permissions)==null?void 0:t.admin)==null||s.forEach(l=>this.addPermissionToRole(l,"transcriptions","admin",r.mode))},this.handleNoiseCancellationPlugin=e=>{this.room&&(this.room.isNoiseCancellationEnabled=!!(e!=null&&e.enabled)&&!!this.room.isNoiseCancellationEnabled)}}getConfig(){return this.config}setSimulcastEnabled(e){this.simulcastEnabled=e}removeRemoteTracks(){this.tracks.forEach(e=>{(e instanceof ia||e instanceof yi)&&(this.removeTrack(e),delete this.peerTrackStates[e.trackId])})}getEnv(){return this.env}getPublishParams(){let e=this.getLocalPeer(),t=(e==null?void 0:e.asRole)||(e==null?void 0:e.role);return t==null?void 0:t.publishParams}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getTemplateAppData(){return this.templateAppData}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter(e=>!e.isLocal)}getPeers(){return Object.values(this.peers)}getPeerMap(){return this.peers}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Array.from(this.tracks.values())}getVideoTracks(){return this.getTracks().filter(e=>e.type==="video")}getRemoteVideoTracks(){return this.getTracks().filter(e=>e instanceof yi)}getAudioTracks(){return this.getTracks().filter(e=>e.type==="audio")}getPeerTracks(e){let t=e?this.peers[e]:void 0,s=[];return t!=null&&t.videoTrack&&s.push(t.videoTrack),t!=null&&t.audioTrack&&s.push(t.audioTrack),s.concat((t==null?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}hasTrack(e){return this.tracks.has(e)}getTrackById(e){var t,s;let r=Array.from(this.tracks.values()).find(u=>u.trackId===e);if(r)return r;let l=this.getLocalPeer();if(l){if((t=l.audioTrack)!=null&&t.isPublishedTrackId(e))return l.audioTrack;if((s=l.videoTrack)!=null&&s.isPublishedTrackId(e))return l.videoTrack}}getPeerByTrackId(e){let t=Array.from(this.tracks.values()).find(s=>s.trackId===e);return t!=null&&t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map(e=>e.peer)}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=Kd(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){var t,s;if(this.knownRoles=e.known_roles,this.addPluginsToRoles(e.plugins),this.roleDetailsArrived=!0,this.templateAppData=e.app_data,!this.simulcastEnabled)return;let r=(t=this.knownRoles[e.name])==null?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers((s=r.simulcast)==null?void 0:s.video),this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,s,r;if(Gn.rememberDevices(!!e.rememberDeviceSelection),e.rememberDeviceSelection){let l=Gn.getSelection();l&&(e.settings||(e.settings={}),(t=l.audioInput)!=null&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||l.audioInput.deviceId),(s=l.audioOutput)!=null&&s.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||l.audioOutput.deviceId),(r=l.videoInput)!=null&&r.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||l.videoInput.deviceId))}e.autoManageVideo=e.autoManageVideo!==!1,e.autoManageWakeLock=e.autoManageWakeLock!==!1,this.config=e,this.setEnv()}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks.set(e,e)}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removeTrackState(e){delete this.peerTrackStates[e]}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){this.tracks.delete(e)}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){return y(this,null,function*(){for(let t of this.getAudioTracks())yield t.setVolume(e)})}updateAudioOutputDevice(e){return y(this,null,function*(){let t=[];this.getAudioTracks().forEach(s=>{s instanceof ia&&t.push(s.setOutputDevice(e))}),yield Promise.all(t)})}getSimulcastLayers(e){var t;return!this.simulcastEnabled||!["screen","regular"].includes(e)?[]:e==="screen"?[]:((t=this.videoLayers)==null?void 0:t.layers)||[]}convertSimulcastLayers(e){if(e)return Se(W({},e),{layers:(e.layers||[]).map(t=>Se(W({},t),{maxBitrate:t.maxBitrate*1e3}))})}getSimulcastDefinitionsForPeer(e,t){var s,r,l;if([!e||!e.role,t==="screen",!this.simulcastEnabled].some(v=>!!v))return[];let u=this.getPolicyForRole(e.role.name).publishParams,d,h,p;return t==="regular"?(d=(s=u.simulcast)==null?void 0:s.video,h=u.video.width,p=u.video.height):t==="screen"&&(d=(r=u.simulcast)==null?void 0:r.screen,h=u.screen.width,p=u.screen.height),((l=d==null?void 0:d.layers)==null?void 0:l.map(v=>{let g=h0[v.rid],b={width:Math.floor(h/v.scaleResolutionDownBy),height:Math.floor(p/v.scaleResolutionDownBy)};return{layer:g,resolution:b}}))||[]}setPoll(e){this.polls.set(e.id,e)}getPoll(e){return this.polls.get(e)}setWhiteboard(e){this.whiteboards.set(e.id,e)}getWhiteboards(){return this.whiteboards}getWhiteboard(e){return e?this.whiteboards.get(e):this.whiteboards.values().next().value}getErrorListener(){return this.errorListener}cleanup(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach(e=>{var t;if(!e.role){(t=this.errorListener)==null||t.onError(Y.GenericErrors.InvalidRole("VALIDATION",""));return}e.role=this.getPolicyForRole(e.role.name)})}addPluginsToRoles(e){e&&Object.keys(e).forEach(t=>{let s=t;switch(s){case"whiteboard":{this.addWhiteboardPluginToRole(e[s]);break}case"transcriptions":{this.addTranscriptionsPluginToRole(e[s]);break}case"noiseCancellation":{this.handleNoiseCancellationPlugin(e[s]);break}}})}setEnv(){var e;let t=((e=this.config)==null?void 0:e.initEndpoint).split("https://")[1],s="prod";t.startsWith("prod")?s="prod":t.startsWith("qa")?s="qa":t.startsWith("dev")&&(s="dev"),this.env=s,Tl.setEnv(s)}},oE=class{constructor(){this.TAG="[WakeLockManager]",this.wakeLock=null,this.acquireLock=()=>y(this,null,function*(){yield this.requestWakeLock(),document==null||document.addEventListener("visibilitychange",this.visibilityHandler)}),this.cleanup=()=>y(this,null,function*(){if(this.wakeLock&&!this.wakeLock.released)try{yield this.wakeLock.release(),k.d(this.TAG,"Wake lock released")}catch(e){let t=e;k.w(this.TAG,"Error while releasing wake lock",`name=${t.name}, message=${t.message}`)}document==null||document.removeEventListener("visibilitychange",this.visibilityHandler),this.wakeLock=null}),this.visibilityHandler=()=>y(this,null,function*(){(document==null?void 0:document.visibilityState)==="visible"&&(!this.wakeLock||this.wakeLock.released)&&(k.d(this.TAG,"Re-acquiring wake lock due to visibility change"),yield this.requestWakeLock())}),this.requestWakeLock=()=>y(this,null,function*(){try{if(!("wakeLock"in navigator)){k.d(this.TAG,"Wake lock feature not supported");return}this.wakeLock=yield navigator.wakeLock.request("screen"),k.d(this.TAG,"Wake lock acquired")}catch(e){let t=e;k.w(this.TAG,"Error acquiring wake lock",`name=${t.name}, message=${t.message}`)}})}},uE=class{constructor(e){this.store=e,this.bufferSize=100,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=1}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let t=this.pendingEvents.shift();k.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",t)}return this}flushFailedClientEvents(){Tl.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=(e=this.store.getLocalPeer())==null?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(t){k.w(this.TAG,"Flush Failed",t)}}sendClientEventOnHTTP(e){var t,s,r,l;let u=this.store.getRoom(),d=this.store.getLocalPeer();e.metadata.token=(t=this.store.getConfig())==null?void 0:t.authToken,e.metadata.peer={session_id:u==null?void 0:u.sessionId,room_id:u==null?void 0:u.id,room_name:u==null?void 0:u.name,template_id:u==null?void 0:u.templateId,joined_at:(s=u==null?void 0:u.joinedAt)==null?void 0:s.getTime(),session_started_at:(r=u==null?void 0:u.startedAt)==null?void 0:r.getTime(),role:(l=d==null?void 0:d.role)==null?void 0:l.name,user_name:d==null?void 0:d.name,user_data:d==null?void 0:d.metadata,peer_id:d==null?void 0:d.peerId},Tl.sendEvent(e)}},Kg={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},cE=class{constructor(e,t,s){this.store=e,this.deviceManager=t,this.eventBus=s,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=W({},Kg),this.handleAudioPaused=r=>y(this,null,function*(){k.d(this.TAG,"Audio Paused",r.target.id);let l=this.store.getTrackById(r.target.id);l&&this.autoPausedTracks.add(l)}),this.handleTrackUpdate=({track:r})=>{k.d(this.TAG,"Track updated",`${r}`)},this.handleTrackAdd=r=>y(this,[r],function*({track:l,peer:u,callListener:d=!0}){var h,p;let v=document.createElement("audio");v.style.display="none",v.id=l.trackId,v.addEventListener("pause",this.handleAudioPaused),v.onerror=()=>y(this,null,function*(){var g,b;k.e(this.TAG,"error on audio element",v.error);let S=Y.TracksErrors.AudioPlaybackError(`Audio playback error for track - ${l.trackId} code - ${(g=v==null?void 0:v.error)==null?void 0:g.code}`);this.eventBus.analytics.publish(be.audioPlaybackError(S)),((b=v==null?void 0:v.error)==null?void 0:b.code)===MediaError.MEDIA_ERR_DECODE&&(this.removeAudioElement(v,l),yield Ts(500),yield this.handleTrackAdd({track:l,peer:u,callListener:!1}),this.state.autoplayFailed||this.eventBus.analytics.publish(be.audioRecovered("Audio recovered after media decode error")))}),l.setAudioElement(v),yield l.setVolume(this.volume),k.d(this.TAG,"Audio track added",`${l}`),this.init(),(h=this.audioSink)==null||h.append(v),this.outputDevice&&(yield l.setOutputDevice(this.outputDevice)),v.srcObject=new MediaStream([l.nativeTrack]),d&&((p=this.listener)==null||p.onTrackUpdate(0,l,u)),yield this.handleAutoplayError(l)}),this.handleAutoplayError=r=>y(this,null,function*(){if(this.state.autoplayFailed===void 0&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(l=>{this.playAudioFor(r).then(l)})),yield this.state.autoplayCheckPromise),this.state.autoplayFailed){this.autoPausedTracks.add(r);return}yield this.playAudioFor(r)}),this.handleAudioDeviceChange=r=>y(this,null,function*(){r.isUserSelection||r.error||!r.selection||r.type==="video"||(yield this.unpauseAudioTracks())}),this.handleTrackRemove=r=>{this.autoPausedTracks.delete(r);let l=document.getElementById(r.trackId);l&&this.removeAudioElement(l,r),this.audioSink&&this.audioSink.childElementCount===0&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),k.d(this.TAG,"Audio track removed",`${r}`)},this.unpauseAudioTracks=()=>y(this,null,function*(){let r=[];this.autoPausedTracks.forEach(l=>{r.push(this.playAudioFor(l))}),yield Promise.all(r)}),this.removeAudioElement=(r,l)=>{r&&(k.d(this.TAG,"removing audio element",`${l}`),r.removeEventListener("pause",this.handleAudioPaused),r.srcObject=null,r.remove(),l.setAudioElement(null))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseAudioTracks)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){return y(this,null,function*(){yield this.store.updateAudioOutputVolume(e),this.volume=e})}unblockAutoplay(){return y(this,null,function*(){this.autoPausedTracks.size>0&&(yield this.unpauseAudioTracks()),yield aa.resumeContext()})}init(e){if(this.state.initialized||this.audioSink)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${ks()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t,k.d(this.TAG,"audio sink created",this.audioSink)}cleanup(){var e;(e=this.audioSink)==null||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.autoPausedTracks=new Set,this.state=W({},Kg)}playAudioFor(e){return y(this,null,function*(){let t=e.getAudioElement();if(!t){k.w(this.TAG,"No audio element found on track",e.trackId);return}try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),k.d(this.TAG,"Played track",`${e}`)}catch(s){this.autoPausedTracks.add(e),k.w(this.TAG,"Failed to play track",`${e}`,s);let r=s;if(!this.state.autoplayFailed&&r.name==="NotAllowedError"){this.state.autoplayFailed=!0;let l=Y.TracksErrors.AutoplayBlocked("AUTOPLAY","");l.addNativeError(r),this.eventBus.analytics.publish(be.autoplayError()),this.eventBus.autoplayError.publish(l)}}})}},dE=class{constructor(e){this.eventBus=e,this.pluginUsage=new Map,this.pluginLastAddedAt=new Map,this.getPluginUsage=t=>{if(this.pluginUsage.has(t)||this.pluginUsage.set(t,0),this.pluginLastAddedAt.has(t)){let s=this.pluginLastAddedAt.get(t)||0,r=s?Date.now()-s:0;this.pluginUsage.set(t,(this.pluginUsage.get(t)||0)+r),this.pluginLastAddedAt.delete(t)}return this.pluginUsage.get(t)},this.updatePluginUsageData=t=>{var s;let r=((s=t.properties)==null?void 0:s.plugin_name)||"";switch(t.name){case"mediaPlugin.toggled.on":case"mediaPlugin.added":{let l=t.properties.added_at||Date.now();this.pluginLastAddedAt.set(r,l);break}case"mediaPlugin.toggled.off":case"mediaPlugin.stats":{if(this.pluginLastAddedAt.has(r)){let l=t.properties.duration||(Date.now()-(this.pluginLastAddedAt.get(r)||0))/1e3;this.pluginUsage.set(r,(this.pluginUsage.get(r)||0)+Math.max(l,0)*1e3),this.pluginLastAddedAt.delete(r)}break}}},this.cleanup=()=>{this.pluginLastAddedAt.clear(),this.pluginUsage.clear()},this.eventBus.analytics.subscribe(t=>this.updatePluginUsageData(t))}},hE=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.currentSelection={audioInput:void 0,videoInput:void 0,audioOutput:void 0},this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.earpieceSelected=!1,this.timer=null,this.updateOutputDevice=(r,l)=>y(this,null,function*(){let u=this.audioOutput.find(d=>d.deviceId===r);return u&&(this.outputDevice=u,yield this.store.updateAudioOutputDevice(u),this.eventBus.analytics.publish(be.deviceChange({isUserSelection:l,selection:{audioOutput:u},devices:this.getDevices(),type:"audioOutput"})),Gn.updateSelection("audioOutput",{deviceId:u.deviceId,groupId:u.groupId})),u}),this.getCurrentSelection=()=>{var r,l;let u=this.store.getLocalPeer(),d=this.createIdentifier((r=u==null?void 0:u.audioTrack)==null?void 0:r.getMediaTrackSettings()),h=this.createIdentifier((l=u==null?void 0:u.videoTrack)==null?void 0:l.getMediaTrackSettings()),p=this.audioInput.find(g=>this.createIdentifier(g)===d),v=this.videoInput.find(g=>this.createIdentifier(g)===h);return{audioInput:p,videoInput:v,audioOutput:this.outputDevice}},this.computeChange=(r,l)=>r.length!==l.length?!0:l.some(u=>!r.includes(this.createIdentifier(u))),this.enumerateDevices=()=>y(this,null,function*(){try{let r=yield navigator.mediaDevices.enumerateDevices(),l=this.videoInput.map(this.createIdentifier),u=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],r.forEach(d=>{d.kind==="audioinput"&&d.label?(this.hasMicrophonePermission=!0,this.audioInput.push(d)):d.kind==="audiooutput"?this.audioOutput.push(d):d.kind==="videoinput"&&d.label&&(this.hasWebcamPermission=!0,this.videoInput.push(d))}),this.videoInputChanged=this.computeChange(l,this.videoInput),this.audioInputChanged=this.computeChange(u,this.audioInput),Gn.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(r){k.e(this.TAG,"Failed enumerating devices",r)}}),this.updateToActualDefaultDevice=()=>y(this,null,function*(){var r,l,u,d,h;let p=this.store.getLocalPeer();if(!((l=(r=this.store.getConfig())==null?void 0:r.settings)!=null&&l.videoDeviceId)&&p!=null&&p.videoTrack&&(yield p.videoTrack.setSettings({deviceId:(u=this.videoInput[0])==null?void 0:u.deviceId},!0)),!((h=(d=this.store.getConfig())==null?void 0:d.settings)!=null&&h.audioInputDeviceId)&&p!=null&&p.audioTrack){let v=()=>{var g;let b=this.audioInput.find(S=>!S.label.toLowerCase().includes("iphone"));return YT()&&b?b==null?void 0:b.deviceId:(g=this.getNewAudioInputDevice())==null?void 0:g.deviceId};v()&&(yield p.audioTrack.setSettings({deviceId:v()},!0))}}),this.handleDeviceChange=Jm(()=>y(this,null,function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let r=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(r==null?void 0:r.audioTrack),yield this.handleVideoInputDeviceChange(r==null?void 0:r.videoTrack),this.eventBus.analytics.publish(be.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}),500).bind(this),this.handleAudioInputDeviceChange=r=>y(this,null,function*(){if(!r){k.d(this.TAG,"No Audio track on local peer");return}if(!this.audioInputChanged){k.d(this.TAG,"No Change in AudioInput Device");return}let l=this.getNewAudioInputDevice();if(!l||!l.deviceId){this.eventBus.analytics.publish(be.deviceChange({selection:{audioInput:l},error:Y.TracksErrors.SelectedDeviceMissing("audio"),devices:this.getDevices(),type:"audioInput"})),k.e(this.TAG,"Audio device not found");return}let{settings:u}=r,d=new jn().codec(u.codec).maxBitrate(u.maxBitrate).deviceId(l.deviceId).audioMode(u.audioMode).build();try{yield r.setSettings(d,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:l,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(h){k.e(this.TAG,"[Audio Device Change]",h),this.eventBus.analytics.publish(be.deviceChange({selection:{audioInput:l},devices:this.getDevices(),type:"audioInput",error:h})),this.eventBus.deviceChange.publish({error:h,selection:l,type:"audioInput",devices:this.getDevices()})}}),this.handleVideoInputDeviceChange=r=>y(this,null,function*(){if(!r){k.d(this.TAG,"No video track on local peer");return}if(!this.videoInputChanged){k.d(this.TAG,"No Change in VideoInput Device");return}let l=this.videoInput[0];if(!l||!l.deviceId){this.eventBus.analytics.publish(be.deviceChange({selection:{videoInput:l},error:Y.TracksErrors.SelectedDeviceMissing("video"),devices:this.getDevices(),type:"video"})),k.e(this.TAG,"Video device not found");return}let{settings:u}=r,d=new Ss().codec(u.codec).maxBitrate(u.maxBitrate).maxFramerate(u.maxFramerate).setWidth(u.width).setHeight(u.height).deviceId(l.deviceId).build();try{yield r.setSettings(d,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:l,type:"video"}),this.logDevices("Video Device Change Success")}catch(h){k.e(this.TAG,"[Video Device Change]",h),this.eventBus.analytics.publish(be.deviceChange({selection:{videoInput:l},devices:this.getDevices(),type:"video",error:h})),this.eventBus.deviceChange.publish({error:h,type:"video",selection:l,devices:this.getDevices()})}}),this.startPollingForDevices=()=>y(this,null,function*(){let{earpiece:r}=this.categorizeAudioInputDevices();r&&(this.timer=setTimeout(()=>{y(this,null,function*(){yield this.enumerateDevices(),yield this.autoSelectAudioOutput(),this.startPollingForDevices()})},5e3))}),this.autoSelectAudioOutput=()=>y(this,null,function*(){var r,l;let{bluetoothDevice:u,earpiece:d,speakerPhone:h,wired:p}=this.categorizeAudioInputDevices(),v=(r=this.store.getLocalPeer())==null?void 0:r.audioTrack;if(!v||!d)return;let g=this.getManuallySelectedAudioDevice(),b=(g==null?void 0:g.deviceId)||(u==null?void 0:u.deviceId)||(p==null?void 0:p.deviceId)||(h==null?void 0:h.deviceId);if(!(v.settings.deviceId===b&&this.earpieceSelected))try{if(!this.earpieceSelected){if((u==null?void 0:u.deviceId)===b){this.earpieceSelected=!0;return}yield v.setSettings({deviceId:d==null?void 0:d.deviceId},!0),this.earpieceSelected=!0}yield v.setSettings({deviceId:b},!0);let S=(l=this.audioInput.find(C=>C.deviceId===b))==null?void 0:l.groupId;this.eventBus.deviceChange.publish({isUserSelection:!1,type:"audioInput",selection:{deviceId:b,groupId:S},devices:this.getDevices(),internal:!0})}catch(S){this.eventBus.error.publish(S)}});let s=({enabled:r,track:l})=>r&&l.source==="regular";this.eventBus.localVideoEnabled.waitFor(s).then(()=>{this.videoInput.length===0&&this.init(!0)}),this.eventBus.localAudioEnabled.waitFor(s).then(()=>{this.audioInput.length===0&&this.init(!0)}),this.eventBus.deviceChange.subscribe(({type:r,isUserSelection:l,selection:u})=>{if(l){let d=r==="video"?"videoInput":r,h=this[d].find(p=>this.createIdentifier(p)===this.createIdentifier(u));this.eventBus.analytics.publish(be.deviceChange({selection:{[d]:h},devices:this.getDevices(),type:r,isUserSelection:l}))}})}init(e=!1,t=!0){return y(this,null,function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),e||(yield this.updateToActualDefaultDevice(),this.startPollingForDevices()),yield this.autoSelectAudioOutput(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),t&&this.eventBus.analytics.publish(be.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))})}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanup(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.initialized=!1,this.earpieceSelected=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){var e,t;let s=this.getManuallySelectedAudioDevice();if(s)return s;(t=(e=this.store.getLocalPeer())==null?void 0:e.audioTrack)==null||t.resetManuallySelectedDeviceId();let r=this.audioInput.find(l=>l.deviceId==="default");return r?this.audioInput.find(l=>l.deviceId!=="default"&&r.label.includes(l.label)):this.audioInput[0]}setOutputDevice(e=!1){return y(this,null,function*(){let t=this.getNewAudioInputDevice(),s=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>this.createIdentifier(r)===s),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>r.deviceId==="default")||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&s!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(be.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))})}getManuallySelectedAudioDevice(){let e=this.store.getLocalPeer(),t=e==null?void 0:e.audioTrack;return this.audioInput.find(s=>s.deviceId===(t==null?void 0:t.getManuallySelectedDeviceId()))}categorizeAudioInputDevices(){let e=null,t=null,s=null,r=null;for(let l of this.audioInput){let u=S0(l.label);u==="SPEAKERPHONE"?t=l:u==="WIRED"?s=l:u==="BLUETOOTH"?e=l:u==="EARPIECE"&&(r=l)}return{bluetoothDevice:e,speakerPhone:t,wired:s,earpiece:r}}getAudioOutputDeviceMatchingInput(e){var t,s;let r=((s=(t=this.store.getConfig())==null?void 0:t.settings)==null?void 0:s.speakerAutoSelectionBlacklist)||[];if(r==="all"||!e)return;let l=e.label.toLowerCase()||"";if(r.some(h=>l.includes(h.toLowerCase())))return;let u=this.audioOutput.find(h=>e.deviceId!=="default"&&h.label===e.label);if(u)return u;let d=this.audioOutput.find(h=>h.groupId===e.groupId);if(d&&this.audioOutput[0].deviceId==="default"&&d.groupId===this.audioOutput[0].groupId)return d}logDevices(e=""){k.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},fE=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e,!0)}unblockAutoplay(){return y(this,null,function*(){yield this.audioSinkManager.unblockAutoplay(),yield aa.resumeContext()})}},Ay=class{static handleError(e){if(e.status===404)throw Y.APIErrors.EndpointUnreachable("FEEDBACK",e.statusText);if(e.status>=400)throw Y.APIErrors.ServerErrors(e.status,"FEEDBACK",e==null?void 0:e.statusText)}static sendFeedback(e){return y(this,arguments,function*({token:t,eventEndpoint:s="https://event.100ms.live",info:r,feedback:l}){k.d(this.TAG,`sendFeedback: feedbackEndpoint=${s} peerId=${r.peer.peer_id} session=${r.peer.session_id} `);let u=new URL("v2/client/feedback",s),d=Se(W({},r),{payload:l});try{let h=yield fetch(u,{headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(d),method:"POST"});try{this.handleError(h);return}catch(p){throw k.e(this.TAG,"error",p.message,h.status),p instanceof ge?p:Y.APIErrors.ServerErrors(h.status,"FEEDBACK",p.message)}}catch(h){let p=h;throw["Failed to fetch","NetworkError","ECONNRESET"].some(v=>p.message.includes(v))?Y.APIErrors.EndpointUnreachable("FEEDBACK",p.message):p}})}};Ay.TAG="[FeedbackService]";var Ct=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=s=>{this.eventEmitter.emit(this.eventName,s)},this.subscribe=s=>{this.eventEmitter.on(this.eventName,s)},this.subscribeOnce=s=>{this.eventEmitter.once(this.eventName,s)},this.unsubscribe=s=>{this.eventEmitter.off(this.eventName,s)},this.waitFor=s=>this.eventEmitter.waitFor(this.eventName,{filter:s}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},pE=class{constructor(){this.eventEmitter=new lu.EventEmitter2,this.analytics=new Ct(At.ANALYTICS,this.eventEmitter),this.deviceChange=new Ct(At.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new Ct(At.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new Ct(At.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.localVideoUnmutedNatively=new Ct(At.LOCAL_VIDEO_UNMUTED_NATIVELY,this.eventEmitter),this.localAudioUnmutedNatively=new Ct(At.LOCAL_AUDIO_UNMUTED_NATIVELY,this.eventEmitter),this.statsUpdate=new Ct(At.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new Ct(At.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new Ct(At.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new Ct(At.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new Ct(At.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new Ct(At.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.policyChange=new Ct(At.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new Ct(At.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new Ct(At.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new Ct(At.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new Ct(At.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new Ct(At.AUTOPLAY_ERROR,this.eventEmitter),this.leave=new Ct(At.LEAVE,this.eventEmitter),this.error=new Ct(At.ERROR,this.eventEmitter)}},vE=class{constructor(e,t,s){this.store=e,this.listener=t,this.audioListener=s}handleActiveSpeakers(e){var t,s,r;let l=e["speaker-list"],u=l.map(h=>({audioLevel:h.level,peer:this.store.getPeerById(h.peer_id),track:this.store.getTrackById(h.track_id)}));(t=this.audioListener)==null||t.onAudioLevelUpdate(u),this.store.updateSpeakers(u);let d=l[0];if(d){let h=this.store.getPeerById(d.peer_id);(s=this.listener)==null||s.onPeerUpdate(4,h)}else(r=this.listener)==null||r.onPeerUpdate(5,null)}},gE=class{constructor(e){this.listener=e,this.TAG="[BroadcastManager]"}handleNotification(e,t){e==="on-broadcast"&&this.handleBroadcast(t)}handleBroadcast(e){var t,s;k.d(this.TAG,`Received Message from sender=${(t=e==null?void 0:e.peer)==null?void 0:t.peer_id}: ${e}`),(s=this.listener)==null||s.onMessageReceived(e)}},mE=class{constructor(e,t){this.store=e,this.listener=t}handleQualityUpdate(e){var t;let s=e.peers.map(r=>{let l=this.store.getPeerById(r.peer_id);return l&&l.updateNetworkQuality(r.downlink_score),{peerID:r.peer_id,downlinkQuality:r.downlink_score}});(t=this.listener)==null||t.onConnectionQualityUpdate(s)}},Cy=class{constructor(e,t,s){this.store=e,this.eventBus=t,this.listener=s,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=r=>{k.d(this.TAG,"ONTRACKADD",`${r}`),this.tracksToProcess.set(r.trackId,r),this.processPendingTracks()},this.handleTrackRemovedPermanently=r=>{k.d(this.TAG,"ONTRACKREMOVE permanently",r),Object.keys(r.tracks).forEach(l=>{var u;let d=this.store.getTrackState(l);if(!d)return;let h=this.store.getTrackById(l);if(!h){k.d(this.TAG,"Track not found in store");return}h.type==="audio"&&this.eventBus.audioTrackRemoved.publish(h),this.store.removeTrack(h);let p=this.store.getPeerById(d.peerId);p&&(this.removePeerTracks(p,h),(u=this.listener)==null||u.onTrackUpdate(1,h,p))})},this.handleTrackLayerUpdate=r=>{for(let l in r.tracks){let u=r.tracks[l],d=this.store.getTrackById(l);!d||!this.store.getPeerByTrackId(l)||d instanceof yi&&this.setLayer(d,u)}},this.handleTrackUpdate=(r,l=!0)=>{var u,d;let h=this.store.getPeerById(r.peer.peer_id),p=r.peer;if(!h&&!p){k.d(this.TAG,"Track Update ignored - Peer not added to store");return}h||(h=Zr(p,this.store),this.store.addPeer(h));for(let v in r.tracks){let g=Object.assign({},(u=this.store.getTrackState(v))==null?void 0:u.trackInfo),b=r.tracks[v],S=this.store.getTrackById(v);if(this.store.setTrackState({peerId:r.peer.peer_id,trackInfo:W(W({},g),b)}),!S||this.tracksToProcess.has(v))this.processTrackInfo(b,r.peer.peer_id,l),this.processPendingTracks();else{S.setEnabled(!b.mute);let C=this.processTrackUpdate(S,g,b);C&&((d=this.listener)==null||d.onTrackUpdate(C,S,h))}}},this.processTrackInfo=(r,l,u)=>{},this.processPendingTracks=()=>{new Map(this.tracksToProcess).forEach(r=>{var l;let u=this.store.getTrackState(r.trackId);if(!u){k.d(this.TAG,"TrackState not added to store",`peerId - ${r.peerId}`,`trackId -${r.trackId}`);return}let d=this.store.getPeerById(u.peerId);if(!d){k.d(this.TAG,"Peer not added to store, peerId",u.peerId);return}r.source=u.trackInfo.source,r.peerId=d.peerId,r.logIdentifier=d.name,r.setEnabled(!u.trackInfo.mute),this.addAudioTrack(d,r),this.addVideoTrack(d,r),r.type==="audio"?this.eventBus.audioTrackAdded.publish({track:r,peer:d}):(l=this.listener)==null||l.onTrackUpdate(0,r,d),this.tracksToProcess.delete(r.trackId)})}}handleTrackMetadataAdd(e){k.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks){let s=e.tracks[t];this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:s})}this.processPendingTracks()}handleTrackRemove(e,t=!0){var s;k.d(this.TAG,"ONTRACKREMOVE",`${e}`);let r=this.store.getTrackState(e.trackId);if(r){if(!this.store.hasTrack(e)){k.d(this.TAG,"Track not found in store");return}if(t){this.store.removeTrack(e);let l=this.store.getPeerById(r.peerId);if(!l)return;this.removePeerTracks(l,e),(s=this.listener)==null||s.onTrackUpdate(1,e,l),e.type==="audio"&&this.eventBus.audioTrackRemoved.publish(e)}}}setLayer(e,t){var s,r;let l=this.store.getPeerByTrackId(e.trackId);l&&(e.setLayerFromServer(t)?(s=this.listener)==null||s.onTrackUpdate(5,e,l):(r=this.listener)==null||r.onTrackUpdate(6,e,l))}removePeerTracks(e,t){let s=e.auxiliaryTracks.indexOf(t);s>-1?(e.auxiliaryTracks.splice(s,1),k.d(this.TAG,"auxiliary track removed",`${t}`)):t.type==="audio"&&e.audioTrack===t?(e.audioTrack=void 0,k.d(this.TAG,"audio track removed",`${t}`)):t.type==="video"&&e.videoTrack===t&&(e.videoTrack=void 0,k.d(this.TAG,"video track removed",`${t}`))}addAudioTrack(e,t){var s;t.type==="audio"&&(t.source==="regular"&&(!e.audioTrack||((s=e.audioTrack)==null?void 0:s.trackId)===t.trackId)?e.audioTrack=t:e.auxiliaryTracks.push(t),this.store.addTrack(t),k.d(this.TAG,"audio track added",`${t}`))}addVideoTrack(e,t){if(t.type!=="video")return;let s=t,r=this.store.getSimulcastDefinitionsForPeer(e,s.source);if(s.setSimulcastDefinitons(r),this.addAsPrimaryVideoTrack(e,s))e.videoTrack?e.videoTrack.replaceTrack(s):e.videoTrack=s,this.store.addTrack(e.videoTrack);else{let l=e.auxiliaryTracks.findIndex(u=>u.trackId===s.trackId);l===-1?(e.auxiliaryTracks.push(s),this.store.addTrack(s)):(e.auxiliaryTracks[l].replaceTrack(s),this.store.addTrack(e.auxiliaryTracks[l]))}k.d(this.TAG,"video track added",`${t}`)}addAsPrimaryVideoTrack(e,t){var s;return t.source==="regular"&&(!e.videoTrack||((s=e.videoTrack)==null?void 0:s.trackId)===t.trackId)}processTrackUpdate(e,t,s){let r;return t.mute!==s.mute?(r=s.mute?2:3,e.type==="audio"&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!s.mute})):t.description!==s.description&&(r=4),r}},yE=class extends Cy{constructor(e,t,s,r){super(e,t,r),this.transport=s,this.TAG="[OnDemandTrackManager]",this.processTrackInfo=(l,u,d=!0)=>{var h,p;if(l.type!=="video")return;let v=this.store.getPeerById(u);if(!v||!this.isPeerRoleSubscribed(u)){k.d(this.TAG,`no peer in store for peerId: ${u}`);return}let g=new Ah(new MediaStream,this.transport.getSubscribeConnection()),b=nu.getEmptyVideoTrack();b.enabled=!l.mute;let S=new yi(g,b,l.source,(h=this.store.getRoom())==null?void 0:h.disableNoneLayerRequest);S.setTrackId(l.track_id),S.peerId=v.peerId,S.logIdentifier=v.name,this.addVideoTrack(v,S),d&&((p=this.listener)==null||p.onTrackUpdate(0,v.videoTrack,v))}}handleTrackMetadataAdd(e){super.handleTrackMetadataAdd(e);for(let t in e.tracks)e.tracks[t].type==="video"&&this.processTrackInfo(e.tracks[t],e.peer.peer_id)}handleTrackRemove(e){let t=e.type==="video"&&e.source==="regular";super.handleTrackRemove(e,!t),t&&this.processTrackInfo({track_id:e.trackId,mute:!e.enabled,type:e.type,source:e.source,stream_id:e.stream.id},e.peerId,!1)}addAsPrimaryVideoTrack(e,t){return t.source!=="regular"?!1:!e.videoTrack||e.videoTrack.trackId===t.trackId?!0:e.videoTrack.enabled&&Jr(e.videoTrack.nativeTrack)}isPeerRoleSubscribed(e){var t,s,r,l;if(!e)return!0;let u=this.store.getLocalPeer(),d=this.store.getPeerById(e);return d&&((l=(s=(t=u==null?void 0:u.role)==null?void 0:t.subscribeParams)==null?void 0:s.subscribeToRoles)==null?void 0:l.includes((r=d.role)==null?void 0:r.name))}},bE=class{constructor(e,t,s,r){this.store=e,this.peerManager=t,this.trackManager=s,this.listener=r,this.TAG="[PeerListManager]",this.handleInitialPeerList=l=>{let u=Object.values(l.peers);this.peerManager.handlePeerList(u)},this.handleReconnectPeerList=l=>{this.handleRepeatedPeerList(l.peers)},this.handlePreviewRoomState=l=>{if(!this.store.hasRoleDetailsArrived())return;let u=l.peers;if(u==null){l.peer_count===0&&this.handleRepeatedPeerList({});return}Object.keys(u).forEach(d=>{u[d].tracks={},u[d].is_from_room_state=!0}),this.handleRepeatedPeerList(u)},this.handleRepeatedPeerList=l=>{let u=this.store.getRemotePeers(),d=Object.values(l),h=u.filter(v=>!l[v.peerId]);h.length>0&&k.d(this.TAG,`${h}`),h.forEach(v=>{var g;let b={peer_id:v.peerId,role:((g=v.role)==null?void 0:g.name)||"",info:{name:v.name,data:v.metadata||"",user_id:v.customerUserId||"",type:v.type},tracks:{},groups:[],realtime:v.realtime};this.peerManager.handlePeerLeave(b)});let p=[];d.forEach(v=>{let g=this.store.getPeerById(v.peer_id),b=Object.values(v.tracks);g&&(this.store.getPeerTracks(g.peerId).forEach(S=>{var C;v.tracks[S.trackId]||(this.removePeerTrack(g,S.trackId),(C=this.listener)==null||C.onTrackUpdate(1,S,g))}),b.forEach(S=>{this.store.getTrackById(S.track_id)||this.store.setTrackState({peerId:g.peerId,trackInfo:S})}),this.trackManager.handleTrackUpdate({peer:v,tracks:v.tracks},!1),this.peerManager.handlePeerUpdate(v)),p.push(v)}),p.length>0&&this.peerManager.handlePeerList(p)}}handleNotification(e,t,s){if(e==="peer-list"){let r=t;s?(k.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(k.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e==="room-state"){let r=t;this.handlePreviewRoomState(r)}}removePeerTrack(e,t){var s,r;if(k.d(this.TAG,`removing track - ${t} from ${e}`),((s=e.audioTrack)==null?void 0:s.trackId)===t)e.audioTrack=void 0;else if(((r=e.videoTrack)==null?void 0:r.trackId)===t)e.videoTrack=void 0;else{let l=e.auxiliaryTracks.findIndex(u=>u.trackId===t);l>=0&&e.auxiliaryTracks.splice(l,1)}}},Qe=e=>e?new Date(e):void 0,SE=class{constructor(e,t,s){this.store=e,this.trackManager=t,this.listener=s,this.TAG="[PeerManager]",this.handlePeerList=r=>{var l,u;if(r.length===0){(l=this.listener)==null||l.onPeerUpdate(9,[]);return}let d=[],h=new Set(r.map(p=>p.peer_id));this.store.getRemotePeers().forEach(({peerId:p,fromRoomState:v})=>{!h.has(p)&&v&&this.store.removePeer(p)});for(let p of r)d.push(this.makePeer(p));(u=this.listener)==null||u.onPeerUpdate(9,d),this.trackManager.processPendingTracks()},this.handlePeerJoin=r=>{var l;let u=this.makePeer(r);(l=this.listener)==null||l.onPeerUpdate(0,u),this.trackManager.processPendingTracks()},this.handlePeerLeave=r=>{var l,u,d,h;let p=this.store.getPeerById(r.peer_id);this.store.removePeer(r.peer_id),k.d(this.TAG,"PEER_LEAVE",r.peer_id,`remainingPeers=${this.store.getPeers().length}`),p&&(p.audioTrack&&((l=this.listener)==null||l.onTrackUpdate(1,p.audioTrack,p)),p.videoTrack&&((u=this.listener)==null||u.onTrackUpdate(1,p.videoTrack,p)),(d=p.auxiliaryTracks)==null||d.forEach(v=>{var g;(g=this.listener)==null||g.onTrackUpdate(1,v,p)}),(h=this.listener)==null||h.onPeerUpdate(1,p))}}handleNotification(e,t){switch(e){case"on-peer-join":{let s=t;this.handlePeerJoin(s);break}case"on-peer-leave":{let s=t;this.handlePeerLeave(s);break}case"on-peer-update":this.handlePeerUpdate(t);break}}handlePeerUpdate(e){var t,s,r,l,u;let d=this.store.getPeerById(e.peer_id);if(!d&&e.realtime){d=this.makePeer(e),(t=this.listener)==null||t.onPeerUpdate(d.isHandRaised?12:14,d);return}if(d&&!d.isLocal&&!e.realtime){this.store.removePeer(d.peerId),(s=this.listener)==null||s.onPeerUpdate(13,d);return}if(!d){k.d(this.TAG,`peer ${e.peer_id} not found`);return}if(d.role&&d.role.name!==e.role){let v=this.store.getPolicyForRole(e.role);d.updateRole(v),this.updateSimulcastLayersForPeer(d),(r=this.listener)==null||r.onPeerUpdate(8,d)}let h=d.isHandRaised;d.updateGroups(e.groups);let p=(l=e.groups)==null?void 0:l.includes(Kr);h!==p&&((u=this.listener)==null||u.onPeerUpdate(12,d)),this.handlePeerInfoUpdate(W({peer:d},e.info))}handlePeerInfoUpdate({peer:e,name:t,data:s}){var r,l;e&&(t&&e.name!==t&&(e.updateName(t),(r=this.listener)==null||r.onPeerUpdate(10,e)),s&&e.metadata!==s&&(e.updateMetadata(s),(l=this.listener)==null||l.onPeerUpdate(11,e)))}makePeer(e){let t=this.store.getPeerById(e.peer_id);t||(t=Zr(e,this.store),t.realtime=e.realtime,t.joinedAt=Qe(e.joined_at),t.fromRoomState=!!e.is_from_room_state,this.store.addPeer(t),k.d(this.TAG,"adding to the peerList",`${t}`));for(let s in e.tracks){let r=e.tracks[s];this.store.setTrackState({peerId:e.peer_id,trackInfo:r}),r.type==="video"&&this.trackManager.processTrackInfo(r,e.peer_id,!1)}return t}updateSimulcastLayersForPeer(e){this.store.getPeerTracks(e.peerId).forEach(t=>{if(t.type==="video"&&["regular","screen"].includes(t.source)){let s=t,r=this.store.getSimulcastDefinitionsForPeer(e,s.source);s.setSimulcastDefinitons(r)}})}},TE=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){let t=this.store.getLocalPeer();if(t&&!t.role){let r=e.known_roles[e.name];t.updateRole(r)}this.store.setKnownRoles(e);let s=this.store.getRoom();s?s.templateId=e.template_id:k.w("[PolicyChangeManager]","on policy change - room not present"),this.updateLocalPeerRole(e),this.eventBus.policyChange.publish(e)}updateLocalPeerRole(e){var t;let s=this.store.getLocalPeer();if(s!=null&&s.role&&s.role.name!==e.name){let r=this.store.getPolicyForRole(e.name),l=s.role;s.updateRole(r),r.name===((t=s.asRole)==null?void 0:t.name)&&delete s.asRole,this.eventBus.localRoleUpdate.publish({oldRole:l,newRole:r})}}},Ry=(e=>(e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer",e.FLAG_PUBLISH_STATS="publishStats",e.FLAG_SUBSCRIBE_STATS="subscribeStats",e.FLAG_ON_DEMAND_TRACKS="onDemandTracks",e.FLAG_DISABLE_VIDEO_TRACK_AUTO_UNSUBSCRIBE="disableVideoTrackAutoUnsubscribe",e.FLAG_WHITEBOARD_ENABLED="whiteboardEnabled",e.FLAG_EFFECTS_SDK_ENABLED="effectsSDKEnabled",e.FLAG_VB_ENABLED="vb",e.FLAG_HIPAA_ENABLED="hipaa",e.FLAG_NOISE_CANCELLATION="noiseCancellation",e.FLAG_SCALE_SCREENSHARE_BASED_ON_PIXELS="scaleScreenshareBasedOnPixels",e.FLAG_DISABLE_NONE_LAYER_REQUEST="disableNoneLayerRequest",e))(Ry||{}),th=(e,t,s)=>{let r=s==="qa"?q0:V0,l=new URL(r);return l.searchParams.set("endpoint",`https://${t}`),l.searchParams.set("token",e),l.toString()},kE=class{constructor(e,t,s){this.transport=e,this.store=t,this.listener=s,this.TAG="[HMSWhiteboardInteractivityCenter]"}get isEnabled(){return this.transport.isFlagEnabled("whiteboardEnabled")}open(e){return y(this,null,function*(){var t;if(!this.isEnabled)return k.w(this.TAG,"Whiteboard is not enabled for customer");let s=this.store.getWhiteboard(e==null?void 0:e.id),r=s==null?void 0:s.id;if(s||(r=(yield this.transport.signal.createWhiteboard(this.getCreateOptionsWithDefaults(e))).id),!r)throw new Error(`Whiteboard ID: ${r} not found`);let l=yield this.transport.signal.getWhiteboard({id:r}),u=Se(W({},s),{title:e==null?void 0:e.title,attributes:e==null?void 0:e.attributes,id:l.id,url:th(l.token,l.addr,this.store.getEnv()),token:l.token,addr:l.addr,owner:l.owner,permissions:l.permissions||[],open:!0});this.store.setWhiteboard(u),(t=this.listener)==null||t.onWhiteboardUpdate(u)})}close(e){return y(this,null,function*(){var t;if(!this.isEnabled)return k.w(this.TAG,"Whiteboard is not enabled for customer");let s=this.store.getWhiteboard(e);if(!s)throw new Error(`Whiteboard ID: ${e} not found`);let r={id:s.id,title:s.title,open:!1};this.store.setWhiteboard(r),(t=this.listener)==null||t.onWhiteboardUpdate(r)})}setListener(e){this.listener=e}handleLocalRoleUpdate(){return y(this,null,function*(){var e,t,s;let r=this.store.getWhiteboards();for(let l of r.values())if(l.url){let u=yield this.transport.signal.getWhiteboard({id:l.id}),d=this.store.getLocalPeer(),h=(d==null?void 0:d.customerUserId)===u.owner?(t=(e=d.role)==null?void 0:e.permissions.whiteboard)==null?void 0:t.includes("admin"):u.permissions.length>0,p=Se(W({},l),{id:u.id,url:th(u.token,u.addr,this.store.getEnv()),token:u.token,addr:u.addr,owner:u.owner,permissions:u.permissions,open:h});this.store.setWhiteboard(p),(s=this.listener)==null||s.onWhiteboardUpdate(p)}})}getCreateOptionsWithDefaults(e){var t;let s=Object.values(this.store.getKnownRoles()),r=[],l=[],u=[];return s.forEach(d=>{var h,p,v;(h=d.permissions.whiteboard)!=null&&h.includes("read")&&r.push(d.name),(p=d.permissions.whiteboard)!=null&&p.includes("write")&&l.push(d.name),(v=d.permissions.whiteboard)!=null&&v.includes("admin")&&u.push(d.name)}),{title:(e==null?void 0:e.title)||`${(t=this.store.getRoom())==null?void 0:t.id} Whiteboard`,reader:(e==null?void 0:e.reader)||r,writer:(e==null?void 0:e.writer)||l,admin:(e==null?void 0:e.admin)||u}}},EE=class{constructor(e,t,s){this.transport=e,this.store=t,this.listener=s,this.whiteboard=new kE(e,t,s)}setListener(e){this.listener=e,this.whiteboard.setListener(e)}createPoll(e){return y(this,null,function*(){var t,s;let r={customerID:"userid",peerID:"peerid",userName:"username"},{poll_id:l}=yield this.transport.signal.setPollInfo(Se(W({},e),{mode:e.mode?r[e.mode]:void 0,poll_id:e.id,vote:e.rolesThatCanVote,responses:e.rolesThatCanViewResponses}));e.id||(e.id=l),Array.isArray(e.questions)&&(yield this.addQuestionsToPoll(e.id,e.questions));let u=yield this.transport.signal.getPollQuestions({poll_id:e.id,index:0,count:50}),d=ih(Se(W({},e),{poll_id:e.id,state:"created",created_by:(t=this.store.getLocalPeer())==null?void 0:t.peerId}));d.questions=u.questions.map(({question:h,options:p,answer:v})=>Se(W({},h),{options:p,answer:v})),(s=this.listener)==null||s.onPollsUpdate(0,[d])})}startPoll(e){return y(this,null,function*(){typeof e=="string"?yield this.transport.signal.startPoll({poll_id:e}):(yield this.createPoll(e),yield this.transport.signal.startPoll({poll_id:e.id}))})}addQuestionsToPoll(e,t){return y(this,null,function*(){t.length>0&&(yield this.transport.signal.setPollQuestions({poll_id:e,questions:t.map((s,r)=>this.createQuestionSetParams(s,r))}))})}stopPoll(e){return y(this,null,function*(){yield this.transport.signal.stopPoll({poll_id:e})})}addResponsesToPoll(e,t){return y(this,null,function*(){let s=this.store.getPoll(e);if(!s)throw new Error("Invalid poll ID - Poll not found");let r=t.map(l=>{var u,d;let h=this.getQuestionInPoll(s,l.questionIndex);return h.type==="single-choice"?(l.option=l.option||((u=l.options)==null?void 0:u[0])||-1,delete l.text,delete l.options):h.type==="multiple-choice"?((d=l.options)==null||d.sort(),delete l.text,delete l.option):(delete l.option,delete l.options),l.skipped&&(delete l.option,delete l.options,delete l.text),W({duration:0,type:h.type,question:l.questionIndex},l)});yield this.transport.signal.setPollResponses({poll_id:e,responses:r})})}fetchLeaderboard(e,t,s){return y(this,null,function*(){var r,l;let u=this.store.getPoll(e);if(!u)throw new Error("Invalid poll ID - Poll not found");let d=(l=(r=this.store.getLocalPeer())==null?void 0:r.role)==null?void 0:l.permissions,h=!!(d!=null&&d.pollRead||d!=null&&d.pollWrite);if(u.anonymous||u.state!=="stopped"||!h)return{entries:[],hasNext:!1};let p=yield this.transport.signal.fetchPollLeaderboard({poll_id:u.id,count:s,offset:t}),v={avgScore:p.avg_score,avgTime:p.avg_time,votedUsers:p.voted_users,totalUsers:p.total_users,correctUsers:p.correct_users};return{entries:p.questions.map(g=>({position:g.position,totalResponses:g.total_responses,correctResponses:g.correct_responses,duration:g.duration,peer:g.peer,score:g.score})),hasNext:!p.last,summary:v}})}getPollResponses(e,t){return y(this,null,function*(){var s,r;let l=yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t}),u=JSON.parse(JSON.stringify(e));(s=l.responses)==null||s.forEach(({response:d,peer:h,final:p})=>{var v,g;let b=(v=e==null?void 0:e.questions)==null?void 0:v.find(S=>S.index===d.question);if(b){let S={id:d.response_id,questionIndex:d.question,option:d.option,options:d.options,text:d.text,responseFinal:p,peer:{peerid:h.peerid,userHash:h.hash,userid:h.userid,username:h.username},skipped:d.skipped,type:d.type,update:d.update},C=b.responses&&!t?[...b.responses]:[];(g=u.questions)!=null&&g[d.question-1]&&(u.questions[d.question-1].responses=[...C,S])}}),this.store.setPoll(u),(r=this.listener)==null||r.onPollsUpdate(4,[u])})}getPolls(){return y(this,null,function*(){var e,t,s;let r=yield this.transport.signal.getPollsList({count:50,state:"started"}),l=[],u=(t=(e=this.store.getLocalPeer())==null?void 0:e.role)==null?void 0:t.permissions.pollWrite,d=[...r.polls];if(u){let h=yield this.transport.signal.getPollsList({count:50,state:"created"}),p=yield this.transport.signal.getPollsList({count:50,state:"stopped"});d=[...h.polls,...d,...p.polls]}for(let h of d){let p=yield this.transport.signal.getPollQuestions({poll_id:h.poll_id,index:0,count:50}),v=ih(h),g=this.store.getPoll(h.poll_id);v.questions=p.questions.map(({question:b,options:S,answer:C},D)=>{var M,j;return Se(W({},b),{options:S,answer:C,responses:(j=(M=g==null?void 0:g.questions)==null?void 0:M[D])==null?void 0:j.responses})}),l.push(v),this.store.setPoll(v)}return(s=this.listener)==null||s.onPollsUpdate(3,l),l})}createQuestionSetParams(e,t){var s,r;if(e.index){let h=(s=e.options)==null?void 0:s.map((p,v)=>Se(W({},p),{index:v+1}));return{question:Se(W({},e),{index:t+1}),options:h,answer:e.answer}}let l=Se(W({},e),{index:t+1}),u,d=e.answer||{hidden:!1};return Array.isArray(e.options)&&["single-choice","multiple-choice"].includes(e.type)?(u=(r=e.options)==null?void 0:r.map((h,p)=>({index:p+1,text:h.text,weight:h.weight})),e.type==="single-choice"?d.option=e.options.findIndex(h=>h.isCorrectAnswer)+1||void 0:d.options=e.options.map((h,p)=>h.isCorrectAnswer?p+1:void 0).filter(h=>!!h)):(d==null||delete d.options,d==null||delete d.option),{question:l,options:u,answer:d}}getQuestionInPoll(e,t){var s;let r=(s=e==null?void 0:e.questions)==null?void 0:s.find(l=>l.index===t);if(!r)throw new Error("Invalid question index - Question not found in poll");return r}},ih=e=>{let t={userid:"customerID",peerid:"peerID",username:"userName"};return{id:e.poll_id,title:e.title,startedBy:e.started_by,createdBy:e.created_by,anonymous:e.anonymous,type:e.type,duration:e.duration,locked:e.locked,mode:e.mode?t[e.mode]:void 0,visibility:e.visibility,rolesThatCanVote:e.vote||[],rolesThatCanViewResponses:e.responses||[],state:e.state,stoppedBy:e.stopped_by,startedAt:Qe(e.started_at),stoppedAt:Qe(e.stopped_at),createdAt:Qe(e.created_at)}},AE=class{constructor(e,t,s){this.store=e,this.transport=t,this.listener=s}handleNotification(e,t){switch(e){case"on-poll-start":{this.handlePollStart(t);break}case"on-poll-stop":{this.handlePollStop(t);break}case"on-poll-stats":this.handlePollStats(t);break}}handlePollStart(e){return y(this,null,function*(){var t,s;let r=[];for(let l of e.polls){let u=this.store.getPoll(l.poll_id);if(u&&u.state==="started"){(t=this.listener)==null||t.onPollsUpdate(1,[u]);return}let d=yield this.transport.signal.getPollQuestions({poll_id:l.poll_id,index:0,count:50}),h=ih(l);h.questions=d.questions.map(({question:p,options:v,answer:g})=>Se(W({},p),{options:v,answer:g})),yield this.updatePollResponses(h,!0),r.push(h),this.store.setPoll(h)}(s=this.listener)==null||s.onPollsUpdate(1,r)})}handlePollStop(e){return y(this,null,function*(){var t;let s=[];for(let r of e.polls){let l=this.store.getPoll(r.poll_id);if(l){l.state="stopped",l.stoppedAt=Qe(r.stopped_at),l.stoppedBy=r.stopped_by;let u=yield this.transport.signal.getPollResult({poll_id:r.poll_id});this.updatePollResult(l,u),s.push(l)}}s.length>0&&((t=this.listener)==null||t.onPollsUpdate(2,s))})}handlePollStats(e){return y(this,null,function*(){var t;let s=[];for(let r of e.polls){let l=this.store.getPoll(r.poll_id);if(!l)return;this.updatePollResult(l,r),s.push(l)}s.length>0&&((t=this.listener)==null||t.onPollsUpdate(4,s))})}updatePollResult(e,t){var s;e.result=W({},e.result),e.result.totalUsers=t.user_count,e.result.maxUsers=t.max_user,e.result.totalResponses=t.total_response,(s=t.questions)==null||s.forEach(r=>{var l,u;let d=(l=e.questions)==null?void 0:l.find(h=>h.index===r.question);d&&(d.result=W({},d.result),d.result.correctResponses=r.correct,d.result.skippedCount=r.skipped,d.result.totalResponses=r.total,(u=r.options)==null||u.forEach((h,p)=>{var v;let g=(v=d.options)==null?void 0:v[p];g&&g.voteCount!==h&&(g.voteCount=h)}))})}updatePollResponses(e,t){return y(this,null,function*(){var s;(s=(yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t})).responses)==null||s.forEach(({response:r,peer:l,final:u})=>{var d;let h=(d=e==null?void 0:e.questions)==null?void 0:d.find(v=>v.index===r.question);if(!h)return;let p={id:r.response_id,questionIndex:r.question,option:r.option,options:r.options,text:r.text,responseFinal:u,peer:{peerid:l.peerid,userHash:l.hash,userid:l.userid,username:l.username},skipped:r.skipped,type:r.type,update:r.update};Array.isArray(h.responses)&&h.responses.length>0?h.responses.find(({id:v})=>v===p.id)||h.responses.push(p):h.responses=[p]})})}},CE=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case"on-role-change-request":this.handleRoleChangeRequest(t);break;case"on-track-update-request":this.handleTrackUpdateRequest(t);break;case"on-change-track-mute-state-request":this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let s={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};(t=this.listener)==null||t.onRoleChangeRequest(s)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:s,mute:r}=e,l=t?this.store.getPeerById(t):void 0,u=this.store.getLocalPeerTracks().find(h=>h.publishedTrackId===s);if(!u)return;let d=()=>{var h;(h=this.listener)==null||h.onChangeTrackStateRequest({requestedBy:l,track:u,enabled:!r})};if(r){if(u.enabled===!r)return;u.setEnabled(!r).then(d)}else d()}handleChangeTrackStateRequest(e){var t;let{type:s,source:r,value:l,requested_by:u}=e,d=u?this.store.getPeerById(u):void 0,h=!l,p=this.getTracksToBeUpdated({type:s,source:r,enabled:h});if(p.length!==0)if(h)(t=this.listener)==null||t.onChangeMultiTrackStateRequest({requestedBy:d,tracks:p,type:s,source:r,enabled:!0});else{let v=[];for(let g of p)v.push(g.setEnabled(!1));Promise.all(v).then(()=>{var g;(g=this.listener)==null||g.onChangeMultiTrackStateRequest({requestedBy:d,tracks:p,enabled:!1})})}}getTracksToBeUpdated({type:e,source:t,enabled:s}){let r=this.store.getLocalPeerTracks();return e&&(r=r.filter(l=>l.type===e)),t&&(r=r.filter(l=>l.source===t)),r.filter(l=>l.enabled!==s)}},RE=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="[RoomUpdateManager]"}handleNotification(e,t){switch(e){case"peer-list":this.onRoomState(t.room);break;case"on-rtmp-update":this.updateRTMPStatus(t);break;case"on-record-update":this.updateRecordingStatus(t);break;case"room-state":this.handlePreviewRoomState(t);break;case"room-info":this.handleRoomInfo(t);break;case"session-info":this.handleSessionInfo(t);break;case"on-hls-update":this.updateHLSStatus(t);break;case"on-transcription-update":this.handleTranscriptionStatus([t]);break}}handleRoomInfo(e){let t=this.store.getRoom();if(!t){k.w(this.TAG,"on session info - room not present");return}t.description=e.description,t.large_room_optimization=e.large_room_optimization,t.max_size=e.max_size,t.name=e.name}handleSessionInfo(e){var t;let s=this.store.getRoom();if(!s){k.w(this.TAG,"on session info - room not present");return}s.sessionId=e.session_id,s.peerCount!==e.peer_count&&(s.peerCount=e.peer_count,(t=this.listener)==null||t.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",s))}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t)}onRoomState(e){var t,s,r,l;let{recording:u,streaming:d,transcriptions:h,session_id:p,started_at:v,name:g}=e,b=this.store.getRoom();if(!b){k.w(this.TAG,"on room state - room not present");return}b.name=g,b.rtmp.running=this.isStreamingRunning((t=d==null?void 0:d.rtmp)==null?void 0:t.state),b.rtmp.startedAt=Qe((s=d==null?void 0:d.rtmp)==null?void 0:s.started_at),b.rtmp.state=(r=d==null?void 0:d.rtmp)==null?void 0:r.state,b.recording.server=this.getPeerListSFURecording(u),b.recording.browser=this.getPeerListBrowserRecording(u),b.recording.hls=this.getPeerListHLSRecording(u),b.hls=this.convertHls(d==null?void 0:d.hls),b.transcriptions=this.addTranscriptionDetail(h),b.sessionId=p,b.startedAt=Qe(v),(l=this.listener)==null||l.onRoomUpdate("RECORDING_STATE_UPDATED",b)}addTranscriptionDetail(e){return e?e.map(t=>({state:t.state,mode:t.mode,initialised_at:Qe(t.initialised_at),started_at:Qe(t.started_at),stopped_at:Qe(t.stopped_at),updated_at:Qe(t.updated_at),error:this.toSdkError(t==null?void 0:t.error)})):[]}isRecordingRunning(e){return e?!["none","paused","stopped","failed"].includes(e):!1}isStreamingRunning(e){return e?!["none","stopped","failed"].includes(e):!1}initHLS(e){let t=this.store.getRoom(),s={running:!0,variants:[]};return t?(e!=null&&e.variants&&e.variants.forEach((r,l)=>{var u,d,h;r.state!=="initialised"?s.variants.push({meetingURL:r==null?void 0:r.meetingURL,url:r==null?void 0:r.url,metadata:r==null?void 0:r.metadata,playlist_type:r==null?void 0:r.playlist_type,startedAt:Qe((u=e==null?void 0:e.variants)==null?void 0:u[l].started_at),initialisedAt:Qe((d=e==null?void 0:e.variants)==null?void 0:d[l].initialised_at),state:r.state,stream_type:r==null?void 0:r.stream_type}):s.variants.push({initialisedAt:Qe((h=e==null?void 0:e.variants)==null?void 0:h[l].initialised_at),url:""})}),s):(k.w(this.TAG,"on hls - room not present"),s)}updateHLSStatus(e){var t;let s=this.store.getRoom(),r=e.variants&&e.variants.length>0?e.variants.some(l=>this.isStreamingRunning(l.state)):!1;if(!s){k.w(this.TAG,"on hls - room not present");return}e.enabled=r,s.hls=this.convertHls(e),(t=this.listener)==null||t.onRoomUpdate("HLS_STREAMING_STATE_UPDATED",s)}handleTranscriptionStatus(e){var t;let s=this.store.getRoom();if(!s){k.w(this.TAG,"on transcription - room not present");return}s.transcriptions=this.addTranscriptionDetail(e)||[],(t=this.listener)==null||t.onRoomUpdate("TRANSCRIPTION_STATE_UPDATED",s)}convertHls(e){var t;if(e!=null&&e.variants&&e.variants.length>0&&e.variants.some(r=>r.state==="initialised"))return this.initHLS(e);let s={running:!!(e!=null&&e.enabled),variants:[],error:this.toSdkError(e==null?void 0:e.error)};return(t=e==null?void 0:e.variants)==null||t.forEach(r=>{s.variants.push({meetingURL:r==null?void 0:r.meeting_url,url:r==null?void 0:r.url,metadata:r==null?void 0:r.metadata,playlist_type:r==null?void 0:r.playlist_type,startedAt:Qe(r==null?void 0:r.started_at),initialisedAt:Qe(r==null?void 0:r.initialised_at),state:r.state,stream_type:r==null?void 0:r.stream_type})}),s}getHLSRecording(e){var t,s;let r={running:!1},l=this.isRecordingRunning(e==null?void 0:e.state);return(l||(e==null?void 0:e.state)==="paused")&&(r={running:l,singleFilePerLayer:!!((t=e==null?void 0:e.hls_recording)!=null&&t.single_file_per_layer),hlsVod:!!((s=e==null?void 0:e.hls_recording)!=null&&s.hls_vod),startedAt:Qe(e==null?void 0:e.started_at),initialisedAt:Qe(e==null?void 0:e.initialised_at),state:e==null?void 0:e.state,error:this.toSdkError(e==null?void 0:e.error)}),r}getPeerListHLSRecording(e){var t,s;let r=e==null?void 0:e.hls;return{running:this.isRecordingRunning(r==null?void 0:r.state),startedAt:Qe(r==null?void 0:r.started_at),initialisedAt:Qe(r==null?void 0:r.initialised_at),state:r==null?void 0:r.state,singleFilePerLayer:(t=r==null?void 0:r.config)==null?void 0:t.single_file_per_layer,hlsVod:(s=r==null?void 0:r.config)==null?void 0:s.hls_vod}}getPeerListBrowserRecording(e){let t=e==null?void 0:e.browser;return{running:this.isRecordingRunning(t==null?void 0:t.state),startedAt:Qe(t==null?void 0:t.started_at),state:t==null?void 0:t.state}}getPeerListSFURecording(e){let t=e==null?void 0:e.sfu;return{running:this.isRecordingRunning(t==null?void 0:t.state),startedAt:Qe(t==null?void 0:t.started_at),state:t==null?void 0:t.state}}updateRecordingStatus(e){var t;let s=this.store.getRoom(),r=this.isRecordingRunning(e.state);if(!s){k.w(this.TAG,`set recording status running=${r} - room not present`);return}let l;e.type==="sfu"?(s.recording.server={running:r,startedAt:r?Qe(e.started_at):void 0,error:this.toSdkError(e.error),state:e.state},l="SERVER_RECORDING_STATE_UPDATED"):e.type==="HLS"?(s.recording.hls=this.getHLSRecording(e),l="RECORDING_STATE_UPDATED"):(s.recording.browser={running:r,startedAt:r?Qe(e.started_at):void 0,error:this.toSdkError(e.error),state:e==null?void 0:e.state},l="BROWSER_RECORDING_STATE_UPDATED"),(t=this.listener)==null||t.onRoomUpdate(l,s)}updateRTMPStatus(e){var t,s;let r=this.store.getRoom(),l=this.isStreamingRunning(e.state);if(!r){k.w(this.TAG,"on policy change - room not present");return}if(!l){r.rtmp={running:l,state:e.state,error:this.toSdkError(e.error)},(t=this.listener)==null||t.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",r);return}r.rtmp={running:l,startedAt:l?Qe(e.started_at):void 0,state:e.state,error:this.toSdkError(e.error)},(s=this.listener)==null||s.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",r)}toSdkError(e){if(!(e!=null&&e.code))return;let t=e.message||"error in streaming/recording",s=new ge(e.code,"ServerErrors","NONE",t,t);return k.e(this.TAG,"error in streaming/recording",s),s}},_E=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){e==="on-metadata-change"&&this.handleMetadataChange(t)}handleMetadataChange(e){var t;let s=e.values.map(r=>({key:r.key,value:r.data,updatedAt:Qe(r.updated_at),updatedBy:r.updated_by?this.store.getPeerById(r.updated_by):void 0}));(t=this.listener)==null||t.onSessionStoreUpdate(s)}},PE=class{constructor(e,t,s){this.store=e,this.transport=t,this.listener=s}handleNotification(e,t){switch(e){case"on-whiteboard-update":{this.handleWhiteboardUpdate(t);break}}}handleWhiteboardUpdate(e){return y(this,null,function*(){var t;let s=this.store.getLocalPeer(),r=this.store.getWhiteboard(e.id),l=e.owner===(s==null?void 0:s.peerId)||e.owner===(s==null?void 0:s.customerUserId),u=e.state==="open",d={id:e.id,title:e.title,attributes:e.attributes};if(d.open=l?r==null?void 0:r.open:u,d.owner=d.open?e.owner:void 0,d.open)if(l)d.url=r==null?void 0:r.url,d.token=r==null?void 0:r.token,d.addr=r==null?void 0:r.addr,d.permissions=r==null?void 0:r.permissions;else{let h=yield this.transport.signal.getWhiteboard({id:e.id});d.url=th(h.token,h.addr,this.store.getEnv()),d.token=h.token,d.addr=h.addr,d.permissions=h.permissions,d.open=h.permissions.length>0}this.store.setWhiteboard(d),(t=this.listener)==null||t.onWhiteboardUpdate(d)})}},DE=class{constructor(e,t,s,r,l,u){this.store=e,this.transport=s,this.listener=r,this.audioListener=l,this.connectionQualityListener=u,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=h=>{if(h==="peer-list")this.hasConsistentRoomStateArrived=!0;else if(h==="room-state")return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=h=>{this.trackManager.handleTrackAdd(h)},this.handleTrackRemove=h=>{this.trackManager.handleTrackRemove(h)},this.updateLocalPeer=({name:h,metadata:p})=>{let v=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:v,name:h,data:p})};let d=this.transport.isFlagEnabled("onDemandTracks");this.trackManager=d?new yE(this.store,t,this.transport,this.listener):new Cy(this.store,t,this.listener),this.peerManager=new SE(this.store,this.trackManager,this.listener),this.peerListManager=new bE(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new gE(this.listener),this.policyChangeManager=new TE(this.store,t),this.requestManager=new CE(this.store,this.listener),this.activeSpeakerManager=new vE(this.store,this.listener,this.audioListener),this.connectionQualityManager=new mE(this.store,this.connectionQualityListener),this.roomUpdateManager=new RE(this.store,this.listener),this.sessionMetadataManager=new _E(this.store,this.listener),this.pollsManager=new AE(this.store,this.transport,this.listener),this.whiteboardManager=new PE(this.store,this.transport,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e,this.sessionMetadataManager.listener=e,this.pollsManager.listener=e,this.whiteboardManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var s,r;let l=e.method,u=e.params;["active-speakers","sfu-stats","on-connection-quality-update",void 0].includes(l)||k.d(this.TAG,`Received notification - ${l}`,{notification:u}),l==="sfu-stats"&&(s=window.HMS)!=null&&s.ON_SFU_STATS&&typeof((r=window.HMS)==null?void 0:r.ON_SFU_STATS)=="function"&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(l)&&(this.roomUpdateManager.handleNotification(l,u),this.peerManager.handleNotification(l,u),this.requestManager.handleNotification(l,u),this.peerListManager.handleNotification(l,u,t),this.broadcastManager.handleNotification(l,u),this.sessionMetadataManager.handleNotification(l,u),this.pollsManager.handleNotification(l,u),this.whiteboardManager.handleNotification(l,u),this.handleIsolatedMethods(l,u))}handleIsolatedMethods(e,t){switch(e){case"on-track-add":{this.trackManager.handleTrackMetadataAdd(t);break}case"on-track-update":{this.trackManager.handleTrackUpdate(t);break}case"on-track-remove":{if(!t.peer){k.d(this.TAG,`Ignoring sfu notification - ${e}`,{notification:t});return}this.trackManager.handleTrackRemovedPermanently(t);break}case"on-track-layer-update":{this.trackManager.handleTrackLayerUpdate(t);break}case"active-speakers":this.activeSpeakerManager.handleActiveSpeakers(t);break;case"on-connection-quality-update":this.connectionQualityManager.handleQualityUpdate(t);break;case"on-policy-change":this.policyChangeManager.handlePolicyChange(t);break;case"node-info":this.transport.setSFUNodeId(t.sfu_node_id);break}}},wE=class{constructor(e){this.transport=e,this.observedKeys=new Set}get(e){return y(this,null,function*(){let{data:t,updated_at:s}=yield this.transport.signal.getSessionMetadata(e);return{value:t,updatedAt:Qe(s)}})}set(e,t){return y(this,null,function*(){let{data:s,updated_at:r}=yield this.transport.signal.setSessionMetadata({key:e,data:t}),l=Qe(r);return{value:s,updatedAt:l}})}observe(e){return y(this,null,function*(){let t=new Set(this.observedKeys);if(e.forEach(s=>this.observedKeys.add(s)),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(s){throw this.observedKeys=t,s}})}unobserve(e){return y(this,null,function*(){let t=new Set(this.observedKeys);if(this.observedKeys=new Set([...this.observedKeys].filter(s=>!e.includes(s))),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(s){throw this.observedKeys=t,s}})}},ME=class{constructor(e,t,s="",r="",l="https://prod-init.100ms.live/init",u=!1,d){this.authToken=e,this.peerId=t,this.peerName=s,this.data=r,this.endpoint=l,this.autoSubscribeVideo=u,this.iceServers=d}},ti=(e=>(e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed",e))(ti||{}),OE={0:[],1:[],2:[1],3:[1],4:[1]},nh=(e=>(e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving",e))(nh||{}),LE=class{constructor(e){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s,e(t,s)})}},IE=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return y(this,arguments,function*({category:t,error:s,task:r,originalState:l,maxRetryTime:u=6e4,changeState:d=!0}){yield this.scheduleTask({category:t,error:s,changeState:d,task:r,originalState:l,maxRetryTime:u,failedAt:Date.now()})})}reset(){this.retryTaskIds.forEach(e=>clearTimeout(e)),this.retryTaskIds=[],this.inProgress.clear()}isTaskInProgress(e){return!!this.inProgress.get(e)}scheduleTask(e){return y(this,arguments,function*({category:t,error:s,changeState:r,task:l,originalState:u,failedAt:d,maxRetryTime:h=6e4,failedRetryCount:p=0}){if(k.d(this.TAG,"schedule: ",{category:ti[t],error:s}),p===0){let M=this.inProgress.get(t);if(M){k.d(this.TAG,`schedule: Already a task for ${ti[t]} scheduled, waiting for its completion`),yield M.promise;return}let j=new LE((le,oe)=>{});this.inProgress.set(t,j),this.sendEvent(s,t)}let v=!1,g=OE[t];for(let M in g){let j=g[parseInt(M)];try{let le=this.inProgress.get(j);le&&(k.d(this.TAG,`schedule: Suspending retry task of ${ti[t]}, waiting for ${ti[j]} to recover`),yield le.promise,k.d(this.TAG,`schedule: Resuming retry task ${ti[t]} as it's dependency ${ti[j]} is recovered`))}catch{k.d(this.TAG,`schedule: Stopping retry task of ${ti[t]} as it's dependency ${ti[j]} failed to recover`),v=!0;break}}let b=M=>{if(this.inProgress.delete(t),this.sendEvent(M,t),this.reset(),r)this.onStateChange("Failed",M);else throw M},S=Date.now()-d;if(S>=h||v)return s.description+=`. [${ti[t]}] Could not recover after ${S} milliseconds`,v&&(s.description+=` Could not recover all of it's required dependencies - [${g.map(M=>ti[M]).toString()}]`),s.isTerminal=!0,b(s);r&&this.onStateChange("Reconnecting",s);let C=this.getDelayForRetryCount(t);k.d(this.TAG,`schedule: [${ti[t]}] [failedRetryCount=${p}] Scheduling retry task in ${C}ms`);let D;try{D=yield this.setTimeoutPromise(l,C)}catch(M){D=!1;let j=M;if(j.isTerminal)return k.e(this.TAG,`[${ti[t]}] Un-caught terminal exception ${j.name} in retry-task`,M),b(j);k.w(this.TAG,`[${ti[t]}] Un-caught exception ${j.name} in retry-task, initiating retry`,M)}if(D){let M=this.inProgress.get(t);this.inProgress.delete(t),M==null||M.resolve(p),r&&this.inProgress.size===0&&this.onStateChange(u),k.d(this.TAG,`schedule: [${ti[t]}] [failedRetryCount=${p}] Recovered  after ${S}ms`)}else yield this.scheduleTask({category:t,error:s,changeState:r,task:l,originalState:u,maxRetryTime:h,failedAt:d,failedRetryCount:p+1})})}getDelayForRetryCount(e){let t=e===2?Math.random()*2:Math.random(),s=0;return e===2?s=2+t:e===1&&(s=1),s*1e3}setTimeoutPromise(e,t){return y(this,null,function*(){return new Promise((s,r)=>{let l=window.setTimeout(()=>y(this,null,function*(){try{let u=yield e();u&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(l),1),s(u)}catch(u){r(u)}}),t);this.retryTaskIds.push(l)})})}},NE=class extends Eh{constructor(){super(100),this.localStorage=new ou("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;(e=this.localStorage.get())==null||e.forEach(t=>{let s=new Fe(t);super.enqueue(s)})}},UE=class{constructor(){this.TAG="[AnalyticsTransport]",this.eventCount=0,this.lastResetTime=Date.now(),this.MAX_EVENTS_PER_MINUTE=200,this.RESET_INTERVAL_MS=6e4}checkRateLimit(){let e=Date.now();if(e-this.lastResetTime>=this.RESET_INTERVAL_MS&&(this.eventCount=0,this.lastResetTime=e),this.eventCount>=this.MAX_EVENTS_PER_MINUTE)throw new Error("Too many events being sent, please check the implementation.");this.eventCount++}sendEvent(e){try{this.checkRateLimit()}catch(t){throw k.w(this.TAG,"Rate limit exceeded",t),t}try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){k.w(this.TAG,"sendEvent failed",t)}}flushFailedEvents(e){var t;try{for(k.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let s=this.failedEvents.dequeue();s&&(((t=s.metadata)==null?void 0:t.peer.peer_id)===e||!s.metadata.peer.peer_id?this.sendSingleEvent(s):Tl.sendEvent(s))}}catch(s){k.w(this.TAG,"flushFailedEvents failed",s)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),k.d(this.TAG,"Sent event",e.name,e)}catch(t){throw k.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}},xE=class extends UE{constructor(e){super(),this.transportProvider=e,this.failedEvents=new NE}},_y=class{constructor(e,t,s,r){this.store=e,this.eventBus=t,this.sampleWindowSize=s,this.pushInterval=r,this.shouldSendEvent=!1,this.sequenceNum=1,this.stop=()=>{this.shouldSendEvent&&this.sendEvent(),this.eventBus.statsUpdate.unsubscribe(this.handleStatsUpdate.bind(this)),this.shouldSendEvent=!1},this.start()}start(){this.shouldSendEvent||(this.stop(),this.shouldSendEvent=!0,this.eventBus.statsUpdate.subscribe(this.handleStatsUpdate.bind(this)),this.startLoop().catch(e=>k.e("[StatsAnalytics]",e.message)))}startLoop(){return y(this,null,function*(){for(;this.shouldSendEvent;)yield Ts(this.pushInterval*1e3),this.sendEvent()})}sendEvent(){this.trackAnalytics.forEach(e=>{e.clearSamples()})}cleanTrackAnalyticsAndCreateSample(e){this.trackAnalytics.forEach(t=>{!this.store.hasTrack(t.track)&&!(t.samples.length>0)&&this.trackAnalytics.delete(t.track_id)}),e&&this.trackAnalytics.forEach(t=>{t.createSample()})}},Py=class{constructor({track:e,ssrc:t,rid:s,kind:r,sampleWindowSize:l}){this.samples=[],this.tempStats=[],this.track=e,this.ssrc=t,this.rid=s,this.kind=r,this.track_id=this.track.trackId,this.source=this.track.source,this.sampleWindowSize=l}pushTempStat(e){this.tempStats.push(e)}createSample(){this.tempStats.length!==0&&(this.samples.push(this.collateSample()),this.prevLatestStat=this.getLatestStat(),this.tempStats.length=0)}clearSamples(){this.samples.length=0}getLatestStat(){return this.tempStats[this.tempStats.length-1]}getFirstStat(){return this.tempStats[0]}calculateSum(e){if(typeof this.getLatestStat()[e]=="number")return this.tempStats.reduce((t,s)=>t+(s[e]||0),0)}calculateAverage(e,t=!0){let s=this.calculateSum(e),r=s!==void 0?s/this.tempStats.length:void 0;return r?t?Math.round(r):r:void 0}calculateDifferenceForSample(e){var t;let s=Number((t=this.prevLatestStat)==null?void 0:t[e])||0;return(Number(this.getLatestStat()[e])||0)-s}calculateDifferenceAverage(e,t=!0){let s=this.calculateDifferenceForSample(e)/this.tempStats.length;return t?Math.round(s):s}calculateInstancesOfHigh(e,t){if(typeof this.getLatestStat()[e]=="number")return this.tempStats.reduce((s,r)=>s+((r[e]||0)>t?1:0),0)}},Dy=(e,t)=>e&&t&&(e.frameWidth!==t.frameWidth||e.frameHeight!==t.frameHeight),wy=(e,t)=>e&&t&&e.enabled!==t.enabled,sh=e=>Object.entries(e).filter(([,t])=>t!==void 0).reduce((t,[s,r])=>(t[s]=r,t),{}),BE=class extends _y{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let s=[],r=[];return this.trackAnalytics.forEach(l=>{l.track.type==="audio"?s.push(l.toAnalytics()):l.track.type==="video"&&r.push(l.toAnalytics())}),{audio:s,video:r,joined_at:(t=(e=this.store.getRoom())==null?void 0:e.joinedAt)==null?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:30}}sendEvent(){this.eventBus.analytics.publish(be.publishStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=!1,s=e.getLocalTrackStats();Object.keys(s).forEach(r=>{let l=s[r],u=this.store.getLocalPeerTracks().find(d=>d.getTrackIDBeingSent()===r);Object.keys(l).forEach(d=>{var h,p,v;let g=l[d];if(!u)return;let b=this.getTrackIdentifier(u.trackId,g),S=Se(W({},g),{availableOutgoingBitrate:(p=(h=e.getLocalPeerStats())==null?void 0:h.publish)==null?void 0:p.availableOutgoingBitrate});if(b&&this.trackAnalytics.has(b))(v=this.trackAnalytics.get(b))==null||v.pushTempStat(S);else if(u){let D=new GE({track:u,sampleWindowSize:this.sampleWindowSize,rid:g.rid,ssrc:g.ssrc.toString(),kind:g.kind});D.pushTempStat(S),this.trackAnalytics.set(this.getTrackIdentifier(u.trackId,g),D)}let C=this.trackAnalytics.get(b);C!=null&&C.shouldCreateSample()&&(t=!0)})}),this.cleanTrackAnalyticsAndCreateSample(t)}getTrackIdentifier(e,t){return t.rid?`${e}:${t.rid}`:e}},GE=class extends Py{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=e.qualityLimitationDurations,s=t&&{bandwidth_sec:t.bandwidth,cpu_sec:t.cpu,other_sec:t.other},r=e.frameHeight?{height_px:this.getLatestStat().frameHeight,width_px:this.getLatestStat().frameWidth}:void 0,l=this.calculateAverage("jitter",!1),u=l?Math.round(l*1e3):void 0,d=this.calculateAverage("roundTripTime",!1),h=d?Math.round(d*1e3):void 0;return sh({timestamp:Date.now(),avg_available_outgoing_bitrate_bps:this.calculateAverage("availableOutgoingBitrate"),avg_bitrate_bps:this.calculateAverage("bitrate"),avg_fps:this.calculateAverage("framesPerSecond"),total_packets_lost:this.getLatestStat().packetsLost,total_packets_sent:this.getLatestStat().packetsSent,total_packet_sent_delay_sec:parseFloat(this.calculateDifferenceForSample("totalPacketSendDelay").toFixed(4)),total_fir_count:this.calculateDifferenceForSample("firCount"),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_ms:u,avg_round_trip_time_ms:h,total_quality_limitation:s,resolution:r})},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],s=this.tempStats[e-2];return e===30||wy(t,s)||t.kind==="video"&&Dy(t,s)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}},jE=class extends _y{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let s=[],r=[];return this.trackAnalytics.forEach(l=>{l.track.type==="audio"?s.push(l.toAnalytics()):l.track.type==="video"&&r.push(l.toAnalytics())}),{audio:s,video:r,joined_at:(t=(e=this.store.getRoom())==null?void 0:e.joinedAt)==null?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:10}}sendEvent(){this.eventBus.analytics.publish(be.subscribeStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=e.getAllRemoteTracksStats(),s=!1;Object.keys(t).forEach(r=>{var l,u;let d=this.store.getTrackById(r),h=t[r],p=(l=this.trackAnalytics.get(r))==null?void 0:l.getLatestStat(),v=((C,D)=>{let M=(D==null?void 0:D.jitterBufferDelay)||0,j=(D==null?void 0:D.jitterBufferEmittedCount)||0,le=((C==null?void 0:C.jitterBufferDelay)||0)-M,oe=((C==null?void 0:C.jitterBufferEmittedCount)||0)-j;return oe>0?le*1e3/oe:(D==null?void 0:D.calculatedJitterBufferDelay)||0})(h,p),g=this.calculateAvSyncForStat(h,e),b=Se(W({},h),{calculatedJitterBufferDelay:v,avSync:g});if(h.kind==="video"){let C=d.getPreferredLayerDefinition();b.expectedFrameHeight=C==null?void 0:C.resolution.height,b.expectedFrameWidth=C==null?void 0:C.resolution.width}if(this.trackAnalytics.has(r))(u=this.trackAnalytics.get(r))==null||u.pushTempStat(b);else if(d){let C=new zE({track:d,sampleWindowSize:this.sampleWindowSize,ssrc:h.ssrc.toString(),kind:h.kind});C.pushTempStat(b),this.trackAnalytics.set(r,C)}let S=this.trackAnalytics.get(r);S!=null&&S.shouldCreateSample()&&(s=!0)}),this.cleanTrackAnalyticsAndCreateSample(s)}calculateAvSyncForStat(e,t){if(!e.peerID||!e.estimatedPlayoutTimestamp||e.kind!=="video")return;let s=this.store.getPeerById(e.peerID),r=s==null?void 0:s.audioTrack,l=s==null?void 0:s.videoTrack;if(!(r&&l&&r.enabled&&l.enabled))return su;let u=t.getRemoteTrackStats(r.trackId);if(!u)return su;if(u.estimatedPlayoutTimestamp)return u.estimatedPlayoutTimestamp-e.estimatedPlayoutTimestamp}},zE=class extends Py{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=this.getFirstStat(),s={timestamp:Date.now(),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_buffer_delay:this.calculateAverage("calculatedJitterBufferDelay",!1)};if(e.kind==="video")return sh(Se(W({},s),{avg_av_sync_ms:this.calculateAvgAvSyncForSample(),avg_frames_received_per_sec:this.calculateDifferenceAverage("framesReceived"),avg_frames_dropped_per_sec:this.calculateDifferenceAverage("framesDropped"),avg_frames_decoded_per_sec:this.calculateDifferenceAverage("framesDecoded"),frame_width:this.calculateAverage("frameWidth"),frame_height:this.calculateAverage("frameHeight"),expected_frame_width:this.calculateAverage("expectedFrameWidth"),expected_frame_height:this.calculateAverage("expectedFrameHeight"),pause_count:this.calculateDifferenceForSample("pauseCount"),pause_duration_seconds:this.calculateDifferenceForSample("totalPausesDuration"),freeze_count:this.calculateDifferenceForSample("freezeCount"),freeze_duration_seconds:this.calculateDifferenceForSample("totalFreezesDuration")}));{let r=(e.concealedSamples||0)-(e.silentConcealedSamples||0)-((t.concealedSamples||0)-(t.silentConcealedSamples||0));return sh(Se(W({},s),{audio_level:this.calculateInstancesOfHigh("audioLevel",.05),audio_concealed_samples:r,audio_total_samples_received:this.calculateDifferenceForSample("totalSamplesReceived"),audio_concealment_events:this.calculateDifferenceForSample("concealmentEvents"),fec_packets_discarded:this.calculateDifferenceForSample("fecPacketsDiscarded"),fec_packets_received:this.calculateDifferenceForSample("fecPacketsReceived"),total_samples_duration:this.calculateDifferenceForSample("totalSamplesDuration"),total_packets_received:this.calculateDifferenceForSample("packetsReceived"),total_packets_lost:this.calculateDifferenceForSample("packetsLost")}))}},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],s=this.tempStats[e-2];return e===10||wy(t,s)||t.kind==="video"&&Dy(t,s)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}calculateAvgAvSyncForSample(){let e=this.tempStats.map(t=>t.avSync).filter(t=>t!==void 0&&t!==su);return e.length===0?su:e.reduce((t,s)=>t+s,0)/e.length}},ru=(e=>(e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe",e))(ru||{});function HE(e,t){var s;let r=qd.parse(e.sdp);if(!((s=r.origin)!=null&&s.username.startsWith("mozilla")))return e;let l=t?Array.from(t.values()):[];return r.media.forEach(u=>{var d,h,p;let v=(d=u.msid)==null?void 0:d.split(" ")[0],g=(h=l.find(b=>b.type===u.type&&b.stream_id===v))==null?void 0:h.track_id;g&&(u.msid=(p=u.msid)==null?void 0:p.replace(/\s(.+)/,` ${g}`))}),{type:e.type,sdp:qd.write(r)}}function VE(e,t){var s;if(!(e!=null&&e.sdp)||!t)return;let r=qd.parse(e.sdp).media.find(l=>bs(l.mid)&&parseInt(l.mid)===parseInt(t));return(s=r==null?void 0:r.msid)==null?void 0:s.split(" ")[1]}function qE(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Nn="[HMSConnection]",My=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===0?"PUBLISH":"SUBSCRIBE"}setSfuNodeId(e){this.sfuNodeId=e}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return y(this,null,function*(){try{let s=yield this.nativeConnection.createOffer(t);return k.d(Nn,`[role=${this.role}] createOffer offer=${JSON.stringify(s,null,1)}`),qE(HE(s,e))}catch(s){throw Y.WebrtcErrors.CreateOfferFailed(this.action,s.message)}})}createAnswer(e=void 0){return y(this,null,function*(){try{let t=yield this.nativeConnection.createAnswer(e);return k.d(Nn,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(t){throw Y.WebrtcErrors.CreateAnswerFailed(this.action,t.message)}})}setLocalDescription(e){return y(this,null,function*(){try{k.d(Nn,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(t){throw Y.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.message)}})}setRemoteDescription(e){return y(this,null,function*(){try{k.d(Nn,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(t){throw Y.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.message)}})}addIceCandidate(e){return y(this,null,function*(){if(this.nativeConnection.signalingState==="closed"){k.d(Nn,`[role=${this.role}] addIceCandidate signalling state closed`);return}k.d(Nn,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)})}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}handleSelectedIceCandidatePairs(){try{(this.role===0?this.getSenders():this.getReceivers()).forEach(e=>{var t;let s=(t=e.track)==null?void 0:t.kind;if(e.transport){let r=e.transport.iceTransport,l=()=>{typeof r.getSelectedCandidatePair=="function"&&(this.selectedCandidatePair=r.getSelectedCandidatePair(),this.selectedCandidatePair&&(this.observer.onSelectedCandidatePairChange(this.selectedCandidatePair),k.d(Nn,`${ru[this.role]} connection`,`selected ${s||"unknown"} candidate pair`,JSON.stringify(this.selectedCandidatePair,null,2))))};typeof r.onselectedcandidatepairchange=="function"&&(r.onselectedcandidatepairchange=l),l()}})}catch(e){k.w(Nn,`Error in logging selected ice candidate pair for ${ru[this.role]} connection`,e)}}removeTrack(e){this.nativeConnection.signalingState!=="closed"&&this.nativeConnection.removeTrack(e)}setMaxBitrateAndFramerate(e,t){return y(this,null,function*(){let s=(t==null?void 0:t.maxBitrate)||e.settings.maxBitrate,r=e instanceof Li&&e.settings.maxFramerate,l=this.getSenders().find(u=>{var d;return((d=u==null?void 0:u.track)==null?void 0:d.id)===e.getTrackIDBeingSent()});if(l){let u=l.getParameters();u.encodings.length===1&&(s&&(u.encodings[0].maxBitrate=s*1e3),r&&(u.encodings[0].maxFramerate=r)),yield l.setParameters(u)}else k.w(Nn,`no sender found to setMaxBitrate for track - ${e.trackId}, sentTrackId - ${e.getTrackIDBeingSent()}`)})}getStats(){return y(this,null,function*(){return yield this.nativeConnection.getStats()})}close(){this.nativeConnection.close()}getReceivers(){return this.nativeConnection.getReceivers()}},FE=class extends My{constructor(e,t,s){super(0,e),this.TAG="[HMSPublishConnection]",this.observer=s,this.nativeConnection=new RTCPeerConnection(t),this.channel=this.nativeConnection.createDataChannel(iy,{protocol:"SCTP"}),this.channel.onerror=r=>k.e(this.TAG,`publish data channel onerror ${r}`,r),this.nativeConnection.onicecandidate=({candidate:r})=>{r&&(this.observer.onIceCandidate(r),e.trickle(this.role,r))},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState),this.nativeConnection.sctp&&(this.nativeConnection.sctp.transport.onstatechange=()=>{var r;this.observer.onDTLSTransportStateChange((r=this.nativeConnection.sctp)==null?void 0:r.transport.state)},this.nativeConnection.sctp.transport.onerror=r=>{var l;this.observer.onDTLSTransportError(new Error((l=r==null?void 0:r.error)==null?void 0:l.errorDetail)||"DTLS Transport failed")})}}close(){super.close(),this.channel.close()}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>y(this,null,function*(){k.d(this.TAG,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()})}},$E=class{constructor(e,t,s=""){this.TAG="[HMSDataChannel]",this.nativeChannel=e,this.observer=t,this.metadata=s,e.onmessage=r=>{this.observer.onMessage(r.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){k.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},YE=class extends My{constructor(e,t,s,r){super(1,e),this.isFlagEnabled=s,this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.MAX_RETRIES=3,this.pendingMessageQueue=[],this.eventEmitter=new fT({maxListeners:60}),this.handlePendingApiMessages=()=>{this.eventEmitter.emit("open",!0),this.pendingMessageQueue.length>0&&(k.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach(l=>this.sendOverApiDataChannel(l)),this.pendingMessageQueue.length=0)},this.sendMessage=(l,u)=>y(this,null,function*(){var d;((d=this.apiChannel)==null?void 0:d.readyState)!=="open"&&(yield this.eventEmitter.waitFor("open"));let h;for(let p=0;p<this.MAX_RETRIES;p++){this.apiChannel.send(l),h=yield this.waitForResponse(u);let v=h.error;if(v){if(v.code===404){k.d(this.TAG,`Track not found ${u}`,{request:l,try:p+1,error:v});break}if(k.d(this.TAG,`Failed sending ${u}`,{request:l,try:p+1,error:v}),!(v.code/100===5||v.code===429))throw Error(`code=${v.code}, message=${v.message}`);let g=(2+Math.random()*2)*1e3;yield uu(g)}else break}return h}),this.waitForResponse=l=>y(this,null,function*(){let u=yield this.eventEmitter.waitFor("message",function(h){return h.includes(l)}),d=JSON.parse(u[0]);return k.d(this.TAG,`response for ${l} -`,JSON.stringify(d,null,2)),d}),this.observer=r,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===iy&&(this.apiChannel=new $E(e.channel,{onMessage:t=>{this.eventEmitter.emit("message",t),this.observer.onApiChannelMessage(t)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{e.candidate!==null&&(this.observer.onIceCandidate(e.candidate),this.signal.trickle(this.role,e.candidate))},this.nativeConnection.ontrack=e=>{var t;let s=e.streams[0],r=s.id;if(!this.remoteStreams.has(r)){let v=new Ah(s,this);this.remoteStreams.set(r,v)}s.addEventListener("removetrack",v=>{if(v.track.id!==e.track.id)return;let g=l.tracks.findIndex(b=>{var S;return b.nativeTrack.id===v.track.id&&e.transceiver.mid===((S=b.transceiver)==null?void 0:S.mid)});if(g>=0){let b=l.tracks[g];this.observer.onTrackRemove(b),l.tracks.splice(g,1),l.tracks.length===0&&this.remoteStreams.delete(r)}});let l=this.remoteStreams.get(r),u=e.track.kind==="audio",d=u?ia:yi,h=u?new d(l,e.track):new d(l,e.track,void 0,this.isFlagEnabled("disableNoneLayerRequest"));e.track.kind==="video"&&l.setVideoLayerLocally("none","addTrack","subscribeConnection"),h.transceiver=e.transceiver;let p=VE(this.remoteDescription,(t=e.transceiver)==null?void 0:t.mid);p&&h.setSdpTrackId(p),l.tracks.push(h),this.observer.onTrackAdd(h)}}sendOverApiDataChannel(e){this.apiChannel&&this.apiChannel.readyState==="open"?this.apiChannel.send(e):(k.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}sendOverApiDataChannelWithResponse(e,t){return y(this,null,function*(){let s=ks();if(e.method==="prefer-video-track-state"&&this.isFlagEnabled("disableVideoTrackAutoUnsubscribe")&&e.params.max_spatial_layer==="none")return k.d(this.TAG,"video auto unsubscribe is disabled, request is ignored"),{id:s};let r=JSON.stringify(W({id:t||s,jsonrpc:"2.0"},e));return this.sendMessage(r,s)})}close(){var e;super.close(),(e=this.apiChannel)==null||e.close()}},KE=(e,t)=>!t||t.length===0?e:t.map(s=>({urls:s.urls,credentialType:"password",credential:s.password,username:s.userName})),Wo="[InitService]",QE=class{static handleError(e,t){switch(e.status){case 404:throw Y.APIErrors.EndpointUnreachable("INIT",t.message||e.statusText);case 200:break;default:throw Y.APIErrors.ServerErrors(t.code||e.status,"INIT",t.message||(e==null?void 0:e.statusText))}}static fetchInitConfig(e){return y(this,arguments,function*({token:t,peerId:s,userAgent:r,initEndpoint:l="https://prod-init.100ms.live",region:u="",iceServers:d}){k.d(Wo,`fetchInitConfig: initEndpoint=${l} token=${t} peerId=${s} region=${u} `);let h=WE(l,s,r,u);try{let p=yield fetch(h,{headers:{Authorization:`Bearer ${t}`}});try{let v=yield p.clone().json();return this.handleError(p,v),k.d(Wo,`config is ${JSON.stringify(v,null,2)}`),JE(v,d)}catch(v){let g=yield p.text();throw k.e(Wo,"json error",v.message,g),v instanceof ge?v:Y.APIErrors.ServerErrors(p.status,"INIT",v.message)}}catch(p){let v=p;throw["Failed to fetch","NetworkError","ECONNRESET"].some(g=>v.message.includes(g))?Y.APIErrors.EndpointUnreachable("INIT",v.message):v}})}};function WE(e,t,s,r){try{let l=new URL("/init",e);return r&&r.trim().length>0&&l.searchParams.set("region",r.trim()),l.searchParams.set("peer_id",t),l.searchParams.set("user_agent_v2",s),l.toString()}catch(l){let u=l;throw k.e(Wo,u.name,u.message),u}}function JE(e,t){var s;return Se(W({},e),{rtcConfiguration:Se(W({},e.rtcConfiguration),{iceServers:KE((s=e.rtcConfiguration)==null?void 0:s.ice_servers,t)})})}var XE=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Eh(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.resolvePingOnAnyResponse=()=>{this.callbacks.forEach((t,s)=>{var r;((r=t.metadata)==null?void 0:r.method)==="ping"&&(t.resolve({timestamp:Date.now()}),this.callbacks.delete(s))})},this.offlineListener=()=>{k.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{k.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setSfuNodeId(e){this.sfuNodeId=e}setIsConnected(e,t=""){k.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.rejectPendingCalls(t),this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return y(this,null,function*(){var s;let r=ks(),l={method:e,params:t,id:r,jsonrpc:"2.0"};(s=this.socket)==null||s.send(JSON.stringify(l));try{return yield new Promise((u,d)=>{this.callbacks.set(r,{resolve:u,reject:d,metadata:{method:e}})})}catch(u){if(u instanceof ge)throw u;let d=u;throw Y.WebsocketMethodErrors.ServerErrors(Number(d.code),wg(e),d.message)}})}notify(e,t){var s,r;let l={method:e,params:t};((s=this.socket)==null?void 0:s.readyState)===WebSocket.OPEN&&((r=this.socket)==null||r.send(JSON.stringify(l)))}open(e){return new Promise((t,s)=>{let r=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let l=()=>{k.e(this.TAG,"Error from websocket"),r=!0,s(Y.WebSocketConnectionErrors.FailedToConnect("JOIN","Error opening websocket connection"))};this.onCloseHandler=d=>{k.w(`Websocket closed code=${d.code}`),r?this.setIsConnected(!1,`code: ${d.code}${d.code!==1e3?", unexpected websocket close":""}`):(r=!0,s(Y.WebSocketConnectionErrors.AbnormalClose("JOIN",`Error opening websocket connection - websocket closed unexpectedly with code=${d.code}`)))},this.socket.addEventListener("error",l);let u=()=>{var d,h;r=!0,t(),this.setIsConnected(!0),this.id++,(d=this.socket)==null||d.removeEventListener("open",u),(h=this.socket)==null||h.removeEventListener("error",l),this.pingPongLoop(this.id)};this.socket.addEventListener("open",u),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)})}close(){return y(this,null,function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")})}join(e,t,s,r,l,u,d){return y(this,null,function*(){if(!this.isConnected)throw Y.WebSocketConnectionErrors.WebSocketConnectionLost("JOIN","Failed to send join over WS connection");let h={name:e,disableVidAutoSub:s,data:t,offer:d,server_sub_degrade:r,simulcast:l,onDemandTracks:u},p=yield this.internalCall("join",h);return this.isJoinCompleted=!0,this.pendingTrickle.forEach(({target:v,candidate:g})=>this.trickle(v,g)),this.pendingTrickle.length=0,k.d(this.TAG,`join: response=${JSON.stringify(p,null,1)}`),p})}trickle(e,t){this.isJoinCompleted?this.notify("trickle",{target:e,candidate:t,sfu_node_id:this.sfuNodeId}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return y(this,null,function*(){return yield this.call("offer",{desc:e,tracks:Object.fromEntries(t),sfu_node_id:this.sfuNodeId})})}answer(e){this.notify("answer",{desc:e,sfu_node_id:this.sfuNodeId})}trackUpdate(e){this.notify("track-update",{tracks:Object.fromEntries(e)})}broadcast(e){return y(this,null,function*(){return yield this.call("broadcast",e)})}leave(e){this.notify("leave",{client_reason:e})}endRoom(e,t){return y(this,null,function*(){yield this.call("end-room",{lock:e,reason:t})})}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify("analytics",e.toSignalParams())}ping(e){let t=Date.now(),s=new Promise(l=>{setTimeout(()=>{l(Date.now()-t)},e+1)}),r=this.internalCall("ping",{timestamp:t}).then(()=>Date.now()-t).catch(()=>Date.now()-t);return Promise.race([s,r])}requestRoleChange(e){return y(this,null,function*(){yield this.call("role-change-request",e)})}requestBulkRoleChange(e){return y(this,null,function*(){yield this.call("role-change-request",e)})}acceptRoleChangeRequest(e){return y(this,null,function*(){yield this.call("role-change",e)})}requestTrackStateChange(e){return y(this,null,function*(){yield this.call("track-update-request",e)})}requestMultiTrackStateChange(e){return y(this,null,function*(){yield this.call("change-track-mute-state-request",e)})}removePeer(e){return y(this,null,function*(){yield this.call("peer-leave-request",e)})}startRTMPOrRecording(e){return y(this,null,function*(){yield this.call("rtmp-start",W({},e))})}stopRTMPAndRecording(){return y(this,null,function*(){yield this.call("rtmp-stop",{})})}startHLSStreaming(e){return y(this,null,function*(){yield this.call("hls-start",W({},e))})}stopHLSStreaming(e){return y(this,null,function*(){yield this.call("hls-stop",W({},e))})}startTranscription(e){return y(this,null,function*(){yield this.call("transcription-start",W({},e))})}stopTranscription(e){return y(this,null,function*(){yield this.call("transcription-stop",W({},e))})}sendHLSTimedMetadata(e){return y(this,null,function*(){yield this.call("hls-timed-metadata",W({},e))})}updatePeer(e){return y(this,null,function*(){yield this.call("peer-update",W({},e))})}getPeer(e){return y(this,null,function*(){return yield this.call("get-peer",W({},e))})}joinGroup(e){return y(this,null,function*(){return yield this.call("group-join",{name:e})})}leaveGroup(e){return y(this,null,function*(){return yield this.call("group-leave",{name:e})})}addToGroup(e,t){return y(this,null,function*(){yield this.call("group-add",{name:t,peer_id:e})})}removeFromGroup(e,t){return y(this,null,function*(){yield this.call("group-remove",{name:t,peer_id:e})})}peerIterNext(e){return y(this,null,function*(){return yield this.call("peer-iter-next",e)})}findPeers(e){return y(this,null,function*(){return yield this.call("find-peer",e)})}findPeerByName(e){return y(this,null,function*(){return yield this.call("peer-name-search",e)})}setSessionMetadata(e){if(!this.isConnected)throw Y.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("set-metadata",W({},e))}listenMetadataChange(e){if(!this.isConnected)throw Y.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to observe session store key due to network disconnection");return this.call("listen-metadata-change",{keys:e})}getSessionMetadata(e){if(!this.isConnected)throw Y.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("get-metadata",{key:e})}setPollInfo(e){return this.call("poll-info-set",W({},e))}getPollInfo(e){return this.call("poll-info-get",W({},e))}setPollQuestions(e){return this.call("poll-questions-set",W({},e))}startPoll(e){return this.call("poll-start",W({},e))}stopPoll(e){return this.call("poll-stop",W({},e))}getPollQuestions(e){return this.call("poll-questions-get",W({},e))}setPollResponses(e){return this.call("poll-response",W({},e))}getPollResponses(e){return this.call("poll-responses",W({},e))}getPollsList(e){return this.call("poll-list",W({},e))}getPollResult(e){return this.call("poll-result",W({},e))}createWhiteboard(e){return this.validateConnection(),this.call("whiteboard-create",W({},e))}getWhiteboard(e){return this.validateConnection(),this.call("whiteboard-get",W({},e))}fetchPollLeaderboard(e){return this.call("poll-leaderboard",W({},e))}validateConnection(){if(!this.isConnected)throw Y.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to send message due to network disconnection")}onMessageHandler(e){let t=e.data,s=JSON.parse(t);if(this.resolvePingOnAnyResponse(),s.id)this.handleResponseWithId(s);else if(s.method)this.handleResponseWithMethod(s);else throw Error(`WebSocket message has no 'method' or 'id' field, message=${s}`)}handleResponseWithId(e){let t=e,s=t.id;if(this.callbacks.has(s)){let r=this.callbacks.get(s);this.callbacks.delete(s),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case"offer":this.observer.onOffer(e.params);break;case"trickle":this.observer.onTrickle(e.params);break;case"on-error":this.observer.onServerError(Y.WebsocketMethodErrors.ServerErrors(Number(e.params.code),"on-error",e.params.message));break;case"on-warning":k.w(this.TAG,e.params);break;default:this.observer.onNotification(e);break}}rejectPendingCalls(e=""){this.callbacks.forEach((t,s)=>{var r,l,u,d;((r=t.metadata)==null?void 0:r.method)!=="ping"&&(k.e(this.TAG,`rejecting pending callback ${(l=t.metadata)==null?void 0:l.method}, id=${s}`),t.reject(Y.WebSocketConnectionErrors.WebSocketConnectionLost((u=t.metadata)!=null&&u.method?wg((d=t.metadata)==null?void 0:d.method):"RECONNECT_SIGNAL",e)),this.callbacks.delete(s))})}pingPongLoop(e){return y(this,null,function*(){var t,s;let r=((t=window.HMS)==null?void 0:t.PING_TIMEOUT)||12e3;if(this.isConnected){let l=yield this.ping(r);this.pongResponseTimes.enqueue(l),l>r?(k.d(this.TAG,`Pong timeout ${e}, pageHidden=${$T()}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(()=>this.pingPongLoop(e),((s=window.HMS)==null?void 0:s.PING_INTERVAL)||3e3)}})}call(e,t){return y(this,null,function*(){let s=Y.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`),r;for(r=1;r<=3;r++)try{return this.validateConnection(),k.d(this.TAG,`Try number ${r} sending ${e}`,t),yield this.internalCall(e,t)}catch(l){if(s=l,k.e(this.TAG,`Failed sending ${e} try: ${r}`,{method:e,params:t,error:s}),!(parseInt(`${s.code/100}`)===5||s.code===429||s.code===1003))break;let u=(2+Math.random()*2)*1e3;yield uu(u)}throw k.e(`Sending ${e} over WS failed after ${Math.min(r,3)} retries`,{method:e,params:t,error:s}),s})}},ZE=()=>{if(!Ii||typeof navigator.connection>"u")return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}},Ee="[HMSTransport]:",eA=class{constructor(e,t,s,r,l,u,d){this.observer=e,this.deviceManager=t,this.store=s,this.eventBus=r,this.analyticsEventsService=l,this.analyticsTimer=u,this.pluginUsageTracker=d,this.state="Disconnected",this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.publishDisconnectTimer=0,this.onScreenshareStop=()=>{},this.screenStream=new Set,this.callbacks=new Map,this.setListener=p=>{this.listener=p},this.setOnScreenshareStop=p=>{this.onScreenshareStop=p},this.signalObserver={onOffer:p=>y(this,null,function*(){try{if(!this.subscribeConnection)return;if(p.sfu_node_id&&this.subscribeConnection.sfuNodeId&&this.subscribeConnection.sfuNodeId!==p.sfu_node_id){k.d(Ee,"ignoring old offer");return}yield this.subscribeConnection.setRemoteDescription(p),k.d(Ee,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let g of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(g);this.subscribeConnection.candidates.length=0;let v=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(v),this.signal.answer(v),k.d(Ee,"[role=SUBSCRIBE] onOffer renegotiation DONE ")}catch(v){k.d(Ee,"[role=SUBSCRIBE] onOffer renegotiation FAILED ",v),this.state="Failed";let g;v instanceof ge?g=v:g=Y.GenericErrors.Unknown("SUBSCRIBE",v.message),this.observer.onFailure(g),this.eventBus.analytics.publish(be.subscribeFail(g))}}),onTrickle:p=>y(this,null,function*(){let v=p.target===0?this.publishConnection:this.subscribeConnection;v!=null&&v.remoteDescription?yield v.addIceCandidate(p.candidate):v==null||v.candidates.push(p.candidate)}),onNotification:p=>this.observer.onNotification(p),onServerError:p=>y(this,null,function*(){yield this.observer.onStateChange("Failed",p)}),onFailure:p=>{this.joinParameters&&this.retryScheduler.schedule({category:1,error:p,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:p=>y(this,null,function*(){k.d(Ee,"socket offline",nh[this.state]);try{this.state!=="Leaving"&&this.joinParameters&&this.retryScheduler.schedule({category:1,error:Y.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL",p),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(v){console.error(v)}}),onOnline:()=>{var p;k.d(Ee,"socket online",nh[this.state]),this.analyticsSignalTransport.flushFailedEvents((p=this.store.getLocalPeer())==null?void 0:p.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new XE(this.signalObserver),this.analyticsSignalTransport=new xE(this.signal),this.publishDtlsStateTimer=0,this.lastPublishDtlsState="new",this.handleLocalRoleUpdate=p=>y(this,[p],function*({oldRole:v,newRole:g}){!this.doesRoleNeedWebRTC(v)&&this.doesRoleNeedWebRTC(g)&&(k.d(Ee,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation "),this.createPeerConnections(),yield this.negotiateOnFirstPublish())}),this.retryPublishIceFailedTask=()=>y(this,null,function*(){if(this.publishConnection){let p=new Promise((v,g)=>{this.callbacks.set(ul,{promise:{resolve:v,reject:g},action:"RESTART_ICE",extra:{}})});yield this.performPublishRenegotiation({iceRestart:this.publishConnection.connectionState!=="connected"}),yield p}return!0}),this.retrySubscribeIceFailedTask=()=>y(this,null,function*(){if(this.subscribeConnection&&this.subscribeConnection.connectionState!=="connected"){let p=new Promise((g,b)=>{this.callbacks.set(cl,{promise:{resolve:g,reject:b},action:"RESTART_ICE",extra:{}})}),v=new Promise(g=>{setTimeout(g,6e4,!1)});return Promise.race([p,v])}return!0}),this.retrySignalDisconnectTask=()=>y(this,null,function*(){var p;k.d(Ee,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected||(yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId,this.joinParameters.iceServers));let v=(p=this.store.getRoom())!=null&&p.joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),v}),this.webrtcInternals=new Z0(this.store,this.eventBus);let h=(p,v)=>y(this,null,function*(){p!==this.state&&(this.state=p,yield this.observer.onStateChange(this.state,v))});this.retryScheduler=new IE(h,this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(p=>{var v,g;let b=((g=(v=p.getLocalPeerStats())==null?void 0:v.subscribe)==null?void 0:g.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,b)}),this.eventBus.localAudioEnabled.subscribe(({track:p,enabled:v})=>this.trackUpdate(p,v)),this.eventBus.localVideoEnabled.subscribe(({track:p,enabled:v})=>this.trackUpdate(p,v))}getWebsocketEndpoint(){if(this.initConfig)return this.initConfig.endpoint}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let s=(t=this.initConfig)==null?void 0:t.config;return((s==null?void 0:s.enabledFlags)||[]).includes(e)}setConnectivityListener(e){this.connectivityListener=e}preview(e,t,s,r,l=!1,u){return y(this,null,function*(){let d=yield this.connect(e,t,s,r,l,u);return this.state="Preview",this.observer.onStateChange(this.state),d})}join(e,t,s,r,l=!1,u){return y(this,null,function*(){k.d(Ee,"join: started ");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,r,t,s,l,u)),this.validateNotDisconnected("connect"),this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(s,l),this.initStatsAnalytics(),k.d(Ee," join: Negotiated over PUBLISH connection"))}catch(d){k.e(Ee,`join: failed  [token=${e}]`,d),this.state="Failed";let h=d;throw h.isTerminal=h.isTerminal||h.code===500,yield this.observer.onStateChange(this.state,h),h}k.d(Ee," join: successful"),this.state="Joined",this.observer.onStateChange(this.state)})}connect(e,t,s,r,l=!1,u){return y(this,null,function*(){this.setTransportStateForConnect(),this.joinParameters=new ME(e,s,r.name,r.metaData,t,l,u);try{return yield this.internalConnect(e,t,s,u)}catch(d){if(d instanceof ge&&([fe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,fe.WebSocketConnectionErrors.FAILED_TO_CONNECT,fe.WebSocketConnectionErrors.ABNORMAL_CLOSE,fe.APIErrors.ENDPOINT_UNREACHABLE].includes(d.code)||d.code.toString().startsWith("5")||d.code.toString().startsWith("429"))){let h=()=>y(this,null,function*(){return yield this.internalConnect(e,t,s,u),!!(this.initConfig&&this.initConfig.endpoint)});yield this.retryScheduler.schedule({category:0,error:d,task:h,originalState:this.state,changeState:!1})}else throw d}})}leave(e){return y(this,arguments,function*(t,s="user request"){var r,l,u;this.retryScheduler.reset(),this.joinParameters=void 0,k.d(Ee,"leaving in transport");try{let d=this.pluginUsageTracker.getPluginUsage("HMSKrispPlugin");if(d&&this.eventBus.analytics.publish(be.getKrispUsage(d)),this.state="Leaving",(r=this.publishStatsAnalytics)==null||r.stop(),(l=this.subscribeStatsAnalytics)==null||l.stop(),(u=this.webrtcInternals)==null||u.cleanup(),this.clearPeerConnections(),t)try{this.signal.leave(s),k.d(Ee,"signal leave done")}catch(h){k.w(Ee,"failed to send leave on websocket to server",h)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(d){this.eventBus.analytics.publish(be.disconnect(d)),k.e(Ee,"leave: FAILED ",d)}finally{this.state="Disconnected",this.observer.onStateChange(this.state)}})}publish(e){return y(this,null,function*(){var t;for(let s of e)try{yield this.publishTrack(s),(t=this.connectivityListener)==null||t.onMediaPublished(s)}catch(r){this.eventBus.analytics.publish(be.publish({devices:this.deviceManager.getDevices(),error:r}))}})}unpublish(e){return y(this,null,function*(){for(let t of e)yield this.unpublishTrack(t)})}setSFUNodeId(e){var t,s;this.signal.setSfuNodeId(e),this.sfuNodeId?e&&this.sfuNodeId!==e&&(this.sfuNodeId=e,this.handleSFUMigration()):(this.sfuNodeId=e,(t=this.publishConnection)==null||t.setSfuNodeId(e),(s=this.subscribeConnection)==null||s.setSfuNodeId(e))}handleSFUMigration(){return y(this,null,function*(){var e,t;k.time("sfu migration"),this.clearPeerConnections();let s=this.store.getPeerMap();this.store.removeRemoteTracks();for(let d in s){let h=s[d];h.isLocal||(h.audioTrack=void 0,h.videoTrack=void 0,h.auxiliaryTracks=[])}let r=this.store.getLocalPeer();if(!r)return;this.createPeerConnections(),this.trackStates.clear(),yield this.negotiateOnFirstPublish();let l=new Map;if(r.audioTrack){let d=r.audioTrack.stream;l.get(d.id)||l.set(d.id,new Xr(new MediaStream));let h=r.audioTrack.clone(l.get(d.id));this.store.removeTrack(r.audioTrack),r.audioTrack.cleanup(),yield this.publishTrack(h),r.audioTrack=h}if(r.videoTrack){let d=r.videoTrack.stream;l.get(d.id)||l.set(d.id,new Xr(new MediaStream)),this.store.removeTrack(r.videoTrack);let h=r.videoTrack.clone(l.get(d.id));r.videoTrack.cleanup(),yield this.publishTrack(h),r.videoTrack=h}let u=[];for(;r.auxiliaryTracks.length>0;){let d=r.auxiliaryTracks.shift();if(d){let h=d.stream;l.get(h.id)||l.set(h.id,new Xr(d.source==="screen"?h.nativeStream.clone():new MediaStream)),this.store.removeTrack(d);let p=d.clone(l.get(h.id));p.type==="video"&&p.source==="screen"&&(this.screenStream.add(h.nativeStream),this.screenStream.add(p.stream.nativeStream),p.nativeTrack.addEventListener("ended",this.onScreenshareStop)),d.cleanup(),yield this.publishTrack(p),u.push(p)}}r.auxiliaryTracks=u,l.clear(),(t=(e=this.listener)==null?void 0:e.onSFUMigration)==null||t.call(e),k.timeEnd("sfu migration")})}trackUpdate(e,t){var s;let r=Array.from(this.trackStates.values()).find(l=>e.type===l.type&&e.source===l.source);if(r){let l=new Yg(Se(W({},r),{mute:!t}));this.trackStates.set(r.track_id,l),k.d(Ee,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[r.track_id,l]]));let u=this.store.getLocalPeer();u&&t===e.enabled&&((s=this.listener)==null||s.onTrackUpdate(t?3:2,e,u))}}publishTrack(e){return y(this,null,function*(){e.publishedTrackId=e.getTrackIDBeingSent(),k.d(Ee,` publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new Yg(e));let t=new Promise((l,u)=>{this.callbacks.set(ul,{promise:{resolve:l,reject:u},action:"PUBLISH",extra:{}})}),s=e.stream;s.setConnection(this.publishConnection);let r=this.store.getSimulcastLayers(e.source);s.addTransceiver(e,r),k.time(`publish-${e.trackId}-${e.type}`),yield t,k.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e),yield s.setMaxBitrateAndFramerate(e).then(()=>{k.d(Ee,`Setting maxBitrate=${e.settings.maxBitrate} kpbs${e instanceof Li?` and maxFramerate=${e.settings.maxFramerate}`:""} for ${e.source} ${e.type} ${e.trackId}`)}).catch(l=>k.w(Ee,"Failed setting maxBitrate and maxFramerate",l)),e.isPublished=!0,k.d(Ee,` publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)})}unpublishTrack(e){return y(this,null,function*(){if(k.d(Ee,` unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let s=Array.from(this.trackStates.values()).find(r=>e.type===r.type&&e.source===r.source);s&&this.trackStates.delete(s.track_id)}let t=new Promise((s,r)=>{this.callbacks.set(ul,{promise:{resolve:s,reject:r},action:"UNPUBLISH",extra:{}})});e.stream.removeSender(e),yield t,yield e.cleanup(),e.source==="screen"&&this.screenStream&&this.screenStream.forEach(s=>{s.getTracks().forEach(r=>{r.stop()}),this.screenStream.delete(s)}),this.store.removeTrack(e),k.d(Ee,` unpublishTrack: trackId=${e.trackId}`,this.callbacks)})}clearPeerConnections(){return y(this,null,function*(){var e,t;clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0,clearTimeout(this.publishDisconnectTimer),this.publishDisconnectTimer=0,this.lastPublishDtlsState="new",(e=this.publishConnection)==null||e.close(),(t=this.subscribeConnection)==null||t.close(),this.publishConnection=null,this.subscribeConnection=null})}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise(e=>{this.eventBus.policyChange.subscribeOnce(()=>e())})}createConnectionsAndNegotiateJoin(e,t=!1){return y(this,null,function*(){let s=this.doesLocalPeerNeedWebRTC();s&&this.createPeerConnections(),this.analyticsTimer.start("join_response_time"),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:s}),this.analyticsTimer.end("join_response_time")})}createPeerConnections(){var e,t,s;let r=(l,u,d=!1)=>{(["disconnected","failed"].includes(u)?k.w.bind(k):k.d.bind(k))(Ee,`${ru[l]} ${d?"ice":""} connection state change: ${u}`)};if(this.initConfig){let l={onRenegotiationNeeded:()=>y(this,null,function*(){yield this.performPublishRenegotiation()}),onDTLSTransportStateChange:d=>{var h,p,v;if((d==="failed"?k.w.bind(k):k.d.bind(k))(Ee,`Publisher on dtls transport state change: ${d}`),!d||this.lastPublishDtlsState===d||(this.lastPublishDtlsState=d,this.publishDtlsStateTimer!==0&&(clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0),d!=="connecting"&&d!=="failed"))return;let g=(v=(p=(h=this.initConfig)==null?void 0:h.config)==null?void 0:p.dtlsStateTimeouts)==null?void 0:v[d];!g||g<=0||(this.publishDtlsStateTimer=window.setTimeout(()=>{var b;let S=(b=this.publishConnection)==null?void 0:b.nativeConnection.connectionState;if(S&&d&&S===d){let C=Y.WebrtcErrors.ICEFailure("PUBLISH",`DTLS transport state ${d} timeout:${g}ms`,!0);this.eventBus.analytics.publish(be.disconnect(C)),this.observer.onFailure(C)}},g))},onDTLSTransportError:d=>{k.e(Ee,`onDTLSTransportError ${d.name} ${d.message}`,d),this.eventBus.analytics.publish(be.disconnect(d))},onIceConnectionChange:d=>y(this,null,function*(){r(0,d,!0)}),onConnectionStateChange:d=>y(this,null,function*(){var h,p,v,g,b,S,C,D;r(0,d,!1),d!=="new"&&(d==="connected"?((h=this.connectivityListener)==null||h.onICESuccess(!0),(p=this.publishConnection)==null||p.handleSelectedIceCandidatePairs()):d==="failed"?yield this.handleIceConnectionFailure(0,Y.WebrtcErrors.ICEFailure("PUBLISH",`local candidate - ${(b=(g=(v=this.publishConnection)==null?void 0:v.selectedCandidatePair)==null?void 0:g.local)==null?void 0:b.candidate}; remote candidate - ${(D=(C=(S=this.publishConnection)==null?void 0:S.selectedCandidatePair)==null?void 0:C.remote)==null?void 0:D.candidate}`)):this.publishDisconnectTimer=window.setTimeout(()=>{var M,j,le,oe,ie,se,ae;((M=this.publishConnection)==null?void 0:M.connectionState)!=="connected"&&this.handleIceConnectionFailure(0,Y.WebrtcErrors.ICEDisconnected("PUBLISH",`local candidate - ${(oe=(le=(j=this.publishConnection)==null?void 0:j.selectedCandidatePair)==null?void 0:le.local)==null?void 0:oe.candidate}; remote candidate - ${(ae=(se=(ie=this.publishConnection)==null?void 0:ie.selectedCandidatePair)==null?void 0:se.remote)==null?void 0:ae.candidate}`))},5e3))}),onIceCandidate:d=>{var h;(h=this.connectivityListener)==null||h.onICECandidate(d,!0)},onSelectedCandidatePairChange:d=>{var h;(h=this.connectivityListener)==null||h.onSelectedICECandidatePairChange(d,!0)}},u={onApiChannelMessage:d=>{this.observer.onNotification(JSON.parse(d))},onTrackAdd:d=>{k.d(Ee,"[Subscribe] onTrackAdd",`${d}`),this.observer.onTrackAdd(d)},onTrackRemove:d=>{k.d(Ee,"[Subscribe] onTrackRemove",`${d}`),this.observer.onTrackRemove(d)},onIceConnectionChange:d=>y(this,null,function*(){var h;if(r(1,d,!0),d==="connected"){let p=this.callbacks.get(cl);this.callbacks.delete(cl),(h=this.connectivityListener)==null||h.onICESuccess(!1),p&&p.promise.resolve(!0)}}),onConnectionStateChange:d=>y(this,null,function*(){var h,p,v,g,b,S,C;if(r(1,d,!1),d==="failed")yield this.handleIceConnectionFailure(1,Y.WebrtcErrors.ICEFailure("SUBSCRIBE",`local candidate - ${(v=(p=(h=this.subscribeConnection)==null?void 0:h.selectedCandidatePair)==null?void 0:p.local)==null?void 0:v.candidate}; remote candidate - ${(S=(b=(g=this.subscribeConnection)==null?void 0:g.selectedCandidatePair)==null?void 0:b.remote)==null?void 0:S.candidate}`));else if(d==="disconnected")setTimeout(()=>{var D,M,j,le,oe,ie,se;((D=this.subscribeConnection)==null?void 0:D.connectionState)==="disconnected"&&this.handleIceConnectionFailure(1,Y.WebrtcErrors.ICEDisconnected("SUBSCRIBE",`local candidate - ${(le=(j=(M=this.subscribeConnection)==null?void 0:M.selectedCandidatePair)==null?void 0:j.local)==null?void 0:le.candidate}; remote candidate - ${(se=(ie=(oe=this.subscribeConnection)==null?void 0:oe.selectedCandidatePair)==null?void 0:ie.remote)==null?void 0:se.candidate}`))},5e3);else if(d==="connected"){(C=this.subscribeConnection)==null||C.handleSelectedIceCandidatePairs();let D=this.callbacks.get(cl);this.callbacks.delete(cl),D&&D.promise.resolve(!0)}}),onIceCandidate:d=>{var h;(h=this.connectivityListener)==null||h.onICECandidate(d,!1)},onSelectedCandidatePairChange:d=>{var h;(h=this.connectivityListener)==null||h.onSelectedICECandidatePairChange(d,!1)}};this.publishConnection||(this.publishConnection=new FE(this.signal,this.initConfig.rtcConfiguration,l)),this.subscribeConnection||(this.subscribeConnection=new YE(this.signal,this.initConfig.rtcConfiguration,this.isFlagEnabled.bind(this),u))}(s=this.webrtcInternals)==null||s.setPeerConnections({publish:(e=this.publishConnection)==null?void 0:e.nativeConnection,subscribe:(t=this.subscribeConnection)==null?void 0:t.nativeConnection})}negotiateJoinWithRetry(e){return y(this,arguments,function*({name:t,data:s,autoSubscribeVideo:r,isWebRTC:l=!0}){try{yield this.negotiateJoin({name:t,data:s,autoSubscribeVideo:r,isWebRTC:l})}catch(u){k.e(Ee,"Join negotiation failed ",u);let d=u instanceof ge?u:Y.WebsocketMethodErrors.ServerErrors(500,"JOIN",`Websocket join error - ${u.message}`),h=parseInt(`${d.code/100}`)===5||[fe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,429].includes(d.code);if(d.code===410&&(d.isTerminal=!0),h){this.joinRetryCount=0,d.isTerminal=!1;let p=()=>y(this,null,function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:t,data:s,autoSubscribeVideo:r,isWebRTC:l})});yield this.retryScheduler.schedule({category:2,error:d,task:p,originalState:"Joined",changeState:!1})}else throw u}})}negotiateJoin(e){return y(this,arguments,function*({name:t,data:s,autoSubscribeVideo:r,isWebRTC:l=!0}){return l?yield this.negotiateJoinWebRTC({name:t,data:s,autoSubscribeVideo:r}):yield this.negotiateJoinNonWebRTC({name:t,data:s,autoSubscribeVideo:r})})}negotiateJoinWebRTC(e){return y(this,arguments,function*({name:t,data:s,autoSubscribeVideo:r}){if(k.d(Ee," join: Negotiating over PUBLISH connection"),!this.publishConnection)return k.e(Ee,"Publish peer connection not found, cannot negotiate"),!1;let l=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(l);let u=this.isFlagEnabled("subscribeDegradation"),d=this.isFlagEnabled("simulcast"),h=this.isFlagEnabled("onDemandTracks"),p=yield this.signal.join(t,s,!r,u,d,h,l);this.setSFUNodeId(p==null?void 0:p.sfu_node_id),yield this.publishConnection.setRemoteDescription(p);for(let v of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(v);return this.publishConnection.initAfterJoin(),!!p})}negotiateJoinNonWebRTC(e){return y(this,arguments,function*({name:t,data:s,autoSubscribeVideo:r}){k.d(Ee," join: Negotiating Non-WebRTC");let l=this.isFlagEnabled("subscribeDegradation"),u=this.isFlagEnabled("simulcast"),d=this.isFlagEnabled("onDemandTracks"),h=yield this.signal.join(t,s,!r,l,u,d);return this.setSFUNodeId(h==null?void 0:h.sfu_node_id),!!h})}negotiateOnFirstPublish(){return y(this,null,function*(){if(k.d(Ee," Negotiating offer over PUBLISH connection"),!this.publishConnection)return k.e(Ee,"Publish peer connection not found, cannot negotiate"),!1;try{let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let s of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(s);return this.publishConnection.initAfterJoin(),!!t}catch(e){if(e instanceof ge&&e.code===421)return!0;throw e}})}performPublishRenegotiation(e){return y(this,null,function*(){k.d(Ee," [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(ul);if(!t){k.w(Ee,"no callback found for renegotiation");return}if(!this.publishConnection){k.e(Ee,"Publish peer connection not found, cannot renegotiate");return}try{let s=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(s),k.time("renegotiation-offer-exchange");let r=yield this.signal.offer(s,this.trackStates);this.callbacks.delete(ul),k.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(r),t.promise.resolve(!0),k.d(Ee,"[role=PUBLISH] onRenegotiationNeeded DONE ")}catch(s){let r;s instanceof ge?r=s:r=Y.GenericErrors.Unknown("PUBLISH",s.message),r.code===421?t.promise.resolve(!0):t.promise.reject(r),k.d(Ee,"[role=PUBLISH] onRenegotiationNeeded FAILED ")}})}handleIceConnectionFailure(e,t){return y(this,null,function*(){this.retryScheduler.isTaskInProgress(4)||(e===0?this.retryScheduler.schedule({category:3,error:t,task:this.retryPublishIceFailedTask,originalState:"Joined"}):this.retryScheduler.schedule({category:4,error:t,task:this.retrySubscribeIceFailedTask,originalState:"Joined"}))})}internalConnect(e,t,s,r){return y(this,null,function*(){var l,u,d;k.d(Ee,"connect: started ");let h=new Date;try{this.analyticsTimer.start("init_response_time"),this.initConfig=yield QE.fetchInitConfig({token:e,peerId:s,userAgent:this.store.getUserAgent(),initEndpoint:t,iceServers:r}),(l=this.connectivityListener)==null||l.onInitSuccess(this.initConfig.endpoint);let p=this.store.getRoom();return p&&(p.effectsKey=(u=this.initConfig.config.vb)==null?void 0:u.effectsKey,p.isEffectsEnabled=this.isFlagEnabled("effectsSDKEnabled"),p.disableNoneLayerRequest=this.isFlagEnabled("disableNoneLayerRequest"),p.isVBEnabled=this.isFlagEnabled("vb"),p.isHipaaEnabled=this.isFlagEnabled("hipaa"),p.isNoiseCancellationEnabled=this.isFlagEnabled("noiseCancellation")),this.analyticsTimer.end("init_response_time"),Tl.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),yield this.openSignal(e,s),this.observer.onConnected(),(d=this.connectivityListener)==null||d.onSignallingSuccess(),this.store.setSimulcastEnabled(this.isFlagEnabled("simulcast")),k.d(Ee,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(p){throw this.state!=="Reconnecting"&&this.eventBus.analytics.publish(be.connect(p,this.getAdditionalAnalyticsProperties(),h,new Date,t)),k.e(Ee," internal connect: failed",p),p}})}validateNotDisconnected(e){if(this.state==="Disconnected")throw k.w(Ee,"aborting join as transport state is disconnected"),Y.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return y(this,null,function*(){if(!this.initConfig)throw Y.APIErrors.InitConfigNotAvailable("INIT","Init Config not found");k.d(Ee," internal connect: connecting to ws endpoint",this.initConfig.endpoint);let s=new URL(this.initConfig.endpoint);s.searchParams.set("peer",t),s.searchParams.set("token",e),s.searchParams.set("user_agent_v2",this.store.getUserAgent()),s.searchParams.set("protocol_version",z0),s.searchParams.set("protocol_spec",H0),this.endpoint=s.toString(),this.analyticsTimer.start("ws_connect_time"),yield this.signal.open(this.endpoint),this.analyticsTimer.end("ws_connect_time"),this.analyticsTimer.start("on_policy_change_time"),this.analyticsTimer.start("room_state_time"),k.d(Ee," internal connect: connected to ws endpoint")})}initStatsAnalytics(){var e,t;this.isFlagEnabled("publishStats")&&(this.publishStatsAnalytics=new BE(this.store,this.eventBus,this.getValueFromInitConfig("publishStats","maxSampleWindowSize",30),this.getValueFromInitConfig("publishStats","maxSamplePushInterval",300)),(e=this.getWebrtcInternals())==null||e.start()),this.isFlagEnabled("subscribeStats")&&(this.subscribeStatsAnalytics=new jE(this.store,this.eventBus,this.getValueFromInitConfig("subscribeStats","maxSampleWindowSize",10),this.getValueFromInitConfig("subscribeStats","maxSamplePushInterval",60)),(t=this.getWebrtcInternals())==null||t.start())}getValueFromInitConfig(e,t,s){var r,l;return((l=(r=this.initConfig)==null?void 0:r.config[e])==null?void 0:l[t])||s}doesRoleNeedWebRTC(e){var t,s;if(!this.isFlagEnabled("nonWebRTCDisableOffer"))return!0;let r=!!(e.publishParams.allowed&&((t=e.publishParams.allowed)==null?void 0:t.length)>0),l=!!(e.subscribeParams.subscribeToRoles&&((s=e.subscribeParams.subscribeToRoles)==null?void 0:s.length)>0);return r||l}doesLocalPeerNeedWebRTC(){var e;let t=(e=this.store.getLocalPeer())==null?void 0:e.role;return t?this.doesRoleNeedWebRTC(t):!0}setTransportStateForConnect(){if(this.state==="Failed"&&(this.state="Disconnected"),this.state!=="Disconnected"&&this.state!=="Reconnecting")throw Y.WebsocketMethodErrors.AlreadyJoined("JOIN",`Cannot join a meeting in ${this.state} state`);this.state==="Disconnected"&&(this.state="Connecting",this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let s=this.getAdditionalAnalyticsProperties(),r;switch(t){case 0:r=be.connect(e,s);break;case 1:r=be.disconnect(e,s);break;case 2:r=be.join({error:e,time:this.analyticsTimer.getTimeTaken("join_time"),init_response_time:this.analyticsTimer.getTimeTaken("init_response_time"),ws_connect_time:this.analyticsTimer.getTimeTaken("ws_connect_time"),on_policy_change_time:this.analyticsTimer.getTimeTaken("on_policy_change_time"),local_audio_track_time:this.analyticsTimer.getTimeTaken("local_audio_track_time"),local_video_track_time:this.analyticsTimer.getTimeTaken("local_video_track_time"),retries_join:this.joinRetryCount});break;case 3:r=be.publish({error:e});break;case 4:r=be.subscribeFail(e);break}this.eventBus.analytics.publish(r)}getSubscribeConnection(){return this.subscribeConnection}getAdditionalAnalyticsProperties(){var e,t,s,r,l,u,d,h;let p=ZE(),v=typeof document<"u"&&document.hidden,g=this.store.getRemoteVideoTracks().filter(C=>C.degraded).length,b=(r=(s=(t=(e=this.getWebrtcInternals())==null?void 0:e.getCurrentStats())==null?void 0:t.getLocalPeerStats())==null?void 0:s.publish)==null?void 0:r.bitrate,S=(h=(d=(u=(l=this.getWebrtcInternals())==null?void 0:l.getCurrentStats())==null?void 0:u.getLocalPeerStats())==null?void 0:d.subscribe)==null?void 0:h.bitrate;return{network_info:p,document_hidden:v,num_degraded_tracks:g,bitrate:{publish:b,subscribe:S},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}};function Qg(e){if(!e||e.length===0)throw Y.APIErrors.InvalidTokenFormat("INIT","Token cannot be an empty string or undefined or null");let t=e.split(".");if(t.length!==3)throw Y.APIErrors.InvalidTokenFormat("INIT","Expected 3 '.' separate fields - header, payload and signature respectively");let s=atob(t[1]);try{let r=JSON.parse(s);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(r){throw Y.APIErrors.InvalidTokenFormat("INIT",`couldn't parse to json - ${r.message}`)}}var Wg={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isPreviewCalled:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},tA=class{constructor(){this.TAG="[HMSSdk]:",this.transportState="Disconnected",this.analyticsTimer=new B0,this.sdkState=W({},Wg),this.isDiagnostics=!1,this.playlistSettings={video:{bitrate:Gg},audio:{bitrate:jg}},this.handleAutoplayError=e=>{var t,s;(s=(t=this.errorListener)==null?void 0:t.onError)==null||s.call(t,e)},this.observer={onNotification:e=>{var t;if(e.method==="on-peer-leave-request"){this.handlePeerLeaveRequest(e.params);return}switch(e.method){case"on-policy-change":this.analyticsTimer.end("on_policy_change_time");break;case"peer-list":this.analyticsTimer.end("peer_list_time"),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled);break;case"room-state":this.analyticsTimer.end("room_state_time");break}(t=this.notificationManager)==null||t.handleNotification(e,this.sdkState.isReconnecting)},onConnected:()=>{this.initNotificationManager()},onTrackAdd:e=>{var t;(t=this.notificationManager)==null||t.handleTrackAdd(e)},onTrackRemove:e=>{var t;(t=this.notificationManager)==null||t.handleTrackRemove(e)},onFailure:e=>{var t;(t=this.errorListener)==null||t.onError(e)},onStateChange:(e,t)=>y(this,null,function*(){var s,r;let l=u=>y(this,null,function*(){var d,h;yield this.internalLeave(!0,u),!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&((h=(d=this.errorListener)==null?void 0:d.onError)==null||h.call(d,u)),this.sdkState.isReconnecting=!1});switch(e){case"Preview":case"Joined":this.initNotificationManager(),this.transportState==="Reconnecting"&&((s=this.listener)==null||s.onReconnected());break;case"Failed":yield l(t);break;case"Reconnecting":this.sdkState.isReconnecting=!0,(r=this.listener)==null||r.onReconnecting(t);break}this.transportState=e,k.d(this.TAG,"Transport State Change",this.transportState)})},this.handlePeerLeaveRequest=e=>{var t;let s=e.requested_by?this.store.getPeerById(e.requested_by):void 0,r={roomEnded:e.room_end,reason:e.reason,requestedBy:s};(t=this.listener)==null||t.onRemovedFromRoom(r),this.internalLeave(!1)},this.handlePreviewError=e=>{var t;this.analyticsTimer.end("preview_time"),e&&((t=this.errorListener)==null||t.onError(e)),this.sendPreviewAnalyticsEvent(e),this.sdkState.isPreviewInProgress=!1},this.handleDeviceChange=e=>{var t,s;e.isUserSelection||(k.d(this.TAG,"Device Change event",e),(s=(t=this.deviceChangeListener)==null?void 0:t.onDeviceChange)==null||s.call(t,e),(()=>{var r,l,u,d;if(e.error&&e.type){let h=e.type.includes("audio")?(r=this.localPeer)==null?void 0:r.audioTrack:(l=this.localPeer)==null?void 0:l.videoTrack;(u=this.errorListener)==null||u.onError(e.error),[fe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,fe.TracksErrors.DEVICE_IN_USE,fe.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&h&&(h.setEnabled(!1),(d=this.listener)==null||d.onTrackUpdate(2,h,this.localPeer))}})())},this.handleAudioPluginError=e=>{var t;k.e(this.TAG,"Audio Plugin Error event",e),(t=this.errorListener)==null||t.onError(e)},this.handleError=e=>{var t;k.e(this.TAG,e),(t=this.errorListener)==null||t.onError(e)},this.handleLocalRoleUpdate=e=>y(this,[e],function*({oldRole:t,newRole:s}){var r;this.deviceManager.currentSelection=this.deviceManager.getCurrentSelection(),yield this.transport.handleLocalRoleUpdate({oldRole:t,newRole:s}),yield(r=this.roleChangeManager)==null?void 0:r.handleLocalPeerRoleUpdate({oldRole:t,newRole:s}),yield this.interactivityCenter.whiteboard.handleLocalRoleUpdate()}),this.unpauseRemoteVideoTracks=()=>{this.store.getRemoteVideoTracks().forEach(e=>e.handleTrackUnmute())},this.sendAudioPresenceFailed=()=>{var e;let t=Y.TracksErrors.NoAudioDetected("PREVIEW");k.w(this.TAG,"Audio Presence Failure",this.transportState,t),this.isDiagnostics&&((e=this.listener)==null||e.onError(t))},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish(be.join(Se(W({error:t},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("join_time"),is_preview_called:e,retries_join:this.transport.joinRetryCount})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(be.preview(Se(W({error:e},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("preview_time")})))},this.sendAnalyticsEvent=e=>{this.isDiagnostics||this.analyticsEventsService.queue(e).flush()}}setSessionPeerInfo(e,t){var s,r,l,u;let d=this.store.getRoom();if(!t||!d){k.e(this.TAG,"setSessionPeerInfo> Local peer or room is undefined");return}this.sessionPeerInfo={peer:{peer_id:t.peerId,role:(s=t.role)==null?void 0:s.name,joined_at:((r=t.joinedAt)==null?void 0:r.valueOf())||0,room_name:d.name,session_started_at:((l=d.startedAt)==null?void 0:l.valueOf())||0,user_data:t.customerUserId,user_name:t.name,template_id:d.templateId,session_id:d.sessionId,token:(u=this.store.getConfig())==null?void 0:u.authToken},agent:this.store.getUserAgent(),device_id:$m(),cluster:{websocket_url:e},timestamp:Date.now()}}initNotificationManager(){this.notificationManager||(this.notificationManager=new DE(this.store,this.eventBus,this.transport,this.listener,this.audioListener))}initStoreAndManagers(e){var t,s;if(this.listener=e,this.errorListener=e,this.deviceChangeListener=e,(t=this.store)==null||t.setErrorListener(this.errorListener),this.sdkState.isInitialised){(s=this.notificationManager)==null||s.setListener(this.listener),this.audioSinkManager.setListener(this.listener),this.interactivityCenter.setListener(this.listener),this.transport.setListener(this.listener);return}this.sdkState.isInitialised=!0,this.store=new lE,this.store.setErrorListener(this.errorListener),this.eventBus=new pE,this.pluginUsageTracker=new dE(this.eventBus),this.wakeLockManager=new oE,this.networkTestManager=new sE(this.eventBus,this.listener),this.playlistManager=new sk(this,this.eventBus),this.deviceManager=new hE(this.store,this.eventBus),this.audioSinkManager=new cE(this.store,this.deviceManager,this.eventBus),this.audioOutput=new fE(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new nu(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new uE(this.store),this.transport=new eA(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer,this.pluginUsageTracker),"onInitSuccess"in e&&this.transport.setConnectivityListener(e),this.sessionStore=new wE(this.transport),this.interactivityCenter=new EE(this.transport,this.store,this.listener),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError),this.eventBus.error.subscribe(this.handleError)}validateJoined(e){if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION",`Not connected - ${e}`)}sendHLSAnalytics(e){this.sendAnalyticsEvent(be.hlsPlayerError(e))}refreshDevices(){return y(this,null,function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)})}getWebrtcInternals(){var e;return(e=this.transport)==null?void 0:e.getWebrtcInternals()}getDebugInfo(){var e;if(!this.transport)throw k.e(this.TAG,"Transport is not defined"),new Error("getDebugInfo can only be called after join");let t=this.transport.getWebsocketEndpoint(),s=Object.values(Ry).filter(l=>this.transport.isFlagEnabled(l)),r=(e=this.store.getConfig())==null?void 0:e.initEndpoint;return{websocketURL:t,enabledFlags:s,initEndpoint:r}}getSessionStore(){return this.sessionStore}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return(e=this.store.getRoom())==null?void 0:e.recording}getRTMPState(){var e;return(e=this.store.getRoom())==null?void 0:e.rtmp}getHLSState(){var e;return(e=this.store.getRoom())==null?void 0:e.hls}getTranscriptionState(){var e;return(e=this.store.getRoom())==null?void 0:e.transcriptions}getTemplateAppData(){return this.store.getTemplateAppData()}getInteractivityCenter(){return this.interactivityCenter}getPeerListIterator(e){return new tk(this.transport,this.store,e)}updatePlaylistSettings(e){e.video&&Object.assign(this.playlistSettings.video,e.video),e.audio&&Object.assign(this.playlistSettings.audio,e.audio)}get localPeer(){var e;return(e=this.store)==null?void 0:e.getLocalPeer()}preview(e,t){return y(this,null,function*(){if(Yd(),$d(),this.sdkState.isPreviewInProgress)return Promise.reject(Y.GenericErrors.PreviewAlreadyInProgress("PREVIEW","Preview already called"));if(["Joined","Reconnecting"].includes(this.transportState))return this.midCallPreview(e.asRole,e.settings);this.analyticsTimer.start("preview_time"),this.setUpPreview(e,t);let s=!1,r=!1,l=setTimeout(()=>{var u,d;(!s||!r)&&((d=(u=this.listener)==null?void 0:u.onNetworkQuality)==null||d.call(u,-1))},3e3);return new Promise((u,d)=>{let h=()=>y(this,null,function*(){var p;if(this.localPeer){let b=e.asRole&&this.store.getPolicyForRole(e.asRole);this.localPeer.asRole=b||this.localPeer.role}let v=yield this.localTrackManager.getTracksToPublish(e.settings);v.forEach(b=>{var S;if(this.setLocalPeerTrack(b),b.isTrackNotPublishing()){let C=Y.TracksErrors.NoDataInTrack(`${b.type} track has no data. muted: ${b.nativeTrack.muted}, readyState: ${b.nativeTrack.readyState}`);k.e(this.TAG,C),this.sendAnalyticsEvent(be.publish({devices:this.deviceManager.getDevices(),error:C})),(S=this.listener)==null||S.onError(C)}}),(p=this.localPeer)!=null&&p.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end("preview_time");let g=this.store.getRoom();g&&t.onPreview(g,v),this.sendPreviewAnalyticsEvent(),u()});this.eventBus.policyChange.subscribeOnce(h),this.eventBus.leave.subscribeOnce(this.handlePreviewError),this.eventBus.leave.subscribeOnce(p=>d(p)),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe,e.iceServers).then(p=>{var v;s=!0,clearTimeout(l),p&&e.captureNetworkQualityInPreview&&this.networkTestManager.start((v=p.config)==null?void 0:v.networkHealth).then(()=>{r=!0})}).catch(p=>{this.handlePreviewError(p),d(p)})})})}midCallPreview(e,t){return y(this,null,function*(){var s,r;if(!this.localPeer||this.transportState!=="Joined")throw Y.GenericErrors.NotConnected("VALIDATION","Not connected - midCallPreview");let l=e&&this.store.getPolicyForRole(e);if(!l)throw Y.GenericErrors.InvalidRole("PREVIEW",`role ${e} does not exist in policy`);this.localPeer.asRole=l;let u=yield this.localTrackManager.getTracksToPublish(t);u.forEach(d=>this.setLocalPeerTrack(d)),(s=this.localPeer)!=null&&s.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),(r=this.listener)==null||r.onPreview(this.store.getRoom(),u)})}cancelMidCallPreview(){return y(this,null,function*(){var e,t,s;if((!this.localPeer||!this.localPeer.isInPreview())&&k.w(this.TAG,"Cannot cancel mid call preview as preview is not in progress"),(e=this.localPeer)!=null&&e.asRole&&this.localPeer.role){let r=this.localPeer.asRole,l=this.localPeer.role;delete this.localPeer.asRole,yield(t=this.roleChangeManager)==null?void 0:t.diffRolesAndPublishTracks({oldRole:r,newRole:l}),(s=this.listener)==null||s.onPeerUpdate(8,this.localPeer)}})}join(e,t){return y(this,null,function*(){var s,r,l,u,d,h,p,v;if(Yd(),$d(),this.sdkState.isPreviewInProgress)throw Y.GenericErrors.NotReady("JOIN","Preview is in progress, can't join");(r=(s=this.eventBus)==null?void 0:s.leave)==null||r.unsubscribe(this.handlePreviewError),this.analyticsTimer.start("join_time"),this.sdkState.isJoinInProgress=!0;let{roomId:g,userId:b,role:S}=Qg(e.authToken),C=((u=(l=this.localPeer)==null?void 0:l.asRole)==null?void 0:u.name)||((h=(d=this.localPeer)==null?void 0:d.role)==null?void 0:h.name);(p=this.networkTestManager)==null||p.stop(),this.commonSetup(e,g,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),aa.resumeContext();let D=this.store.getConfig();D!=null&&D.autoManageWakeLock&&this.wakeLockManager.acquireLock(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(S),this.localPeer.customerUserId=b,this.localPeer.metadata=e.metaData,delete this.localPeer.asRole):this.createAndAddLocalPeerToStore(e,S,b),this.roleChangeManager=new rE(this.store,this.transport,this.deviceManager,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),k.d(this.TAG,` Joining room ${g}`),k.time(`join-room-${g}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe,e.iceServers),k.d(this.TAG,` Joined room ${g}`),this.analyticsTimer.start("peer_list_time"),yield this.notifyJoin(),this.sdkState.isJoinInProgress=!1,yield this.publish(e.settings,C)}catch(M){throw this.analyticsTimer.end("join_time"),this.sdkState.isJoinInProgress=!1,(v=this.listener)==null||v.onError(M),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled,M),k.e(this.TAG,"Unable to join room",M),M}k.timeEnd(`join-room-${g}`)})}stringifyMetadata(e){e.metaData&&typeof e.metaData!="string"?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanup(){var e,t,s;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.error.unsubscribe(this.handleError),this.analyticsTimer.cleanup(),Gn.cleanup(),this.playlistManager.cleanup(),(e=this.wakeLockManager)==null||e.cleanup(),nu.cleanup(),this.notificationManager=void 0,k.cleanup(),this.sdkState=W({},Wg),this.localPeer&&((t=this.localPeer.audioTrack)==null||t.cleanup(),this.localPeer.audioTrack=void 0,(s=this.localPeer.videoTrack)==null||s.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanup(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.handleLocalRoleUpdate)}leave(e){return this.internalLeave(e)}internalLeave(e=!0,t){return y(this,null,function*(){var s,r,l,u;let d=(s=this.store)==null?void 0:s.getRoom();if(d){for(;(this.sdkState.isPreviewInProgress||this.sdkState.isJoinInProgress)&&!(t!=null&&t.isTerminal);)yield uu(100);let h=d.id;this.setSessionPeerInfo(this.transport.getWebsocketEndpoint()||"",this.localPeer),(r=this.networkTestManager)==null||r.stop(),this.eventBus.leave.publish(t);let p=(l=this.localPeer)==null?void 0:l.peerId;k.d(this.TAG,` Leaving room ${h}, peerId=${p}`),yield(u=this.transport)==null?void 0:u.leave(e,t?"sdk request":"user request"),this.cleanup(),k.d(this.TAG,` Left room ${h}, peerId=${p}`)}})}getAuthTokenByRoomCode(e,t){return y(this,null,function*(){let s=(t||{}).endpoint||"https://auth.100ms.live/v2/token";this.analyticsTimer.start("GET_TOKEN");let r=yield ky(s,{method:"POST",body:JSON.stringify({code:e.roomCode,user_id:e.userId})},[429,500,501,502,503,504,505,506,507,508,509,510,511]),l=yield r.json();if(this.analyticsTimer.end("GET_TOKEN"),!r.ok)throw Y.APIErrors.ServerErrors(l.code,"GET_TOKEN",l.message,!1);let{token:u}=l;if(!u)throw Error(l.message);return u})}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){return this.store.getPeers()}getPeerMap(){return this.store.getPeerMap()}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return y(this,null,function*(){return yield this.sendMessageInternal({message:e,type:t})})}sendGroupMessage(e,t,s){return y(this,null,function*(){let r=this.store.getKnownRoles();if((t.filter(l=>r[l.name])||[]).length===0)throw Y.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:s})})}sendDirectMessage(e,t,s){return y(this,null,function*(){var r,l;if(((r=this.localPeer)==null?void 0:r.peerId)===t)throw Y.GenericErrors.ValidationFailed("Cannot send message to self");let u=!!((l=this.store.getRoom())!=null&&l.large_room_optimization),d=this.store.getPeerById(t);if(!d)if(u){let h=yield this.transport.signal.getPeer({peer_id:t});if(!h)throw Y.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);d=Zr(h,this.store)}else throw Y.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);return yield this.sendMessageInternal({message:e,recipientPeer:d,type:s})})}submitSessionFeedback(e,t){return y(this,null,function*(){if(!this.sessionPeerInfo)throw k.e(this.TAG,"submitSessionFeedback> session is undefined"),new Error("session is undefined");let s=this.sessionPeerInfo.peer.token;if(!s)throw k.e(this.TAG,"submitSessionFeedback> token is undefined"),new Error("Internal error, token is not present");try{yield Ay.sendFeedback({token:s,info:this.sessionPeerInfo,feedback:e,eventEndpoint:t}),k.i(this.TAG,"submitSessionFeedback> submitted feedback"),this.sessionPeerInfo=void 0}catch(r){throw k.e(this.TAG,"submitSessionFeedback> error occured ",r),new Error("Unable to submit feedback")}})}getPeer(e){return y(this,null,function*(){let t=yield this.transport.signal.getPeer({peer_id:e});if(t)return Zr(t,this.store)})}findPeerByName(e){return y(this,arguments,function*({query:t,limit:s=10,offset:r}){let{peers:l,offset:u,eof:d}=yield this.transport.signal.findPeerByName({query:t==null?void 0:t.toLowerCase(),limit:s,offset:r});return l.length>0?{offset:u,eof:d,peers:l.map(h=>Zr({peer_id:h.peer_id,role:h.role,groups:[],info:{name:h.name,data:"",user_id:"",type:h.type}},this.store))}:{offset:u,peers:[]}})}sendMessageInternal(e){return y(this,arguments,function*({recipientRoles:t,recipientPeer:s,type:r="chat",message:l}){if(l.replace(/\u200b/g," ").trim()==="")throw k.w(this.TAG,"sendMessage","Ignoring empty message send"),Y.GenericErrors.ValidationFailed("Empty message not allowed");let u={info:{message:l,type:r}};return t!=null&&t.length&&(u.roles=t.map(d=>d.name)),s!=null&&s.peerId&&(u.peer_id=s.peerId),k.d(this.TAG,"Sending Message: ",u),yield this.transport.signal.broadcast(u)})}startScreenShare(e,t){return y(this,null,function*(){var s,r,l;let u=this.store.getPublishParams();if(!u)return;let{allowed:d}=u;if(!(d&&d.includes("screen"))){k.e(this.TAG,`Role ${(s=this.localPeer)==null?void 0:s.role} cannot share screen`);return}if((l=(r=this.localPeer)==null?void 0:r.auxiliaryTracks)!=null&&l.find(p=>p.source==="screen"))throw Error("Cannot share multiple screens");let h=yield this.getScreenshareTracks(e,t);if(!this.localPeer){k.d(this.TAG,"Screenshared when not connected"),h.forEach(p=>{p.cleanup()});return}this.transport.setOnScreenshareStop(()=>{this.stopEndedScreenshare(e)}),yield this.transport.publish(h),h.forEach(p=>{var v,g,b;p.peerId=(v=this.localPeer)==null?void 0:v.peerId,(g=this.localPeer)==null||g.auxiliaryTracks.push(p),(b=this.listener)==null||b.onTrackUpdate(0,p,this.localPeer)})})}stopEndedScreenshare(e){return y(this,null,function*(){k.d(this.TAG," Screenshare ended natively"),yield this.stopScreenShare(),e()})}stopScreenShare(){return y(this,null,function*(){var e;k.d(this.TAG," Screenshare ended from app");let t=(e=this.localPeer)==null?void 0:e.auxiliaryTracks.filter(s=>s.source==="screen");if(t)for(let s of t)yield this.removeTrack(s.trackId)})}addTrack(e,t="regular"){return y(this,null,function*(){var s,r,l,u;if(!e){k.w(this.TAG,"Please pass a valid MediaStreamTrack");return}if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find(b=>b.trackId===e.id))return;let d=e.kind,h=new MediaStream([e]),p=new Xr(h),v=d==="audio"?nr:Li,g=new v(p,e,t,this.eventBus);yield this.applySettings(g),yield this.setPlaylistSettings({track:e,hmsTrack:g,source:t}),yield(s=this.transport)==null?void 0:s.publish([g]),g.peerId=(r=this.localPeer)==null?void 0:r.peerId,(l=this.localPeer)==null||l.auxiliaryTracks.push(g),(u=this.listener)==null||u.onTrackUpdate(0,g,this.localPeer)})}removeTrack(e,t=!1){return y(this,null,function*(){var s;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot removeTrack");let r=this.localPeer.auxiliaryTracks.findIndex(l=>l.trackId===e);if(r>-1){let l=this.localPeer.auxiliaryTracks[r];l.isPublished?yield this.transport.unpublish([l]):yield l.cleanup(),t||this.stopPlaylist(l),this.localPeer.auxiliaryTracks.splice(r,1),(s=this.listener)==null||s.onTrackUpdate(1,l,this.localPeer)}else k.w(this.TAG,`No track found for ${e}`)})}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){k.level=e}addAudioListener(e){var t;this.audioListener=e,(t=this.notificationManager)==null||t.setAudioListener(e)}addConnectionQualityListener(e){var t;(t=this.notificationManager)==null||t.setConnectionQualityListener(e)}setIsDiagnostics(e){this.isDiagnostics=e}changeRole(e,t,s=!1){return y(this,null,function*(){var r;yield(r=this.transport)==null?void 0:r.signal.requestRoleChange({requested_for:e,role:t,force:s})})}changeRoleOfPeer(e,t,s=!1){return y(this,null,function*(){var r;yield(r=this.transport)==null?void 0:r.signal.requestRoleChange({requested_for:e,role:t,force:s})})}changeRoleOfPeersWithRoles(e,t){return y(this,null,function*(){var s;e.length<=0||!t||(yield(s=this.transport)==null?void 0:s.signal.requestBulkRoleChange({roles:e.map(r=>r.name),role:t,force:!0}))})}acceptChangeRole(e){return y(this,null,function*(){var t,s;yield(s=this.transport)==null?void 0:s.signal.acceptRoleChangeRequest({requested_by:(t=e.requestedBy)==null?void 0:t.peerId,role:e.role.name,token:e.token})})}endRoom(e,t){return y(this,null,function*(){var s;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot end room");yield(s=this.transport)==null?void 0:s.signal.endRoom(e,t),yield this.leave()})}removePeer(e,t){return y(this,null,function*(){var s;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot remove peer");yield(s=this.transport)==null?void 0:s.signal.removePeer({requested_for:e,reason:t})})}startRTMPOrRecording(e){return y(this,null,function*(){var t,s;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start streaming or recording");let r={meeting_url:e.meetingURL,record:e.record};(t=e.rtmpURLs)!=null&&t.length&&(r.rtmp_urls=e.rtmpURLs),e.resolution&&(r.resolution=e.resolution),yield(s=this.transport)==null?void 0:s.signal.startRTMPOrRecording(r)})}stopRTMPAndRecording(){return y(this,null,function*(){var e;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop streaming or recording");yield(e=this.transport)==null?void 0:e.signal.stopRTMPAndRecording()})}startHLSStreaming(e){return y(this,null,function*(){var t;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start HLS streaming");let s={};e&&e.variants&&e.variants.length>0&&(s.variants=e.variants.map(r=>{let l={meeting_url:r.meetingURL};return r.metadata&&(l.metadata=r.metadata),l})),e!=null&&e.recording&&(s.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield(t=this.transport)==null?void 0:t.signal.startHLSStreaming(s)})}stopHLSStreaming(e){return y(this,null,function*(){var t,s,r;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop HLS streaming");if(e){let l={variants:(t=e==null?void 0:e.variants)==null?void 0:t.map(u=>{let d={meeting_url:u.meetingURL};return u.metadata&&(d.metadata=u.metadata),d})};yield(s=this.transport)==null?void 0:s.signal.stopHLSStreaming(l)}yield(r=this.transport)==null?void 0:r.signal.stopHLSStreaming()})}startTranscription(e){return y(this,null,function*(){var t;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start transcriptions");let s={mode:e.mode};yield(t=this.transport)==null?void 0:t.signal.startTranscription(s)})}stopTranscription(e){return y(this,null,function*(){var t;if(!this.localPeer)throw Y.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop transcriptions");if(!e)throw Y.GenericErrors.Signalling("VALIDATION","No mode is passed to stop the transcription");let s={mode:e.mode};yield(t=this.transport)==null?void 0:t.signal.stopTranscription(s)})}sendHLSTimedMetadata(e){return y(this,null,function*(){var t;if(this.validateJoined("sendHLSTimedMetadata"),e.length>0){let s={metadata_objs:e};yield(t=this.transport)==null?void 0:t.signal.sendHLSTimedMetadata(s)}})}changeName(e){return y(this,null,function*(){var t,s;this.validateJoined("changeName");let r=this.store.getLocalPeer();r&&r.name!==e&&(yield(t=this.transport)==null?void 0:t.signal.updatePeer({name:e}),(s=this.notificationManager)==null||s.updateLocalPeer({name:e}))})}changeMetadata(e){return y(this,null,function*(){var t,s;this.validateJoined("changeMetadata"),yield(t=this.transport)==null?void 0:t.signal.updatePeer({data:e}),(s=this.notificationManager)==null||s.updateLocalPeer({metadata:e})})}setSessionMetadata(e){return y(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.setSessionMetadata({key:"default",data:e})})}getSessionMetadata(){return y(this,null,function*(){var e;return(yield(e=this.transport)==null?void 0:e.signal.getSessionMetadata("default")).data})}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return y(this,null,function*(){var s;if(e.type==="video"&&e.source!=="regular"){k.w(this.TAG,"Muting non-regular video tracks is currently not supported");return}if(e.enabled===t){k.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);return}if(!this.store.getTrackById(e.trackId))throw Y.GenericErrors.ValidationFailed("No track found for change track state",e);let r=this.store.getPeerByTrackId(e.trackId);if(!r)throw Y.GenericErrors.ValidationFailed("No peer found for change track state",e);yield(s=this.transport)==null?void 0:s.signal.requestTrackStateChange({requested_for:r.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})})}changeMultiTrackState(e){return y(this,null,function*(){var t;if(typeof e.enabled!="boolean")throw Y.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:s,roles:r,type:l,source:u}=e;yield(t=this.transport)==null?void 0:t.signal.requestMultiTrackStateChange({value:!s,type:l,source:u,roles:r==null?void 0:r.map(d=>d==null?void 0:d.name)})})}raiseLocalPeerHand(){return y(this,null,function*(){var e;this.validateJoined("raiseLocalPeerHand"),yield(e=this.transport)==null?void 0:e.signal.joinGroup(Kr)})}lowerLocalPeerHand(){return y(this,null,function*(){var e;this.validateJoined("lowerLocalPeerHand"),yield(e=this.transport)==null?void 0:e.signal.leaveGroup(Kr)})}raiseRemotePeerHand(e){return y(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.addToGroup(e,Kr)})}lowerRemotePeerHand(e){return y(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.removeFromGroup(e,Kr)})}setFrameworkInfo(e){this.frameworkInfo=W(W({},this.frameworkInfo),e)}attachVideo(e,t){return y(this,null,function*(){let s=this.store.getConfig();s!=null&&s.autoManageVideo?e.attach(t):yield e.addSink(t)})}detachVideo(e,t){return y(this,null,function*(){let s=this.store.getConfig();s!=null&&s.autoManageVideo?e.detach(t):yield e.removeSink(t)})}publish(e,t){return y(this,null,function*(){var s,r,l;if([this.store.getPublishParams(),!this.sdkState.published,!yh].every(u=>!!u)){let u=t&&t!==((r=(s=this.localPeer)==null?void 0:s.role)==null?void 0:r.name)?()=>{var d;return(d=this.roleChangeManager)==null?void 0:d.diffRolesAndPublishTracks({oldRole:this.store.getPolicyForRole(t),newRole:this.localPeer.role})}:()=>this.getAndPublishTracks(e);yield(l=u==null?void 0:u())==null?void 0:l.catch(d=>{var h;k.e(this.TAG,"Error in publish",d),(h=this.listener)==null||h.onError(d)})}})}getAndPublishTracks(e){return y(this,null,function*(){var t,s;let r=yield this.localTrackManager.getTracksToPublish(e);yield this.initDeviceManagers(),yield this.setAndPublishTracks(r),(s=(t=this.localPeer)==null?void 0:t.audioTrack)==null||s.initAudioLevelMonitor(),this.sdkState.published=!0})}setAndPublishTracks(e){return y(this,null,function*(){var t,s;for(let r of e){if(yield this.transport.publish([r]),r.isTrackNotPublishing()){let l=Y.TracksErrors.NoDataInTrack(`${r.type} track has no data. muted: ${r.nativeTrack.muted}, readyState: ${r.nativeTrack.readyState}`);k.e(this.TAG,l),this.sendAnalyticsEvent(be.publish({devices:this.deviceManager.getDevices(),error:l})),(t=this.listener)==null||t.onError(l)}yield this.setLocalPeerTrack(r),(s=this.listener)==null||s.onTrackUpdate(0,r,this.localPeer)}})}setLocalPeerTrack(e){return y(this,null,function*(){var t;switch(e.peerId=(t=this.localPeer)==null?void 0:t.peerId,e.type){case"audio":this.localPeer.audioTrack=e,yield this.deviceManager.autoSelectAudioOutput();break;case"video":this.localPeer.videoTrack=e;break}})}initDeviceManagers(){return y(this,null,function*(){var e,t,s,r,l;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice((t=(e=this.store.getConfig())==null?void 0:e.settings)==null?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice((r=(s=Gn.getSelection())==null?void 0:s.audioOutput)==null?void 0:r.deviceId)),this.audioSinkManager.init((l=this.store.getConfig())==null?void 0:l.audioSinkElementId))})}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanup(),this.audioSinkManager.cleanup()}initPreviewTrackAudioLevelMonitor(){var e;let t=(e=this.localPeer)==null?void 0:e.audioTrack;t==null||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(s=>{var r;let l=s&&s.track.trackId===(t==null?void 0:t.trackId)?[{audioLevel:s.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(l),(r=this.audioListener)==null||r.onAudioLevelUpdate(l)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),s=this.store.getRoom();if(!s){k.w(this.TAG,"notify join - room not present");return}if(s.joinedAt=new Date,t&&(t.joinedAt=s.joinedAt),t!=null&&t.role){this.analyticsTimer.end("join_time"),(e=this.listener)==null||e.onJoin(s);return}return new Promise((r,l)=>{this.eventBus.policyChange.subscribeOnce(()=>{var u;this.analyticsTimer.end("join_time"),(u=this.listener)==null||u.onJoin(s),r()}),this.eventBus.leave.subscribeOnce(u=>{l(u)})})}setUpPreview(e,t){this.sdkState.isPreviewCalled=!0,this.sdkState.isPreviewInProgress=!0;let{roomId:s,userId:r,role:l}=Qg(e.authToken);this.commonSetup(e,s,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,l,r,e.asRole)}setPlaylistSettings(e){return y(this,arguments,function*({track:t,hmsTrack:s,source:r}){var l,u;if(r==="videoplaylist"){let d={};if(t.kind==="audio")d.maxBitrate=((l=this.playlistSettings.audio)==null?void 0:l.bitrate)||jg;else{d.maxBitrate=((u=this.playlistSettings.video)==null?void 0:u.bitrate)||Gg;let{width:h,height:p}=t.getSettings();d.width=h,d.height=p}yield s.setSettings(d)}else r==="audioplaylist"&&(yield s.setSettings({maxBitrate:64}))})}createAndAddLocalPeerToStore(e,t,s,r){let l=this.store.getPolicyForRole(t),u=r?this.store.getPolicyForRole(r):void 0,d=new ay({name:e.userName||"",customerUserId:s,metadata:e.metaData||"",role:l,asRole:u||l,type:"regular"});this.store.addPeer(d)}commonSetup(e,t,s){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.initStoreAndManagers(s),this.store.getRoom()||this.store.setRoom(new Ty(t))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return y(this,null,function*(){let s=this.transport.isFlagEnabled("scaleScreenshareBasedOnPixels"),[r,l]=yield this.localTrackManager.getLocalScreen(t,s),u=()=>{this.stopEndedScreenshare(e)},d=[];if(t!=null&&t.audioOnly){if(r.nativeTrack.stop(),!l)throw Y.TracksErrors.NothingToReturn("TRACK","Select share audio when sharing screen","No audio found");d.push(l),l.nativeTrack.addEventListener("ended",u)}else d.push(r),r.nativeTrack.addEventListener("ended",u),l&&d.push(l);return d})}stopPlaylist(e){e.source==="audioplaylist"?this.playlistManager.stop("audio"):e.source==="videoplaylist"&&this.playlistManager.stop("video")}applySettings(e){return y(this,null,function*(){t0(this.store);let t=this.store.getPublishParams();if(t){if(e instanceof Li){let s=e.source==="regular"?"video":e.source==="screen"?"screen":"";if(!s||!t.allowed.includes(s))return;let r=t[s];if(!r)return;let l=new Ss().codec(r.codec).maxBitrate(r.bitRate).maxFramerate(r.frameRate).setWidth(r.width).setHeight(r.height).build();yield e.setSettings(l)}else if(e instanceof nr){if(!t.allowed.includes("audio"))return;let s=new jn().codec(t.audio.codec).maxBitrate(t.audio.bitRate).build();yield e.setSettings(s)}}})}},Oy=class tr{constructor(t,s,r){this.getStats=()=>(this.stats||(this.stats=new aA(this.store,this.sdk)),this.stats),this.getDiagnosticsSDK=()=>(this.diagnostics||(this.diagnostics=this.actions.initDiagnostics()),this.diagnostics),t?this.store=t:this.store=tr.createNewHMSStore(Ey("HMSStore"),xm),r?this.notifications=r:this.notifications=new Gk(this.store),s?this.actions=s:(this.sdk=new tA,this.actions=new nE(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Um().version}),this.initialTriggerOnSubscribe=!1,Ii&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(tr.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(t,s){let r=_T(()=>s()),l=r.setState;r.setState=h=>{let p=typeof h=="function"?CT(h):h;l(p)};let u=r.getState;r.getState=h=>h?h(u()):u(),tr.compareWithShallowCheckInSubscribe(r);let d=tr.setUpDevtools(r,t);return Se(W({},r),{namedSetState:d})}static makeStoreTriggerOnSubscribe(t){let s=t.subscribe;t.subscribe=(r,l,u)=>(r(t.getState(l),void 0),s(r,l,u))}static compareWithShallowCheckInSubscribe(t){let s=t.subscribe;t.subscribe=(r,l,u)=>(l||(l=d=>d),u=u||RT,s(r,l,u))}static setUpDevtools(t,s){let r;try{r=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!r)return d=>{t.setState(d)};let l=r.connect(tr.devtoolsOptions(s));l.prefix=s?`${s} > `:"";let u=t.setState;return t.setState=d=>{u(d),l.send(`${l.prefix}setState`,t.getState())},l.subscribe(tr.devtoolsSubscribe(l,t,u)),l.send("setUpStore",t.getState()),(d,h)=>{u(d);let p=h||`${l.prefix}action`;l.send(p,t.getState())}}static devtoolsOptions(t){return{name:t,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(t,s,r){return l=>{var u,d,h,p;if(l.type==="DISPATCH"&&l.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(l.payload.type)?r(JSON.parse(l.state)):s.setState(JSON.parse(l.state));else if(l.type==="DISPATCH"&&((u=l.payload)==null?void 0:u.type)==="COMMIT")t.init(s.getState());else if(l.type==="DISPATCH"&&((d=l.payload)==null?void 0:d.type)==="IMPORT_STATE"){let v=(h=l.payload.nextLiftedState)==null?void 0:h.actionsById;(((p=l.payload.nextLiftedState)==null?void 0:p.computedStates)||[]).forEach(({state:g},b)=>{let S=v[b]||`${t.prefix}setState`;b===0?t.init(g):(r(g),t.send(S,s.getState()))})}}}},iA=(e,t,s)=>{let r;s.getState(cn)==="Connected"&&(r=Jg(e,t,s)),s.subscribe(l=>{["Connected","Reconnecting"].includes(l)?r||(r=Jg(e,t,s)):["Disconnected","Failed"].includes(l)&&r&&(rA(t,l),r(),r=void 0)},cn)},Jg=(e,t,s)=>{var r,l;let u=nA(s,t);(r=e.getWebrtcInternals())==null||r.start();let d=(l=e.getWebrtcInternals())==null?void 0:l.onStatsChange(h=>sA(t,h,s,e));return()=>{u(),d&&d()}},nA=(e,t)=>{let s,r,l;return e.getState(ea)?t.namedSetState(u=>{u.localPeer.id=e.getState(ea)},"localpeer-id"):s=e.subscribe(u=>{u&&t.namedSetState(d=>{d.localPeer.id=u},"localpeer-id")},ea),e.getState(Wi)?t.namedSetState(u=>{u.localPeer.videoTrack=e.getState(Wi)},"localpeer-videotrack-id"):r=e.subscribe(u=>{u&&t.namedSetState(d=>{d.localPeer.videoTrack=u},"localpeer-videotrack-id")},Wi),e.getState(xn)?t.namedSetState(u=>{u.localPeer.audioTrack=e.getState(xn)},"localpeer-audiotrack-id"):l=e.subscribe(u=>{u&&t.namedSetState(d=>{d.localPeer.audioTrack=u},"localpeer-audiotrack-id")},xn),()=>{s==null||s(),r==null||r(),l==null||l()}},sA=(e,t,s,r)=>{let l=s.getState(yt);e.namedSetState(u=>{let d=s.getState(ea),h={},p=Object.keys(l).filter(g=>l[g].peerId!==d);for(let g of p){let b=t.getRemoteTrackStats(g);b&&(h[g]=b)}Vg(u.remoteTrackStats,h);let v={[d]:t.getLocalPeerStats()};Vg(u.peerStats,v),Fk(u.localTrackStats,t.getLocalTrackStats(),r.store.getLocalPeerTracks())},"webrtc-stats")},rA=(e,t="resetState")=>{e.namedSetState(s=>{Object.assign(s,Bm())},t)},aA=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=Oy.createNewHMSStore(Ey("HMSStatsStore"),Bm),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(s=>{var r,l;this.hmsStore.getState(cn)==="Connected"?s((l=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:l.getPublishPeerConnection()):this.hmsStore.subscribe(u=>{var d,h;u==="Connected"&&s((h=(d=this.sdk)==null?void 0:d.getWebrtcInternals())==null?void 0:h.getPublishPeerConnection())},cn)}),this.getSubscribePeerConnection=()=>new Promise(s=>{var r,l;this.hmsStore.getState(cn)==="Connected"?s((l=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:l.getSubscribePeerConnection()):this.hmsStore.subscribe(u=>{var d,h;u==="Connected"&&s((h=(d=this.sdk)==null?void 0:d.getWebrtcInternals())==null?void 0:h.getSubscribePeerConnection())},cn)}),this.sdk&&iA(this.sdk,this.store,this.hmsStore)}},lA=e=>e.localPeer.id,oA=e=>e.localPeer.audioTrack,uA=e=>e.localPeer.videoTrack,cA=(e,t)=>t,Ly=(e,t)=>t,dA=e=>e.remoteTrackStats,Iy=e=>e.peerStats,wh=e=>e.localTrackStats,As=Z([Iy,lA],(e,t)=>e[t]);Z(As,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.packetsLost});Z(As,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.jitter});Z(As,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bitrate});Z(As,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bitrate});Z(As,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.availableOutgoingBitrate});Z(As,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.availableIncomingBitrate});Z(As,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bytesSent});Z(As,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bytesReceived});Z([Iy,cA],(e,t)=>t?e[t]:void 0);Z([dA,Ly],(e,t)=>t?e[t]:void 0);var Ny=Z([wh,Ly],(e,t)=>t?e[t]:void 0);Z([wh,oA],(e,t)=>{var s;return t?(s=e[t])==null?void 0:s[0]:void 0});Wt(Z(Ny,e=>e==null?void 0:e[0]));Z([wh,uA],(e,t)=>{var s;return t?(s=e[t])==null?void 0:s[0]:void 0});Wt(Z(Ny,e=>e));function hA(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(let r=0;r<s.length;r++)if(!Object.prototype.hasOwnProperty.call(t,s[r])||!Object.is(e[s[r]],t[s[r]]))return!1;return!0}var mi,Oi;(Oi=mi||(mi={}))[Oi.VERBOSE=0]="VERBOSE",Oi[Oi.DEBUG=1]="DEBUG",Oi[Oi.INFO=2]="INFO",Oi[Oi.WARN=3]="WARN",Oi[Oi.ERROR=4]="ERROR",Oi[Oi.NONE=5]="NONE";class Uy{static v(t,...s){this.log(mi.VERBOSE,t,...s)}static d(t,...s){this.log(mi.DEBUG,t,...s)}static i(t,...s){this.log(mi.INFO,t,...s)}static w(t,...s){this.log(mi.WARN,t,...s)}static e(t,...s){this.log(mi.ERROR,t,...s)}static log(t,s,...r){if(!(this.level.valueOf()>t.valueOf()))switch(t){case mi.VERBOSE:console.log("HMSui-components: ",s,...r);break;case mi.DEBUG:console.debug("HMSui-components: ",s,...r);break;case mi.INFO:console.info("HMSui-components: ",s,...r);break;case mi.WARN:console.warn("HMSui-components: ",s,...r);break;case mi.ERROR:console.error("HMSui-components: ",s,...r)}}}Uy.level=mi.VERBOSE;var gl=Uy;const xy=`It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://www.100ms.live/docs/javascript/v2/how-to-guides/install-the-sdk/integration#react-hooks) to check on the required steps for using this hook. If the provider is present
  at the top level, check the yarn.lock/package-lock.json, if there are multiple versions of @100mslive/react-sdk. Please ensure the versions of @100mslive/react-sdk and @100mslive/roomkit-react are the same versions from the release notes(https://www.100ms.live/docs/javascript/v2/changelog/release-notes) that you are trying to update to.`;function fA(e){return(t,s=hA)=>{t||gl.w("fetching full store without passing any selector may have a heavy performance impact on your website.");const r=Xe.useContext(e);if(!r)throw new Error(xy);return(0,r.store)(t,s)}}const pA=typeof window<"u",Mh=Xe.createContext(null),vA=({children:e,actions:t,store:s,notifications:r,stats:l,isHMSStatsOn:u=!1,leaveOnUnload:d=!0})=>{const h=Xe.useMemo(()=>{let p;const v=()=>{throw new Error("modifying store is not allowed")};if(t&&s)p={actions:t,store:Uo(Object.assign(Object.assign({},s),{setState:v,destroy:v}))},r&&(p.notifications=r),l&&(p.statsStore=Uo({getState:l.getState,subscribe:l.subscribe,setState:v,destroy:v}));else{const g=new Oy;if(p={actions:g.getActions(),store:Uo(Object.assign(Object.assign({},g.getStore()),{setState:v,destroy:v})),notifications:g.getNotifications()},u){const b=g.getStats();p.statsStore=Uo({getState:b.getState,subscribe:b.subscribe,setState:v,destroy:v})}}return p.actions.setFrameworkInfo({type:"react-web",version:$v.version,sdkVersion:"0.10.32"}),p},[t,s,r,l,u]);return Xe.useEffect(()=>{if(pA&&d){const p=()=>h.actions.leave();return window.addEventListener("unload",p),()=>{window.removeEventListener("unload",p)}}return()=>{}},[d,h]),$v.createElement(Mh.Provider,{value:h},e)},ir=fA(Mh),pu=()=>{const e=Xe.useContext(Mh);if(!e)throw new Error(xy);return e.actions};function ml(e,t,s,r){return new(s||(s=Promise))(function(l,u){function d(v){try{p(r.next(v))}catch(g){u(g)}}function h(v){try{p(r.throw(v))}catch(g){u(g)}}function p(v){var g;v.done?l(v.value):(g=v.value,g instanceof s?g:new s(function(b){b(g)})).then(d,h)}p((r=r.apply(e,[])).next())})}const gA=(e,t)=>gl.e("react-sdk",t,e);["blink"].some(e=>{var t,s;return((s=(t=Bn.getEngine())===null||t===void 0?void 0:t.name)===null||s===void 0?void 0:s.toLowerCase())===e});const mA=(e=gA)=>{const t=ir(fk),s=ir(Zd),r=ir(cy),l=ir(r?xk:Uk),u=pu(),d=Xe.useCallback(()=>ml(void 0,void 0,void 0,function*(){try{yield u.setLocalAudioEnabled(!t)}catch(p){e(p,"toggleAudio")}}),[u,t,e]),h=Xe.useCallback(()=>ml(void 0,void 0,void 0,function*(){try{yield u.setLocalVideoEnabled(!s)}catch(p){e(p,"toggleVideo")}}),[u,s,e]);return{isLocalAudioEnabled:t,isLocalVideoEnabled:s,toggleAudio:l!=null&&l.audio?d:void 0,toggleVideo:l!=null&&l.video?h:void 0}},yA=({trackId:e,attach:t})=>{const s=pu(),r=Xe.useRef(null),l=ir(gy(e)),u=Xe.useRef(),d=Xe.useCallback(h=>{h&&(r.current=h)},[]);return Xe.useEffect(()=>{u.current?l!=null&&l.id&&u.current!==(l==null?void 0:l.id)&&ml(void 0,void 0,void 0,function*(){if(r.current)try{gl.d("detaching because different track is passed"),yield s.detachVideo(u.current,r.current)}catch(h){gl.w("detach video error for track",u.current,h)}u.current=l==null?void 0:l.id}):u.current=l==null?void 0:l.id},[l==null?void 0:l.id,s]),Xe.useEffect(()=>{ml(void 0,void 0,void 0,function*(){l!=null&&l.id&&r.current&&(t!==!1?yield s.attachVideo(l.id,r.current):yield s.detachVideo(l.id,r.current))})},[l,t,s]),Xe.useEffect(()=>()=>{ml(void 0,void 0,void 0,function*(){if(r.current&&l)try{yield s.detachVideo(l.id,r.current)}catch(h){gl.w("detach video error for track",l.id,h)}})},[]),{videoRef:d}};function bA(){const e=pu(),[t,s]=Xe.useState({userName:"",roomCode:"rll-rayp-uef"}),r=u=>{s(d=>({...d,[u.target.name]:u.target.value}))},l=async u=>{u.preventDefault();const{userName:d="",roomCode:h=""}=t,p=await e.getAuthTokenByRoomCode({roomCode:h});try{await e.join({userName:d,authToken:p})}catch(v){console.error(v)}};return it.jsxs("form",{onSubmit:l,children:[it.jsx("h2",{children:"Join Room"}),it.jsx("div",{className:"input-container",children:it.jsx("input",{required:!0,value:t.userName,onChange:r,id:"user-name",type:"text",name:"userName",placeholder:"Your name"})}),it.jsx("div",{className:"input-container",children:it.jsx("input",{required:!0,value:t.roomCode,onChange:r,id:"room-code",type:"text",name:"roomCode",placeholder:"Room code"})}),it.jsx("button",{className:"btn-primary",children:"Join"})]})}function SA({peer:e}){const{videoRef:t}=yA({trackId:e.videoTrack});return it.jsxs("div",{className:"peer-container",children:[it.jsx("video",{ref:t,className:`peer-video ${e.isLocal?"local":""}`,autoPlay:!0,muted:!0,playsInline:!0}),it.jsxs("div",{className:"peer-name",children:[e.name," ",e.isLocal?"(You)":""]})]})}function TA(){const e=ir(du);return it.jsxs("div",{className:"conference-section",children:[it.jsx("h2",{children:"Conference"}),it.jsx("div",{className:"peers-container",children:e.map(t=>it.jsx(SA,{peer:t},t.id))})]})}function kA(){const{isLocalAudioEnabled:e,isLocalVideoEnabled:t,toggleAudio:s,toggleVideo:r}=mA();return it.jsxs("div",{className:"control-bar",children:[it.jsx("button",{className:"btn-control",onClick:s,children:e?"Mute":"Unmute"}),it.jsx("button",{className:"btn-control",onClick:r,children:t?"Hide":"Unhide"})]})}function EA(){const e=ir(sr),t=pu();return Xe.useEffect(()=>{window.onunload=()=>{e&&t.leave()}},[t,e]),it.jsx("div",{className:"App",children:e?it.jsxs(it.Fragment,{children:[it.jsx(TA,{}),it.jsx(kA,{})]}):it.jsx(bA,{})})}GS.createRoot(document.getElementById("root")).render(it.jsx(Xe.StrictMode,{children:it.jsx(vA,{children:it.jsx(EA,{})})}));
